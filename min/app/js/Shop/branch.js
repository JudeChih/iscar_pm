var nowBranchType=localStorage.getItem("listtype"),nowAddImgType,shopcoupon_num=0,nowTab,nowSd_id,carModelArray,modelIndex,branch_menu="0",branch_cate=localStorage.getItem("cate"),map,full_map,markers=[],prev=!1,prev_infowindow,nowCenter,nowMode="list",calendarReservation,order_swiper,order_totalcount=0,now_page_picker,settle_accounts_swiper,settle_accounts_totalcount=0,settle_accounts_picker,billingtype=1,now_scm_id,now_scl_id,mgrid,isOpen,doc,branchObj={dataUrl:{shoplistquery:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shop/shoplistquery",shopcontentquery:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shop/shopcontentquery",shopdatabind:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shop/shopdatabind",shopbasicdataupdate:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shop/shopbasicdataupdate",shopcouponlistquery:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponlistquery",shopcouponmanager:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponmanager",shopcouponcontentquery:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponcontentquery",shopcouponget:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponget",shopcouponrecorver:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponrecorver",shopcouponreservationinfo:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponreservationinfo",shopcouponreservationbook:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponreservationbook",shopcouponscan:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponscan",shopcouponexec:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponexec",shopcouponabandon:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponabandon",shopcouponreservationquery:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/shopcouponreservationquery",query_reservationreplystatus:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/query_reservationreplystatus",update_couponreplystatus:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopcoupon/update_couponreplystatus",shopquestionnaire_read:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopquestionnaire/shopquestionnaire_read",shopquestionnaire_ans:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopquestionnaire/shopquestionnaire_ans",shopquestionnaire_result:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopquestionnaire/shopquestionnaire_result",shopquestionnaire_response:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopquestionnaire/shopquestionnaire_response",shopservicelistquery:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicelistquery",shopservicemanage:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicemanage",shopservicecontentquery:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicecontentquery",shoponoffoperation:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shoponoffoperation",shopservicefunctionadjust:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicefunctionadjust",shopservicequeask:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicequeask",shopservicequequery:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicequequery",shopqueuenoshow:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopqueuenoshow",shopservicecallup:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicecallup",shopqueueovercall:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopqueueovercall",shopservicequerecorver:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicequerecorver",shopservicequeabandom:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicequeabandom",shopservicescan:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopservicescan",shopserviceexec:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopserviceexec",shopserviceclientreply:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopservice/shopserviceclientreply",postshopdata:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/carnews/postshopdata",queryshopbonusitem:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopmanage/queryshopbonusitem",postshopbonusmamager:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopmanage/postshopbonusmamager",querymemberidinfo:"http://"+stringObj.MEMBER_URL+":"+stringObj.PORT+"/api/querymemberidinfo",postshopcomsumebonus:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopmanage/postshopcomsumebonus",query_shopmember:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shop/query_shopmember",queryshopclerklist:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopmanage/queryshopclerklist",postshopclerkmanager:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopmanage/postshopclerkmanager",querymembershopbonus:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shopmanage/querymembershopbonus",queryshoppushrecord:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shoppush/queryshoppushrecord",queryshoppushcontent:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shoppush/queryshoppushcontent",queryshopservicefee:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shoppush/queryshopservicefee",pushshopad2member:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shoppush/pushshopad2member",pushshopad2nonmember:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shoppush/pushshopad2nonmember",querypushnonmember:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shoppush/querypushnonmember",querymembercoininfo:"http://"+stringObj.BANK_URL+":"+stringObj.PORT+"/iscar-api/allpoint/getdata",query_advancedata:"http://"+stringObj.MEMBER_URL+":"+stringObj.PORT+"/api/query_advancedata",query_relativelist:"http://"+stringObj.MEMBER_URL+":"+stringObj.PORT+"/api/query_relativelist",modify_relative:"http://"+stringObj.MEMBER_URL+":"+stringObj.PORT+"/api/modify_relative",querytplproduct:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/blesstemple/querytplproduct",createtplsales:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/blesstemple/createtplsales",modifytplsales:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/blesstemple/modifytplsales",createblessreport:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/blesstemple/createblessreport",createblesslightreport:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/blesstemple/createblesslightreport",shopadvanceupdate:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shop/shopadvanceupdate",querycannedmessagelist:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/cannedmessage/querycannedmessagelist",modifycannedmessage:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/cannedmessage/modifycannedmessage",createlogisticsdata:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/createlogisticsdata",createpaymentflow:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/createpaymentflow",updatescgpayment:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/updatescgpayment",queryshopsalesoverview:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/shop/queryshopsalesoverview",queryorderlist:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/queryorderlist",queryordercontent:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/queryordercontent",printdeliverorder:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/printdeliverorder",querysclid:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/querysclid",reportcargopack:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/reportcargopack",reportsentlogistics:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/reportsentlogistics",reportcargoarrive:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/reportcargoarrive",updateshopdatapayment:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/updateshopdatapayment",paysuccesstopush:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/logistics/paysuccesstopush",query_member_car_list:"http://"+stringObj.MEMBER_URL+":"+stringObj.PORT+"/api/query_member_car_list",query_member_car_detail:"http://"+stringObj.MEMBER_URL+":"+stringObj.PORT+"/api/query_member_car_detail",query_reservationpausedlist:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/reservationpaused/query_reservationpausedlist",create_reservationpaused:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/reservationpaused/create_reservationpaused",delete_reservationpaused:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/reservationpaused/delete_reservationpaused",query_couponreservation_year:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/reservationpaused/query_couponreservation_year",verify_memberseccode:"http://"+stringObj.MEMBER_URL+":"+stringObj.PORT+"/api/vrf/verify_memberseccode",modify_memberseccode:"http://"+stringObj.MEMBER_URL+":"+stringObj.PORT+"/api/modify_memberseccode",query_shopsettlementrec_m_list:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/settlementrec/query_shopsettlementrec_m_list",query_shopsettlementrec_m:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/settlementrec/query_shopsettlementrec_m",query_shopsettlementrec_d_list:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/settlementrec/query_shopsettlementrec_d_list",update_settlementview:"http://"+stringObj.API_IP+":"+stringObj.PORT+"/settlementrec/update_settlementview",FTP_HOST:stringObj.FTP_HOST,FTP_PATH_BRANCH:"/shopdata",FTP_TEMPPRARY_PATH:"temporary/"},_menuList:[{name:stringObj.branchMenu.branch_cooperative,list:[{name:stringObj.branchMenu.car_cosmetology,spm_serno:"2"},{name:stringObj.branchMenu.car_repair,spm_serno:"3"}]}],storage:{shop_report_data:"shop_report_data",branchData:"branchData",shopCouponRecord:"shopCouponRecord",branchScanRecord:"branchScanRecord",alarmInfo:"alarmInfo",nextNumObj:"nextNumObj",callTimeObj:"callTimeObj",shopServiceRecord:"shopServiceRecord",searchRegion:"searchRegion",searchShopName:"searchShopName",applicationData:"applicationData",imagePath:"imagePath",md_id_array:"md_id_array",push_objectfillter:"push_objectfillter",today_push:"today_push",my_relatives:"my_relatives",blessed_relatives:"blessed_relatives",temple_products:"temple_products",shop_data:"shop_data",commodity_data:"commodity_data",save_data:"save_data",search_result:"search_result",reservationbook:"reservationbook"},firstId:null,listId:null,listLoading:!1,refreshLoading:!1,distance:"",branchMainInit:function(e){var t=e.query,a=indexObj._dataStorage(branchObj.storage.branchData)||{};t.sd_id&&(a.sd_id=t.sd_id,a.sd_type="shop",indexObj._dataStorage(branchObj.storage.branchData,a),Cookies.set("shoplist",1),Cookies.set("branchData",t.sd_id));var s=indexObj._dataStorage(branchObj.storage.today_push)||[];JSON.stringify(s).match(a.sd_id)||(s.push({sd_id:a.sd_id,push_times:0,last_update_date:"2000/01/01"}),indexObj._dataStorage(branchObj.storage.today_push,s));var r=indexObj._dataStorage(indexObj._storage.myshopdata)||[];findArrayItem(r,"sd_id",a.sd_id),$(".navbar .center").html(r[nowIndex].sd_shopname);var i=new Date,n=i.getMonth()+1,o=i.getDate();n<10&&(n="0"+n),o<10&&(o="0"+o),branchObj.shopcouponreservationquery(a.sd_id,i.getFullYear()+"-"+n+"-"+o,9)},shopadvanceupdate:function(e){var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage(branchObj.storage.shop_data)||{};for(var s in a.sd_advancedata)a.sd_advancedata[s].content_img&&a.sd_advancedata[s].content_img.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(a.sd_advancedata[s].content_img=a.sd_advancedata[s].content_img.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length),indexObj._dataStorage(branchObj.storage.shop_data,a));a=indexObj._dataStorage(branchObj.storage.shop_data)||{};var r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:e,sd_advancedata:JSON.stringify(a.sd_advancedata)};indexObj._wcfget({url:branchObj.dataUrl.shopadvanceupdate,para:r,success:function(t){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(t),t.shopadvanceupdateresult){var s=JSON.parse(JSON.stringify(t.shopadvanceupdateresult));if("000000000"===s.message_no){if(void 0!==Cookies.get("app_version"))if(isMobile.Android()){if(a.sd_advancedata&&a.sd_advancedata.length>0)for(var r in a.sd_advancedata)a.sd_advancedata[r].content_img&&webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,a.sd_advancedata[r].content_img,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","")}else if(isMobile.iOS()&&a.sd_advancedata){var i=[];if(a.sd_advancedata.length>0)for(var r in a.sd_advancedata)a.sd_advancedata[r].content_img&&i.push(a.sd_advancedata[r].content_img);webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,i,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",[])}indexObj._dataStorage(branchObj.storage.shop_data,null),myApp.modal({title:stringObj.text.editFinish,text:"是否前往預覽",buttons:[{text:stringObj.text.cancel,onClick:function(){var t=indexObj._dataStorage(indexObj._storage.myshopdata)||[];findArrayItem(t,"sd_id",e),"1"==t[nowIndex].smb_shoptype?mainView.router.load({url:"used-car/publish-management?sd_id="+e}):"0"==t[nowIndex].smb_shoptype&&mainView.router.load({url:"shop/branch-main"})}},{text:stringObj.text.confirm,onClick:function(){var t=indexObj._dataStorage(indexObj._storage.myshopdata)||[];findArrayItem(t,"sd_id",e),"1"==t[nowIndex].smb_shoptype?mainView.router.load({url:"used-car/used-car-branch-info?sd_id="+e,reload:!0}):"0"==t[nowIndex].smb_shoptype?(localStorage.setItem("pageInit","shop/branch-info-edit"),window.location="pm/branch-info?sd_id="+e):"99"==t[nowIndex].smb_shoptype&&mainView.router.load({url:"temple-info?sd_id="+e+"&from=preview"})}}]})}else stringObj.return_header(s.message_no),_tip&&(myApp.alert(_tip+"( "+s.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},branchInfoEditInit:function(e){e.query;var t=indexObj._dataStorage(branchObj.storage.branchData)||{};branchObj.branchInfoGet(t.sd_id,""),$(".edit").click(function(){$(".branch-name").removeClass("lengthError"),$(".branch-tel").removeClass("lengthError"),$(".user-name").removeClass("lengthError"),$(".user-email").removeClass("lengthError"),$(".user-tel").removeClass("lengthError"),$(".user-phone").removeClass("lengthError"),$(".user-address").removeClass("lengthError"),$(".branch-address").removeClass("lengthError"),$(".user-email").removeClass("formatError"),$(".branch-name").removeClass("spacesError"),$(".branch-tel").removeClass("spacesError"),$(".branch-address").removeClass("spacesError"),$(".branch-name").removeClass("nullError"),$(".branch-tel").removeClass("nullError"),$(".branch-date").removeClass("nullError"),$(".branch-time").removeClass("nullError"),$(".branch-region").removeClass("nullError"),$(".branch-address").removeClass("nullError"),$(".user-name").removeClass("nullError"),$(".noSetImg").css("display","none");var e=$(".page:not(.cached) #branch-name").val(),t=$(".page:not(.cached) #branch-tel").val(),a=$(".branchDate").val(),s=$(".branchTime").val(),r=$(".branchRegion").val(),i=$(".page:not(.cached) #branch-address").val(),n=$(".page:not(.cached) #branch-info").val(),o=$(".page:not(.cached) #user-name").val(),c=$(".page:not(.cached) #user-email").val(),l=$(".page:not(.cached) #user-tel").val(),d=$(".page:not(.cached) #user-phone").val(),p=$(".page:not(.cached) #user-address").val(),m=!1;-1==c.search(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i)&&""!==c&&($(".user-email").addClass("formatError"),m=!0),4>t.length>10&&($(".branch-tel").addClass("lengthError"),m=!0),o.length>20&&($(".user-name").addClass("lengthError"),m=!0),4>l.length>20&&($(".user-tel").addClass("lengthError"),m=!0),10!=d.length&&""!=d&&($(".user-phone").addClass("lengthError"),m=!0),p.length>100&&($(".user-address").addClass("lengthError"),m=!0),e.length>20&&($(".branch-name").addClass("lengthError"),m=!0),c.length>50&&($(".user-email").addClass("lengthError"),m=!0),i.length>100&&($(".branch-address").addClass("lengthError"),m=!0),-1!==e.indexOf(" ")&&($(".branch-name").addClass("spacesError"),m=!0),-1!==t.indexOf(" ")&&($(".branch-tel").addClass("spacesError"),m=!0),-1!==i.indexOf(" ")&&($(".branch-address").addClass("spacesError"),m=!0);var u=indexObj._dataStorage(branchObj.storage.branchData);if(""===u.sd_shopphotopath&&($(".noSetImg").css("display","inherit"),m=!0),""===e&&($(".branch-name").addClass("nullError"),m=!0),""===t&&($(".branch-tel").addClass("nullError"),m=!0),""===a&&($(".branch-date").addClass("nullError"),m=!0),""===s&&($(".branch-time").addClass("nullError"),m=!0),""===r&&($(".branch-region").addClass("nullError"),m=!0),""===i&&($(".branch-address").addClass("nullError"),m=!0),""===o&&($(".user-name").addClass("nullError"),m=!0),u.sd_shopphotopath.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(u.sd_shopphotopath=u.sd_shopphotopath.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length),indexObj._dataStorage(branchObj.storage.branchData,u)),m)myApp.alert(stringObj.text.data_not_complete,stringObj.text.warn);else{var b=indexObj._dataCookies(indexObj._storage.main);u=indexObj._dataStorage(branchObj.storage.branchData);var _={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:b.sat,sd_id:u.sd_id,sd_shopname:e,sd_shoptel:t,sd_zipcode:r,sd_shopaddress:i,sd_weeklystart:a.substring(2,3),sd_weeklyend:a.substring(8,9),sd_dailystart:s.substring(0,5),sd_dailyend:s.substring(8,13),sd_shopphotopath:u.sd_shopphotopath,sd_introtext:n,sd_contact_person:o,sd_contact_tel:t,sd_contact_mobile:d,sd_contact_address:p,sd_contact_email:c,rl_city_code:stringObj.counties.indexOf(mCounty)+1};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopbasicdataupdate,para:_,success:function(t){if(t.shopbasicdataupdateresult){var a=JSON.parse(JSON.stringify(t.shopbasicdataupdateresult));if("000000000"===a.message_no){u=indexObj._dataStorage(branchObj.storage.branchData);var s=indexObj._dataStorage(indexObj._storage.myshopdata)||[];if(findArrayItem(s,"sd_id",u.sd_id),s[nowIndex].sd_shopname=e,s[nowIndex].sd_shopphotopath=stringObj.text.branch_img_path+u.sd_shopphotopath,indexObj._dataStorage(indexObj._storage.myshopdata,s),indexObj._dataStorage(branchObj.storage.imagePath,null),isMobile.Android())webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,u.sd_shopphotopath,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","");else if(isMobile.iOS()){var r=[];r.push(u.sd_shopphotopath),webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,r,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",[])}branchObj.shopadvanceupdate(u.sd_id)}else myApp.hideIndicator(),stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})}}),$(".preview").click(function(){var e=indexObj._dataCookies(indexObj._storage.main);"1"===e.md_clienttype?(localStorage.setItem("pageInit","shop/branch-info-edit"),window.location="pm/branch-info?sd_id="+t.sd_id):"99"===e.md_clienttype&&mainView.router.load({url:"temple-info?sd_id="+t.sd_id+"&from=preview"})})},menuDataGet:function(e,t){branch_cate=t;var a={};a.menu=e in branchObj._menuList?e:0,a.name=branchObj._menuList[a.menu].name,a.cate=t in branchObj._menuList[a.menu].list?t:0,a.list=branchObj._menuList[a.menu].list.map(function(e,t){var s={name:e.name};return t==a.cate&&(s.active=!0,a.spm_serno=e.spm_serno),s}),branchObj.menuInfo=a},menuChange:function(e){var t=mainView.activePage.query.menu||0,a=mainView.activePage.query.cate||0,s=parseInt(a)+e;branchObj._menuList[t].list[s]&&mainView.router.load({url:"branch-cooperative?menu="+t+"&cate="+s})},_pageTouch:function(e){if("block"===$$(".panel-overlay").css("display"))return branchObj._tmsx=null,!1;if(1==$$("body.with-panel-left-reveal").length)return branchObj._tmsx=null,!1;if("touchstart"===e.type)return branchObj._tmsx=Math.round(e.changedTouches[0].clientX),branchObj._tmsy=Math.round(e.changedTouches[0].clientY),!0;if(("touchcancel"===e.type||"touchend"===e.type)&&branchObj._tmsx){var t=Math.round(e.changedTouches[0].clientX)-branchObj._tmsx,a=Math.round(e.changedTouches[0].clientY)-branchObj._tmsy;if(Math.abs(a)>Math.abs(t))return!1;t>30&&branchObj.menuChange(-1),t<-30&&branchObj.menuChange(1)}},menuInit:function(e,t){if(branchObj.menuDataGet(e,t),$$(".menu-title").html(branchObj.menuInfo.name),"branch-cooperative"===nowPage)a=indexObj.template("templateBranchCate");else if("around-search-result"===nowPage)var a=indexObj.template("templateAroundSearchCate");var s=a(branchObj.menuInfo);$$(".blog-cate.swiper-container").html(s);myApp.swiper(".blog-cate.swiper-container",{spaceBetween:0,slidesPerView:2,initialSlide:branchObj.menuInfo.cate});if(void 0!==e&&void 0!==t)(r={}).menu=e,r.cate=t;else{var r={};r.menu="0",r.cate="0"}if(branch_menu=r.menu,branch_cate=r.cate,"branch-cooperative"===nowPage){var i=indexObj.template("templateBranchListType")(r);$$(".branchType .toolbar-inner").html(i)}},branchCooperativeInit:function(e){var t=e.query;void 0!==t.listType&&(nowBranchType=t.listType),branchObj.menuInit(t.menu,t.cate),branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),t.shopname?branchObj.branchListGet(t.shopname):branchObj.branchListGet(""),$$(".pull-to-refresh-content").on("refresh",function(){myApp.attachInfiniteScroll($$(".infinite-scroll")),t.shopname?branchObj.branchListRefresh(t.shopname):branchObj.branchListRefresh("")}),$$(".infinite-scroll").on("infinite",function(){t.shopname?branchObj.branchListGet(t.shopname):branchObj.branchListGet("")}),$(".around_search").unbind("click"),$(".around_search").click(function(e){indexObj._dataStorage(branchObj.storage.search_result,null);var t={};nowlat="25.047908",nowlng="121.517115",void 0!==Cookies.get("app_version")?webview.getLocation():((t={}).spm_serno=2,t.sd_lat=nowlat||"",t.sd_lng=nowlng||"",t.sd_shopname="",t.sd_country="",indexObj._dataStorage(indexObj._storage.search_result,t),mainView.router.load({url:"around-search-result"}))}),$(".advanced_search").unbind("click"),$(".advanced_search").click(function(e){indexObj._dataStorage(branchObj.storage.search_result,{spm_serno:1,sd_shopname:"",sd_lat:"25.047908",sd_lng:"121.517115",sd_country:""})})},postshopdata:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.postshopdata,para:e,success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.postshopdataresult){var a=JSON.parse(JSON.stringify(t.postshopdataresult));"011103000"===a.message_no?(myApp.alert(stringObj.text.application_success,stringObj.text.warn),indexObj._dataStorage(branchObj.storage.applicationData,null),$(".modal-button").click(function(e){indexObj._userLogout()})):(indexObj._dataStorage(branchObj.storage.applicationData,e),stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(t){indexObj._dataStorage(branchObj.storage.applicationData,e),myApp.hideIndicator(),noNetwork()}})},branchRegionSearchInit:function(e){$(".branch-search-left").click(function(e){indexObj._dataStorage(branchObj.storage.search_result,null)});var t=indexObj._dataStorage(branchObj.storage.search_result)||{};t.sd_shopname&&$(".sd_shopname").val(t.sd_shopname);var a;for(var s in stringObj.counties)(a={}).rl_no=s+1,a.rl_city=stringObj.counties[s],temp=indexObj.template("templateBranchRegionList"),item=temp(a),$$(".block-list").append(item);if(nowlat="",nowlng="",$("input[type=checkbox][name=my_location]").change(function(){this.checked?($(".block-list input").attr("disabled","disabled"),$('.block-list input[type="checkbox"] + label').css("background","dimgray"),$('.block-list input[type="checkbox"] + label').css("color","#333"),nowlat="",nowlng="",$(".block-list input").prop("checked",!1),(isMobile.Android()||isMobile.iOS())&&webview.getLocation(),void 0!==nowlat&&0!==nowlat&&""!==nowlat||($(this).prop("checked",!1),$(".block-list input").removeAttr("disabled"),$('.block-list input[type="checkbox"] + label').css("background","darkgray"),$('.block-list input[type="checkbox"] + label').css("color","#000"))):($(".block-list input").removeAttr("disabled"),$('.block-list input[type="checkbox"] + label').css("background","darkgray"),$('.block-list input[type="checkbox"] + label').css("color","#000"),nowlat="",nowlng="")}),t.sd_lat)$("input[type=checkbox][name=my_location]").prop("checked",!0),$(".block-list input").attr("disabled","disabled"),$('.block-list input[type="checkbox"] + label').css("background","dimgray"),$('.block-list input[type="checkbox"] + label').css("color","#333");else if(t.sd_country)for(var s in t.sd_country.split(","))$("#r"+t.sd_country.split(",")[s]).prop("checked",!0);$(".block-list input").change(function(){this.checked?($(this).next().css("background","darkorange"),$(this).next().css("color","#FCFAF2")):($(this).next().css("background","darkgray"),$(this).next().css("color","#000"))}),t.spm_serno?$(".spm_serno").val(stringObj.shop.spm_serno_array[parseInt(t.spm_serno)-1]):t.spm_serno=1;myApp.picker({input:".spm_serno",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.spm_serno+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]},onOpen:function(e){t.spm_serno&&e.setValue([stringObj.shop.spm_serno_array[parseInt(t.spm_serno)-1]])},onClose:function(e){t.spm_serno=e.cols[0].activeIndex+1},cols:[{width:"100%",textAlign:"center",values:stringObj.shop.spm_serno_array}]});$$(".search").click(function(){var e=[];$("input[name='region']:checked").each(function(){e.push($(this).val())}),t.sd_shopname=$(".sd_shopname").val(),t.sd_lat=nowlat||"",t.sd_lng=nowlng||"",t.sd_country=e.toString(),indexObj._dataStorage(branchObj.storage.search_result,t),mainView.router.load({url:"shop-search-result"})})},aroundSearchResultInit:function(e){var t=e.query;branchObj.menuInit(0,t.cate);indexObj._dataStorage(branchObj.storage.search_result);$(".around-search-result-left").click(function(e){nowMode="list",indexObj._dataStorage(branchObj.storage.search_result,null),window.location="pm/branch-cooperative?cate="+localStorage.getItem("cate")+"&listtype="+nowBranchType}),branchObj.firstId="",branchObj.listId="",branchObj.distance="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll").on("infinite",function(){branchObj.branchListGet("")}),branchObj.branchListGet(""),toTop(),branchObj.changeMode(nowMode),$(".toolbar.mode").click(function(e){"list"===nowMode?(nowMode="map",branchObj.changeMode("map")):"map"===nowMode&&(nowMode="list",branchObj.changeMode("list"))}),$(".subnavbar a").click(function(){if(branchObj.menuDataGet(0,$(this).attr("cate")),$(".subnavbar a").removeClass("swiper-slide-active"),$(".subnavbar a").removeClass("active"),$(this).addClass("swiper-slide-active"),$(this).addClass("active"),branchObj.firstId="",branchObj.listId="",branchObj.distance="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll").on("infinite",function(){branchObj.branchListGet("")}),"map"===nowMode){full_map.setCenter(new google.maps.LatLng(nowlat,nowlng));for(var e=0;e<markers.length;e++)markers[e].setMap(null);markers=[]}branchObj.branchListGet("")}),$(".search-btn").click(function(e){full_map.setCenter(new google.maps.LatLng(nowlat,nowlng)),branchObj.branchListGet("")})},changeMode:function(e){"map"===e?($(".blog-box").css("display","none"),$(".full_map").css("display","block"),$(".toolbar.mode a").html('<i class="fa fa-th" aria-hidden="true"></i>&nbsp;&nbsp;列表模式'),$(".search-btn").css("display","block"),$(".set_location").css("display","block"),void 0!==Cookies.get("app_version")?webview.getLocation():$.getJSON("http://ip-api.com/json/?callback=?",function(e){nowLocation(e.lon,e.lat)}),void 0!==nowCenter&&full_map.setCenter(nowCenter)):"list"===e&&($(".full_map").css("display","none"),$(".search-btn").css("display","none"),$(".set_location").css("display","none"),$(".blog-box").css("display","block"),$(".toolbar.mode a").html('<i class="fa fa-map-marker" aria-hidden="true"></i>&nbsp;&nbsp;地圖模式'))},shopSearchResultInit:function(e){e.query;var t=indexObj._dataStorage(branchObj.storage.search_result)||{};nowlat="",nowlng="",branchObj.popupCondition(),$(".shop-search-result-left").click(function(e){indexObj._dataStorage(branchObj.storage.search_result,null),window.location="pm/branch-cooperative?cate="+localStorage.getItem("cate")+"&listtype="+nowBranchType});var a=[];if(a.push({condition:stringObj.shop.spm_serno_array[parseInt(t.spm_serno)-1]}),a.push({condition:t.sd_shopname}),t.sd_lat&&t.sd_lng&&a.push({condition:stringObj.shop.around_me}),t.sd_country)for(var s in t.sd_country.split(","))a.push({condition:t.sd_country.split(",")[s]});a={condition_list:a};var r=indexObj.template("templateConditionBlock")(a);$$(".condition-block").html(r),branchObj.firstId="",branchObj.listId="",branchObj.distance="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll").on("infinite",function(){branchObj.branchListGet("")}),branchObj.branchListGet(""),toTop(),$(".more-condition").unbind("click"),$(".more-condition").click(function(e){branchObj.popupCondition()}),nowMode="list",$(".result-title .mode").click(function(e){if("list"===nowMode){$(".blog-box").css("display","none"),$(".full_map").css("display","block"),nowMode="map",$(this).html('<i class="fa fa-th" aria-hidden="true"></i>'),void 0!==Cookies.get("app_version")&&webview.getLocation();var t,a={zoom:14,center:t=void 0===nowlat||0===nowlat||""===nowlat?new google.maps.LatLng(25.047908,121.517115):new google.maps.LatLng(nowlat,nowlng),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},s=$(".full_map");if(full_map=new google.maps.Map(s[0],a),void 0!==nowlat&&0!==nowlat&&""!==nowlat){full_map.setCenter(t);var r={url:"app/image/user-marker.png"};new google.maps.Marker({position:t,map:full_map,title:"Me",icon:r})}void 0!==nowCenter&&full_map.setCenter(nowCenter),branchObj.branchListGet("")}else"map"===nowMode&&($(".full_map").css("display","none"),$(".blog-box").css("display","block"),nowMode="list",$(this).html('<i class="fa fa-map-marker" aria-hidden="true"></i>'))})},popupCondition:function(){myApp.popup(".popup-condition"),$$(".block-list").html("");var e=indexObj._dataStorage(branchObj.storage.search_result)||{};e.sd_shopname&&$(".sd_shopname").val(e.sd_shopname);var t,a;for(var s in stringObj.counties)(a={}).rl_no=parseInt(s)+1,a.rl_city=stringObj.counties[s],t=indexObj.template("templateBranchRegionList")(a),$$(".block-list").append(t);if($("input[type=checkbox][name=my_location]").change(function(){this.checked?($(this).next().css("background","darkorange"),$(this).next().css("color","#FCFAF2"),$(".block-list input").attr("disabled","disabled"),$('.block-list input[type="checkbox"] + label').css("background","dimgray"),$('.block-list input[type="checkbox"] + label').css("color","#333"),nowlat="",nowlng="",$(".block-list input").prop("checked",!1),void 0!==Cookies.get("app_version")?webview.getLocation():(myApp.modal({title:stringObj.text.warn,text:stringObj.shop.no_GPS,buttons:[{text:stringObj.text.cancel,onClick:function(){}}]}),$(this).prop("checked",!1),$(this).next().css("background","darkgray"),$(this).next().css("color","#000"),$(".block-list input").removeAttr("disabled"),$('.block-list input[type="checkbox"] + label').css("background","darkgray"),$('.block-list input[type="checkbox"] + label').css("color","#000"))):($(this).next().css("background","darkgray"),$(this).next().css("color","#000"),$(".block-list input").removeAttr("disabled"),$('.block-list input[type="checkbox"] + label').css("background","darkgray"),$('.block-list input[type="checkbox"] + label').css("color","#000"),nowlat="",nowlng="")}),e.sd_lat)$("input[type=checkbox][name=my_location]").prop("checked",!0),$(".block-list input").attr("disabled","disabled"),$('.block-list input[type="checkbox"] + label').css("background","dimgray"),$('.block-list input[type="checkbox"] + label').css("color","#333");else if(e.sd_country)for(var s in e.sd_country.split(","))$("#r"+e.sd_country.split(",")[s]).prop("checked",!0);$(".block-list input").change(function(){this.checked?($(this).next().css("background","darkorange"),$(this).next().css("color","#FCFAF2")):($(this).next().css("background","darkgray"),$(this).next().css("color","#000"))}),e.spm_serno?$(".spm_serno").val(stringObj.shop.spm_serno_array[parseInt(e.spm_serno)-1]):e.spm_serno=1;myApp.picker({input:".spm_serno",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.spm_serno+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]},onOpen:function(t){e.spm_serno&&t.setValue([stringObj.shop.spm_serno_array[parseInt(e.spm_serno)-1]])},onClose:function(t){e.spm_serno=t.cols[0].activeIndex+1},cols:[{width:"100%",textAlign:"center",values:stringObj.shop.spm_serno_array}]});$(".search").unbind("click"),$(".search").click(function(){var t=[];$("input[name='region']:checked").each(function(){t.push($(this).val())}),e.sd_shopname=$(".sd_shopname").val(),e.sd_lat=nowlat||"",e.sd_lng=nowlng||"",e.sd_country=t.toString(),indexObj._dataStorage(branchObj.storage.search_result,e),myApp.closeModal(),e=indexObj._dataStorage(branchObj.storage.search_result)||{};var a=[];if(a.push({condition:stringObj.shop.spm_serno_array[parseInt(e.spm_serno)-1]}),a.push({condition:e.sd_shopname}),e.sd_lat&&e.sd_lng&&a.push({condition:stringObj.shop.around_me}),e.sd_country)for(var s in e.sd_country.split(","))a.push({condition:stringObj.counties[e.sd_country.split(",")[s]-1]});a={condition_list:a};var r=indexObj.template("templateConditionBlock")(a);$$(".condition-block").html(r),branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll").on("infinite",function(){branchObj.branchListGet("")}),branchObj.branchListGet("")})},branchSearchInit:function(e){var t,a=regionObj[0].rl_city,s={rlList:[{rl_city:a,rl_city_ename:regionObj[0].rl_city_ename}]};for(var r in regionObj)if(a!=regionObj[r].rl_city){var i={};i.rl_city=regionObj[r].rl_city,i.rl_city_ename=regionObj[r].rl_city_ename,s.rlList.push(i),a=regionObj[r].rl_city}t=indexObj.template("templateRegionAccordion")(s),$$(".regionList").append(t);for(var r in regionObj)t=indexObj.template("templateRegionList")(regionObj[r]),$$("."+regionObj[r].rl_city_ename).append(t);$(".search").click(function(){var e=[],t=[],a=[],s=[];$("input[name='serving']:checked").each(function(){e.push($(this).val())}),$("input[name='brands']:checked").each(function(){t.push($(this).val())}),$("input[name='cars']:checked").each(function(){a.push($(this).val())}),$("input[name='region']:checked").each(function(){s.push($(this).val())})}),$$(".accordion-item1").on("open",function(e){$(".content-block-title+.list-block").css("height","auto"),$(".accordion-item1 .item-content").css("min-height","44px")}),$$(".accordion-item1").on("close",function(e){$(".content-block-title+.list-block").css("height","93%"),$(".accordion-item1 .item-content").css("min-height","100%")}),$$(".accordion-item2").on("open",function(e){$(".content-block-title+.list-block").css("height","auto"),$(".accordion-item2 .item-content").css("min-height","44px")}),$$(".accordion-item2").on("close",function(e){$(".content-block-title+.list-block").css("height","93%"),$(".accordion-item2 .item-content").css("min-height","100%")}),$$(".accordion-item3").on("open",function(e){$(".content-block-title+.list-block").css("height","auto"),$(".accordion-item3 .item-content").css("min-height","44px")}),$$(".accordion-item3").on("close",function(e){$(".content-block-title+.list-block").css("height","93%"),$(".accordion-item3 .item-content").css("min-height","100%")}),$$(".accordion-item4").on("open",function(e){isOpen=!0,$(".content-block-title+.list-block").css("height","auto"),$(".accordion-item4 .region-content").css("min-height","44px")}),$$(".accordion-item4").on("close",function(e){isOpen&&($(".content-block-title+.list-block").css("height","93%"),$(".accordion-item4 .region-content").css("min-height","100%"))}),$$(".region-item").on("close",function(e){isOpen=!1,$(".accordion-item4 .region-content").css("min-height","44px")})},branchInfoInit:function(e){var t=indexObj._dataCookies(indexObj._storage.main)||{},a=e.query;nowSd_id=a.sd_id,t.mdId&&branchObj.shopservicequerecorver(),branchObj.branchInfoGet(nowSd_id,a.from),a.tab&&(myApp.showTab("."+a.tab),"branch-preferential-content"==a.tab?($(".toolbar-bottom a").removeClass("active"),$(".preferential").addClass("active"),shopcoupon_num=0,branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,branchObj.getShopCouponList(nowSd_id),$$(".pull-to-refresh-content").on("refresh",function(){branchObj.shopCouponListRefresh(a.sd_id)}),$$(".infinite-scroll").on("infinite",function(){branchObj.getShopCouponList(nowSd_id)})):"branch-queue-content"==a.tab&&($(".toolbar-bottom a").removeClass("active"),$(".queue").addClass("active"),branchObj.getBranchQueue(nowSd_id))),$$(".branch-info-content").on("show",function(){$(".toolbar-bottom a").removeClass("active"),$(".info").addClass("active"),branchObj.branchInfoGet(nowSd_id,a.from)}),$$(".branch-evaluate-browse-content").on("show",function(){$(".toolbar-bottom a").removeClass("active"),$(".evaluate-browse").addClass("active"),branchObj.shopquestionnaire_result(nowSd_id)}),$$(".branch-queue-content").on("show",function(){$(".toolbar-bottom a").removeClass("active"),$(".queue").addClass("active"),branchObj.getBranchQueue(nowSd_id)}),$$(".branch-preferential-content").on("show",function(){$(".toolbar-bottom a").removeClass("active"),$(".preferential").addClass("active"),shopcoupon_num=0,branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$(".shopcoupon-list-container").html(""),branchObj.getShopCouponList(nowSd_id),$$(".pull-to-refresh-content").on("refresh",function(){branchObj.shopCouponListRefresh(nowSd_id)}),$$(".infinite-scroll").on("infinite",function(){branchObj.getShopCouponList(nowSd_id)})}),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},2e3)},branchInfoGet:function(e,t){myApp.showIndicator(),"pay-setting"===nowPage&&myApp.showIndicator();var a={modacc:stringObj.shop.moduleaccount,modvrf:encodeURIComponent(btoa(localStorage.getItem("salt_no")+"_"+CryptoJS.SHA256(stringObj.shop.moduleaccount+stringObj.shop.modulepassword+localStorage.getItem("salt")))),sd_id:e};indexObj._wcfget({url:branchObj.dataUrl.shopcontentquery,para:a,success:function(a){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(a),a.shopcontentqueryresult){var s=JSON.parse(JSON.stringify(a.shopcontentqueryresult));if("000000000"===s.message_no){if("branch-info"===nowPage||"used-car-branch-info"===nowPage||"temple-info"===nowPage){if(s.sd_advancedata){s.sd_advancedata=JSON.parse(s.sd_advancedata);for(var r in s.sd_advancedata)s.sd_advancedata[r].content_img&&(s.sd_advancedata[r].content_img=stringObj.text.branch_img_path+s.sd_advancedata[r].content_img)}if(s.sd_shopphotopath?s.sd_shopphotopath=stringObj.text.branch_img_path+s.sd_shopphotopath:s.sd_shopphotopath="../app/image/imgDefault.png","1"===s.sd_havebind?(s.sd_havebind=!0,s.authenticate_icon="../app/image/authenticate.png",$(".toolbar-bottom.tabbar").css("display","block")):(s.sd_havebind=!1,$(".toolbar-bottom.tabbar").css("display","none")),s.subscription_icon="../app/image/unsubscribe.png",s.sd_id=e,"branch-info"===nowPage||"used-car-branch-info"===nowPage){c=(l=indexObj.template("templateBranchInfo"))(s);$$(".branch-info-content").html(c)}myApp.initImagesLazyLoad(".page-content"),s.sd_shopphotopath&&$(".main-img").wrap('<span style="display:inline-block"></span>').css("display","block").parent().zoom();var i=indexObj._dataCookies(indexObj._storage.main)||{},n=indexObj._dataStorage(branchObj.storage.search_result)||{};"preview"===t?($(".back-btn a").attr("href","shop/branch-info-edit"),$(".back-btn a").html('<span class="icon-chevron-left"></span>'),$(".back-btn").css("font-size","1.5em")):"favorite"===t?$(".back-btn a").attr("href","shop/favorite"):"map"===t?$(".back-btn a").attr("href","map"):"map_mode"===t?$(".back-btn a").attr("href","around-search-result?menu="+branch_menu+"&cate="+branch_cate):"search"===t?($(".back-btn a").attr("href","#"),$(".back-btn a").addClass("back")):indexObj._dataStorage(branchObj.storage.search_result)&&n.sd_lat?$(".back-btn a").attr("href","around-search-result"):indexObj._dataStorage(branchObj.storage.search_result)?$(".back-btn a").attr("href","shop-search-result"):$(".back-btn a").attr("href","branch-cooperative?menu="+branch_menu+"&cate="+branch_cate),$$(".track").click(function(){addFavorite(e,stringObj.text.branch_img_path+s.sd_shopphotopath,s.sd_shopname,s.sd_shopaddress,s.sd_shoptel,"","2")});var o=indexObj._dataStorage(indexObj._storage.favorite)||{lastupdate:"",newsList:[],couponList:[],branchList:[],shopcouponList:[]};JSON.stringify(o.branchList).match(e)&&$$(".track").html('<img src="../app/image/subscribe.png" onerror=\'this.src="app/image/imgDefault.png"\' />')}else if("branch-info-edit"===nowPage){(u=indexObj._dataStorage(branchObj.storage.branchData)||{}).sd_shopphotopath=s.sd_shopphotopath,indexObj._dataStorage(branchObj.storage.branchData,u),localStorage.getItem(branchObj.storage.imagePath)?(s.sd_shopphotopath=stringObj.text.branch_img_path+localStorage.getItem(branchObj.storage.imagePath),u.sd_shopphotopath=localStorage.getItem(branchObj.storage.imagePath),indexObj._dataStorage(branchObj.storage.branchData,u)):s.sd_shopphotopath?s.sd_shopphotopath=stringObj.text.branch_img_path+s.sd_shopphotopath:s.sd_shopphotopath="../app/image/imgDefault.png";var c,l=indexObj.template("templateBranchInfoEdit"),d=indexObj._dataStorage(branchObj.storage.shop_data)||{};if(d.sd_shopname){localStorage.getItem(branchObj.storage.imagePath)?d.sd_shopphotopath=stringObj.text.branch_img_path+localStorage.getItem(branchObj.storage.imagePath):d.sd_shopphotopath=stringObj.text.branch_img_path+d.sd_shopphotopath;for(var r in d.sd_advancedata)d.sd_advancedata[r].content_img&&(d.sd_advancedata[r].img_path=stringObj.text.branch_img_path);c=l(d)}else{if(s.sd_advancedata){s.sd_advancedata=JSON.parse(s.sd_advancedata);for(var r in s.sd_advancedata)s.sd_advancedata[r].content_img&&(s.sd_advancedata[r].img_path=stringObj.text.branch_img_path)}c=l(s)}$$(".branch-info-edit-content").html(c),myApp.initImagesLazyLoad(".page-content"),localStorage.getItem("scrollTop")&&($(".branch-info-edit-content").scrollTop(parseFloat(localStorage.getItem("scrollTop"))),localStorage.removeItem("scrollTop")),$(".move-up").click(function(e){0!==$(this).parents("li").index()&&((d=indexObj._dataStorage(branchObj.storage.shop_data)||{}).sd_advancedata||(d.sd_advancedata=s.sd_advancedata||[],indexObj._dataStorage(branchObj.storage.shop_data,d)),d.sd_advancedata.splice($(this).parents("li").index()-1,0,d.sd_advancedata.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.shop_data,d),$(this).parents("li").insertBefore(".branch-details-block.sortable li:nth-child("+$(this).parents("li").index()+")"))}),$(".move-down").click(function(e){(d=indexObj._dataStorage(branchObj.storage.shop_data)||{}).sd_advancedata?$(this).parents("li").index()<d.sd_advancedata.length-1&&(d.sd_advancedata.splice($(this).parents("li").index()+1,0,d.sd_advancedata.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.shop_data,d),$(this).parents("li").insertAfter(".branch-details-block.sortable li:nth-child("+($(this).parents("li").index()+2)+")")):(d.sd_advancedata=s.sd_advancedata||[],indexObj._dataStorage(branchObj.storage.shop_data,d),d.sd_advancedata.splice($(this).parents("li").index()+1,0,d.sd_advancedata.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.shop_data,d),$(this).parents("li").insertAfter(".branch-details-block.sortable li:nth-child("+($(this).parents("li").index()+2)+")"))}),d=indexObj._dataStorage(branchObj.storage.shop_data)||{},$(".details-img").click(function(){d.sd_advancedata||(d.sd_advancedata=s.sd_advancedata||[],indexObj._dataStorage(branchObj.storage.shop_data,d)),void 0!==Cookies.get("app_version")?addImage("shopcontent",d.sd_advancedata[$(this).parents("li").index()].content_img):setImgOnPC("sd_id="+e+"&folder=shopcontent&position="+$(this).parents("li").index(),d.sd_advancedata[$(this).parents("li").index()].content_img)}),$(".details-text").parents(".item-inner").click(function(){d.sd_advancedata||(d.sd_advancedata=s.sd_advancedata||[],indexObj._dataStorage(branchObj.storage.shop_data,d));var e=$(this).parents("li").index(),t=$(this).find(".details-text");myApp.modal({title:"文字內容",text:'<textarea class="info resizable" placeholder="內容" rows="8"></textarea>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text._clear,onClick:function(){d.sd_advancedata.splice(e,1),t.parents(".branch-details-item").remove(),indexObj._dataStorage(branchObj.storage.shop_data,d)}},{text:stringObj.text.edit,onClick:function(){d.sd_advancedata||(d.sd_advancedata=s.sd_advancedata,indexObj._dataStorage(branchObj.storage.shop_data,d)),d.sd_advancedata[e].content_text=$("textarea.info").val(),$("textarea.info").val()?t.text($("textarea.info").val()):(d.sd_advancedata.splice(e,1),t.parents(".branch-details-item").remove()),indexObj._dataStorage(branchObj.storage.shop_data,d)}}]}),$("textarea.info").val(t.text()),$("textarea.info").focus()}),$(".add-details-image").click(function(){d.sd_advancedata||(d.sd_advancedata=s.sd_advancedata||[],indexObj._dataStorage(branchObj.storage.shop_data,d)),void 0!==Cookies.get("app_version")?addImage("shopcontent",""):setImgOnPC("sd_id="+e+"&folder=shopcontent&position=add","")}),$(".add-details-text").click(function(){myApp.modal({title:"文字內容",text:'<textarea class="info resizable" placeholder="內容" rows="8"></textarea>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.add,onClick:function(){d.sd_advancedata||(d.sd_advancedata=s.sd_advancedata||[],indexObj._dataStorage(branchObj.storage.shop_data,d)),""!==$.trim($("textarea.info").val())&&(d.sd_advancedata.push({content_text:$("textarea.info").val(),content_img:""}),indexObj._dataStorage(branchObj.storage.shop_data,d),localStorage.setItem("scrollTop",$(".branch-info-edit-content").scrollTop()+70),saveShopData(),mainView.router.load({url:window.location.href.substring(window.location.href.indexOf("#!/")+3),reload:!0}))}}]}),$("textarea.info").focus()}),d.sd_shopname?($$(".branch-address textarea").val(d.sd_shopaddress),$$(".branch-info textarea").val(d.sd_introtext),$$(".user-address textarea").val(d.sd_contact_address)):($$(".branch-address textarea").val(s.sd_shopaddress),$$(".branch-info textarea").val(s.sd_introtext),$$(".user-address textarea").val(s.sd_contact_address)),s.sd_weeklystart?$$(".branchDate").val("星期"+s.sd_weeklystart+" ~ 星期"+s.sd_weeklyend):d.sd_weeklystart?$$(".branchDate").val("星期"+d.sd_weeklystart+" ~ 星期"+d.sd_weeklyend):$$(".branchDate").val(""),s.sd_dailystart?$$(".branchTime").val(s.sd_dailystart.substring(0,5)+" ~ "+s.sd_dailyend.substring(0,5)):d.sd_dailystart?$$(".branchTime").val(d.sd_dailystart.substring(0,5)+" ~ "+d.sd_dailyend.substring(0,5)):$$(".branchTime").val("");myApp.picker({input:".branchDate",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+" ~ "+t[1]},cols:[{values:stringObj.text.week_array,textAlign:"center",width:120},{textAlign:"center",divider:!0,content:" ~ "},{values:stringObj.text.week_array,textAlign:"center",width:120}]}),myApp.picker({input:".branchTime",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+":"+t[1]+" ~ "+t[2]+":"+t[3]},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:":"},{values:function(){for(var e=[],t=0;t<=59;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:" ~ "},{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:":"},{textAlign:"center",values:function(){for(var e=[],t=0;t<=59;t++)e.push(t<10?"0"+t:t);return e}()}]});var p=stringObj.region;zipArray=p.臺北市[1];myApp.picker({input:".branchRegion",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return zipArray[regionIndex]},cols:[{textAlign:"center",width:140,values:stringObj.counties,onChange:function(e,t){mCounty=t,e.cols[1].replaceValues&&(e.cols[1].replaceValues(p[t][0]),zipArray=p[t][1],$("#branch-address").val(t+p[t][0][0]))}},{textAlign:"center",values:p.臺北市[0],width:140,onChange:function(e,t){mDistrict=t,regionIndex=e.cols[1].activeIndex,$("#branch-address").val(mCounty+t)}}]});$(".edit-img").click(function(){void 0!==Cookies.get("app_version")?addImage("branch-img",""):setImgOnPC("sd_id="+e+"&folder=maincover","")})}else if("pay-setting"===nowPage){if("0"!==s.sd_paymentflow){var m=JSON.parse(s.sd_paymentflowdata);switch(s.sd_paymentflow){case"1":$(".list-block li.esafe").css("display","block"),$(".list-block li.ecpay").css("display","none"),$(".sd_paymentflow").val("紅陽"),$(".web").val(m.web),$(".TransPwd").val(m.TransPwd);break;case"2":$(".list-block li.esafe").css("display","none"),$(".list-block li.ecpay").css("display","block"),$(".sd_paymentflow").val("綠界"),$(".MerchantID").val(m.MerchantID),$(".HashKey").val(m.HashKey),$(".HashIV").val(m.HashIV)}}var i=indexObj._dataCookies(indexObj._storage.main)||{},u=indexObj._dataStorage(branchObj.storage.branchData)||{},b={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:i.sat,sd_id:u.sd_id,sd_paymentflow:parseInt(s.sd_paymentflow)};myApp.picker({input:".sd_paymentflow",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.sd_paymentflow+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]},onOpen:function(e){if(0!==b.sd_paymentflow)switch(e.setValue([stringObj.shop.sd_paymentflow_array[b.sd_paymentflow]]),b.sd_paymentflow){case 1:$(".list-block li.esafe").css("display","block"),$(".list-block li.ecpay").css("display","none");break;case 2:$(".list-block li.esafe").css("display","none"),$(".list-block li.ecpay").css("display","block")}},onClose:function(e){b.sd_paymentflow=e.cols[0].activeIndex+1},onChange:function(e,t){switch(e.cols[0].activeIndex+1){case 1:$(".list-block li.esafe").css("display","block"),$(".list-block li.ecpay").css("display","none");break;case 2:$(".list-block li.esafe").css("display","none"),$(".list-block li.ecpay").css("display","block")}b.sd_paymentflow=e.cols[0].activeIndex+1},cols:[{width:"100%",textAlign:"center",values:stringObj.shop.sd_paymentflow_array}]});$(".toolbar-bottom.set").click(function(e){var t=!1;if(0!==b.sd_paymentflow){switch(b.sd_paymentflow){case 1:""!==$.trim($(".web").val())||""!==$.trim($(".TransPwd").val())?b.sd_paymentflowdata={web:$(".web").val(),TransPwd:$(".TransPwd").val()}:t=!0;break;case 2:""!==$.trim($(".MerchantID").val())||""!==$.trim($(".HashKey").val())||""!==$.trim($(".HashIV").val())?b.sd_paymentflowdata={MerchantID:$(".MerchantID").val(),HashKey:$(".HashKey").val(),HashIV:$(".HashIV").val()}:t=!0}t?(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%"))):(b.sd_paymentflowdata=JSON.stringify(b.sd_paymentflowdata),branchObj.updateshopdatapayment(b))}else myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%"))})}}else stringObj.return_header(s.message_no),_tip&&(myApp.alert(_tip+"( "+s.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},getBranchQueue:function(e){branchObj.shopservicelistquery(e)},branchBindingInit:function(e){var t=e.query.md_id;$(".branch-binding-left").click(function(e){localStorage.setItem("pageInit",nowPage),window.location="pm/branch-cooperative?cate="+branch_cate+"&listtype="+nowBranchType});var a=indexObj.template("templateBranchListNull")("");$$(".branch-binding-content .list-block ul").html(a),$$(".pull-to-refresh-content").on("refresh",function(){myApp.attachInfiniteScroll($$(".infinite-scroll")),branchObj.branchListRefresh($(".search-block input").val())}),$$(".infinite-scroll").on("infinite",function(){branchObj.branchListGet($(".search-block input").val())}),$$(".search-block .col-15").click(function(){""==$(".search-block input").val()?myApp.alert(stringObj.text.no_input_name,stringObj.text.warn):(branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),branchObj.branchListGet($(".search-block input").val()))}),$$(".binding").click(function(){if(null==$("input[name=branch-radio]:checked").val())myApp.alert(stringObj.text.no_shop,stringObj.text.warn);else{var e=stringObj.text.dcil_list,a="";for(var s in e)3===e[s].dcil_category&&(a+='<li style="border-bottom: 1px dashed #ccc;"><label class="label-radio item-content"><input type="radio" name="bindDays" value="'+e[s].dcil_id+'" checked><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+e[s].dcil_itemname+'</b></div><div class="item-after">'+e[s].dcil_depositamount+'pt</div></div><div class="item-text">'+e[s].dcil_itemdescript+"</div></div></label></li>");myApp.modal({title:stringObj.text.bindingType,text:'<div class="row"><div class="col-40 note">'+stringObj.text.shop_type+'：</div><div class="col-60">'+stringObj.text.shop_type_array[0]+'</div></div><div class="row"><div class="col-40 note">試用方案：</div><div class="col-60"></div></div><div class="list-block media-list"><ul id="bindDaysList" style="background:none;">'+a+"</ul></div>",buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){if(null!==$('input[name="bindDays"]:checked').val()&&""!==$(".modal-text .row select option:selected").val()){var e=indexObj._dataCookies(indexObj._storage.main)||{},a=(JSON.parse(localStorage.getItem(indexObj._storage.businessData)),{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sls_sat:e.sat,sd_id:$("input[name=branch-radio]:checked").val(),md_id:t,dcil_id:$('input[name="bindDays"]:checked').val(),shop_type:"1"});myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopdatabind,para:a,success:function(e){if(e.shopdatabindresult){var t=JSON.parse(JSON.stringify(e.shopdatabindresult));"000000000"===t.message_no?myApp.modal({title:stringObj.text.warn,text:stringObj.text.binding_success,buttons:[{text:stringObj.text.confirm,onClick:function(){localStorage.setItem("pageInit",nowPage),window.location="pm/branch-cooperative?cate="+branch_cate+"&listtype="+nowBranchType}}]}):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator(),noNetwork()}})}else myApp.toast(stringObj.text.no_dcil_id_or_type,"",{}).show(),browser_width<992?($(".toast-container").css("width","48%"),$(".toast-container").css("left","42%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%"))}}]}),$(".modal-text").css("margin","5% 0"),$(".modal-text .row select").css("width","100%"),$(".modal-text .row select").css("border","0"),$(".modal-text .row select").css("background","none"),$(".modal-text .row select").css("border-bottom","1px solid #ccc"),$(".modal-text .row select").css("font-size",".95em"),$(".modal-text .row").css("margin-top","5%"),$(".modal-text .list-block").css("margin","1% 0"),$(".modal-text .col-40.note").css("color","steelblue"),$(".modal .list-block").css("margin","1% 0"),$(".modal-inner").css("background","#FFF"),$(".modal .item-text").css("text-align","left"),$(".media-list li").css("border-bottom","1px solid #DDD"),$(".item-after").css("color","firebrick")}})},branchListGet:function(e){if(myApp.showIndicator(),!branchObj.listLoading){branchObj.listLoading=!0,$$(".infinite-scroll-preloader").show(),"branch-binding"===nowPage&&myApp.showIndicator();var t,a=branchObj.listId,s=branchObj.dataUrl.shoplistquery;if("map"===nowPage)t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),operation_type:"0",spm_serno:Cookies.get("marker_type"),sd_zipcode:"",sd_country:"",sd_shopname:e,startid:"",queryamount:"",sd_lat:Cookies.get("sd_lat"),sd_lng:Cookies.get("sd_lng"),distance:""},void 0===Cookies.get("marker_type")&&(t.spm_serno="2");else if("shop-search-result"===nowPage||"around-search-result"===nowPage||indexObj._dataStorage(branchObj.storage.search_result)){var r=indexObj._dataStorage(branchObj.storage.search_result)||{};1===r.spm_serno&&(r.spm_serno=""),t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),operation_type:"2",spm_serno:r.spm_serno,sd_zipcode:"",sd_country:r.sd_country,sd_shopname:r.sd_shopname,startid:a,queryamount:"20",sd_lat:r.sd_lat,sd_lng:r.sd_lng,distance:branchObj.distance},"around-search-result"===nowPage&&(t.startid="",t.spm_serno=branchObj.menuInfo.spm_serno),"map"===nowMode&&(t.startid="",t.queryamount="50",t.sd_lat=nowlat,t.sd_lng=nowlng)}else if("branch-cooperative"===nowPage){t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),operation_type:"0",spm_serno:branchObj.menuInfo.spm_serno,sd_zipcode:"",sd_country:"",sd_shopname:e,startid:a,queryamount:"20",sd_lat:"",sd_lng:"",distance:""};var i=localStorage.getItem(branchObj.storage.searchShopName)||"";t.sd_shopname=i;var n=indexObj._dataStorage(branchObj.storage.searchRegion)||[];n&&(t.sd_zipcode=n+"")}else"branch-binding"===nowPage&&(t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),operation_type:"2",spm_serno:"",sd_zipcode:"",sd_country:"",sd_shopname:e,startid:a,queryamount:"20",sd_lat:"",sd_lng:"",distance:""});indexObj._wcfget({url:s,para:t,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),"000000000"===e.shoplistqueryresult.message_no||"011101000"===e.shoplistqueryresult.message_no){if(e.shoplistqueryresult.shoplistarray){""===a&&($$(".branch-list-container").html('<div class="row branch-block"></div>'),$$(".branch-binding-content .list-block ul").html(""));var s={list:[]};"map"!==nowPage&&"map"!==nowMode||indexObj._dataStorage("shop_list",e.shoplistqueryresult.shoplistarray);for(var i in e.shoplistqueryresult.shoplistarray){if(("map"===nowPage||"map"===nowMode)&&e.shoplistqueryresult.shoplistarray[i].sd_lat&&e.shoplistqueryresult.shoplistarray[i].sd_lng){var n=new google.maps.LatLng(e.shoplistqueryresult.shoplistarray[i].sd_lat,e.shoplistqueryresult.shoplistarray[i].sd_lng);"map"===nowPage?branchObj.addMarker_fullmap(n,e.shoplistqueryresult.shoplistarray[i].sd_shopname,full_map,Cookies.get("marker_type"),e.shoplistqueryresult.shoplistarray[i].sd_id):"map"===nowMode&&branchObj.addMarker_fullmap(n,e.shoplistqueryresult.shoplistarray[i].sd_shopname,full_map,e.shoplistqueryresult.shoplistarray[i].spm_serno,e.shoplistqueryresult.shoplistarray[i].sd_id)}var o={};o.sd_id=e.shoplistqueryresult.shoplistarray[i].sd_id,""!==e.shoplistqueryresult.shoplistarray[i].sd_shopphotopath?o.sd_shopphotopath=stringObj.text.branch_img_path+e.shoplistqueryresult.shoplistarray[i].sd_shopphotopath:o.sd_shopphotopath="../app/image/imgDefault.png","1"===e.shoplistqueryresult.shoplistarray[i].sd_havebind?(o.sd_havebind=!0,o.authenticate_icon="../app/image/authenticate.png"):o.sd_havebind=!1,o.subscription_icon="../app/image/unsubscribe.png",o.sd_shopname=e.shoplistqueryresult.shoplistarray[i].sd_shopname,o.star_sd_shopname=indexObj.jsonUrlEncode(e.shoplistqueryresult.shoplistarray[i].sd_shopname),o.sd_shoptel=e.shoplistqueryresult.shoplistarray[i].sd_shoptel,o.sd_shopaddress=e.shoplistqueryresult.shoplistarray[i].sd_shopaddress,o.spm_serno=e.shoplistqueryresult.shoplistarray[i].spm_serno,"99"!==e.shoplistqueryresult.shoplistarray[i].spm_serno&&(o.sd_type=stringObj.shop.spm_serno_array[parseInt(e.shoplistqueryresult.shoplistarray[i].spm_serno)-1]),"99"==t.spm_serno?o.isTemple=!0:o.isTemple=!1,("shop-search-result"===nowPage||"around-search-result"===nowPage||indexObj._dataStorage(branchObj.storage.search_result))&&(o.sd_distance=(google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(parseFloat(r.sd_lat),parseFloat(r.sd_lng)),new google.maps.LatLng(parseFloat(e.shoplistqueryresult.shoplistarray[i].sd_lat),parseFloat(e.shoplistqueryresult.shoplistarray[i].sd_lng)))/1e3).toFixed(1)),s.list.push(o)}if(s.list.length>0&&""===branchObj.firstId&&(branchObj.firstId=s.list[0].sd_id),"map"!==nowMode&&"around-search-result"!==nowPage||(branchObj.distance=e.shoplistqueryresult.shoplistarray[e.shoplistqueryresult.shoplistarray.length-1].distance),s.list.length>0&&(branchObj.listId=s.list[s.list.length-1].sd_id),"branch-cooperative"===nowPage||"around-search-result"===nowPage){if("map"!==nowMode){var c;switch(nowBranchType){case"0":l=(c=indexObj.template("templateBranchList"))(s),$$(".branch-list-container").append(l),$(".listType0").css("display","none"),$(".listType2").css("display","flex"),$(".title a").ellipsis({row:2});break;case"1":l=(c=indexObj.template("templateBranchListType1"))(s),$$(".branch-list-container").append(l),$(".fa-th-list").css("color","#f26531"),$(".image").addClass("listType1"),$(".type1Title").ellipsis({row:2});break;case"2":l=(c=indexObj.template("templateBranchListType2"))(s),$$(".branch-list-container .branch-block").append(l),$(".listType0").css("display","flex"),$(".listType2").css("display","none"),$(".image").addClass("listType2"),$(".branch-block .branch-item .title span").ellipsis({row:2});break;default:l=(c=indexObj.template("templateBranchList"))(s),$$(".branch-list-container").append(l),$(".fa-stop").css("color","#f26531"),$(".title a").ellipsis({row:2})}$(".branch-pager").click(function(e){indexObj._dataStorage(branchObj.storage.blessed_relatives,null)}),"around-search-result"===nowPage&&($(".to_info").unbind("click"),$(".to_info").click(function(){localStorage.setItem("pageInit","around-search-result"),window.location="pm/branch-info?sd_id="+$(this).attr("sd_id")}))}}else if("branch-binding"===nowPage){var l=(c=indexObj.template("templateBranchBindList"))(s);$$(".branch-binding-content .list-block ul").append(l),$(".shopname").ellipsis({row:2})}else"shop-search-result"===nowPage&&(l=(c=indexObj.template("templateBranchSearchList"))(s),$$(".branch-list-container").append(l),$(".title a").ellipsis({row:2}),$(".to_info").unbind("click"),$(".to_info").click(function(){localStorage.setItem("pageInit","shop-search-result"),window.location="pm/branch-info?sd_id="+$(this).attr("sd_id")}));$$(".infinite-scroll-preloader").hide();var d=indexObj._dataStorage(indexObj._storage.favorite)||"";if(d)for(var i in d.branchList)$$(".favorite-"+d.branchList[i].ubm_objectid).html('<img src="../app/image/subscribe.png" onerror=\'this.src="app/image/imgDefault.png"\' />');myApp.initImagesLazyLoad(".page-content")}else if("99"===t.spm_serno)myApp.detachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll-preloader").remove(),$(".temple-item").css("display","inherit");else if(myApp.detachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll-preloader").remove(),""===a)if("branch-binding"===nowPage){m=(p=indexObj.template("templateBranchListNull"))("");$$(".branch-binding-content .list-block ul").html(m),$(".content-null h3").html("暫無店家資訊")}else if("around-search-result"===nowPage){m=(p=indexObj.template("templateCooperativeListNull"))("");$$(".page-content .branch-list-container").html(m)}else if("shop-search-result"===nowPage||""!==indexObj._dataStorage(branchObj.storage.search_result)){m=(p=indexObj.template("templateShopSearchNull"))("");$$(".page-content .branch-list-container").html(m)}else{m=(p=indexObj.template("templateCooperativeListNull"))("");$$(".page-content.branch-cooperative-content").html(m)}branchObj.listLoading=!1}else{if("shop-search-result"==nowPage||indexObj._dataStorage(branchObj.storage.search_result)){m=(p=indexObj.template("templateShopSearchNull"))("");$$(".page-content .branch-list-container").html(m)}else{var p=indexObj.template("templateCooperativeListNull"),m=p("");$$(".page-content.branch-cooperative-content").html(m)}stringObj.return_header(e.shoplistqueryresult.message_no),_tip&&(myApp.alert(_tip+"( "+e.shoplistqueryresult.message_no+" )",stringObj.text.warn),_tip=null)}myApp.hideIndicator()},error:function(e){myApp.hideIndicator(),myApp.detachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll-preloader").remove(),noNetwork(),branchObj.listLoading=!1}})}},branchListRefresh:function(e){if(""===branchObj.firstId)return myApp.pullToRefreshDone(".pull-to-refresh-content"),!1;if(branchObj.refreshLoading)return!1;branchObj.refreshLoading=!0;var t,a=branchObj.dataUrl.shoplistquery;if("branch-cooperative"===nowPage){t={operation_type:"0",spm_serno:branchObj.menuInfo.spm_serno,sd_zipcode:"",sd_shopname:e,startid:"",queryamount:"20"};var s=localStorage.getItem(branchObj.storage.searchShopName)||"";t.sd_shopname=s;var r=indexObj._dataStorage(branchObj.storage.searchRegion)||[];r&&(t.sd_zipcode=r+"")}else"branch-binding"===nowPage&&(t={operation_type:"2",spm_serno:"",sd_zipcode:"",sd_shopname:e,startid:"",queryamount:"20"});indexObj._wcfget({url:a,para:t,success:function(e){if(indexObj.jsonUrlDecode(e),e.shoplistqueryresult.shoplistarray){if(e.shoplistqueryresult.shoplistarray[0].sd_id!=branchObj.firstId)return myApp.pullToRefreshDone(".pull-to-refresh-content"),branchObj.refreshLoading=!1,!1;"branch-binding"===nowPage?$$(".branch-list-container").html(""):$$(".branch-list-container").html('<div class="row branch-block"></div>');var a={list:[]};for(var s in e.shoplistqueryresult.shoplistarray){var r={};r.sd_id=e.shoplistqueryresult.shoplistarray[s].sd_id,r.sd_shopphotopath=stringObj.text.branch_img_path+e.shoplistqueryresult.shoplistarray[s].sd_shopphotopath,r.sd_shopname=e.shoplistqueryresult.shoplistarray[s].sd_shopname,r.star_sd_shopname=indexObj.jsonUrlEncode(e.shoplistqueryresult.shoplistarray[s].sd_shopname),r.sd_shoptel=e.shoplistqueryresult.shoplistarray[s].sd_shoptel,r.sd_shopaddress=e.shoplistqueryresult.shoplistarray[s].sd_shopaddress,"99"==t.spm_serno?r.isTemple=!0:r.isTemple=!1,a.list.push(r)}if(""===branchObj.firstId&&(branchObj.firstId=a.list[0].sd_id),branchObj.listId=a.list[a.list.length-1].sd_id,"branch-cooperative"===nowPage){var i;switch(nowBranchType){case"0":n=(i=indexObj.template("templateBranchList"))(a),$$(".branch-list-container").append(n),$(".fa-stop").css("color","#f26531"),$(".title a").ellipsis({row:2});break;case"1":n=(i=indexObj.template("templateBranchListType1"))(a),$$(".branch-list-container").append(n),$(".fa-th-list").css("color","#f26531"),$(".image").addClass("listType1"),$(".type1Title").ellipsis({row:2});break;case"2":n=(i=indexObj.template("templateBranchListType2"))(a),$$(".branch-list-container .branch-block").append(n),$(".fa-th-large").css("color","#f26531"),$(".image").addClass("listType2"),$(".branch-block .branch-item .title span").ellipsis({row:2});break;default:n=(i=indexObj.template("templateBranchList"))(a),$$(".branch-list-container").append(n),$(".fa-stop").css("color","#f26531"),$(".title a").ellipsis({row:2})}}else if("branch-binding"===nowPage){$$(".branch-binding-content .list-block ul").html("");var n=(i=indexObj.template("templateBranchBindList"))(a);$$(".branch-binding-content .list-block ul").append(n),$(".shopname").ellipsis({row:2})}myApp.initImagesLazyLoad(".page-content"),$$(".infinite-scroll-preloader").hide();var o=indexObj._dataStorage(indexObj._storage.favorite);if(o)for(var s in o.branchList)$$(".favorite-"+o.branchList[s].ubm_objectid).html('<img src="../app/image/subscribe.png" onerror=\'this.src="app/image/imgDefault.png"\' />')}myApp.pullToRefreshDone(".pull-to-refresh-content"),branchObj.refreshLoading=!1},error:function(e){myApp.pullToRefreshDone(".pull-to-refresh-content"),noNetwork(),branchObj.refreshLoading=!1}})},myBranchsInit:function(e){indexObj.listId="",indexObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),indexObj.querymembershopinfo(),$$(".infinite-scroll").on("infinite",function(){indexObj.querymembershopinfo()})},getShopCouponList:function(e){if(!branchObj.listLoading){branchObj.listLoading=!0,myApp.showIndicator();var t=branchObj.listId,a=(indexObj._dataCookies(indexObj._storage.main),indexObj._dataStorage(branchObj.storage.branchData),{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),scm_category:"",sd_zipcode:"",sd_id:e,create_date:t,queryamount:"20"});"message-info"===nowPage&&(a.create_date="",a.queryamount=""),indexObj._wcfget({url:branchObj.dataUrl.shopcouponlistquery,para:a,success:function(t){indexObj.jsonUrlDecode(t);var a=JSON.parse(JSON.stringify(t.shopcouponlistqueryresult));if("000000000"===a.message_no)if(t.shopcouponlistqueryresult.shopcoupon_list){""===branchObj.firstId&&(branchObj.firstId=a.shopcoupon_list[0].create_date),branchObj.listId=a.shopcoupon_list[a.shopcoupon_list.length-1].create_date;var s={shopcoupon_now:{list:[]},shopcoupon_fail:{list:[]}};if("shopcoupon-management"==nowPage){for(var r in a.shopcoupon_list){a.shopcoupon_list[r].scm_enddate=a.shopcoupon_list[r].scm_enddate.replace(/-/gi,"/");var i=parseFloat(new Date(a.shopcoupon_list[r].scm_enddate).getTime()),n=parseFloat((new Date).getTime());switch(a.shopcoupon_list[r].scm_poststatus){case"0":a.shopcoupon_list[r].scm_poststatus=stringObj.shop.status_off,a.shopcoupon_list[r].poststatus=!1,i<n?(a.shopcoupon_list[r].scm_poststatus=stringObj.shop.expired,s.shopcoupon_fail.list.push(a.shopcoupon_list[r]),shopcoupon_num++):(a.shopcoupon_list[r].scm_poststatus=stringObj.shop.status_off,s.shopcoupon_now.list.push(a.shopcoupon_list[r]));break;case"1":a.shopcoupon_list[r].scm_poststatus=stringObj.shop.status_on,a.shopcoupon_list[r].poststatus=!0,i<n?(a.shopcoupon_list[r].scm_poststatus=stringObj.shop.expired,s.shopcoupon_fail.list.push(a.shopcoupon_list[r]),shopcoupon_num++):(a.shopcoupon_list[r].scm_poststatus=stringObj.shop.status_on,s.shopcoupon_now.list.push(a.shopcoupon_list[r]));break;case"2":a.shopcoupon_list[r].scm_poststatus=stringObj.shop.illegal,a.shopcoupon_list[r].poststatus=!1,s.shopcoupon_fail.list.push(a.shopcoupon_list[r]),shopcoupon_num++;break;case"3":a.shopcoupon_list[r].scm_poststatus=stringObj.shop.expired,a.shopcoupon_list[r].poststatus=!1,s.shopcoupon_fail.list.push(a.shopcoupon_list[r]),shopcoupon_num++}switch(a.shopcoupon_list[r].scm_mainpic=stringObj.text.branch_img_path+a.shopcoupon_list[r].scm_mainpic,a.shopcoupon_list[r].scm_reservationtag){case"0":a.shopcoupon_list[r].reservationtag=!1;break;case"1":a.shopcoupon_list[r].reservationtag=!0}switch(a.shopcoupon_list[r].scm_producttype){case"1":a.shopcoupon_list[r].coupontag=!0;break;case"2":a.shopcoupon_list[r].commoditytag=!0}}l=(c=indexObj.template("templateShopCoupons"))(s.shopcoupon_now);if($$("#shopcoupon-now .shopcoupon-list").append(l),myApp.initImagesLazyLoad(".page-content"),$$(".infinite-scroll-preloader").hide(),"shopcoupon-fail"==nowTab&&shopcoupon_num>0){l=(c=indexObj.template("templateShopCoupons"))(s.shopcoupon_fail);$$(".shopcoupon-fail .shopcoupon-list").append(l),myApp.initImagesLazyLoad(".page-content"),$$(".infinite-scroll-preloader").hide()}$(".title a").ellipsis({row:2}),$(".to_info").unbind("click"),$(".to_info").click(function(){localStorage.setItem("pageInit","shop/shopcoupon-management"),window.location="pm/shopcoupon-info?scm_id="+$(this).attr("scm_id")}),$(".check").click(function(){myApp.alert(stringObj.text.shopcoupon_edit_check,stringObj.text.warn)})}else if("branch-info"==nowPage){for(var r in a.shopcoupon_list){switch(a.shopcoupon_list[r].scm_poststatus){case"0":a.shopcoupon_list[r].scm_poststatus=stringObj.shop.status_off,a.shopcoupon_list[r].poststatus=!1;break;case"1":a.shopcoupon_list[r].scm_poststatus=stringObj.shop.status_on,a.shopcoupon_list[r].poststatus=!0;break;case"2":a.shopcoupon_list[r].scm_poststatus=stringObj.shop.illegal,a.shopcoupon_list[r].poststatus=!1;break;case"3":a.shopcoupon_list[r].scm_poststatus=stringObj.shop.expired,a.shopcoupon_list[r].poststatus=!1}switch(a.shopcoupon_list[r].scm_mainpic=stringObj.text.branch_img_path+a.shopcoupon_list[r].scm_mainpic,a.shopcoupon_list[r].scm_reservationtag){case"0":a.shopcoupon_list[r].reservationtag=!1;break;case"1":a.shopcoupon_list[r].reservationtag=!0}switch(a.shopcoupon_list[r].scm_producttype){case"1":a.shopcoupon_list[r].coupontag=!0;break;case"2":a.shopcoupon_list[r].commoditytag=!0}a.shopcoupon_list[r].scm_startdate=a.shopcoupon_list[r].scm_startdate.replace(/-/gi,"/"),a.shopcoupon_list[r].scm_enddate=a.shopcoupon_list[r].scm_enddate.replace(/-/gi,"/");var o=parseFloat(new Date(a.shopcoupon_list[r].scm_startdate).getTime()),i=parseFloat(new Date(a.shopcoupon_list[r].scm_enddate).getTime()),n=parseFloat((new Date).getTime());a.shopcoupon_list[r].date_status=i>n&&n>o,1==a.shopcoupon_list[r].poststatus&&1==a.shopcoupon_list[r].date_status&&shopcoupon_num++}var c=indexObj.template("templateShopCouponList"),l=c(a);$$(".shopcoupon-list-container").append(l),$(".title a").ellipsis({row:2})}else if("message-info"==nowPage){var d="";for(var r in a.shopcoupon_list){a.shopcoupon_list[r].scm_mainpic?a.shopcoupon_list[r].scm_mainpic=stringObj.text.branch_img_path+a.shopcoupon_list[r].scm_mainpic:a.shopcoupon_list[r].scm_mainpic="app/image/imgDefault.png",a.shopcoupon_list[r].scm_startdate=a.shopcoupon_list[r].scm_startdate.replace(/-/gi,"/"),a.shopcoupon_list[r].scm_enddate=a.shopcoupon_list[r].scm_enddate.replace(/-/gi,"/");var o=parseFloat(new Date(a.shopcoupon_list[r].scm_startdate).getTime()),i=parseFloat(new Date(a.shopcoupon_list[r].scm_enddate).getTime()),n=parseFloat((new Date).getTime());a.shopcoupon_list[r].date_status=i>n&&n>o,"1"===a.shopcoupon_list[r].scm_poststatus&&!0===a.shopcoupon_list[r].date_status&&(d+='<li><label class="label-radio item-content"><input type="radio" name="shop_items" value="'+a.shopcoupon_list[r].scm_id+'"><div class="item-media"><img src="'+a.shopcoupon_list[r].scm_mainpic+'" width="120" onerror=\'this.src="app/image/imgDefault.png"\'></div><div class="item-inner"><div class="item-text">'+a.shopcoupon_list[r].scm_title+"</div></div></label></li>")}var p='<div class="popup popup-shop-items"><div class="content-block"><div class="title">'+stringObj.shop.shop_items+'</div><div class="shop-items-content"><div class="list-block"><ul>'+d+'</ul></div></div></div><div class="toolbar toolbar-bottom tabbar animated fadeInUp"><div class="toolbar-inner"><a href="#" class="confirm">'+stringObj.text.confirm+"</a></div></div></div>";myApp.popup(p),$(".popup-shop-items").css("z-index","91000"),$(".item-text").ellipsis({row:2}),$(".shop-items-content ul li input").eq(0).attr("checked",'"checked"'),$(".popup-shop-items .toolbar-bottom .confirm").click(function(e){myApp.closeModal(".popup-shop-items"),$(".push-item-block").css("display","initial"),$(".push-item-block .push-item").attr("scm_id",$("input[name=shop_items]:checked").val()),$(".push-item-block .push-item").val($("input[name=shop_items]:checked").parents(".item-content").find(".item-inner .item-text").text())})}myApp.initImagesLazyLoad(".page-content"),$$(".infinite-scroll-preloader").hide(),myApp.hideIndicator();var m=indexObj._dataStorage(indexObj._storage.favorite);if(m)for(var r in m.shopcouponList)$$(".favorite-"+m.shopcouponList[r].ubm_objectid).html('<i class="fa fa-star"></i>');branchObj.listLoading=!1,"branch-info"===nowPage&&shopcoupon_num<10?branchObj.getShopCouponList(e):"shopcoupon-fail"===nowTab&&shopcoupon_num<10&&branchObj.getShopCouponList(e)}else s={shopcoupon_now:{list:[]},shopcoupon_fail:{list:[]}},"branch-info"==nowPage&&0==shopcoupon_num?dataNull("templateShopCouponNull",stringObj.text.no_shopcoupon,".shopcoupon-list-block"):"shopcoupon-fail"==nowTab&&0==shopcoupon_num&&dataNull("templateShopCouponListNull",stringObj.text.no_data,".shopcoupon-fail"),myApp.detachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll-preloader").hide();else"010903001"===a.message_no?("shopcoupon-management"==nowPage?(dataNull("templateShopCouponListNull",stringObj.text.no_data,".shopcoupon-now"),dataNull("templateShopCouponListNull",stringObj.text.no_data,".shopcoupon-fail")):"branch-info"==nowPage&&dataNull("templateShopCouponNull",stringObj.text.no_shopcoupon,".branch-preferential-content"),myApp.detachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll-preloader").hide()):(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null));myApp.hideIndicator()},error:function(e){myApp.detachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll-preloader").remove(),myApp.hideIndicator(),noNetwork(),branchObj.listLoading=!1}})}},shopCouponListRefresh:function(e){if(""===branchObj.firstId)return myApp.pullToRefreshDone(".pull-to-refresh-content"),!1;if(branchObj.refreshLoading)return!1;branchObj.refreshLoading=!0;indexObj._dataCookies(indexObj._storage.main);var t=indexObj._dataStorage(branchObj.storage.branchData);e||(e=t.sd_id);var a={scm_category:"",sd_zipcode:"",sd_id:e,create_date:"",queryamount:"20"};indexObj._wcfget({url:branchObj.dataUrl.shopcouponlistquery,para:a,success:function(e){var t=JSON.parse(JSON.stringify(e.shopcouponlistqueryresult));if(t.shopcoupon_list){if(indexObj.jsonUrlDecode(e),t.shopcoupon_list[0].create_date!=branchObj.firstId)return myApp.pullToRefreshDone(".pull-to-refresh-content"),branchObj.refreshLoading=!1,!1;$$(".shopcoupon-list-container").html(""),branchObj.firstId=t.shopcoupon_list[0].create_date,branchObj.listId=t.shopcoupon_list[t.shopcoupon_list.length-1].create_date;var a={shopcoupon_now:{list:[]},shopcoupon_fail:{list:[]}};if("shopcoupon-management"==nowPage){for(var s in t.shopcoupon_list){t.shopcoupon_list[s].scm_enddate=t.shopcoupon_list[s].scm_enddate.replace(/-/gi,"/");var r=parseFloat(new Date(t.shopcoupon_list[s].scm_enddate).getTime()),i=parseFloat((new Date).getTime());switch(t.shopcoupon_list[s].scm_poststatus){case"0":t.shopcoupon_list[s].scm_poststatus=stringObj.shop.status_off,t.shopcoupon_list[s].poststatus=!1,r<i?(t.shopcoupon_list[s].scm_poststatus=stringObj.shop.expired,a.shopcoupon_fail.list.push(t.shopcoupon_list[s])):(t.shopcoupon_list[s].scm_poststatus=stringObj.shop.status_off,a.shopcoupon_now.list.push(t.shopcoupon_list[s]));break;case"1":t.shopcoupon_list[s].scm_poststatus=stringObj.shop.status_on,t.shopcoupon_list[s].poststatus=!0,r<i?(t.shopcoupon_list[s].scm_poststatus=stringObj.shop.expired,a.shopcoupon_fail.list.push(t.shopcoupon_list[s])):(t.shopcoupon_list[s].scm_poststatus=stringObj.shop.status_on,a.shopcoupon_now.list.push(t.shopcoupon_list[s]));break;case"2":t.shopcoupon_list[s].scm_poststatus=stringObj.shop.illegal,t.shopcoupon_list[s].poststatus=!1,a.shopcoupon_fail.list.push(t.shopcoupon_list[s]);break;case"3":t.shopcoupon_list[s].scm_poststatus=stringObj.shop.expired,t.shopcoupon_list[s].poststatus=!1,a.shopcoupon_fail.list.push(t.shopcoupon_list[s])}switch(t.shopcoupon_list[s].scm_reservationtag){case"0":t.shopcoupon_list[s].reservationtag=!1;break;case"1":t.shopcoupon_list[s].reservationtag=!0}}if(0==a.shopcoupon_now.list.length)dataNull("templateShopCouponListNull",stringObj.text.no_data,"#shopcoupon-now");else{c=(o=indexObj.template("templateShopCoupons"))(a.shopcoupon_now);$$("#shopcoupon-now .shopcoupon-list").html(c)}$$(".shopcoupon-now").on("show",function(){if(0==a.shopcoupon_now.list.length)dataNull("templateShopCouponListNull",stringObj.text.no_data,".shopcoupon-now");else{var e=indexObj.template("templateShopCoupons")(a.shopcoupon_now);$$(".shopcoupon-now .shopcoupon-list").html(e),setTimeout(function(){myApp.initImagesLazyLoad(".page-content"),$$(".infinite-scroll-preloader").hide()},500)}$(".now").css("background","#F26531"),$(".fail").css("background","#202020")}),$$(".shopcoupon-fail").on("show",function(){if(0==a.shopcoupon_fail.list.length)dataNull("templateShopCouponListNull",stringObj.text.no_data,".shopcoupon-fail");else{var e=indexObj.template("templateShopCoupons")(a.shopcoupon_fail);$$(".shopcoupon-fail .shopcoupon-list").html(e),myApp.initImagesLazyLoad(".page-content"),$$(".infinite-scroll-preloader").hide()}$(".now").css("background","#202020"),$(".fail").css("background","#F26531")}),$(".title a").ellipsis({row:2}),$(".check").click(function(){myApp.alert(stringObj.shop.status_off_edit,stringObj.text.warn)})}else if("branch-info"==nowPage){for(var s in t.shopcoupon_list){switch(t.shopcoupon_list[s].scm_poststatus){case"0":t.shopcoupon_list[s].scm_poststatus=stringObj.shop.status_off,t.shopcoupon_list[s].poststatus=!1;break;case"1":t.shopcoupon_list[s].scm_poststatus=stringObj.shop.status_on,t.shopcoupon_list[s].poststatus=!0;break;case"2":t.shopcoupon_list[s].scm_poststatus=stringObj.shop.illegal,t.shopcoupon_list[s].poststatus=!1;break;case"3":t.shopcoupon_list[s].scm_poststatus=stringObj.shop.expired,t.shopcoupon_list[s].poststatus=!1}switch(t.shopcoupon_list[s].scm_reservationtag){case"0":t.shopcoupon_list[s].reservationtag=!1;break;case"1":t.shopcoupon_list[s].reservationtag=!0}switch(t.shopcoupon_list[s].scm_producttype){case"1":t.shopcoupon_list[s].coupontag=!0;break;case"2":t.shopcoupon_list[s].commoditytag=!0}t.shopcoupon_list[s].scm_startdate=t.shopcoupon_list[s].scm_startdate.replace(/-/gi,"/"),t.shopcoupon_list[s].scm_enddate=t.shopcoupon_list[s].scm_enddate.replace(/-/gi,"/");var n=parseFloat(new Date(t.shopcoupon_list[s].scm_startdate).getTime()),r=parseFloat(new Date(t.shopcoupon_list[s].scm_enddate).getTime()),i=parseFloat((new Date).getTime());t.shopcoupon_list[s].date_status=r>i&&i>n}var o=indexObj.template("templateShopCouponList"),c=o(t);$$(".shopcoupon-list-container").append(c),$(".title a").ellipsis({row:2})}myApp.initImagesLazyLoad(".page-content")}myApp.pullToRefreshDone(".pull-to-refresh-content"),branchObj.refreshLoading=!1},error:function(e){myApp.pullToRefreshDone(".pull-to-refresh-content"),noNetwork(),branchObj.refreshLoading=!1}})},shopcouponManagementInit:function(e){$$(".tab-link").click(function(){$$(".tab-link").removeClass("active"),$$(this).addClass("active")});var t=indexObj._dataStorage(branchObj.storage.branchData);branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,branchObj.getShopCouponList(t.sd_id),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},2e3),$$(".shopcoupon-now").on("show",function(){nowTab="shopcoupon-now",branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$$(".shopcoupon-now .shopcoupon-list").html(""),branchObj.getShopCouponList(t.sd_id)}),$$(".shopcoupon-fail").on("show",function(){nowTab="shopcoupon-fail",shopcoupon_num=0,branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$$(".shopcoupon-fail .shopcoupon-list").html(""),branchObj.getShopCouponList(t.sd_id)}),$$(".pull-to-refresh-content").on("refresh",branchObj.shopCouponListRefresh),$$(".infinite-scroll").on("infinite",function(){branchObj.getShopCouponList(t.sd_id)})},shopquestionnaire_result:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopquestionnaire_result,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sd_id:e},success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopquestionnaire_resultresult){var t=JSON.parse(JSON.stringify(e.shopquestionnaire_resultresult));if("000000000"===t.message_no){for(var a in t.activemessage)t.activemessage[a].ssd_picturepath.match("square")&&(t.activemessage[a].ssd_picturepath=t.activemessage[a].ssd_picturepath.replace("picture?type=square","picture?type=large"));if("questionnaire-management"==nowPage){if(""==t.sd_questiontotalaverage||"0.0"==t.sd_questiontotalaverage)$(".average").html(0),$(".count").html(0),$$(".questionnaire-list .list-null").html(stringObj.text.no_comment),$(".list-null").css("margin-top","25%");else{var s=JSON.parse(t.sd_questiontotalaverage),r={useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""};if((o=new CountUp(".average",0,parseFloat(s.questiontotalaverage.average),0,1,r)).start(),(c=new CountUp(".count",0,parseInt(s.questiontotalaverage.count),0,1,r)).start(),t.activemessage){for(var a in t.activemessage){""==t.activemessage[a].ssd_picturepath&&(t.activemessage[a].ssd_picturepath="../app/image/general_user.png");l=new Date(t.activemessage[a].sqna_last_update);t.activemessage[a].sqna_dt=l.getTime()}t.activemessage.sort(sortByProperty("sqna_dt",-1));p=(d=indexObj.template("templateQuestionnaireList"))(t);$$(".questionnaire-list").append(p),myApp.initImagesLazyLoad(".page-content")}}var i=[],n=[];if(t.sd_questionnaireresult){m=JSON.parse(t.sd_questionnaireresult);for(var a in m.questionnaireresult)i.push(stringObj.shop.sd_question_category_array[parseInt(m.questionnaireresult[a].sd_question_category)]),n.push(20*parseFloat(m.questionnaireresult[a].avg))}else i=stringObj.shop.sd_question_category_array,n=[0,0,0,0,0,0,0,0];u={labels:i,datasets:[{label:"Test",fillColor:"rgba(20,120,220,0.4)",strokeColor:"rgba(20,120,220,1)",pointColor:"rgba(20,120,220,1)",pointStrokeColor:"rgba(255,255,255,.5)",pointHighlightFill:"#000",pointHighlightStroke:"rgba(20,20,220,1)",data:n}]};window.myRadar=new Chart(document.getElementById("mCanvas").getContext("2d")).Radar(u,{responsive:!1,angleLineColor:"rgba(200,200,200,.7)",pointLabelFontColor:"green",pointLabelFontFamily:"'Microsoft JhengHei'",pointLabelFontSize:18,scaleLineColor:"rgba(200, 200, 200, 0.9)"}),browser_width<992?($(".page:not(.cached) #mCanvas").css("width","80%"),$(".page:not(.cached) #mCanvas").css("padding-left","10%")):($(".page:not(.cached) #mCanvas").css("width","50%"),$(".page:not(.cached) #mCanvas").css("padding-left","25%")),$(window).on("resize",function(){browser_width=$(window).width(),"questionnaire-management"==nowPage&&(browser_width<992?($(".page:not(.cached) #mCanvas").css("width","80%"),$(".page:not(.cached) #mCanvas").css("padding-left","10%")):($(".page:not(.cached) #mCanvas").css("width","50%"),$(".page:not(.cached) #mCanvas").css("padding-left","25%")))}),$(".page:not(.cached) #mCanvas").css("height","auto")}else if("branch-info"==nowPage||"used-car-branch-info"==nowPage){if($$(".activemessage-list").html('<div class="list-null"></div>'),""==t.sd_questiontotalaverage||"0.0"==t.sd_questiontotalaverage)$(".average").html(0),$(".count").html(0),$$(".activemessage-list .list-null").html(stringObj.text.no_comment),$(".list-null").css("margin-top","25%");else{var s=JSON.parse(t.sd_questiontotalaverage),r={useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""},o=new CountUp(".average",0,parseFloat(s.questiontotalaverage.average),0,1,r);o.start();var c=new CountUp(".count",0,parseInt(s.questiontotalaverage.count),0,1,r);if(c.start(),t.activemessage){for(var a in t.activemessage){""==t.activemessage[a].ssd_picturepath&&(t.activemessage[a].ssd_picturepath="../app/image/general_user.png"),t.activemessage[a].sqna_last_update=t.activemessage[a].sqna_last_update.replace(/-/gi,"/"),t.activemessage[a].sqnr_last_update=t.activemessage[a].sqnr_last_update.replace(/-/gi,"/");var l=new Date(t.activemessage[a].sqna_last_update);t.activemessage[a].sqna_dt=l.getTime()}t.activemessage.sort(sortByProperty("sqna_dt",-1));var d=indexObj.template("templateBranchEvaluateBrowse"),p=d(t);$$(".activemessage-list").append(p),myApp.initImagesLazyLoad(".page-content")}}var i=[],n=[];if(t.sd_questionnaireresult){var m=JSON.parse(t.sd_questionnaireresult);for(var a in m.questionnaireresult)i.push(m.questionnaireresult[a].sd_question_category),n.push(20*parseFloat(m.questionnaireresult[a].avg))}else i=[0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0];var u={labels:i,datasets:[{label:"TestTest",fillColor:"rgba(20,120,220,0.4)",strokeColor:"rgba(20,120,220,1)",pointColor:"rgba(20,120,220,1)",pointStrokeColor:"rgba(255,255,255,.5)",pointHighlightFill:"#000",pointHighlightStroke:"rgba(20,20,220,1)",data:n}]};window.myRadar=new Chart(document.getElementById("canvas").getContext("2d")).Radar(u,{responsive:!1,angleLineColor:"rgba(200,200,200,.7)",pointLabelFontColor:"green",pointLabelFontFamily:"'Microsoft JhengHei'",pointLabelFontSize:18,scaleLineColor:"rgba(200, 200, 200, 0.9)"}),browser_width<992?($(".page:not(.cached) #canvas").css("width","70%"),$(".page:not(.cached) #canvas").css("margin-left","15%")):($(".page:not(.cached) #canvas").css("width","35%"),$(".page:not(.cached) #canvas").css("margin-left","32.5%")),$(window).on("resize",function(){browser_width=$(window).width(),"branch-info"!=nowPage&&"used-car-branch-info"!=nowPage||(browser_width<992?($(".page:not(.cached) #canvas").css("width","70%"),$(".page:not(.cached) #canvas").css("margin-left","15%")):($(".page:not(.cached) #canvas").css("width","35%"),$(".page:not(.cached) #canvas").css("margin-left","32.5%")))}),$(".page:not(.cached) #canvas").css("height","auto")}}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},questionnaireManagementInit:function(e){var t=indexObj._dataStorage(branchObj.storage.branchData);branchObj.shopquestionnaire_result(t.sd_id)},shopcouponmanager:function(e){e.scm_coupon_usetype=0;var t=indexObj._dataStorage(branchObj.storage.branchData),a=indexObj._dataStorage(branchObj.storage.commodity_data)||{};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopcouponmanager,para:e,success:function(e){if(myApp.hideIndicator(),e.shopcouponmanagerresult){var s=JSON.parse(JSON.stringify(e.shopcouponmanagerresult));if(indexObj._dataStorage(branchObj.storage.imagePath,null),"010907001"===s.message_no){if(isMobile.Android()){if(webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,t.shopcoupon_imgs.main,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",""),t.shopcoupon_imgs.imgs.length>0)for(var r in t.shopcoupon_imgs.imgs)webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,t.shopcoupon_imgs.imgs[r],branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","");if(a.scm_advancedescribe.length>0)for(var i in a.scm_advancedescribe)a.scm_advancedescribe[i].content_img&&webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,a.scm_advancedescribe[i].content_img,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","")}else if(isMobile.iOS()){if(t.shopcoupon_imgs.imgs.push(t.shopcoupon_imgs.main),a.scm_advancedescribe.length>0)for(var i in a.scm_advancedescribe)a.scm_advancedescribe[i].content_img&&t.shopcoupon_imgs.imgs.push(a.scm_advancedescribe[i].content_img);webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,t.shopcoupon_imgs.imgs,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",[])}myApp.toast(stringObj.text.add_success,"",{}).show(),t.shopcoupon_imgs={main:"",imgs:[]},indexObj._dataStorage(branchObj.storage.branchData,t),mainView.router.load({url:"shop/shopcoupon-management"}),indexObj._dataStorage(branchObj.storage.commodity_data,null)}else if("010907002"===s.message_no){if("shopcoupon-edit"==nowPage){if(isMobile.Android()){if(webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,t.shopcoupon_imgs.main,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",""),t.shopcoupon_imgs.imgs.length>0)for(var r in t.shopcoupon_imgs.imgs)webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,t.shopcoupon_imgs.imgs[r],branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","");if(t.delete_imgs.length>0)for(var r in t.delete_imgs)webview.deleteFileFromFTP(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,t.delete_imgs[r])}else isMobile.iOS()&&(t.shopcoupon_imgs.imgs.push(t.shopcoupon_imgs.main),webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,t.shopcoupon_imgs.imgs,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",t.delete_imgs));mainView.router.load({url:"shop/shopcoupon-management"})}else mainView.router.load({url:"shop/shopcoupon-management",reload:!0});t.shopcoupon_imgs={main:"",imgs:[]},indexObj._dataStorage(branchObj.storage.branchData,t),myApp.toast(stringObj.text.edit_success,"",{}).show(),indexObj._dataStorage(branchObj.storage.commodity_data,null)}else stringObj.return_header(s.message_no),_tip&&(myApp.alert(_tip+"( "+s.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},addShopCouponInit:function(e){var t=indexObj._dataStorage(branchObj.storage.commodity_data)||{scm_advancedescribe:[]};if($(".add-shopcoupon-left").click(function(e){indexObj._dataStorage(branchObj.storage.commodity_data,null)}),t){for(var a in t.scm_advancedescribe)t.scm_advancedescribe[a].content_img&&(t.scm_advancedescribe[a].img_path=stringObj.text.branch_img_path);var s=indexObj.template("templateCommodityDetailsAdd")(t);$$(".commodity-details-block.sortable").html(s),myApp.initImagesLazyLoad(".page-content");c=indexObj._dataStorage(branchObj.storage.branchData);if("ShopCoupon"!==localStorage.getItem(branchObj.storage.imagePath)&&(c.shopcoupon_imgs={main:"",imgs:[]}),c.delete_imgs=[],indexObj._dataStorage(branchObj.storage.branchData,c),""!==c.shopcoupon_imgs.main?($$(".image-block .container").html('<div class="main-image-block"><img class="main lazy" data-src="'+stringObj.text.branch_img_path+c.shopcoupon_imgs.main+'"/><div class="main-lable">封面</div></div>'),$(".main-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("main-img",c.shopcoupon_imgs.main):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=main","")})):($$(".image-block .container").html('<div class="main-image-block"><div class="image-item main">+</div><div class="main-lable">封面</div></div>'),$(".main-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("main-img",""):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=main","")})),c.shopcoupon_imgs.imgs.length>0){for(var a in c.shopcoupon_imgs.imgs)$$(".image-block .container").append('<div class="sub-image-block" position='+a+'><img class="lazy" data-src="'+stringObj.text.branch_img_path+c.shopcoupon_imgs.imgs[a]+'" /></div>');$(".sub-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("sub-img",c.shopcoupon_imgs.imgs[parseInt($(this).attr("position"))]):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=sub&position="+$(this).attr("position"),c.shopcoupon_imgs.imgs[parseInt($(this).attr("position"))])})}if(""!=c.shopcoupon_imgs.main&&c.shopcoupon_imgs.imgs.length<5&&($$(".image-block .container").append('<div class="image-item">+</div>'),$(".image-item").click(function(){isMobile.Android()||isMobile.iOS()?addImage("sub-img",""):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=sub&position=add","")})),""==c.shopcoupon_imgs.main&&0==c.shopcoupon_imgs.imgs.length&&$(".image-item").css("padding","0"),myApp.initImagesLazyLoad(".page-content"),$("#shopcoupon-name").val(t.scm_title),$(".scm_producttype").val(stringObj.shop.scm_producttype_array[parseInt(t.scm_producttype)-1]),$("#scm_fulldescript").val(t.scm_fulldescript),$("#shopcoupon-type").val(t.scm_type),$(".scm_coupon_providetype").val(stringObj.shop.scm_coupon_providetype_array[parseInt(t.scm_coupon_providetype)]),$("#scm_bonus_payamount").val(t.scm_bonus_payamount),$("#scm_bonus_giveamount").val(t.scm_bonus_giveamount),$("#price").val(t.scm_price),t.scm_startdate&&$("#calendar-range").val(t.scm_startdate.replace(/-/gi,"/")+" - "+t.scm_enddate.replace(/-/gi,"/")),$("#limit").val(t.scm_member_limit),$("#scm_balanceno").val(t.scm_balanceno),"1"===t.scm_coupon_providetype&&($(".scm_bonus_payamount").css("display","inherit"),$("#price").val(0),$(".price").css("display","none")),1===t.scm_bonus_giveafteruse?($(".scm_bonus_giveamount").css("display","inherit"),$(".giveafteruse-checkbox").prop("checked",!0)):$("#scm_bonus_giveamount").val(""),1===(d=t.scm_reservationtag)){if($(".branch-region").css("display","inherit"),$(".reservation-checkbox").prop("checked",!0),$("#calendar-range").css("color","#fff"),$(".shopcoupon-time").css("display","inherit"),$(".weekend-radio").css("display","inherit"),$(".require-time").css("display","inherit"),$(".prepare-time").css("display","inherit"),$(".reserve-num").css("display","inherit"),t.scm_dailystart&&$("#shopcoupon-time").val(t.scm_dailystart.substring(0,5)+" ~ "+t.scm_dailyend.substring(0,5)),t.scm_workhour){var r=parseInt(30*parseFloat(t.scm_workhour)/60),i=parseInt(30*parseFloat(t.scm_workhour)%60);r<10&&(r="0"+r),i<10&&(i="0"+i),$("#require-time").val(r+" 小時 "+i+" 分鐘")}if(t.scm_preparehour){var n=parseInt(30*parseFloat(t.scm_preparehour)/60),o=parseInt(30*parseFloat(t.scm_preparehour)%60);n<10&&(n="0"+n),o<10&&(o="0"+o),$("#prepare-time").val(n+" 小時 "+o+" 分鐘")}$("#reserve-num").val(t.scm_reservationavailable),"1"===t.scm_includeweekend?$(".includ").prop("checked",!0):"0"===t.scm_includeweekend&&$(".not_included").prop("checked",!0)}}var c=indexObj._dataStorage(branchObj.storage.branchData)||{};if("ShopCoupon"!==localStorage.getItem(branchObj.storage.imagePath)&&(c.shopcoupon_imgs={main:"",imgs:[]}),indexObj._dataStorage(branchObj.storage.branchData,c),""!==c.shopcoupon_imgs.main?($$(".image-block .container").html('<div class="main-image-block"><img class="main lazy" data-src="'+stringObj.text.branch_img_path+c.shopcoupon_imgs.main+'"/><div class="main-lable">封面</div></div>'),$(".main-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("main-img",c.shopcoupon_imgs.main):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=main","")})):($$(".image-block .container").html('<div class="main-image-block"><div class="image-item main">+</div><div class="main-lable">封面</div></div>'),$(".main-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("main-img",""):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=main","")})),c.shopcoupon_imgs.imgs.length>0){for(var a in c.shopcoupon_imgs.imgs)$$(".image-block .container").append('<div class="sub-image-block" position='+a+'><img class="lazy" data-src="'+stringObj.text.branch_img_path+c.shopcoupon_imgs.imgs[a]+'" /></div>');$(".sub-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("sub-img",c.shopcoupon_imgs.imgs[parseInt($(this).attr("position"))]):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=sub&position="+$(this).attr("position"),c.shopcoupon_imgs.imgs[parseInt($(this).attr("position"))])})}""!=c.shopcoupon_imgs.main&&c.shopcoupon_imgs.imgs.length<5&&($$(".image-block .container").append('<div class="image-item">+</div>'),$(".image-item").click(function(){isMobile.Android()||isMobile.iOS()?addImage("sub-img",""):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=sub&position=add","")})),""==c.shopcoupon_imgs.main&&0==c.shopcoupon_imgs.imgs.length&&$(".image-item").css("padding","0"),myApp.initImagesLazyLoad(".page-content"),$(".branch-region").css("display","inherit");var l=myApp.calendar({input:"#calendar-range",dateFormat:"yyyy/mm/dd",rangePicker:!0,monthNames:stringObj.text.monthNames});$("#calendar-range").change(function(){23==$(this).val().length&&l.close()}),t.scm_bonus_giveafteruse||(t.scm_bonus_giveafteruse=0,indexObj._dataStorage(branchObj.storage.commodity_data,t));d=t.scm_bonus_giveafteruse||0;$(".giveafteruse-checkbox").change(function(){$(this).is(":checked")?(scm_bonus_giveafteruse=1,t.scm_bonus_giveafteruse=1,indexObj._dataStorage(branchObj.storage.commodity_data,t),$(".scm_bonus_giveamount").css("display","inherit")):(scm_bonus_giveafteruse=0,t.scm_bonus_giveafteruse=0,indexObj._dataStorage(branchObj.storage.commodity_data,t),$(".scm_bonus_giveamount").css("display","none"))}),t.scm_reservationtag||(t.scm_reservationtag=0,indexObj._dataStorage(branchObj.storage.commodity_data,t));var d=t.scm_reservationtag||0;$(".reservation-checkbox").change(function(){$(this).is(":checked")?(d=1,t.scm_reservationtag=1,indexObj._dataStorage(branchObj.storage.commodity_data,t),$(".shopcoupon-time").css("display","inherit"),$(".weekend-radio").css("display","inherit"),$(".require-time").css("display","inherit"),$(".prepare-time").css("display","inherit"),$(".reserve-num").css("display","inherit")):(d=0,t.scm_reservationtag=0,indexObj._dataStorage(branchObj.storage.commodity_data,t),$(".shopcoupon-time").css("display","none"),$(".weekend-radio").css("display","none"),$(".require-time").css("display","none"),$(".prepare-time").css("display","none"),$(".reserve-num").css("display","none"))}),"2"===t.scm_producttype&&(d=0,t.scm_reservationtag=0,indexObj._dataStorage(branchObj.storage.commodity_data,t),$(".branch-region").css("display","none"),$(".shopcoupon-time").css("display","none"),$(".weekend-radio").css("display","none"),$(".require-time").css("display","none"),$(".prepare-time").css("display","none"),$(".reserve-num").css("display","none"),$(".reservation-checkbox").prop("checked",!1)),$$(".shopcoupon-name").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="名稱">',"商品名稱"),$(".input-value").val($("#shopcoupon-name").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#shopcoupon-name").val($(".input-value").val())})}),$$(".scm_fulldescript").on("click",function(){myApp.alert('<textarea class="info resizable" placeholder="內容" rows="9"></textarea>',"活動說明"),$(".info").val($("#scm_fulldescript").val()),$("textarea.info").focus(),$(".modal-button").click(function(){$("#scm_fulldescript").val($(".info").val())})}),$$(".price").on("click",function(){myApp.alert('<input class="input-value" type="number" min="0" placeholder="金額" onkeydown="input_limit(this, 9);" onkeyup="input_limit(this, 9);">',"費用"),$(".input-value").val($("#price").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#price").val($(".input-value").val())})}),$$(".scm_bonus_payamount").on("click",function(){myApp.alert('<input class="input-value" type="number" min="1" placeholder="數額（1~9999）" onkeydown="input_limit(this, 4);" onkeyup="input_limit(this, 4);">',"特點扣除"),$(".input-value").val($("#scm_bonus_payamount").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#scm_bonus_payamount").val($(".input-value").val())})}),$$(".scm_bonus_giveamount").on("click",function(){myApp.alert('<input class="input-value" type="number" min="1" placeholder="數額（1~9999）" onkeydown="input_limit(this, 4);" onkeyup="input_limit(this, 4);">',"特點贈與"),$(".input-value").val($("#scm_bonus_giveamount").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#scm_bonus_giveamount").val($(".input-value").val())})}),$$(".limit").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="張數" onkeydown="input_limit(this, 9);" onkeyup="input_limit(this, 9);">',"索取張數限制"),$(".input-value").val($("#limit").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#limit").val($(".input-value").val())})}),$$(".scm_balanceno").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="單號">',"銷帳單號"),$(".input-value").val($("#scm_balanceno").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#scm_balanceno").val($(".input-value").val())})}),$$(".reserve-num").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="數目">',"同時段允許預約數"),$(".input-value").val($("#reserve-num").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#reserve-num").val($(".input-value").val())}),""!=$("#limit").val()&&$(".input-value").on("input",function(e){$(this).val()>parseInt($("#limit").val())&&$(this).val(parseInt($("#limit").val())),$(this).val()<0&&$(this).val(1),0==$(this).val()&&$(this).val("")})});myApp.picker({input:".scm_producttype",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.scm_producttype+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){t.scm_producttype&&e.setValue([parseInt(t.scm_producttype)])},onClose:function(e){t.scm_producttype=e.cols[0].value,indexObj._dataStorage(branchObj.storage.commodity_data,t),"1"===e.cols[0].value?($(".branch-region").css("display","inherit"),1===t.scm_reservationtag&&($(".shopcoupon-time").css("display","inherit"),$(".weekend-radio").css("display","inherit"),$(".require-time").css("display","inherit"),$(".prepare-time").css("display","inherit"),$(".reserve-num").css("display","inherit"))):($(".branch-region").css("display","none"),$(".shopcoupon-time").css("display","none"),$(".weekend-radio").css("display","none"),$(".require-time").css("display","none"),$(".prepare-time").css("display","none"),$(".reserve-num").css("display","none"))},cols:[{textAlign:"center",values:[1,2],width:"100%",displayValues:stringObj.shop.scm_producttype_array,onChange:function(e,t){}}]}),myApp.picker({input:".scm_coupon_providetype",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.scm_coupon_providetype+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onClose:function(e){t.scm_coupon_providetype=e.cols[0].value,indexObj._dataStorage(branchObj.storage.commodity_data,t),"1"===e.cols[0].value?($(".scm_bonus_payamount").css("display","inherit"),$("#price").val(0),$(".price").css("display","none")):($(".scm_bonus_payamount").css("display","none"),$("#price").val(""),$(".price").css("display","inherit"))},cols:[{textAlign:"center",values:[0,1],width:"100%",displayValues:stringObj.shop.scm_coupon_providetype_array}]}),myApp.picker({input:".page:not(.cached) #shopcoupon-time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">活動每日時間</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+":"+t[1]+" ~ "+t[2]+":"+t[3]},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:":"},{values:["00","30"]},{textAlign:"center",divider:!0,content:" ~ "},{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:":"},{textAlign:"center",values:["00","30"]}]}),myApp.picker({input:".page:not(.cached) #require-time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">作業工時</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+" 小時 "+t[1]+" 分鐘 "},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:" 小時 "},{values:["00","30"]},{textAlign:"center",divider:!0,content:" 分鐘 "}]}),myApp.picker({input:".page:not(.cached) #prepare-time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">準備工時</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+" 小時 "+t[1]+" 分鐘 "},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:" 小時 "},{values:["00","30"]},{textAlign:"center",divider:!0,content:" 分鐘 "}]});localStorage.getItem("scrollTop")&&($(".add-shopcoupon-content").scrollTop(parseFloat(localStorage.getItem("scrollTop"))),localStorage.removeItem("scrollTop")),$(".move-up").click(function(e){0!==$(this).parents("li").index()&&((t=indexObj._dataStorage(branchObj.storage.commodity_data)||{}).scm_advancedescribe||(t.scm_advancedescribe=rObj.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,t)),t.scm_advancedescribe.splice($(this).parents("li").index()-1,0,t.scm_advancedescribe.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.commodity_data,t),$(this).parents("li").insertBefore(".commodity-details-block.sortable li:nth-child("+$(this).parents("li").index()+")"))}),$(".move-down").click(function(e){(t=indexObj._dataStorage(branchObj.storage.commodity_data)||{}).scm_advancedescribe?$(this).parents("li").index()<t.scm_advancedescribe.length-1&&(t.scm_advancedescribe.splice($(this).parents("li").index()+1,0,t.scm_advancedescribe.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.commodity_data,t),$(this).parents("li").insertAfter(".commodity-details-block.sortable li:nth-child("+($(this).parents("li").index()+2)+")")):(t.scm_advancedescribe=rObj.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,t),t.scm_advancedescribe.splice($(this).parents("li").index()+1,0,t.scm_advancedescribe.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.commodity_data,t),$(this).parents("li").insertAfter(".commodity-details-block.sortable li:nth-child("+($(this).parents("li").index()+2)+")"))}),$(".details-img").click(function(){t.scm_advancedescribe||(t.scm_advancedescribe=rObj.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,t)),void 0!==Cookies.get("app_version")?addImage("shopcoupon",t.scm_advancedescribe[$(this).parents("li").index()].content_img):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=details&position="+$(this).parents("li").index(),t.scm_advancedescribe[$(this).parents("li").index()].content_img)}),$(".details-text").parents(".item-inner").click(function(){t.scm_advancedescribe||(t.scm_advancedescribe=rObj.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,t));var e=$(this).parents("li").index(),a=$(this).find(".details-text");myApp.modal({title:"文字內容",text:'<textarea class="info resizable" placeholder="內容" rows="8"></textarea>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text._clear,onClick:function(){t.scm_advancedescribe.splice(e,1),a.parents(".commodity-details-item").remove(),indexObj._dataStorage(branchObj.storage.commodity_data,t)}},{text:stringObj.text.edit,onClick:function(){t.scm_advancedescribe||(t.scm_advancedescribe=rObj.scm_advancedescribe,indexObj._dataStorage(branchObj.storage.commodity_data,t)),t.scm_advancedescribe[e].content_text=$("textarea.info").val(),$("textarea.info").val()?a.text($("textarea.info").val()):(t.scm_advancedescribe.splice(e,1),a.parents(".commodity-details-item").remove()),indexObj._dataStorage(branchObj.storage.commodity_data,t)}}]}),$("textarea.info").val(a.text()),$("textarea.info").focus()}),$(".add-details-image").unbind("click"),$(".add-details-text").unbind("click"),$(".add-details-image").click(function(){t.scm_advancedescribe||(t.scm_advancedescribe=rObj.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,t)),void 0!==Cookies.get("app_version")?addImage("shopcoupon",""):setImgOnPC("sd_id="+c.sd_id+"&folder=shopcoupon&type=details&position=add","")}),$(".add-details-text").click(function(){myApp.modal({title:"文字內容",text:'<textarea class="info resizable" placeholder="內容" rows="8"></textarea>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.add,onClick:function(){""!==$.trim($("textarea.info").val())&&(t.scm_advancedescribe.push({content_text:$("textarea.info").val(),content_img:""}),indexObj._dataStorage(branchObj.storage.commodity_data,t),localStorage.setItem("scrollTop",$(".add-shopcoupon-content").scrollTop()+70),saveData(),mainView.router.load({url:window.location.href.substring(window.location.href.indexOf("#!/")+3),reload:!0}))}}]}),$("textarea.info").focus()}),$(".add").click(function(){c=indexObj._dataStorage(branchObj.storage.branchData),t=indexObj._dataStorage(branchObj.storage.commodity_data),$(".shopcoupon-name").removeClass("lengthError"),$(".scm_fulldescript").removeClass("lengthError"),$(".scm_balanceno").removeClass("lengthError"),$(".scm_bonus_payamount").removeClass("lengthError"),$(".scm_bonus_giveamount").removeClass("lengthError"),$(".price").removeClass("spacesError"),$(".limit").removeClass("spacesError"),$(".reserve-num").removeClass("spacesError"),$(".scm_bonus_payamount").removeClass("spacesError"),$(".scm_bonus_giveamount").removeClass("spacesError"),$(".shopcoupon-name").removeClass("nullError"),$(".scm_fulldescript").removeClass("nullError"),$(".scm_category").removeClass("nullError"),$(".price").removeClass("nullError"),$(".scm_date").removeClass("nullError"),$(".limit").removeClass("nullError"),$(".scm_producttype-block").removeClass("nullError"),$(".shopcoupon-time").removeClass("nullError"),$(".require-time").removeClass("nullError"),$(".prepare-time").removeClass("nullError"),$(".reserve-num").removeClass("nullError"),$(".scm_coupon_providetype-block").removeClass("nullError"),$(".scm_bonus_payamount").removeClass("nullError"),$(".scm_bonus_giveamount").removeClass("nullError"),$(".scm_date").removeClass("formatError"),$(".noSetMainImg").css("display","none");var e=!1;$("#shopcoupon-name").val().length>40&&($(".shopcoupon-name").addClass("lengthError"),e=!0),$("#scm_fulldescript").val().length>500&&($(".scm_fulldescript").addClass("lengthError"),e=!0),$("#scm_balanceno").val().length>50&&($(".scm_balanceno").addClass("lengthError"),e=!0),$("#scm_bonus_payamount").val().length>4&&($(".scm_bonus_payamount").addClass("lengthError"),e=!0),$("#scm_bonus_giveamount").val().length>4&&($(".scm_bonus_giveamount").addClass("lengthError"),e=!0),-1!==$("#price").val().indexOf(" ")&&($(".price").addClass("spacesError"),e=!0),-1!==$("#limit").val().indexOf(" ")&&($(".limit").addClass("spacesError"),e=!0),-1!==$("#scm_bonus_payamount").val().indexOf(" ")&&($(".scm_bonus_payamount").addClass("spacesError"),e=!0),-1!==$("#scm_bonus_giveamount").val().indexOf(" ")&&($(".scm_bonus_giveamount").addClass("spacesError"),e=!0),""===c.shopcoupon_imgs.main&&($(".noSetMainImg").css("display","inherit"),e=!0),""===$.trim($("#shopcoupon-name").val())&&($(".shopcoupon-name").addClass("nullError"),e=!0),""===$.trim($("#scm_fulldescript").val())&&($(".scm_fulldescript").addClass("nullError"),e=!0),""===$.trim($("#calendar-range").val())&&($(".scm_date").addClass("nullError"),e=!0),""===$.trim($("#limit").val())&&($(".limit").addClass("nullError"),e=!0),""===$.trim($(".scm_coupon_providetype").val())&&($(".scm_coupon_providetype-block").addClass("nullError"),e=!0),"1"===t.scm_coupon_providetype?(""===$.trim($("#scm_bonus_payamount").val())||parseInt($.trim($("#scm_bonus_payamount").val()))<=0)&&($(".scm_bonus_payamount").addClass("nullError"),e=!0):(""===$.trim($("#price").val())||parseInt($.trim($("#price").val()))<=0)&&($(".price").addClass("nullError"),e=!0),1===t.scm_bonus_giveafteruse&&(""===$.trim($("#scm_bonus_giveamount").val())||parseInt($.trim($("#scm_bonus_giveamount").val()))<=0)&&($(".scm_bonus_giveamount").addClass("nullError"),e=!0),$("#calendar-range").val().length<23&&($(".scm_date").addClass("formatError"),e=!0),1===d&&(-1!==$("#reserve-num").val().indexOf(" ")&&($(".branch-address").addClass("spacesError"),e=!0),""===$("#shopcoupon-time").val()&&($(".shopcoupon-time").addClass("nullError"),e=!0),""===$("#require-time").val()&&($(".require-time").addClass("nullError"),e=!0),""===$("#prepare-time").val()&&($(".prepare-time").addClass("nullError"),e=!0),""===$("#reserve-num").val()&&($(".reserve-num").addClass("nullError"),e=!0)),e&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%"))),c.shopcoupon_imgs.main.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(c.shopcoupon_imgs.main=c.shopcoupon_imgs.main.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length),indexObj._dataStorage(branchObj.storage.branchData,c));for(var a in c.shopcoupon_imgs.imgs)c.shopcoupon_imgs.imgs[a].match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(c.shopcoupon_imgs.imgs.splice(a,1,c.shopcoupon_imgs.imgs[a].substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length)),indexObj._dataStorage(branchObj.storage.branchData,c));if(t.scm_advancedescribe.length>0)for(var s in t.scm_advancedescribe)t.scm_advancedescribe[s].content_img.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(t.scm_advancedescribe[s].content_img=t.scm_advancedescribe[s].content_img.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length),indexObj._dataStorage(branchObj.storage.commodity_data,t));var r=indexObj._dataCookies(indexObj._storage.main);c=indexObj._dataStorage(branchObj.storage.branchData);var i={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,sd_id:c.sd_id,scm_id:"",managetype:0,scm_title:$("#shopcoupon-name").val(),scm_fulldescript:$("#scm_fulldescript").val(),scm_producttype:"1",scm_category:0,scm_mainpic:c.shopcoupon_imgs.main,scm_activepics:JSON.stringify(c.shopcoupon_imgs.imgs),scm_price:$("#price").val(),scm_startdate:$("#calendar-range").val().substring(0,10),scm_enddate:$("#calendar-range").val().substring(13),scm_reservationtag:d,scm_dailystart:$("#shopcoupon-time").val().substring(0,5),scm_dailyend:$("#shopcoupon-time").val().substring(8),scm_workhour:(60*parseInt($("#require-time").val().substring(0,2))+parseInt($("#require-time").val().substring(6,8)))/30,scm_preparehour:(60*parseInt($("#prepare-time").val().substring(0,2))+parseInt($("#prepare-time").val().substring(6,8)))/30,scm_includeweekend:$("input[name='weekend-radio']:checked").val(),scm_reservationavailable:$("#reserve-num").val(),scm_poststatus:"",scm_member_limit:$("#limit").val(),scm_balanceno:$("#scm_balanceno").val(),scm_coupon_providetype:t.scm_coupon_providetype,scm_bonus_payamount:$("#scm_bonus_payamount").val(),scm_bonus_giveafteruse:t.scm_bonus_giveafteruse,scm_bonus_giveamount:$("#scm_bonus_giveamount").val(),scm_advancedescribe:JSON.stringify(t.scm_advancedescribe),md_securitycode:""};""===$("#scm_bonus_payamount").val()&&(i.scm_bonus_payamount=0),""===$("#scm_bonus_giveamount").val()&&(i.scm_bonus_giveamount=0),e||branchObj.shopcouponmanager(i)}),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},2e3)},shopCouponContentGet:function(e,t,a,s,r){myApp.showIndicator();var i={modacc:stringObj.shop.moduleaccount,modvrf:encodeURIComponent(btoa(localStorage.getItem("salt_no")+"_"+CryptoJS.SHA256(stringObj.shop.moduleaccount+stringObj.shop.modulepassword+localStorage.getItem("salt")))),scm_id:e};indexObj._wcfget({url:branchObj.dataUrl.shopcouponcontentquery,para:i,success:function(i){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(i),i.shopcouponcontentqueryresult){var n=JSON.parse(JSON.stringify(i.shopcouponcontentqueryresult));if("000000000"===n.message_no){if(n.scm_startdate=n.scm_startdate.replace(/-/gi,"/"),n.scm_enddate=n.scm_enddate.replace(/-/gi,"/"),"edit"!=t){if("shopcoupon-info"===nowPage){if(indexObj._dataStorage("logistics_data",null),indexObj._dataStorage("shop_buy_data",null),indexObj._dataStorage("shop_item",n),n.scm_advancedescribe){n.scm_advancedescribe=JSON.parse(n.scm_advancedescribe);for(var o in n.scm_advancedescribe)n.scm_advancedescribe[o].content_img&&(n.scm_advancedescribe[o].content_img=stringObj.text.branch_img_path+n.scm_advancedescribe[o].content_img)}g=(O=indexObj.template("templateShopCouponInfo"))(n);$$(".shopcoupon-info-block").html(g);indexObj._dataCookies(indexObj._storage.main);"scan"===t?($(".serving").css("display","inherit"),$(".favorite").css("display","none"),$(".shopcoupon-subTitle").css("display","none"),$(".branch-info").css("display","none"),$("#shopcoupon-map").css("display","none"),$(".shopcoupon-info-block").css("height","auto"),$$(".shopcoupon-info-left a").attr("href","shop/branch-main")):"shop_available"===t||"shop_finish"==t||"shop_invalid"==t||"reserved"==t||"favorite"==t?"shop_available"===t?($(".showQR").css("display","inherit"),$$(".shopcoupon-info-left a").attr("href","coupon-record?tab=shop-coupon")):"reserved"==t?($(".reserved").css("display","inherit"),$$(".shopcoupon-info-left a").attr("href","coupon-record?tab=shop-coupon")):"favorite"===t?($(".get").css("display","inherit"),$$(".shopcoupon-info-left a").attr("href","#"),$$(".shopcoupon-info-left a").click(function(){window.history.back()})):$$(".shopcoupon-info-left").html('<a href="branch-info?sd_id='+n.sd_id+'&tab=branch-preferential-content" class="link icon-only"><span class="icon-chevron-left"></span></a>'):"management"===t?$$(".shopcoupon-info-left").html('<a href="shop/shopcoupon-management" class="link icon-only"><span class="icon-chevron-left"></span></a>'):($(".get").css("display","inherit"),$$(".shopcoupon-info-left").html('<a href="branch-info?sd_id='+n.sd_id+'&tab=branch-preferential-content" class="link icon-only"><span class="icon-chevron-left"></span></a>')),"1"===n.scm_reservationtag?($(".reservationtag").css("display","inherit"),$(".showQR .toolbar-inner a").html("預約")):"1"===n.scm_producttype?$(".coupontag").css("display","inherit"):"2"===n.scm_producttype&&$(".commoditytag").css("display","inherit");var c=new Swiper(".shopcoupon-imgs",{pagination:".swiper-pagination",paginationClickable:!0,centeredSlides:!0,autoplay:3e3,autoplayDisableOnInteraction:!1,loop:!0,effect:"fade"});c.appendSlide('<div class="swiper-slide shop-item" id="shop-main"><img src="'+stringObj.text.branch_img_path+n.scm_mainpic+'" onerror=\'this.src="../app/image/imgDefault.png"\'/></div>');var l=JSON.parse(n.scm_activepics);for(var o in l)c.appendSlide('<div class="swiper-slide shop-item" id="shop-img'+o+'"><img src="'+stringObj.text.branch_img_path+l[o]+'" onerror=\'this.src="../app/image/imgDefault.png"\'/></div>');c.slideTo(1,0,!0);var d=new google.maps.LatLng(parseFloat(n.sd_lat),parseFloat(n.sd_lng)),p={zoom:15,center:d,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},m=new google.maps.Map(document.getElementById("shopcoupon-map"),p);branchObj.addMarker(d,n.sd_shopname,m),myApp.initImagesLazyLoad(".page-content");var u=indexObj._dataStorage(indexObj._storage.favorite);if(u)for(var o in u.shopcouponList)$$(".favorite-"+u.shopcouponList[o].ubm_objectid).html('<i class="fa fa-star"></i>');$(".get").click(function(){indexObj._dataCookies(indexObj._storage.main).sat?parseInt(n.inventory)>0?(localStorage.setItem("scm_id",e),"1"===n.scm_reservationtag?(mainView.router.load({url:"shop-buy-data?scm_id="+e+"&from=reservation"}),localStorage.setItem("scm_enddate",n.scm_enddate)):"1"===n.scm_producttype?mainView.router.load({url:"shop-buy-data?scm_id="+e+"&from=coupon"}):"2"===n.scm_producttype&&mainView.router.load({url:"shop-buy-data?scm_id="+e+"&from=commodity"})):myApp.toast(stringObj.shop.no_inventory,"",{}).show():myApp.modal({title:stringObj.text.warn,text:stringObj.text.notLogin,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.login,onClick:function(){webview.loginPage()}}]})}),$(".showQR").click(function(){var e=indexObj._dataStorage(branchObj.storage.shopCouponRecord);if(findArrayItem(e.availableList,"scg_id",a),"0"==n.scm_reservationtag){var t=new Date,s=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),r='{"scm_id":"'+e.availableList[nowIndex].scm_id+'","scg_id":"'+a+'","nowDate":"'+s+'"}';myApp.modal({title:"",text:'<div class="qr-content"><div class="qr-title">'+stringObj.text.qr_title+'</div><div class="qr-code"></div><p class="qr-use-title"><b style="color:#F26531;">'+stringObj.text.qr_subtitle+'：</b></p><p class="qr-use-content">'+stringObj.text.qr_context+"</p></div>",buttons:[{text:stringObj.text.confirm,bold:!0,onClick:function(){}}]}),$(".qr-code").qrcode({render:"div",size:235,background:"#fff",text:r}),$(".modal").css("top","30%"),$(".modal").css("width","270px")}else mainView.router.load({url:"shop/shopcoupon-reservation?scm_id="+e.availableList[nowIndex].scm_id+"&scm_title="+e.availableList[nowIndex].scm_title+"&scm_enddate="+e.availableList[nowIndex].scm_enddate+"&scg_id="+e.availableList[nowIndex].scg_id+"&booktype=0",reload:!0})}),$(".qrCode").click(function(){var e=indexObj._dataStorage(branchObj.storage.shopCouponRecord);findArrayItem(e.availableList,"scg_id",a);var t=new Date,s=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),r='{"scm_id":"'+e.availableList[nowIndex].scm_id+'","scg_id":"'+a+'","nowDate":"'+s+'"}';myApp.modal({title:"",text:'<div class="qr-content"><div class="qr-title">'+stringObj.text.qr_title+'</div><div class="qr-code"></div><p class="qr-use-title"><b style="color:#F26531;">'+stringObj.text.qr_subtitle+'：</b></p><p class="qr-use-content">'+stringObj.text.qr_context+"</p></div>",buttons:[{text:stringObj.text.confirm,bold:!0,onClick:function(){}}]}),$(".qr-code").qrcode({render:"div",size:235,background:"#fff",text:r}),$(".modal").css("top","30%"),$(".modal").css("width","270px")}),$(".editDate").click(function(){var t=indexObj._dataStorage(branchObj.storage.shopCouponRecord);findArrayItem(t.availableList,"scg_id",a),mainView.router.load({url:"shop/shopcoupon-reservation?scm_id="+e+"&scm_title="+t.availableList[nowIndex].scm_title+"&scm_enddate="+t.availableList[nowIndex].scm_enddate+"&scg_id="+a+"&booktype=1",reload:!0})}),$(".serving").click(function(){branchObj.shopcouponexec(e,a,s,r)})}else if("branch-main"===nowPage){indexObj._dataStorage("scm_item",n);var b=indexObj._dataStorage("reservationinfo");if(findArrayItem(b.reservelist,"scg_id",a),b.reservelist[nowIndex].moc_id)branchObj.query_member_car_detail(b.reservelist[nowIndex].moc_id);else{var _='<div class="popup popup-reserve"><div class="page-content"><div class="title">'+n.scm_title+'</div><div class="image-blcok"><img src="'+stringObj.text.branch_img_path+n.scm_mainpic+'" class="main-img" onerror=\'this.src="app/image/imgDefault.png"\'/></div><div class="reserve-info-content"><div class="subtitle">'+stringObj.text.description_context+'</div><div class="context">'+n.scm_fulldescript+'</div><div class="subtitle">'+stringObj.text.user_info+'</div><div class="context" style="display: inline-flex;"><div class="item-title">'+stringObj.text.reservationTime+'：</div><div class="reserve-time">'+b.reservationdate+" "+b.reservelist[nowIndex].scr_rvtime+'</div></div><br><div class="context" style="display: inline-flex;"><div class="item-title">備註留言：</div><div class="reserve-time">'+b.reservelist[nowIndex].scg_buyermessage+'</div></div></div></div><div class="toolbar toolbar-bottom tabbar animated fadeInUp"><div class="toolbar-inner"><a href="#" class="confirm">'+stringObj.text.confirm+"</a></div></div></div>";myApp.popup(_),$(".popup-reserve").css("z-index","91000"),$(".toolbar .confirm").click(function(){myApp.closeModal(".popup-reserve")})}}}else if("shopcoupon-edit"==nowPage){var h=indexObj._dataStorage(branchObj.storage.branchData);if("ShopCoupon"!=localStorage.getItem(branchObj.storage.imagePath)&&(h.shopcoupon_imgs={main:n.scm_mainpic,imgs:JSON.parse(n.scm_activepics)}),h.delete_imgs=[],indexObj._dataStorage(branchObj.storage.branchData,h),$(".shopcoupon-edit-left").click(function(){h.shopcoupon_imgs={main:"",imgs:[]},indexObj._dataStorage(branchObj.storage.branchData,h),indexObj._dataStorage(branchObj.storage.commodity_data,null)}),""!==h.shopcoupon_imgs.main?($$(".image-block .container").html('<div class="main-image-block"><img class="main lazy" data-src="'+stringObj.text.branch_img_path+h.shopcoupon_imgs.main+'"/><div class="main-lable">封面</div></div>'),$(".main-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("main-img",h.shopcoupon_imgs.main):setImgOnPC("sd_id="+h.sd_id+"&folder=shopcoupon&type=main","")})):($$(".image-block .container").html('<div class="main-image-block"><div class="image-item main">+</div><div class="main-lable">封面</div></div>'),$(".main-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("main-img",""):(j.scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j)),setImgOnPC("sd_id="+h.sd_id+"&folder=shopcoupon&type=main",""))})),h.shopcoupon_imgs.imgs.length>0){for(var o in h.shopcoupon_imgs.imgs)$$(".image-block .container").append('<div class="sub-image-block" position='+o+'><img class="lazy" data-src="'+stringObj.text.branch_img_path+h.shopcoupon_imgs.imgs[o]+'" /></div>');$(".sub-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("sub-img",h.shopcoupon_imgs.imgs[parseInt($(this).attr("position"))]):(j.scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j)),setImgOnPC("sd_id="+h.sd_id+"&folder=shopcoupon&type=sub&position="+$(this).attr("position"),h.shopcoupon_imgs.imgs[parseInt($(this).attr("position"))]))})}""!==h.shopcoupon_imgs.main&&h.shopcoupon_imgs.imgs.length<5&&($$(".image-block .container").append('<div class="image-item">+</div>'),$(".image-item").click(function(){isMobile.Android()||isMobile.iOS()?addImage("sub-img",""):(j.scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j)),setImgOnPC("sd_id="+h.sd_id+"&folder=shopcoupon&type=sub&position=add",""))})),""==h.shopcoupon_imgs.main&&0==h.shopcoupon_imgs.imgs.length&&$(".image-item").css("padding","0"),myApp.initImagesLazyLoad(".page-content"),isMobile.Android()||isMobile.iOS()||$(".page-content .image-block").niceScroll({cursorcolor:"rgba(100,100,100,.9)",cursoropacitymin:0,cursorborder:"1px solid #000"});var g,v,f,y,O=indexObj.template("templateShopCouponEdit"),j=indexObj._dataStorage(branchObj.storage.commodity_data)||{};if(j.scm_title){for(var o in j.scm_advancedescribe)j.scm_advancedescribe[o].content_img&&(j.scm_advancedescribe[o].img_path=stringObj.text.branch_img_path);if(j.scm_producttype=stringObj.shop.scm_producttype_array[parseInt(j.scm_producttype)-1],j.scm_date=j.scm_startdate.replace(/-/gi,"/")+" - "+j.scm_enddate.replace(/-/gi,"/"),v=j.scm_reservationtag,y=j.scm_coupon_providetype,f=j.scm_bonus_giveafteruse,j.scm_coupon_providetype=stringObj.shop.scm_coupon_providetype_array[parseInt(j.scm_coupon_providetype)],"1"===v){j.scm_daily=j.scm_dailystart.substring(0,5)+" ~ "+j.scm_dailyend.substring(0,5);var x=parseInt(30*parseFloat(j.scm_workhour)/60),k=parseInt(30*parseFloat(j.scm_workhour)%60),w=parseInt(30*parseFloat(j.scm_preparehour)/60),I=parseInt(30*parseFloat(j.scm_preparehour)%60);x<10&&(x="0"+x),k<10&&(k="0"+k),w<10&&(w="0"+w),I<10&&(I="0"+I),j.scm_workhour=x+" 小時 "+k+" 分鐘",j.scm_preparehour=w+" 小時 "+I+" 分鐘"}g=O(j)}else{if(n.scm_advancedescribe){n.scm_advancedescribe=JSON.parse(n.scm_advancedescribe);for(var o in n.scm_advancedescribe)n.scm_advancedescribe[o].content_img&&(n.scm_advancedescribe[o].img_path=stringObj.text.branch_img_path)}if(j.scm_reservationtag=n.scm_reservationtag,j.scm_producttype=n.scm_producttype,j.scm_coupon_providetype=n.scm_coupon_providetype,j.scm_bonus_giveafteruse=n.scm_bonus_giveafteruse,indexObj._dataStorage(branchObj.storage.commodity_data,j),n.scm_producttype=stringObj.shop.scm_producttype_array[parseInt(n.scm_producttype)-1],n.scm_date=n.scm_startdate.replace(/-/gi,"/")+" - "+n.scm_enddate.replace(/-/gi,"/"),y=n.scm_coupon_providetype,n.scm_coupon_providetype=stringObj.shop.scm_coupon_providetype_array[parseInt(n.scm_coupon_providetype)],f=n.scm_bonus_giveafteruse,"1"===(v=n.scm_reservationtag)){n.scm_daily=n.scm_dailystart.substring(0,5)+" ~ "+n.scm_dailyend.substring(0,5);var x=parseInt(30*parseFloat(n.scm_workhour)/60),k=parseInt(30*parseFloat(n.scm_workhour)%60),w=parseInt(30*parseFloat(n.scm_preparehour)/60),I=parseInt(30*parseFloat(n.scm_preparehour)%60);x<10&&(x="0"+x),k<10&&(k="0"+k),w<10&&(w="0"+w),I<10&&(I="0"+I),n.scm_workhour=x+" 小時 "+k+" 分鐘",n.scm_preparehour=w+" 小時 "+I+" 分鐘"}g=O(n)}$$(".shopcoupon-edit-block").html(g),myApp.initImagesLazyLoad(".page-content"),$("#calendar-range").css("color","#aaa");myApp.picker({input:".scm_coupon_providetype",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.scm_coupon_providetype+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){j.scm_coupon_providetype&&e.setValue([stringObj.shop.scm_coupon_providetype_array.indexOf(j.scm_coupon_providetype)])},onClose:function(e){j.scm_coupon_providetype=e.cols[0].value,indexObj._dataStorage(branchObj.storage.commodity_data,j),"1"===e.cols[0].value?($(".scm_bonus_payamount").css("display","inherit"),$("#price").val(0),$(".price").css("display","none")):($(".scm_bonus_payamount").css("display","none"),$("#price").val(""),$(".price").css("display","inherit"))},cols:[{textAlign:"center",values:[0,1],width:"100%",displayValues:stringObj.shop.scm_coupon_providetype_array}]});if("1"==v){$(".reservation-checkbox").prop("checked",!0),$("#calendar-range").css("color","#fff"),$(".shopcoupon-time").css("display","inherit"),$(".weekend-radio").css("display","inherit"),$(".require-time").css("display","inherit"),$(".prepare-time").css("display","inherit"),$(".reserve-num").css("display","inherit"),"1"==n.scm_includeweekend?$(".includ").prop("checked",!0):"0"==n.scm_includeweekend&&$(".not_included").prop("checked",!0);var A=myApp.calendar({input:"#calendar-range",dateFormat:"yyyy/mm/dd",rangePicker:!0,monthNames:stringObj.text.monthNames});$("#calendar-range").change(function(){23==$(this).val().length&&A.close()});myApp.picker({input:".page:not(.cached) #shopcoupon-time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">活動每日時間</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+":"+t[1]+" ~ "+t[2]+":"+t[3]},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:":"},{values:["00","30"]},{textAlign:"center",divider:!0,content:" ~ "},{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:":"},{textAlign:"center",values:["00","30"]}]}),myApp.picker({input:".page:not(.cached) #require-time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">作業工時</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+" 小時 "+t[1]+" 分鐘 "},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:" 小時 "},{values:["00","30"]},{textAlign:"center",divider:!0,content:" 分鐘 "}]}),myApp.picker({input:".page:not(.cached) #prepare-time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">準備工時</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+" 小時 "+t[1]+" 分鐘 "},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:" 小時 "},{values:["00","30"]},{textAlign:"center",divider:!0,content:" 分鐘 "}]});$$(".reserve-num").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="數目">',"同時段允許預約數"),$(".input-value").val($("#reserve-num").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#reserve-num").val($(".input-value").val())}),""!=$("#limit").val()&&$(".input-value").on("input",function(e){$(this).val()>parseInt($("#limit").val())&&$(this).val(parseInt($("#limit").val())),$(this).val()<0&&$(this).val(1),0==$(this).val()&&$(this).val("")})})}"1"===j.scm_bonus_giveafteruse?($(".scm_bonus_giveamount").css("display","inherit"),$(".giveafteruse-checkbox").prop("checked",!0)):$("#scm_bonus_giveamount").val(""),"1"===y&&($(".scm_bonus_payamount").css("display","inherit"),$("#price").val(0),$(".price").css("display","none")),$(".giveafteruse-checkbox").change(function(){$(this).is(":checked")?(f="1",j.scm_bonus_giveafteruse="1",indexObj._dataStorage(branchObj.storage.commodity_data,j),$(".scm_bonus_giveamount").css("display","inherit")):(f="0",j.scm_bonus_giveafteruse="0",indexObj._dataStorage(branchObj.storage.commodity_data,j),$(".scm_bonus_giveamount").css("display","none"))}),$$(".shopcoupon-name").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="名稱">',"商品名稱"),$(".input-value").val($("#shopcoupon-name").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#shopcoupon-name").val($(".input-value").val())})}),$$(".scm_fulldescript").on("click",function(){myApp.alert('<textarea class="info resizable" placeholder="內容" rows="9"></textarea>',"活動說明"),$(".info").val($("#scm_fulldescript").val()),$("textarea.info").focus(),$(".modal-button").click(function(){$("#scm_fulldescript").val($(".info").val())})}),$$(".scm_bonus_payamount").on("click",function(){myApp.alert('<input class="input-value" type="number" min="1" placeholder="數額（1~9999）" onkeydown="input_limit(this, 4);" onkeyup="input_limit(this, 4);">',"特點扣除"),$(".input-value").val($("#scm_bonus_payamount").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#scm_bonus_payamount").val($(".input-value").val())})}),$$(".scm_bonus_giveamount").on("click",function(){myApp.alert('<input class="input-value" type="number" min="1" placeholder="數額（1~9999）" onkeydown="input_limit(this, 4);" onkeyup="input_limit(this, 4);">',"特點贈與"),$(".input-value").val($("#scm_bonus_giveamount").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#scm_bonus_giveamount").val($(".input-value").val())})}),$$(".price").on("click",function(){myApp.alert('<input class="input-value" type="number" min="0" placeholder="金額" onkeydown="input_limit(this, 9);" onkeyup="input_limit(this, 9);">',"費用"),$(".input-value").val($("#price").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#price").val($(".input-value").val())})}),$$(".limit").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="張數" onkeydown="input_limit(this, 9);" onkeyup="input_limit(this, 9);">',"索取張數限制"),$(".input-value").val($("#limit").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#limit").val($(".input-value").val())})}),$$(".scm_balanceno").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="單號">',"銷帳單號"),$(".input-value").val($("#scm_balanceno").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#scm_balanceno").val($(".input-value").val())})});var C,S=myApp.picker({input:".scm_producttype",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.scm_producttype+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){n.scm_producttype&&e.setValue([stringObj.shop.scm_producttype_array.indexOf(n.scm_producttype)+1])},cols:[{textAlign:"center",values:[1,2],displayValues:stringObj.shop.scm_producttype_array,onChange:function(e,t){j.scm_producttype=e.cols[0].value,C=e.cols[0].value}}]});localStorage.getItem("scrollTop")&&($(".shopcoupon-edit-content").scrollTop(parseFloat(localStorage.getItem("scrollTop"))),localStorage.removeItem("scrollTop")),$(".move-up").click(function(e){0!==$(this).parents("li").index()&&((j=indexObj._dataStorage(branchObj.storage.commodity_data)||{}).scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j)),j.scm_advancedescribe.splice($(this).parents("li").index()-1,0,j.scm_advancedescribe.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.commodity_data,j),$(this).parents("li").insertBefore(".commodity-details-block.sortable li:nth-child("+$(this).parents("li").index()+")"))}),$(".move-down").click(function(e){(j=indexObj._dataStorage(branchObj.storage.commodity_data)||{}).scm_advancedescribe?$(this).parents("li").index()<j.scm_advancedescribe.length-1&&(j.scm_advancedescribe.splice($(this).parents("li").index()+1,0,j.scm_advancedescribe.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.commodity_data,j),$(this).parents("li").insertAfter(".commodity-details-block.sortable li:nth-child("+($(this).parents("li").index()+2)+")")):(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j),j.scm_advancedescribe.splice($(this).parents("li").index()+1,0,j.scm_advancedescribe.splice($(this).parents("li").index(),1)[0]),indexObj._dataStorage(branchObj.storage.commodity_data,j),$(this).parents("li").insertAfter(".commodity-details-block.sortable li:nth-child("+($(this).parents("li").index()+2)+")"))}),j=indexObj._dataStorage(branchObj.storage.commodity_data)||{},$(".details-img").click(function(){j.scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j)),void 0!==Cookies.get("app_version")?addImage("shopcoupon",j.scm_advancedescribe[$(this).parents("li").index()].content_img):setImgOnPC("sd_id="+h.sd_id+"&folder=shopcoupon&type=details&position="+$(this).parents("li").index(),j.scm_advancedescribe[$(this).parents("li").index()].content_img)}),$(".details-text").parents(".item-inner").click(function(){j.scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j));var e=$(this).parents("li").index(),t=$(this).find(".details-text");myApp.modal({title:"文字內容",text:'<textarea class="info resizable" placeholder="內容" rows="8"></textarea>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text._clear,onClick:function(){j.scm_advancedescribe.splice(e,1),t.parents(".commodity-details-item").remove(),indexObj._dataStorage(branchObj.storage.commodity_data,j)}},{text:stringObj.text.edit,onClick:function(){j.scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe,indexObj._dataStorage(branchObj.storage.commodity_data,j)),j.scm_advancedescribe[e].content_text=$("textarea.info").val(),$("textarea.info").val()?t.text($("textarea.info").val()):(j.scm_advancedescribe.splice(e,1),t.parents(".commodity-details-item").remove()),indexObj._dataStorage(branchObj.storage.commodity_data,j)}}]}),$("textarea.info").val(t.text()),$("textarea.info").focus()}),$(".add-details-image").unbind("click"),$(".add-details-text").unbind("click"),$(".add-details-image").click(function(){j.scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j)),void 0!==Cookies.get("app_version")?addImage("shopcoupon",""):setImgOnPC("sd_id="+h.sd_id+"&folder=shopcoupon&type=details&position=add","")}),$(".add-details-text").click(function(){myApp.modal({title:"文字內容",text:'<textarea class="info resizable" placeholder="內容" rows="8"></textarea>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.add,onClick:function(){j.scm_advancedescribe||(j.scm_advancedescribe=n.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,j)),""!==$.trim($("textarea.info").val())&&(j.scm_advancedescribe.push({content_text:$("textarea.info").val(),content_img:""}),indexObj._dataStorage(branchObj.storage.commodity_data,j),localStorage.setItem("scrollTop",$(".shopcoupon-edit-content").scrollTop()+70),saveData(),mainView.router.load({url:window.location.href.substring(window.location.href.indexOf("#!/")+3),reload:!0}))}}]}),$("textarea.info").focus()}),$(".reservation-checkbox").attr("disabled","disabled"),$(".edit").unbind("click"),$(".edit").click(function(){C=S.value?S.value[0]:j.scm_producttype?j.scm_producttype:stringObj.shop.scm_producttype_array.indexOf(n.scm_producttype)+1,j.scm_advancedescribe&&(n.scm_advancedescribe=j.scm_advancedescribe),$(".shopcoupon-name").removeClass("lengthError"),$(".scm_fulldescript").removeClass("lengthError"),$(".scm_balanceno").removeClass("lengthError"),$(".scm_bonus_payamount").removeClass("lengthError"),$(".scm_bonus_giveamount").removeClass("lengthError"),$(".price").removeClass("spacesError"),$(".limit").removeClass("spacesError"),$(".reserve-num").removeClass("spacesError"),$(".scm_bonus_payamount").removeClass("spacesError"),$(".scm_bonus_giveamount").removeClass("spacesError"),$(".shopcoupon-name").removeClass("nullError"),$(".scm_producttype-block").removeClass("nullError"),$(".scm_fulldescript").removeClass("nullError"),$(".scm_category").removeClass("nullError"),$(".price").removeClass("nullError"),$(".scm_date").removeClass("nullError"),$(".limit").removeClass("nullError"),$(".shopcoupon-time").removeClass("nullError"),$(".require-time").removeClass("nullError"),$(".prepare-time").removeClass("nullError"),$(".reserve-num").removeClass("nullError"),$(".scm_coupon_providetype-block").removeClass("nullError"),$(".scm_bonus_payamount").removeClass("nullError"),$(".scm_bonus_giveamount").removeClass("nullError"),$(".scm_date").removeClass("formatError"),$(".noSetMainImg").css("display","none");var e=!1;$("#shopcoupon-name").val().length>40&&($(".shopcoupon-name").addClass("lengthError"),e=!0),$("#scm_fulldescript").val().length>500&&($(".scm_fulldescript").addClass("lengthError"),e=!0),$("#scm_balanceno").val().length>50&&($(".scm_balanceno").addClass("lengthError"),e=!0),$("#scm_bonus_payamount").val().length>4&&($(".scm_bonus_payamount").addClass("lengthError"),e=!0),$("#scm_bonus_giveamount").val().length>4&&($(".scm_bonus_giveamount").addClass("lengthError"),e=!0),-1!==$("#price").val().indexOf(" ")&&($(".branch-name").addClass("spacesError"),e=!0),-1!==$("#limit").val().indexOf(" ")&&($(".branch-tel").addClass("spacesError"),e=!0),-1!==$("#scm_bonus_payamount").val().indexOf(" ")&&($(".scm_bonus_payamount").addClass("spacesError"),e=!0),-1!==$("#scm_bonus_giveamount").val().indexOf(" ")&&($(".scm_bonus_giveamount").addClass("spacesError"),e=!0),""===h.shopcoupon_imgs.main&&($(".noSetMainImg").css("display","inherit"),e=!0),""===$.trim($("#shopcoupon-name").val())&&($(".shopcoupon-name").addClass("nullError"),e=!0),""===$.trim($("#scm_fulldescript").val())&&($(".scm_fulldescript").addClass("nullError"),e=!0),""===$.trim($("#price").val())&&($(".price").addClass("nullError"),e=!0),""===$.trim($("#calendar-range").val())&&($(".scm_date").addClass("nullError"),e=!0),""===$.trim($("#limit").val())&&($(".limit").addClass("nullError"),e=!0),"1"===j.scm_coupon_providetype?(""===$.trim($("#scm_bonus_payamount").val())||parseInt($.trim($("#scm_bonus_payamount").val()))<=0)&&($(".scm_bonus_payamount").addClass("nullError"),e=!0):(""===$.trim($("#price").val())||parseInt($.trim($("#price").val()))<=0)&&($(".price").addClass("nullError"),e=!0),"1"===j.scm_bonus_giveafteruse&&(""===$.trim($("#scm_bonus_giveamount").val())||parseInt($.trim($("#scm_bonus_giveamount").val()))<=0)&&($(".scm_bonus_giveamount").addClass("nullError"),e=!0),"1"==v&&(-1!==$("#reserve-num").val().indexOf(" ")&&($(".branch-address").addClass("spacesError"),e=!0),""===$.trim($("#shopcoupon-time").val())&&($(".shopcoupon-time").addClass("nullError"),e=!0),""===$.trim($("#require-time").val())&&($(".require-time").addClass("nullError"),e=!0),""===$.trim($("#prepare-time").val())&&($(".prepare-time").addClass("nullError"),e=!0),""===$.trim($("#reserve-num").val())&&($(".reserve-num").addClass("nullError"),e=!0)),$("#calendar-range").val().length<23&&($(".scm_date").addClass("formatError"),e=!0),e&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%"))),(h=indexObj._dataStorage(branchObj.storage.branchData)).shopcoupon_imgs.main.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(h.shopcoupon_imgs.main=h.shopcoupon_imgs.main.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length),indexObj._dataStorage(branchObj.storage.branchData,h));for(var t in h.shopcoupon_imgs.imgs)h.shopcoupon_imgs.imgs[t].match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(h.shopcoupon_imgs.imgs.splice(t,1,h.shopcoupon_imgs.imgs[t].substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length)),indexObj._dataStorage(branchObj.storage.branchData,h));var a=indexObj._dataCookies(indexObj._storage.main);h=indexObj._dataStorage(branchObj.storage.branchData);var s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:n.sd_id,scm_id:n.scm_id,managetype:"2",scm_title:$("#shopcoupon-name").val(),scm_producttype:C,scm_fulldescript:$("#scm_fulldescript").val(),scm_category:0,scm_mainpic:h.shopcoupon_imgs.main,scm_activepics:JSON.stringify(h.shopcoupon_imgs.imgs),scm_price:$("#price").val(),scm_startdate:$("#calendar-range").val().substring(0,10),scm_enddate:$("#calendar-range").val().substring(13),scm_reservationtag:v,scm_dailystart:$("#shopcoupon-time").val().substring(0,5),scm_dailyend:$("#shopcoupon-time").val().substring(8),scm_workhour:(60*parseInt($("#require-time").val().substring(0,2))+parseInt($("#require-time").val().substring(6,8)))/30,scm_preparehour:(60*parseInt($("#prepare-time").val().substring(0,2))+parseInt($("#prepare-time").val().substring(6,8)))/30,scm_includeweekend:$("input[name='weekend-radio']:checked").val(),scm_reservationavailable:$("#reserve-num").val(),scm_poststatus:n.scm_poststatus,scm_member_limit:$("#limit").val(),scm_balanceno:$("#scm_balanceno").val(),scm_coupon_providetype:stringObj.shop.scm_coupon_providetype_array.indexOf($(".scm_coupon_providetype").val()),scm_bonus_payamount:$("#scm_bonus_payamount").val(),scm_bonus_giveafteruse:f,scm_bonus_giveamount:$("#scm_bonus_giveamount").val(),scm_advancedescribe:JSON.stringify(n.scm_advancedescribe),md_securitycode:""};if(""===$("#scm_bonus_payamount").val()&&(s.scm_bonus_payamount=0),""===$("#scm_bonus_giveamount").val()&&(s.scm_bonus_giveamount=0),!e){var r=0;"1"==v?($("#shopcoupon-name").val()!==n.scm_title?r+=2:$("#scm_fulldescript").val()!==n.scm_fulldescript?r+=2:$("#price").val()!==n.scm_price?r+=2:$("#limit").val()!==n.scm_member_limit?r+=2:$("#scm_balanceno").val()!==n.scm_balanceno?r+=2:$("#scm_fulldescript").val()!==n.scm_fulldescript?r+=2:C!==stringObj.shop.scm_producttype_array.indexOf(n.scm_producttype)+1?r+=2:h.shopcoupon_imgs.main!==n.scm_mainpic?r+=2:(JSON.stringify(h.shopcoupon_imgs.imgs),n.scm_activepics,r+=2),$("#calendar-range").val().substring(0,10)!=n.scm_startdate.replace(/-/gi,"/")?r+=3:$("#calendar-range").val().substring(13)!=n.scm_enddate.replace(/-/gi,"/")?r+=3:$("#shopcoupon-time").val().substring(0,5)!=n.sd_dailystart.substring(0,5)?r+=3:$("#shopcoupon-time").val().substring(8)!=n.sd_dailyend.substring(0,5)?r+=3:$("#scm_fulldescript").val()!=n.scm_fulldescript?r+=3:(60*parseInt($("#require-time").val().substring(0,2))+parseInt($("#require-time").val().substring(6,8)))/30!=n.scm_workhour?r+=3:(60*parseInt($("#prepare-time").val().substring(0,2))+parseInt($("#prepare-time").val().substring(6,8)))/30!=n.scm_preparehour?r+=3:$("#reserve-num").val()!=n.scm_reservationavailable?r+=3:$("input[name='weekend-radio']:checked").val()!=n.scm_includeweekend&&(r+=3),2===r?branchObj.shopcouponmanager(s):3===r?(s.managetype="3",branchObj.shopcouponmanager(s)):5===r?(s.managetype="2",s.scm_coupon_usetype=0,indexObj._wcfget({url:branchObj.dataUrl.shopcouponmanager,para:s,success:function(e){if(e.shopcouponmanagerresult){var t=JSON.parse(JSON.stringify(e.shopcouponmanagerresult));"010907002"===t.message_no||(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){noNetwork()}}),s.managetype="3",branchObj.shopcouponmanager(s)):myApp.toast("無任何修改","",{}).show()):(r=$("#shopcoupon-name").val()!==n.scm_title?2:$("#scm_fulldescript").val()!==n.scm_fulldescript?2:$("#price").val()!==n.scm_price?2:$("#limit").val()!==n.scm_member_limit?2:$("#scm_balanceno").val()!==n.scm_balanceno?2:$("#scm_fulldescript").val()!==n.scm_fulldescript?2:C!==stringObj.shop.scm_producttype_array.indexOf(n.scm_producttype)+1?2:h.shopcoupon_imgs.main!==n.scm_mainpic?2:(JSON.stringify(h.shopcoupon_imgs.imgs),n.scm_activepics,2),branchObj.shopcouponmanager(s))}})}}else stringObj.return_header(n.message_no),_tip&&(myApp.alert(_tip+"( "+n.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopCouponInfoInit:function(e){var t=e.query;t.scm_title?branchObj.shopCouponContentGet(t.scm_id,t.type,t.scg_id,t.scm_title,t.scm_enddate):t.type?branchObj.shopCouponContentGet(t.scm_id,t.type,t.scg_id,"",""):branchObj.shopCouponContentGet(t.scm_id,"0","","","")},addMarker:function(e,t,a){var s=new google.maps.Marker({position:e,title:t,map:a}),r=new google.maps.InfoWindow;r.setContent('<b style="color:#000;">'+t+"</b>"),r.open(a,s),google.maps.event.addListener(s,"click",function(){r.open(a,s)})},shopCouponEditInit:function(e){var t=e.query;branchObj.shopCouponContentGet(t.scm_id,"edit","","",""),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},2e3)},shopCouponGet:function(e,t,a){var s=indexObj._dataCookies(indexObj._storage.main),r=(indexObj._dataStorage(branchObj.storage.branchData),indexObj._dataStorage("shop_buy_data")||{}),i=indexObj._dataStorage("shop_item")||{};void 0===i.coupon_md_id&&(i.coupon_md_id=""),void 0!==r.moc_id&&""!==r.moc_id&&null!==r.moc_id||(r.moc_id=""),myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopcouponget,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,scm_id:e,moc_id:r.moc_id,scg_paymentstatus:r.scg_paymentstatus,scg_buyername:r.scg_buyername,scg_buyermessage:r.scg_buyermessage,scg_buyamount:r.scg_buyamount,scg_totalamount:parseFloat(r.scl_sum)*parseFloat(r.scg_buyamount),sharer_id:i.coupon_md_id,scg_gp_subtract_amount:r.scg_gp_subtract_amount,scg_subtract_price:r.scg_subtract_price,md_securitycode:a,scg_identifier:r.identifier,scg_addr:r.send_addr,scg_contact_phone:r.scg_buyermobile,scg_contact_email:r.scg_buyeremail,scg_tax_title:r.tax_title},success:function(a){if(myApp.hideIndicator(),a.shopcoupongetresult){var s=JSON.parse(JSON.stringify(a.shopcoupongetresult));if("000000000"===s.message_no){Cookies.remove("coupon_scm_id"),Cookies.remove("coupon_md_id"),localStorage.setItem("scg_id",s.scg_id);i=indexObj._dataStorage("shop_item")||{};switch(t){case"coupon":"1"===i.scm_coupon_providetype?(i.errcode="00",paySuccess(JSON.stringify(i))):branchObj.createpaymentflow(s.scg_id);break;case"reservation":var r=indexObj._dataStorage(indexObj._storage.reservationbook)||{};branchObj.shopcouponreservationbook(e,s.scg_id,r.scr_serno,r.booktype);break;default:void 0!==Cookies.get("app_version")?branchObj.createlogisticsdata(2):branchObj.createlogisticsdata(1)}}else if("010905002"===s.message_no){var i=indexObj._dataStorage("shop_item")||{};mainView.router.load({url:"shop/shopcoupon-reservation?scm_id="+e+"&scm_title="+i.scm_title+"&scm_enddate="+localStorage.getItem("scm_enddate")+"&scg_id="+s.scg_id+"&booktype=0",reload:!0}),localStorage.removeItem("scm_enddate")}else stringObj.return_header(s.message_no),_tip&&(myApp.alert(_tip+"( "+s.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopcouponrecorver:function(){var e=indexObj._dataStorage(branchObj.storage.shopCouponRecord)||{last_update_date:"",availableList:[],finishList:[],invalidList:[]},t=indexObj._dataCookies(indexObj._storage.main),a=JSON.parse(localStorage.getItem("alarmCheck"))||{alarmCheckArray:[]};indexObj._wcfget({url:branchObj.dataUrl.shopcouponrecorver,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,last_update_date:e.last_update_date},success:function(t){if(t.shopcouponrecorverresult){indexObj.jsonUrlDecode(t);var s=JSON.parse(JSON.stringify(t.shopcouponrecorverresult));switch(s.message_no){case"000000000":for(var r in s.scg_list)if(findAndRemove(e.availableList,"scg_id",s.scg_list[r].scg_id),findAndRemove(e.finishList,"scg_id",s.scg_list[r].scg_id),findAndRemove(e.invalidList,"scg_id",s.scg_list[r].scg_id),(o={}).scg_id=s.scg_list[r].scg_id,o.scm_id=s.scg_list[r].scm_id,""===s.scg_list[r].reservationdatetime?o.reservationdatetime=!1:o.reservationdatetime=s.scg_list[r].reservationdatetime,o.scg_getdate=s.scg_list[r].scg_getdate,o.scg_usedate=s.scg_list[r].scg_usedate,o.scg_usestatus=s.scg_list[r].scg_usestatus,o.scg_reservationstatus=s.scg_list[r].scg_reservationstatus,findArrayItem(s.scm_list,"scm_id",s.scg_list[r].scm_id),o.sd_id=s.scm_list[nowIndex].sd_id,o.scm_title=s.scm_list[nowIndex].scm_title,o.scm_fulldescript=s.scm_list[nowIndex].scm_fulldescript,o.scm_category=s.scm_list[nowIndex].scm_category,o.scm_mainpic=stringObj.text.branch_img_path+s.scm_list[nowIndex].scm_mainpic,o.scm_activepics=stringObj.text.branch_img_path+s.scm_list[nowIndex].scm_activepics,o.scm_price=s.scm_list[nowIndex].scm_price,o.scm_startdate=s.scm_list[nowIndex].scm_startdate,o.scm_enddate=s.scm_list[nowIndex].scm_enddate,o.scm_reservationtag=s.scm_list[nowIndex].scm_reservationtag,o.scm_producttype=s.scm_list[nowIndex].scm_producttype,"1"===s.scm_list[nowIndex].scm_reservationtag&&(o.reservationCheck=!0),"2"===s.scm_list[nowIndex].scm_producttype&&(o.is_product=!0),o.date=new Date(s.scg_list[r].scg_getdate)/864e5,findArrayItem(s.sd_list,"sd_id",s.scm_list[nowIndex].sd_id),o.sd_shopname=s.sd_list[nowIndex].sd_shopname,o.sd_shopaddress=s.sd_list[nowIndex].sd_shopaddress,o.sd_shoptel=s.sd_list[nowIndex].sd_shoptel,o.sd_lat=s.sd_list[nowIndex].sd_lat,o.sd_lng=s.sd_list[nowIndex].sd_lng,o.sd_weeklystart=s.sd_list[nowIndex].sd_weeklystart,o.sd_weeklyend=s.sd_list[nowIndex].sd_weeklyend,o.sd_dailystart=s.sd_list[nowIndex].sd_dailystart,o.sd_dailyend=s.sd_list[nowIndex].sd_dailyend,JSON.stringify(a.alarmCheckArray).match(s.scg_list[r].scg_id)?o.alarmCheck=!1:""!=s.scg_list[r].reservationdatetime&&(o.alarmCheck=!0),!o.is_product)switch(s.scg_list[r].scg_usestatus){case"5":e.availableList.push(o);break;case"2":e.finishList.push(o);break;case"3":case"4":e.invalidList.push(o)}if(e.last_update_date=s.last_update_date,e.availableList.sort(sortByProperty("date",-1)),e.finishList.sort(sortByProperty("date",-1)),e.invalidList.sort(sortByProperty("date",-1)),indexObj._dataStorage(branchObj.storage.shopCouponRecord,e),"coupon-record"===nowPage){var i;if("[]"===JSON.stringify(e.availableList)?(i=indexObj.template("templateCouponListNull")(""),$$("#shop-coupon .available-content").html(i)):(i=indexObj.template("templateShopCouponAvailableList")(e),$$("#shop-coupon .couponAvailableList").append(i),myApp.initImagesLazyLoad(".page-content")),"[]"===JSON.stringify(e.finishList)){o=(n=indexObj.template("templateCouponListNull"))("");$$("#shop-coupon .finish-content").html(o)}else i=indexObj.template("templateShopCouponFinishList")(e),$$("#shop-coupon .couponFinishList").append(i),myApp.initImagesLazyLoad(".page-content");if("[]"===JSON.stringify(e.invalidList)){var n=indexObj.template("templateCouponListNull"),o=n("");$$("#shop-coupon .invalid-content").html(o)}else i=indexObj.template("templateShopCouponInvalidList")(e),$$("#shop-coupon .couponInvalidList").append(i),myApp.initImagesLazyLoad(".page-content");$(".title").ellipsis({row:2})}break;default:stringObj.return_header(s.message_no)}_tip&&(myApp.alert(_tip+"( "+s.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(t){if(noNetwork(),"coupon-record"===nowPage){var a;if("[]"===JSON.stringify(e.availableList)?(a=indexObj.template("templateCouponListNull")(""),$$(".tab-available").html(a)):(a=indexObj.template("templateShopCouponAvailableList")(e),$$(".couponAvailableList").append(a),myApp.initImagesLazyLoad(".page-content")),"[]"===JSON.stringify(e.finishList)){r=(s=indexObj.template("templateCouponListNull"))("");$$(".tab-finish").html(r)}else a=indexObj.template("templateShopCouponFinishList")(e),$$(".couponFinishList").append(a),myApp.initImagesLazyLoad(".page-content");if("[]"===JSON.stringify(e.invalidList)){var s=indexObj.template("templateCouponListNull"),r=s("");$$(".tab-invalid").html(r)}else a=indexObj.template("templateShopCouponInvalidList")(e),$$(".couponInvalidList").append(a),myApp.initImagesLazyLoad(".page-content");$(".title").ellipsis({row:2})}}})},shopCouponReservationInit:function(e){var t=e.query;t.from?$(".reservation-left a").attr("href","coupon-record?tab=shop-coupon"):"1"===t.booktype?($(".reservation-left a").unbind("click"),$(".reservation-left a").click(function(){window.history.back()})):(t.booktype,$(".reservation-left a").unbind("click"),$(".reservation-left a").click(function(){window.history.back()}));var a=indexObj._dataCookies(indexObj._storage.main);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopcouponreservationinfo,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,scm_id:t.scm_id},success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopcouponreservationinforesult){var a=JSON.parse(JSON.stringify(e.shopcouponreservationinforesult));if("000000000"===a.message_no){var s=indexObj._dataStorage("shop_item")||{},r={scm_title:s.scm_title,scm_enddate:s.scm_enddate},i=indexObj.template("templateShopCouponReservation")(r);$$(".text-block").html(i);var n,o=new Date,c=[];for(var l in a.reservationarray)n=(n=a.reservationarray[l].scr_rvdate).replace(/-/gi,"/"),new Date(n)-new Date(o.getFullYear()+"/"+(o.getMonth()+1)+"/"+o.getDate())>=0&&c.push(n);var d=stringObj.text.monthNames;calendarInline=myApp.calendar({container:".page:not(.cached) #calendar-inline-container",toolbarTemplate:'<div class="toolbar calendar-custom-toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link icon-only"><i class="fa fa-angle-left"></i></a></div><div class="center"></div><div class="right"><a href="#" class="link icon-only"><i class="fa fa-angle-right"></i></a></div></div></div>',onOpen:function(e){$$(".calendar-custom-toolbar .center").text(d[e.currentMonth]+", "+e.currentYear),$$(".calendar-custom-toolbar .left .link").on("click",function(){calendarInline.prevMonth()}),$$(".calendar-custom-toolbar .right .link").on("click",function(){calendarInline.nextMonth()})},onMonthYearChangeStart:function(e){$$(".calendar-custom-toolbar .center").text(d[e.currentMonth]+", "+e.currentYear)},firstDay:0,events:c,onDayClick:function(e,s,r,i,n){var o,c=[];for(var l in a.reservationarray)o=(o=a.reservationarray[l].scr_rvdate).replace(/-/gi,"/"),c.push(o);var d=JSON.stringify(c);if(parseInt(i)+1<10)p="0"+(parseInt(i)+1);else var p=""+(parseInt(i)+1);if(parseInt(n)<10)m="0"+parseInt(n);else var m=""+parseInt(n);if(d.match(r+"/"+p+"/"+m)){findArrayItem(a.reservationarray,"scr_rvdate",r+"-"+p+"-"+m);var u="";for(var b in a.reservationarray[nowIndex].dailytime)u+='<option value="'+a.reservationarray[nowIndex].dailytime[b].scr_serno+'">'+a.reservationarray[nowIndex].dailytime[b].scr_rvtime.substring(0,5)+"</option>";myApp.modal({title:stringObj.text.reservationTime,text:'<select class="styled-select">'+u+"</select>",buttons:[{text:stringObj.text.cancel,onClick:function(){calendarInline.setValue("2016/01/01")}},{text:stringObj.text.confirm,onClick:function(){var e={};e.scr_serno=$(".styled-select").val(),e.booktype=t.booktype,indexObj._dataStorage(indexObj._storage.reservationbook,e),mainView.router.load({url:"pay-info?scm_id="+t.scm_id+"&from=reservation"})}}]})}}}),$$(".picker-calendar-week-day-weekend").each(function(e,t){"Sat"==$$(t).text()&&$$(t).addClass("sat")}),$$(".picker-calendar-week-day-weekend").each(function(e,t){"Sun"==$$(t).text()&&$$(t).addClass("sun")})}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null,$(".modal-button").click(function(){window.history.back()}))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopcouponreservationbook:function(e,t,a,s){var r=indexObj._dataCookies(indexObj._storage.main);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopcouponreservationbook,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,scm_id:e,scg_id:t,scr_serno:a,booktype:s},success:function(a){if(indexObj.jsonUrlDecode(a),myApp.hideIndicator(),a.shopcouponreservationbookresult){var r=JSON.parse(JSON.stringify(a.shopcouponreservationbookresult));if("010906000"===r.message_no){var i=indexObj._dataStorage(branchObj.storage.alarmInfo)||{alarmInfoArray:[]},n=JSON.parse(localStorage.getItem("alarmCheck"))||{alarmCheckArray:[]};if("1"===s)i.alarmInfoArray.length>0&&(nowIndex=-1,findArrayItem(i.alarmInfoArray,"id",t),nowIndex>=0&&(webview.closeAlarm(i.alarmInfoArray[nowIndex].alarmIndex,t),findAndRemove(i.alarmInfoArray,"id",t),indexObj._dataStorage(branchObj.storage.alarmInfo,i),n.alarmCheckArray.splice(n.alarmCheckArray.indexOf(t),1),indexObj._dataStorage("alarmCheck",n))),myApp.toast(stringObj.text.edit_success,"",{}).show(),mainView.router.load({url:"pay-info?scm_id="+e+"&scg_id="+t+"&from=reservation"});else{var o=indexObj._dataStorage("shop_item")||{};void 0!==Cookies.get("app_version")?myApp.modal({title:stringObj.text.set_alarm_time,text:'<div class="list-block media-list"><ul id="reasonlist"><li><label class="label-radio item-content"><input type="radio" name="alarmTime" value="1" checked><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+stringObj.text.hour_ago+'</b></div></div></div></label></li><li><label class="label-radio item-content"><input type="radio" name="alarmTime" value="2"><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+stringObj.text.date_ago+"</b></div></div></div></label></li></ul></div>",buttons:[{text:stringObj.text.cancel,onClick:function(){"1"===o.scm_coupon_providetype?(o.errcode="00",paySuccess(JSON.stringify(o))):branchObj.createpaymentflow(t)}},{text:stringObj.text.confirm,onClick:function(){var e=$('input[name="alarmTime"]:checked').val(),a=r.reservation_datetime,s=localStorage.getItem("alarmIndex")||1;webview.setAlarm(parseInt(a.substring(0,4)),parseInt(a.substring(5,7)),parseInt(a.substring(8,10)),parseInt(a.substring(11,13)),parseInt(a.substring(14,16)),parseInt(s)+1,t,r.scm_cname,e),localStorage.setItem("alarmIndex",parseInt(s)+1),n.alarmCheckArray.push(t),localStorage.setItem("alarmCheck",JSON.stringify(n));var c={id:t,alarmIndex:parseInt(s)+1,reservationTime:r.reservation_datetime};i.alarmInfoArray.push(c),indexObj._dataStorage(branchObj.storage.alarmInfo,i),"1"===o.scm_coupon_providetype?(o.errcode="00",paySuccess(JSON.stringify(o))):branchObj.createpaymentflow(t)}}]}):"1"===o.scm_coupon_providetype?(o.errcode="00",paySuccess(JSON.stringify(o))):branchObj.createpaymentflow(t)}}else stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopcouponscan:function(e,t){var a=indexObj._dataCookies(indexObj._storage.main),s=indexObj._dataStorage(branchObj.storage.branchData);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopcouponscan,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,scm_id:e,scg_id:t},success:function(a){if(indexObj.jsonUrlDecode(a),myApp.hideIndicator(),a.shopcouponscanresult){var s=JSON.parse(JSON.stringify(a.shopcouponscanresult));"010910000"===s.message_no||"010910007"===s.message_no?(localStorage.setItem("pageInit",nowPage),window.location="pm/shopcoupon-info?scm_id="+e+"&type=scan&scg_id="+t+"&scm_title="+s.scm_title+"&scm_enddate="+s.scm_enddate):"010910006"===s.message_no?myApp.modal({title:stringObj.text.warn,text:stringObj.text.not_reservation_time,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){localStorage.setItem("pageInit",nowPage),window.location="pm/shopcoupon-info?scm_id="+e+"&type=scan&scg_id="+t+"&scm_title="+s.scm_title+"&scm_enddate="+s.scm_enddate}}]}):(stringObj.return_header(s.message_no),_tip&&(myApp.alert(_tip+"( "+s.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopcouponexec:function(e,t,a,s){var r=indexObj._dataCookies(indexObj._storage.main),i=indexObj._dataStorage(branchObj.storage.branchData);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopcouponexec,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,sd_id:i.sd_id,scm_id:e,scg_id:t,coupon_operation:"1"},success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.shopcouponexecresult){var r=JSON.parse(JSON.stringify(t.shopcouponexecresult));if("010911000"===r.message_no){var i=new Date,n=i.getMonth()+1,o=i.getDate(),c=i.getHours(),l=i.getMinutes(),d=i.getSeconds();n<10&&(n="0"+n),o<10&&(o="0"+o),c<10&&(c="0"+c),l<10&&(l="0"+l),d<10&&(d="0"+d);var p=indexObj._dataStorage(branchObj.storage.branchScanRecord)||{scanArray:[]},m={};if(JSON.stringify(p).match(e)){var u=""+i.getFullYear()+n+o;findArrayItem(p.scanArray,"scm_id",e),u==p.scanArray[nowIndex].scanDate.substring(0,8)?(m.scanNum=p.scanArray[nowIndex].scanNum+1,findAndRemove(p.scanArray,"scm_id",e)):m.scanNum=1}else m.scanNum=1;m.scm_id=e,m.scm_title=a,m.scm_balanceno=r.scm_balanceno||" ",m.scm_enddate=s,m.scanDate=""+i.getFullYear()+n+o+c+l+d,p.scanArray.push(m),p.scanArray.sort(sortByProperty("scanDate",-1)),indexObj._dataStorage(branchObj.storage.branchScanRecord,p),""==r.scm_balanceno?(myApp.toast(stringObj.text.serving_success,"",{}).show(),mainView.router.load({url:"shop/branch-main"})):(code39(r.scm_balanceno),mainView.router.load({url:"shop/branch-main"}))}else stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},branchScanRecordInit:function(e){var t,a=indexObj._dataStorage(branchObj.storage.branchScanRecord)||{scanArray:[]};if(""==a.scanArray)t=indexObj.template("templateBranchScanRecordNull")(""),$$(".page-content").html(t);else{$$(".page-content").html('<div class="sever-subTitle date1"></div><div class="record-list date1-block"></div><div class="sever-subTitle date2"></div><div class="record-list date2-block"></div><div class="sever-subTitle date3"></div><div class="record-list date3-block"></div>');var s=new Date,r=s.getMonth()+1,i=s.getDate();r<10&&(r="0"+r),i<10&&(i="0"+i);var n,o=new Date(s.getFullYear()+"/"+r+"/"+i)/864e5;$(".date1").css("display","none"),$(".date2").css("display","none"),$(".date3").css("display","none");for(var c=0;c<a.scanArray.length;){var l={scm_title:a.scanArray[c].scm_title,scm_balanceno:a.scanArray[c].scm_balanceno,scm_enddate:a.scanArray[c].scm_enddate,scanNum:a.scanArray[c].scanNum};" "==a.scanArray[c].scm_balanceno&&(l.scm_balanceno=!1),o-(n=new Date(a.scanArray[c].scanDate.substring(0,4)+"/"+a.scanArray[c].scanDate.substring(4,6)+"/"+a.scanArray[c].scanDate.substring(6,8))/864e5)>2?(findAndRemove(a.scanArray,"scanDate",a.scanArray[c].scanDate),indexObj._dataStorage(branchObj.storage.branchScanRecord,a),c=0,""==a.scanArray&&(t=indexObj.template("templateBranchScanRecordNull")(""),$$(".page-content").html(t))):o-n==0?($(".date1").css("display","block"),$(".date1").html(a.scanArray[c].scanDate.substring(0,4)+"/"+a.scanArray[c].scanDate.substring(4,6)+"/"+a.scanArray[c].scanDate.substring(6,8)),t=indexObj.template("templateBranchScanRecordItem")(l),$$(".date1-block").append(t),c++):o-n==1?($(".date2").css("display","block"),$(".date2").html(a.scanArray[c].scanDate.substring(0,4)+"/"+a.scanArray[c].scanDate.substring(4,6)+"/"+a.scanArray[c].scanDate.substring(6,8)),t=indexObj.template("templateBranchScanRecordItem")(l),$$(".date2-block").append(t),c++):o-n==2&&($(".date3").css("display","block"),$(".date3").html(a.scanArray[c].scanDate.substring(0,4)+"/"+a.scanArray[c].scanDate.substring(4,6)+"/"+a.scanArray[c].scanDate.substring(6,8)),t=indexObj.template("templateBranchScanRecordItem")(l),$$(".date3-block").append(t),c++)}}},scanRecordGet:function(){var e,t=indexObj._dataStorage(branchObj.storage.branchScanRecord)||{scanArray:[]};if(""==t.scanArray)e=indexObj.template("templateBranchScanRecordNull")(""),$$(".scan-record").html(e);else{$$(".scan-record").html('<div class="sever-subTitle date1"></div><div class="record-list date1-block"></div><div class="sever-subTitle date2"></div><div class="record-list date2-block"></div><div class="sever-subTitle date3"></div><div class="record-list date3-block"></div>');var a=new Date,s=a.getMonth()+1,r=a.getDate();s<10&&(s="0"+s),r<10&&(r="0"+r);var i,n=new Date(a.getFullYear()+"/"+s+"/"+r)/864e5;$(".date1").css("display","none"),$(".date2").css("display","none"),$(".date3").css("display","none");for(var o=0;o<t.scanArray.length;){var c={scm_title:t.scanArray[o].scm_title,scm_balanceno:t.scanArray[o].scm_balanceno,scm_enddate:t.scanArray[o].scm_enddate,scanNum:t.scanArray[o].scanNum};" "==t.scanArray[o].scm_balanceno&&(c.scm_balanceno=!1),n-(i=new Date(t.scanArray[o].scanDate.substring(0,4)+"/"+t.scanArray[o].scanDate.substring(4,6)+"/"+t.scanArray[o].scanDate.substring(6,8))/864e5)>2?(findAndRemove(t.scanArray,"scanDate",t.scanArray[o].scanDate),indexObj._dataStorage(branchObj.storage.branchScanRecord,t),o=0,""==t.scanArray&&(e=indexObj.template("templateBranchScanRecordNull")(""),$$(".scan-record").html(e))):n-i==0?($(".date1").css("display","block"),$(".date1").html(t.scanArray[o].scanDate.substring(0,4)+"/"+t.scanArray[o].scanDate.substring(4,6)+"/"+t.scanArray[o].scanDate.substring(6,8)),e=indexObj.template("templateBranchScanRecordItem")(c),$$(".date1-block").append(e),o++):n-i==1?($(".date2").css("display","block"),$(".date2").html(t.scanArray[o].scanDate.substring(0,4)+"/"+t.scanArray[o].scanDate.substring(4,6)+"/"+t.scanArray[o].scanDate.substring(6,8)),e=indexObj.template("templateBranchScanRecordItem")(c),$$(".date2-block").append(e),o++):n-i==2&&($(".date3").css("display","block"),$(".date3").html(t.scanArray[o].scanDate.substring(0,4)+"/"+t.scanArray[o].scanDate.substring(4,6)+"/"+t.scanArray[o].scanDate.substring(6,8)),e=indexObj.template("templateBranchScanRecordItem")(c),$$(".date3-block").append(e),o++)}}},shopcouponreservationquery:function(e,t,a){var s=indexObj._dataCookies(indexObj._storage.main);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopcouponreservationquery,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,sd_id:e,query_startdate:t,query_reply_status:a},success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopcouponreservationqueryresult){var t=JSON.parse(JSON.stringify(e.shopcouponreservationqueryresult));if("000000000"===t.message_no){if("branch-reservation-record"===nowPage)if(""===t.reservationinfo){d=(l=indexObj.template("templateReservationNull"))(t);$$(".reservation-record .list-block ul").html(d)}else{for(var a in t.reservationinfo)for(var s in t.reservationinfo[a].reservelist){switch(t.reservationinfo[a].reservelist[s].scg_usestatus){case"1":switch(t.reservationinfo[a].reservelist[s].scg_reservationstatus){case"0":t.reservationinfo[a].reservelist[s].status=stringObj.text.no_use;break;case"3":t.reservationinfo[a].reservelist[s].status=stringObj.text.no_come}break;default:t.reservationinfo[a].reservelist[s].status=stringObj.shop.scg_usestatus_array[parseInt(t.reservationinfo[a].reservelist[s].scg_usestatus)]}""==t.reservationinfo[a].reservelist[s].ssd_picturepath?t.reservationinfo[a].reservelist[s].ssd_picturepath="../app/image/general_user.png":t.reservationinfo[a].reservelist[s].ssd_picturepath.match("square")?t.reservationinfo[a].reservelist[s].ssd_picturepath=t.reservationinfo[a].reservelist[s].ssd_picturepath.replace("picture?type=square","picture?type=large"):t.reservationinfo[a].reservelist[s].ssd_picturepath=t.reservationinfo[a].reservelist[s].ssd_picturepath;c=(o=indexObj.template("templateReserveList"))(t.reservationinfo[a]);$$(".reservation-record .list-block ul").html(c),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},1e3)}}else if("branch-main"==nowPage)if(""!==t.reservationinfo){var r=new Date,i=r.getMonth()+1,n=r.getDate();if(i<10&&(i="0"+i),n<10&&(n="0"+n),t.reservationinfo[0].reservationdate.match(r.getFullYear()+"-"+i+"-"+n)){for(var s in t.reservationinfo[0].reservelist){switch(t.reservationinfo[0].reservelist[s].scg_usestatus){case"1":switch(t.reservationinfo[0].reservelist[s].scg_reservationstatus){case"0":t.reservationinfo[0].reservelist[s].status=stringObj.text.no_use;break;case"3":t.reservationinfo[0].reservelist[s].status=stringObj.text.no_come}break;default:t.reservationinfo[0].reservelist[s].status=stringObj.shop.scg_usestatus_array[parseInt(t.reservationinfo[0].reservelist[s].scg_usestatus)]}""==t.reservationinfo[0].reservelist[s].ssd_picturepath?t.reservationinfo[0].reservelist[s].ssd_picturepath="../app/image/general_user.png":t.reservationinfo[0].reservelist[s].ssd_picturepath=t.reservationinfo[0].reservelist[s].ssd_picturepath;var o=indexObj.template("templateBranchMainReserveList"),c=o(t.reservationinfo[0].reservelist[s]);$$(".reservation-list ul").append(c),myApp.initImagesLazyLoad(".page-content")}$$(".reservation-num span").html(t.reservationinfo[0].reservelist.length),indexObj._dataStorage("reservationinfo",t.reservationinfo[0]),$(".reservation-list .item-content").click(function(e){branchObj.shopCouponContentGet($(this).attr("scm_id"),"reservation",$(this).attr("scg_id"),"","")})}else{d=(l=indexObj.template("templateRecordNull"))(t);$$(".reservation-list").html(d)}}else{d=(l=indexObj.template("templateRecordNull"))(t);$$(".reservation-list").html(d)}}else if("010908001"===t.message_no){if("branch-reservation-record"==nowPage){d=(l=indexObj.template("templateReservationNull"))(t);$$(".reservation-record .list-block ul").html(d)}else if("branch-main"==nowPage){var l=indexObj.template("templateRecordNull"),d=l(t);$$(".reservation-list").html(d)}}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},update_couponreplystatus:function(e,t,a){var s=indexObj._dataCookies(indexObj._storage.main);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.update_couponreplystatus,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,sd_id:e,scg_id:t,scg_reply_status:a},success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.update_couponreplystatusresult){var a=JSON.parse(JSON.stringify(t.update_couponreplystatusresult));"000000000"===a.message_no?(myApp.toast(stringObj.text.reply_success,"",{}).show(),branchObj.query_reservationreplystatus(e)):(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},query_reservationreplystatus:function(e){var t=indexObj._dataCookies(indexObj._storage.main);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.query_reservationreplystatus,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:e},success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.query_reservationreplystatusresult){var a=JSON.parse(JSON.stringify(t.query_reservationreplystatusresult));if("000000000"===a.message_no)if(""===a.reservationinfo){o=(n=indexObj.template("templateNoReplyReservationNull"))(a);$$(".no-reply-content").html(o)}else{o=(n=indexObj.template("templateNoReplyReservationBlock"))(a);$$(".no-reply-content").html(o);for(var s in a.reservationinfo)for(var r in a.reservationinfo[s].reservelist){switch(a.reservationinfo[s].reservelist[r].scg_usestatus){case"1":switch(a.reservationinfo[s].reservelist[r].scg_reservationstatus){case"0":a.reservationinfo[s].reservelist[r].status=stringObj.text.no_use;break;case"3":a.reservationinfo[s].reservelist[r].status=stringObj.text.no_come}break;default:a.reservationinfo[s].reservelist[r].status=stringObj.shop.scg_usestatus_array[parseInt(a.reservationinfo[s].reservelist[r].scg_usestatus)]}""==a.reservationinfo[s].reservelist[r].ssd_picturepath?a.reservationinfo[s].reservelist[r].ssd_picturepath="../app/image/general_user.png":a.reservationinfo[s].reservelist[r].ssd_picturepath.match("square")?a.reservationinfo[s].reservelist[r].ssd_picturepath=a.reservationinfo[s].reservelist[r].ssd_picturepath.replace("picture?type=square","picture?type=large"):a.reservationinfo[s].reservelist[r].ssd_picturepath=a.reservationinfo[s].reservelist[r].ssd_picturepath;var i=indexObj.template("templateNoReplyReservationList")(a.reservationinfo[s].reservelist[r]);$$(".block-"+a.reservationinfo[s].reservationdate).append(i),myApp.initImagesLazyLoad(".page-content"),$(".no-reply-content .reply").unbind("click"),$(".no-reply-content .reply").click(function(t){branchObj.update_couponreplystatus(e,$(this).attr("scg_id"),1)})}}else if("010908001"===a.message_no){if("no-reply-reservation"==nowPage){var n=indexObj.template("templateNoReplyReservationNull"),o=n(a);$$(".no-reply-content").html(o)}}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},query_couponreservation_year:function(e,t){var a=indexObj._dataCookies(indexObj._storage.main)||{};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.query_couponreservation_year,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:e,query_year:t},success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.query_couponreservation_yearresult){var t=JSON.parse(JSON.stringify(e.query_couponreservation_yearresult));if("000000000"===t.message_no){for(var a in t.reservationpaused_list_year)calendarReservation.wrapper.find('.picker-calendar-day[data-date="'+t.reservationpaused_list_year[a].substring(0,4)+"-"+(parseInt(t.reservationpaused_list_year[a].substring(5,7))-1)+"-"+parseInt(t.reservationpaused_list_year[a].substring(8,10))+'"]').addClass("picker-calendar-day-has-events");indexObj._dataStorage("reservationpaused_list",t.reservationpaused_list_year)}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},branchReservationRecordInit:function(e){var t=indexObj._dataStorage(branchObj.storage.branchData),a=new Date,s=a.getMonth()+1,r=a.getDate();s<10&&(s="0"+s),r<10&&(r="0"+r),branchObj.query_couponreservation_year(t.sd_id,a.getFullYear()),branchObj.shopcouponreservationquery(t.sd_id,a.getFullYear()+"-"+s+"-"+r,9);var i=a.getFullYear(),n=indexObj._dataStorage("reservationpaused_list")||"";calendarReservation=myApp.calendar({container:".date-block",dateFormat:"yyyy-mm-dd (D)",firstDay:0,monthNames:stringObj.text.monthNames,dayNamesShort:stringObj.text.dayNames,closeOnSelect:!0,direction:"vertical",toolbarTemplate:'<div class="toolbar calendar-custom-toolbar"><div class="toolbar-inner"><div class="center"><input type="text" class="year" readonly><input type="text" class="month" readonly></div><div class="right pre"><a href="#" class="link icon-only"><i class="fa fa-angle-up" aria-hidden="true"></i></a></div><div class="right next"><a href="#" class="link icon-only"><i class="fa fa-angle-down" aria-hidden="true"></i></a></div></div></div>',onOpen:function(e){$$(".picker-calendar-week-day-weekend").each(function(e,t){"六"==$$(t).text()&&$$(t).addClass("sat")}),$$(".picker-calendar-week-day-weekend").each(function(e,t){"日"==$$(t).text()&&$$(t).addClass("sun")}),$$(".calendar-custom-toolbar .center .year").val(e.currentYear+"年"),$$(".calendar-custom-toolbar .center .month").val(stringObj.text.monthNames[e.currentMonth]),$$(".calendar-custom-toolbar .pre .link").on("click",function(){e.prevMonth()}),$$(".calendar-custom-toolbar .next .link").on("click",function(){e.nextMonth()})},onMonthYearChangeStart:function(e){if($$(".calendar-custom-toolbar .center .year").val(e.currentYear+"年"),$$(".calendar-custom-toolbar .center .month").val(stringObj.text.monthNames[e.currentMonth]),n=indexObj._dataStorage("reservationpaused_list")||"")for(var a in n)e.wrapper.find('.picker-calendar-day[data-date="'+n[a].substring(0,4)+"-"+(parseInt(n[a].substring(5,7))-1)+"-"+parseInt(n[a].substring(8,10))+'"]').addClass("picker-calendar-day-has-events");i!==e.currentYear&&(i=e.currentYear,branchObj.query_couponreservation_year(t.sd_id,e.currentYear))},onDayClick:function(e,a,s,r,i){if(parseInt(r)+1<10)o="0"+(parseInt(r)+1);else var o=""+(parseInt(r)+1);if(parseInt(i)<10)c="0"+parseInt(i);else var c=""+parseInt(i);if(-1!==(n=indexObj._dataStorage("reservationpaused_list")||"").indexOf(s+"-"+o+"-"+c))branchObj.shopcouponreservationquery(t.sd_id,s+"-"+o+"-"+c,9);else{var l=indexObj.template("templateReservationNull")("");$$(".reservation-record .list-block ul").html(l)}}});for(var o=[],c=2017;c<(new Date).getFullYear()+2;c++)o.push(c);myApp.picker({input:".calendar-custom-toolbar .center .year",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.text.select_year+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]+"年"},onOpen:function(e){e.setValue([calendarReservation.currentYear])},onClose:function(e){parseInt(e.cols[0].value)!==calendarReservation.currentYear&&calendarReservation.setYearMonth(parseInt(e.cols[0].value),stringObj.text.monthNames.indexOf($(".center .month").val()))},cols:[{textAlign:"center",values:o,width:"100%"}]}),myApp.picker({input:".calendar-custom-toolbar .center .month",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.text.select_month+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){e.setValue([stringObj.text.monthNames[calendarReservation.currentMonth]])},onClose:function(e){e.cols[0].activeIndex!==calendarReservation.currentMonth&&calendarReservation.setYearMonth($(".center .year").val().substring(0,4),e.cols[0].activeIndex)},cols:[{textAlign:"center",values:stringObj.text.monthNames,width:"100%",onChange:function(e,t){}}]});$(".date-search-block .date").val(a.getFullYear()+"-"+s+"-"+r+" ("+stringObj.text.dayNames[a.getDay()]+")");myApp.calendar({input:".date-search-block .date",dateFormat:"yyyy-mm-dd (D)",firstDay:0,monthNames:stringObj.text.monthNames,dayNamesShort:stringObj.text.dayNames,closeOnSelect:!0,onOpen:function(){$$(".picker-calendar-week-day-weekend").each(function(e,t){"六"==$$(t).text()&&$$(t).addClass("sat")}),$$(".picker-calendar-week-day-weekend").each(function(e,t){"日"==$$(t).text()&&$$(t).addClass("sun")})}});$(".date-search-block a").unbind("click"),$(".date-search-block a").click(function(e){branchObj.shopcouponreservationquery(t.sd_id,$(".date-search-block .date").val().substring(0,10),9)})},noReplyReservationInit:function(e){var t=indexObj._dataStorage(branchObj.storage.branchData);branchObj.query_reservationreplystatus(t.sd_id)},serviceRecordInit:function(e){branchObj.shopservicequequery(1,"","")},shopquestionnaire_read:function(e,t){var a=indexObj._dataCookies(indexObj._storage.main);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopquestionnaire_read,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,event_type:e,event_id:t},success:function(s){if(indexObj.jsonUrlDecode(s),myApp.hideIndicator(),s.shopquestionnaire_readresult){var r=JSON.parse(JSON.stringify(s.shopquestionnaire_readresult));if("000000000"===r.message_no){$(".shop-coupon-img").attr("src",stringObj.text.branch_img_path+r.event_pic),$(".shopcoupon_name").html(r.event_title),r.questionnaire_content.sort(sortByProperty("sqn_questionorder",1));var i=indexObj.template("templateQuestionnaire")(r);$$(".question-block").html(i),myApp.initImagesLazyLoad(".page-content"),$$(".sqna_message").on("click",function(){myApp.alert('<textarea class="sqna_msg resizable" rows="9" placeholder="'+stringObj.text.input_limit70+'" onkeyup="this.value = this.value.slice(0, 70)"></textarea>',stringObj.text.sqna_message),$(".sqna_msg").val($(".sqna_message").val()),$("textarea.sqna_msg").focus(),$(".modal-button").click(function(){$(".sqna_message").val($(".sqna_msg").val())})}),carModelArray=carModels.Alfa_Romeo[1];myApp.picker({input:".carModels",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+"  "+t[1]},cols:[{textAlign:"left",width:180,values:["Alfa_Romeo","Aston_Martin","Audi","Bentley","BMW","Bugatti","Buick","Cadillac","Chery","Chrysler","Citroen","CMC","Daihatsu","DS","Ferrari","Fiat","Ford","Honda","Hyundai","Infiniti","IVECO","Jaguar","Kia","Lamborghini","Land Rover","Lexus","Lotus","Luxgen","Maserati","Mazda","McLaren","Mercedes_Benz","Mini","Mitsubishi","Morgan","Nissan","Opel","Peugeot","Porsche","Proton","Renault","Rolls_Royce","Skoda","Smart","Ssangyong","Subaru","Suzuki","Tesla","Tobe","Toyota","Volkswagen","Volvo"],onChange:function(e,t){e.cols[1].replaceValues&&(e.cols[1].replaceValues(carModels[t][0]),carModelArray=carModels[t][1])}},{values:carModels.Alfa_Romeo[0],width:180,onChange:function(e,t){modelIndex=e.cols[1].activeIndex}}]});$(".send").click(function(){var s={questionnaireanswer:[]};for(var i in r.questionnaire_content){if(void 0==$("input[name=point-"+r.questionnaire_content[i].sqn_serno+"]:checked").val())return void myApp.alert('<div class="alert-text">'+stringObj.text.data_not_complete+"</div>",stringObj.text.warn);s.questionnaireanswer.push(JSON.parse($("input[name=point-"+r.questionnaire_content[i].sqn_serno+"]:checked").val()))}var n=0;for(var i in s.questionnaireanswer)n+=parseInt(s.questionnaireanswer[i].answer);var o={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,event_type:e,event_id:t,answercontent:JSON.stringify(s),ci_serno:carModelArray[modelIndex],sqna_message:$(".sqna_message").val(),averagescore:n/s.questionnaireanswer.length};branchObj.shopquestionnaire_ans(o)})}else stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null),$(".modal-button").click(function(){mainView.router.load({url:"mailbox"})})}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopquestionnaire_ans:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopquestionnaire_ans,para:e,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopquestionnaire_ansresult){var t=JSON.parse(JSON.stringify(e.shopquestionnaire_ansresult));if("011002000"===t.message_no||"011601003"===t.message_no||"011601004"===t.message_no){var a=indexObj._dataCookies(indexObj._storage.main);a.giftpoint=t.cos_end_giftpoint,indexObj._dataCookies(indexObj._storage.main,a,"iscarmg.com"),"000000000"===t.message_no?myApp.alert(stringObj.text.nowCoin+"："+t.cos_end_giftpoint,stringObj.text.comment_finish):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)),$(".modal-button").click(function(){mainView.router.load({url:"mailbox"})})}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null),$(".modal-button").click(function(){mainView.router.load({url:"mailbox"})})}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopQuestionnaireInit:function(e){var t=e.query,a=JSON.parse(t.uml_object);$$(".left a").click(function(){window.history.back()}),branchObj.shopquestionnaire_read(a.Event_type,a.Event_id)},shopquestionnaire_response:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopquestionnaire_response,para:e,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopquestionnaire_responseresult){var t=JSON.parse(JSON.stringify(e.shopquestionnaire_responseresult));"010912000"===t.message_no?(myApp.toast(stringObj.text.reply_success,"",{}).show(),mainView.router.load({url:"shop/questionnaire-management",reload:!0})):(mainView.router.load({url:"shop/questionnaire-management",reload:!0}),stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopServiceManagementInit:function(e){var t,a=indexObj._dataCookies(indexObj._storage.main),s=indexObj._dataStorage(branchObj.storage.branchData);$(".service-checkbox").change(function(){if(s=indexObj._dataStorage(branchObj.storage.branchData),$(this).is(":checked"))t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,operation:"0"},branchObj.shoponoffoperation(t);else if(s.ssqm_dailyend){var e=new Date,r=e.getHours(),i=e.getMinutes(),n=e.getSeconds();r<10&&(r="0"+r),i<10&&(i="0"+i),n<10&&(n="0"+n),e=parseInt(""+r+i+n);var o=s.ssqm_dailyend.substring(0,2)+s.ssqm_dailyend.substring(3,5)+s.ssqm_dailyend.substring(6,8);o=parseInt(o),t=e>o?{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,operation:"2"}:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,operation:"1"},branchObj.shoponoffoperation(t)}}),branchObj.shopservicelistquery(s.sd_id),branchObj.shopservicequequery(0,"",s.sd_id)},shopServiceSettingInit:function(e){var t=e.query,a=indexObj._dataStorage(branchObj.storage.branchData);if($(".left a").attr("href","shop/shopservice-management?sd_id="+a.sd_id),branchObj.shopservicelistquery(a.sd_id),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},2e3),t.tab&&(myApp.showTab("."+t.tab),"shopservice-set"==t.tab)){$(".shopservice-set").html("");var s=indexObj.template("templateShopServiceEditBtn")("");$$(".toolbar-bottom .toolbar-inner").html(s);var r=indexObj._dataCookies(indexObj._storage.main),i={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,sd_id:a.sd_id,action_type:2,ssqm_weekstart:"",ssqm_weekend:"",ssqm_dailystart:"",ssqm_dailyend:"",ssqm_dayoffarray:""};branchObj.shopservicefunctionadjust(i),$(".list").css("background","#202020"),$(".set").css("background","#F26531"),$(".floating-button").css("display","none"),$(".toolbar-bottom").css("display","inherit")}$$(".shopservice-list").on("show",function(){$$(".shopservice-list .shopservice-list-content ul").html(""),branchObj.shopservicelistquery(a.sd_id),$(".list").css("background","#F26531"),$(".set").css("background","#202020"),$(".floating-button").css("display","flex"),$(".toolbar-bottom").css("display","none")}),$$(".shopservice-set").on("show",function(){$(".shopservice-set").html("");var e=indexObj.template("templateShopServiceEditBtn")("");$$(".toolbar-bottom .toolbar-inner").html(e);var t=indexObj._dataCookies(indexObj._storage.main),s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,action_type:2,ssqm_weekstart:"",ssqm_weekend:"",ssqm_dailystart:"",ssqm_dailyend:"",ssqm_dayoffarray:""};branchObj.shopservicefunctionadjust(s),$(".list").css("background","#202020"),$(".set").css("background","#F26531"),$(".floating-button").css("display","none"),$(".toolbar-bottom").css("display","inherit")})},shopServiceEditInit:function(e){var t=e.query,a=indexObj._dataStorage(branchObj.storage.branchData);"edit"==t.type?($(".toolbar.add").css("display","none"),$(".toolbar.edit").css("display","inherit"),branchObj.shopservicecontentquery(t.ssqd_id)):(localStorage.getItem(branchObj.storage.imagePath)?(a.ssqd_mainpic=localStorage.getItem(branchObj.storage.imagePath),$$(".shopservice-img-block").html('<img data-src="'+stringObj.text.branch_img_path+localStorage.getItem(branchObj.storage.imagePath)+'" class="lazy shopservice-img" onerror=\'this.src = "../app/image/imgDefault.png"\'/><div class="edit-img"><i class="fa fa-pencil" aria-hidden="true"></i></div>')):a.ssqd_mainpic="",indexObj._dataStorage(branchObj.storage.branchData,a)),$(".left a").attr("href","shop/shopservice-setting?sd_id="+a.sd_id),$$(".shopservice-name").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="名稱">',"服務名稱"),$(".input-value").val($("#shopservice-name").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#shopservice-name").val($(".input-value").val())})}),$$(".shopservice-price").on("click",function(){myApp.alert('<input class="input-value" type="number" min="0" placeholder="金額" onkeydown="input_limit(this, 10);" onkeyup="input_limit(this, 10);">',"服務費用"),$(".input-value").val($("#shopservice-price").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#shopservice-price").val($(".input-value").val())})}),$$(".shopservice-maxnum").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="人數">',"最大排隊數"),$(".input-value").val($("#shopservice-maxnum").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#shopservice-maxnum").val($(".input-value").val())})}),$$(".shopservice-context").on("click",function(){myApp.alert('<textarea class="info resizable" placeholder="內容" rows="9"></textarea>',"簡介內容"),$(".info").val($("#shopservice-context").val()),$("textarea.info").focus(),$(".modal-button").click(function(){$("#shopservice-context").val($(".info").val())})});myApp.picker({input:".page:not(.cached) #shopservice-require-time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">所需工時</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+" 小時 "+t[1]+" 分鐘 "},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:" 小時 "},{values:["00","30"]},{textAlign:"center",divider:!0,content:" 分鐘 "}]});$(".edit-img").click(function(){void 0!==Cookies.get("app_version")?addImage("branch-service",""):setImgOnPC("sd_id="+a.sd_id+"&folder=shopservice","")}),$(".add").click(function(){$(".shopservice-name").removeClass("lengthError"),$(".shopservice-context").removeClass("lengthError"),$(".shopservice-name").removeClass("spacesError"),$(".shopservice-price").removeClass("spacesError"),$(".shopservice-maxnum").removeClass("spacesError"),$(".shopservice-name").removeClass("nullError"),$(".shopservice-require-time").removeClass("nullError"),$(".shopservice-price").removeClass("nullError"),$(".shopservice-maxnum").removeClass("nullError"),$(".shopservice-context").removeClass("nullError"),$(".noSetImg").css("display","none");var e=!1;$("#shopservice-name").val().length>20&&($(".shopservice-name").addClass("lengthError"),e=!0),$("#shopservice-context").val().length>140&&($(".shopservice-context").addClass("lengthError"),e=!0),-1!==$("#shopservice-name").val().indexOf(" ")&&($(".shopservice-name").addClass("spacesError"),e=!0),-1!==$("#shopservice-price").val().indexOf(" ")&&($(".shopservice-price").addClass("spacesError"),e=!0),-1!==$("#shopservice-maxnum").val().indexOf(" ")&&($(".shopservice-maxnum").addClass("spacesError"),e=!0),""===(a=indexObj._dataStorage(branchObj.storage.branchData)).ssqd_mainpic&&($(".noSetImg").css("display","inherit"),e=!0),""===$("#shopservice-name").val()&&($(".shopservice-name").addClass("nullError"),e=!0),""===$("#shopservice-require-time").val()&&($(".shopservice-require-time").addClass("nullError"),e=!0),""===$("#shopservice-price").val()&&($(".shopservice-price").addClass("nullError"),e=!0),""===$("#price").val()&&($(".price").addClass("nullError"),e=!0),""===$("#shopservice-maxnum").val()&&($(".shopservice-maxnum").addClass("nullError"),e=!0),""===$("#shopservice-context").val()&&($(".shopservice-context").addClass("nullError"),e=!0),e&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%"))),a.ssqd_mainpic.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(a.ssqd_mainpic=a.ssqd_mainpic.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length),indexObj._dataStorage(branchObj.storage.branchData,a));var t=indexObj._dataCookies(indexObj._storage.main),s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,action_type:0,ssqd_id:"",ssqd_title:$("#shopservice-name").val(),ssqd_content:$("#shopservice-context").val(),ssqd_mainpic:a.ssqd_mainpic,ssqd_workhour:(60*parseInt($("#shopservice-require-time").val().substring(0,2))+parseInt($("#shopservice-require-time").val().substring(6,8)))/30,ssqd_serviceprice:$("#shopservice-price").val(),ssqd_effectivity:0,ssqd_maxqueueamount:$("#shopservice-maxnum").val()};e||branchObj.shopservicemanage(s)}),$(".edit").click(function(){$(".shopservice-name").removeClass("lengthError"),$(".shopservice-context").removeClass("lengthError"),$(".shopservice-name").removeClass("spacesError"),$(".shopservice-price").removeClass("spacesError"),$(".shopservice-maxnum").removeClass("spacesError"),$(".shopservice-name").removeClass("nullError"),$(".shopservice-require-time").removeClass("nullError"),$(".shopservice-price").removeClass("nullError"),$(".shopservice-maxnum").removeClass("nullError"),$(".shopservice-context").removeClass("nullError"),$(".noSetImg").css("display","none");var e=!1;$("#shopservice-name").val().length>20&&($(".shopservice-name").addClass("lengthError"),e=!0),$("#shopservice-context").val().length>140&&($(".shopservice-context").addClass("lengthError"),e=!0),-1!==$("#shopservice-name").val().indexOf(" ")&&($(".shopservice-name").addClass("spacesError"),e=!0),-1!==$("#shopservice-price").val().indexOf(" ")&&($(".shopservice-price").addClass("spacesError"),e=!0),-1!==$("#shopservice-maxnum").val().indexOf(" ")&&($(".shopservice-maxnum").addClass("spacesError"),e=!0),""===(a=indexObj._dataStorage(branchObj.storage.branchData)).ssqd_mainpic&&($(".noSetImg").css("display","inherit"),e=!0),""===$("#shopservice-name").val()&&($(".shopservice-name").addClass("nullError"),e=!0),""===$("#shopservice-require-time").val()&&($(".shopservice-require-time").addClass("nullError"),e=!0),""===$("#shopservice-price").val()&&($(".shopservice-price").addClass("nullError"),e=!0),""===$("#price").val()&&($(".price").addClass("nullError"),e=!0),""===$("#shopservice-maxnum").val()&&($(".shopservice-maxnum").addClass("nullError"),e=!0),""===$("#shopservice-context").val()&&($(".shopservice-context").addClass("nullError"),e=!0),e&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%"))),a.ssqd_mainpic.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(a.ssqd_mainpic=a.ssqd_mainpic.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length),indexObj._dataStorage(branchObj.storage.branchData,a));var s=indexObj._dataCookies(indexObj._storage.main),r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,sd_id:a.sd_id,action_type:1,ssqd_id:t.ssqd_id,ssqd_title:$("#shopservice-name").val(),ssqd_content:$("#shopservice-context").val(),ssqd_mainpic:a.ssqd_mainpic,ssqd_workhour:(60*parseInt($("#shopservice-require-time").val().substring(0,2))+parseInt($("#shopservice-require-time").val().substring(6,8)))/30,ssqd_serviceprice:$("#shopservice-price").val(),ssqd_effectivity:0,ssqd_maxqueueamount:$("#shopservice-maxnum").val()};e||branchObj.shopservicemanage(r)})},shopServicePassInit:function(e){var t=indexObj._dataStorage(branchObj.storage.branchData);$(".left a").attr("href","shop/shopservice-management?sd_id="+t.sd_id),branchObj.shopservicequequery(0,"","")},shopRecordInit:function(e){$$(".tab-link").click(function(){$$(".tab-link").removeClass("active"),$$(this).addClass("active")});var t=indexObj._dataStorage(branchObj.storage.branchData);branchObj.shopcouponreservationquery(t.sd_id),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},2e3),$$(".reservation-record").on("show",function(){$$(".reservation-record").html(""),branchObj.shopcouponreservationquery(t.sd_id)}),$$(".service-record").on("show",function(){$$(".service-record").html(""),branchObj.shopservicequequery(1,"","")}),$$(".scan-record").on("show",function(){branchObj.scanRecordGet()})},shopRecordsInit:function(e){$(".shop-records-center").html(stringObj.shop.shop_records)},shopServiceinfoInit:function(e){var t=e.query;"client"==t.from?($(".left a").attr("href","branch-info?tab=branch-queue-content&sd_id="+nowSd_id),$(".left a").unbind("click"),$(".left a").click(function(){localStorage.setItem("pageInit","shop/shopservice-info"),window.location="pm/branch-info?tab=branch-queue-content&sd_id="+nowSd_id})):"setting"==t.from?($(".left a").attr("href","shop/shopservice-setting"),$(".queue").css("display","none")):t.type&&($(".queue").css("display","none"),"service_available"==t.type||"service_finish"==t.type||"service_invalid"==t.type?$(".left a").attr("href","coupon-record?tab=queue"):"scan"==t.type&&($(".left a").attr("href","shop/shopservice-management"),$(".serving").css("display","inherit")),"service_available"==t.type&&$(".showQR").css("display","inherit")),t.type?branchObj.shopservicecontentquery(t.ssqd_id,t.type,t.ssqq_id):branchObj.shopservicecontentquery(t.ssqd_id,"",""),$(".queue").click(function(){queue(t.ssqd_id)})},shopservicelistquery:function(e){nowSd_id=e,myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopservicelistquery,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sd_id:e},success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopservicelistqueryresult){var t=JSON.parse(JSON.stringify(e.shopservicelistqueryresult));if("000000000"===t.message_no){if("shopservice-management"==nowPage){var a=indexObj._dataStorage(branchObj.storage.branchData);if(a.ssqm_dailyend=t.ssqm_dailyend,indexObj._dataStorage(branchObj.storage.branchData,a),"1"==t.ssqm_servicestart&&$(".service-checkbox").prop("checked",!0),""==t.servicelist)dataNull("templateShopServiceListNull",stringObj.text.no_service,".serving-list");else{var s=indexObj._dataStorage(branchObj.storage.callTimeObj)||[],r=JSON.stringify(s);for(var i in t.servicelist)t.servicelist[i].ssqd_mainpic=stringObj.text.branch_img_path+t.servicelist[i].ssqd_mainpic,"0"==t.servicelist[i].ssqd_effectivity?t.servicelist[i].effectivity=!1:t.servicelist[i].effectivity=!0,r.match(t.servicelist[i].ssqd_id)?(findArrayItem(s,"ssqd_id",t.servicelist[i].ssqd_id),t.servicelist[i].call_time=s[nowIndex].call_time):t.servicelist[i].call_time="";c=(o=indexObj.template("templateShopServiceList"))(t);$$(".serving-list ul").html(c),myApp.initImagesLazyLoad(".page-content")}}else if("shopservice-setting"==nowPage)if(""==t.servicelist){c=(o=indexObj.template("templateShopServiceNull"))("");$$(".shopservice-list-content").html(c)}else{for(var i in t.servicelist)t.servicelist[i].ssqd_mainpic=stringObj.text.branch_img_path+t.servicelist[i].ssqd_mainpic,"0"==t.servicelist[i].ssqd_effectivity?(t.servicelist[i].ssqd_effectivity=stringObj.text.stop_use,t.servicelist[i].effectivity=!1):(t.servicelist[i].ssqd_effectivity=stringObj.text.start_use,t.servicelist[i].effectivity=!0);c=(o=indexObj.template("templateShopService"))(t);$$(".shopservice-list-content ul").html(c),myApp.initImagesLazyLoad(".page-content"),$(".check").click(function(){myApp.alert(stringObj.text.shopservice_edit_check,stringObj.text.warn)})}else if("branch-info"==nowPage)if(""==t.servicelist){c=(o=indexObj.template("templateBranchQueueNull"))("");$$(".branch-queue-content .serving-list").html(c)}else{var n=[];for(var i in t.servicelist)t.servicelist[i].ssqd_mainpic=stringObj.text.branch_img_path+t.servicelist[i].ssqd_mainpic,"0"==t.servicelist[i].ssqd_effectivity?t.servicelist[i].effectivity=!1:(t.servicelist[i].effectivity=!0,n.push(t.servicelist[i].ssqd_id));var o=indexObj.template("templateBranchQueue"),c=o(t);$$(".branch-queue-content .serving-list ul").html(c),myApp.initImagesLazyLoad(".branch-queue-content"),$(".item-"+n[0]).addClass("active"),$(".list-item").click(function(){$(".list-item").removeClass("active"),$(this).addClass("active")});var l={useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""};findArrayItem(t.servicelist,"ssqd_id",n[0]),new CountUp(".now-queue-num",0,parseInt(t.servicelist[nowIndex].today_serviced),0,1,l).start(),new CountUp(".queue-sum",0,parseInt(t.today_tatal),0,1,l).start();var d=indexObj._dataStorage(branchObj.storage.shopServiceRecord)||{last_update_date:"",availableList:[],finishList:[],invalidList:[]};if(JSON.stringify(d.availableList).match(n[0])){var p=new Date,m=p.getMonth()+1,u=p.getDate();if(m<10&&(m="0"+m),u<10&&(u="0"+u),new Date(p.getFullYear()+"/"+m+"/"+u)/864e5-new Date(d.last_update_date)/864e5>=1)b=new CountUp(".user-num",0,0,0,1,l);else var b=new CountUp(".user-num",0,parseInt(d.availableList[0].ssqq_queserno),0,1,l);b.start()}else(b=new CountUp(".user-num",0,0,0,1,l)).start()}}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopservicemanage:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopservicemanage,para:e,success:function(t){if(myApp.hideIndicator(),t.shopservicemanageresult){var a=JSON.parse(JSON.stringify(t.shopservicemanageresult));if("000000000"===a.message_no){if("shopservice-edit"==nowPage){indexObj._dataStorage(branchObj.storage.imagePath,null);var s=indexObj._dataStorage(branchObj.storage.branchData);if(isMobile.Android())webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,s.ssqd_mainpic,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","");else if(isMobile.iOS()){var r=[];r.push(s.ssqd_mainpic),webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,r,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",[])}}"1"==e.action_type?myApp.toast(stringObj.text.edit_success,"",{}).show():"0"==e.action_type&&myApp.toast(stringObj.text.add_success,"",{}).show(),mainView.router.load({url:"shop/shopservice-setting",reload:!0})}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopservicecontentquery:function(e,t,a){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopservicecontentquery,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),ssqd_id:e},success:function(s){if(indexObj.jsonUrlDecode(s),myApp.hideIndicator(),s.shopservicecontentqueryresult){var r=JSON.parse(JSON.stringify(s.shopservicecontentqueryresult));if("000000000"===r.message_no){var i=parseInt(30*parseFloat(r.ssqd_workhour)/60),n=parseInt(30*parseFloat(r.ssqd_workhour)%60);if(r.ssqd_workhour=i+"小時"+n+"分鐘","shopservice-info"==nowPage){r.ssqd_mainpic=stringObj.text.branch_img_path+r.ssqd_mainpic;var o=indexObj.template("templateShopServiceInfo")(r);if($$(".shopservice-info-content").html(o),myApp.initImagesLazyLoad(".page-content"),"scan"==t){var c=indexObj._dataStorage(branchObj.storage.branchData);$(".subTitle").css("display","inherit"),$(".client-info").css("display","inherit"),$(".client-pic").attr("src",c.client_pic),$(".client-name").html(c.client_name),$(".client-num").html(c.client_num),$(".client-date").html(c.client_date)}$(".showQR").click(function(){var s,r=new Date,i=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds(),n=indexObj._dataStorage(branchObj.storage.shopServiceRecord);"service_available"==t&&(findArrayItem(n.availableList,"ssqq_id",a),s=n.availableList[nowIndex].ssqq_queserno);var o='{"ssqd_id":"'+e+'","ssqq_id":"'+a+'","ssqq_queserno":"'+s+'","nowDate":"'+i+'"}';myApp.modal({title:"",text:'<div class="qr-content"><div class="qr-title">'+stringObj.text.service_qr_title+'</div><div class="qr-code"></div><p class="qr-use-title"><b style="color:#F26531;">'+stringObj.text.qr_subtitle+'：</b></p><p class="qr-use-content">'+stringObj.text.service_qr_context+"</p></div>",buttons:[{text:stringObj.text.confirm,bold:!0,onClick:function(){}}]}),$(".qr-code").qrcode({render:"div",size:235,background:"#fff",text:o}),$(".modal").css("top","30%"),$(".modal").css("width","270px")}),$(".serving").click(function(){branchObj.shopserviceexec(e,a)})}else"shopservice-edit"==nowPage&&((c=indexObj._dataStorage(branchObj.storage.branchData)).ssqd_mainpic=r.ssqd_mainpic,indexObj._dataStorage(branchObj.storage.branchData,c),localStorage.getItem(branchObj.storage.imagePath)?(r.ssqd_mainpic=stringObj.text.branch_img_path+localStorage.getItem(branchObj.storage.imagePath),c.ssqd_mainpic=localStorage.getItem(branchObj.storage.imagePath),indexObj._dataStorage(branchObj.storage.branchData,c)):r.ssqd_mainpic=stringObj.text.branch_img_path+r.ssqd_mainpic,$$(".shopservice-img-block").html('<img data-src="'+r.ssqd_mainpic+'" class="lazy shopservice-img" onerror=\'this.src = "../app/image/imgDefault.png"\'/><div class="edit-img"><i class="fa fa-pencil" aria-hidden="true"></i></div>'),$("#shopservice-name").val(r.ssqd_title),$("#shopservice-require-time").val(r.ssqd_workhour),$("#shopservice-price").val(r.ssqd_serviceprice),$("#shopservice-maxnum").val(r.ssqd_maxqueueamount),$("#shopservice-context").val(r.ssqd_content),myApp.initImagesLazyLoad(".page-content"),$(".edit-img").click(function(){isMobile.Android()||isMobile.iOS()?addImage("branch-service",""):setImgOnPC("sd_id="+c.sd_id+"&folder=shopservice","")}))}else stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shoponoffoperation:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shoponoffoperation,para:e,success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.shoponoffoperationresult){var a=JSON.parse(JSON.stringify(t.shoponoffoperationresult));if("000000000"===a.message_no||"010917004"===a.message_no){var s=indexObj._dataStorage(branchObj.storage.branchData);s.ssqm_dailyend=a.ssqm_dailyend,indexObj._dataStorage(branchObj.storage.branchData,s),"2"==e.operation&&indexObj._dataStorage(branchObj.storage.callTimeObj,null)}else"010920002"!=a.message_no&&($(".service-checkbox").is(":checked")?$(".service-checkbox").prop("checked",!1):$(".service-checkbox").prop("checked",!0)),"010920003"!=a.message_no&&($(".service-checkbox").is(":checked")?$(".service-checkbox").prop("checked",!1):$(".service-checkbox").prop("checked",!0)),"010920004"!=a.message_no&&($(".service-checkbox").is(":checked")?$(".service-checkbox").prop("checked",!1):$(".service-checkbox").prop("checked",!0)),stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopservicefunctionadjust:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopservicefunctionadjust,para:e,success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.shopservicefunctionadjustresult){var a=JSON.parse(JSON.stringify(t.shopservicefunctionadjustresult));if("000000000"===a.message_no){var s=indexObj.template("templateShopServiceSet")("");$$(".shopservice-set").html(s);var r,i=[];if(""!=a.ssqm_dayoffarray){a.ssqm_dayoffarray=a.ssqm_dayoffarray.replace(/-/gi,"/");for(var n in a.ssqm_dayoffarray.split(","))r=new Date(a.ssqm_dayoffarray.split(",")[n]).getTime(),i.push(r)}var o=myApp.calendar({container:"#calendar-holidays",multiple:!0,firstDay:0,monthNames:stringObj.text.monthNames,value:i});""!=a.ssqm_weekstart&&""!=a.ssqm_weekend&&$("#service-date").val("星期"+a.ssqm_weekstart+" ~ 星期"+a.ssqm_weekend),""!=a.ssqm_dailystart&&""!=a.ssqm_dailyend&&$("#service-time").val(a.ssqm_dailystart.substring(0,5)+" ~ "+a.ssqm_dailyend.substring(0,5)),$$(".picker-calendar-week-day-weekend").each(function(e,t){"Sat"==$$(t).text()&&$$(t).addClass("sat")}),$$(".picker-calendar-week-day-weekend").each(function(e,t){"Sun"==$$(t).text()&&$$(t).addClass("sun")});myApp.picker({input:"#service-date",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+" ~ "+t[1]},cols:[{values:stringObj.text.week_array,textAlign:"center",width:120},{textAlign:"center",divider:!0,content:" ~ "},{values:stringObj.text.week_array,textAlign:"center",width:120}]}),myApp.picker({input:".page:not(.cached) #service-time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">活動每日時間</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+":"+t[1]+" ~ "+t[2]+":"+t[3]},onOpen:function(e){e.setValue([a.ssqm_dailystart.substring(0,2),a.ssqm_dailystart.substring(3,5),a.ssqm_dailyend.substring(0,2),a.ssqm_dailyend.substring(3,5)])},cols:[{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:":"},{values:["00","30"]},{textAlign:"center",divider:!0,content:" ~ "},{textAlign:"center",values:function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},{textAlign:"center",divider:!0,content:":"},{textAlign:"center",values:["00","30"]}]});$(".edit").click(function(){$(".service-date").removeClass("nullError"),$(".service-time").removeClass("nullError");var e=!1;""===$("#service-date").val()&&($(".service-date").addClass("nullError"),e=!0),""===$("#service-time").val()&&($(".service-time").addClass("nullError"),e=!0),e&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%"))),i=[];var t,s;for(var n in o.value)t=(r=new Date(o.value[n])).getMonth()+1,s=r.getDate(),t<10&&(t="0"+t),s<10&&(s="0"+s),r=r.getFullYear()+"-"+t+"-"+s,i.push(r);var c=indexObj._dataCookies(indexObj._storage.main),l=indexObj._dataStorage(branchObj.storage.branchData),d={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:c.sat,sd_id:l.sd_id,action_type:1,ssqm_weekstart:$("#service-date").val().substring(2,3),ssqm_weekend:$("#service-date").val().substring(8,9),ssqm_dailystart:$("#service-time").val().substring(0,5)+":00",ssqm_dailyend:$("#service-time").val().substring(8,13)+":00",ssqm_dayoffarray:i+""};""==a.ssqm_weekstart&&""==a.ssqm_dailystart&&(d.action_type=0),e||branchObj.shopservicefunctionadjust(d)}),2!=e.action_type&&mainView.router.load({url:"shop/shopservice-setting?tab=shopservice-set",reload:!0})}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopservicequeask:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopservicequeask,para:e,success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.shopservicequeaskresult){var a=JSON.parse(JSON.stringify(t.shopservicequeaskresult));if("000000000"===a.message_no||"010914000"===a.message_no){var s=new Date,r=s.getFullYear()+"/"+(s.getMonth()+1)+"/"+s.getDate()+" "+s.getHours()+":"+s.getMinutes()+":"+s.getSeconds(),i='{"ssqd_id":"'+e.ssqd_id+'","ssqq_id":"'+a.ssqq_id+'","ssqq_queserno":"'+a.ssqq_queserno+'","nowDate":"'+r+'"}';myApp.modal({title:"",text:'<div class="qr-content"><div class="qr-title">'+stringObj.text.service_qr_title+'</div><div class="qr-code"></div><p class="qr-use-title"><b style="color:#F26531;">'+stringObj.text.qr_subtitle+'：</b></p><p class="qr-use-content">'+stringObj.text.service_qr_context+"</p></div>",buttons:[{text:stringObj.text.confirm,bold:!0,onClick:function(){branchObj.shopservicequerecorver()}}]}),$(".qr-code").qrcode({render:"div",size:235,background:"#fff",text:i}),$(".modal").css("top","30%"),$(".modal").css("width","270px"),localStorage.setItem("pageInit",nowPage),window.location="branch-info?tab=branch-queue-content&sd_id="+nowSd_id}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopservicequequery:function(e,t,a){var s=indexObj._dataCookies(indexObj._storage.main),r=indexObj._dataStorage(branchObj.storage.branchData)||{},i={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,sd_id:a,operation_type:e};""==a&&(i.sd_id=r.sd_id),myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopservicequequery,para:i,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopservicequequeryresult){var a=JSON.parse(JSON.stringify(e.shopservicequequeryresult));if("000000000"===a.message_no){if("branch-main"==nowPage||"shopservice-pass"==nowPage){if(""!=a.serviceque_array[0].queue_array){var r=new Date,i=r.getMonth()+1,n=r.getDate();if(i<10&&(i="0"+i),n<10&&(n="0"+n),a.serviceque_array[0].date.match(r.getFullYear()+"-"+i+"-"+n)){var o=0;for(var c in a.serviceque_array[0].queue_array)"1"==a.serviceque_array[0].queue_array[c].ssqq_usestatus&&"branch-main"==nowPage?(a.serviceque_array[0].queue_array[c].ssqq_usestatus=!0,o++):"7"==a.serviceque_array[0].queue_array[c].ssqq_usestatus&&"shopservice-pass"==nowPage?(a.serviceque_array[0].queue_array[c].ssqq_usestatus=!0,o++):a.serviceque_array[0].queue_array[c].ssqq_usestatus=!1,""==a.serviceque_array[0].queue_array[c].ssd_picturepath?a.serviceque_array[0].queue_array[c].ssd_picturepath="../app/image/general_user.png":a.serviceque_array[0].queue_array[c].ssd_picturepath.match("square")?a.serviceque_array[0].queue_array[c].ssd_picturepath=a.serviceque_array[0].queue_array[c].ssd_picturepath.replace("picture?type=square","picture?type=large"):a.serviceque_array[0].queue_array[c].ssd_picturepath=a.serviceque_array[0].queue_array[c].ssd_picturepath,findArrayItem(carModelArray,"ci_serno",parseInt(a.serviceque_array[0].queue_array[c].ci_serno)),a.serviceque_array[0].queue_array[c].car_model=carModelArray[nowIndex].ci_carbrand+"  "+carModelArray[nowIndex].ci_carmodel;if(a.serviceque_array[0].queue_array.sort(sortByProperty("ssqq_queserno",1)),0==o){if("branch-main"==nowPage){j=(O=indexObj.template("templateRecordNull"))("");$$(".queue-list").html(j)}else if("shopservice-pass"==nowPage){j=(O=indexObj.template("templateQueuePassedNull"))("");$$(".page-content").html(j)}}else if("branch-main"==nowPage){p=(d=indexObj.template("templateBranchMainQueueList"))(a.serviceque_array[0]);$$(".queue-list ul").html(p),myApp.initImagesLazyLoad(".page-content"),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},2e3),$$(".queue-num span").html(a.serviceque_array[0].queue_array.length)}else if("shopservice-pass"==nowPage){p=(d=indexObj.template("templateQueuePassedList"))(a.serviceque_array[0]);$$(".list-block ul").html(p),myApp.initImagesLazyLoad(".page-content")}}else if("branch-main"==nowPage){j=(O=indexObj.template("templateRecordNull"))("");$$(".queue-list").html(j)}else if("shopservice-pass"==nowPage){j=(O=indexObj.template("templateQueuePassedNull"))("");$$(".page-content").html(j)}}else if("branch-main"==nowPage){j=(O=indexObj.template("templateRecordNull"))("");$$(".queue-list").html(j)}else if("shopservice-pass"==nowPage){j=(O=indexObj.template("templateQueuePassedNull"))("");$$(".page-content").html(j)}}else if("service-record"==nowPage)if(""===a.serviceque_array){j=(O=indexObj.template("templateBranchServiceBlock"))(a);$$(".service-record").html(j)}else{j=(O=indexObj.template("templateBranchServiceBlock"))(a);$$(".service-record").html(j);for(var l in a.serviceque_array){for(var c in a.serviceque_array[l].queue_array){switch(a.serviceque_array[l].queue_array[c].ssqq_usestatus){case"1":a.serviceque_array[l].queue_array[c].status=stringObj.text.queuing;break;case"2":a.serviceque_array[l].queue_array[c].status=stringObj.text.servicing;break;case"3":a.serviceque_array[l].queue_array[c].status=stringObj.text.abandoned;break;case"4":a.serviceque_array[l].queue_array[c].status=stringObj.text.missed;break;case"5":a.serviceque_array[l].queue_array[c].status=stringObj.text.missed_serviced;break;case"6":a.serviceque_array[l].queue_array[c].status=stringObj.text.abandoned_serviced;break;case"7":a.serviceque_array[l].queue_array[c].status=stringObj.text.passed;break;case"8":a.serviceque_array[l].queue_array[c].status=stringObj.text.passed_serviced}""==a.serviceque_array[l].queue_array[c].ssd_picturepath?a.serviceque_array[l].queue_array[c].ssd_picturepath="../app/image/general_user.png":a.serviceque_array[l].queue_array[c].ssd_picturepath.match("square")?a.serviceque_array[l].queue_array[c].ssd_picturepath=a.serviceque_array[l].queue_array[c].ssd_picturepath.replace("picture?type=square","picture?type=large"):a.serviceque_array[l].queue_array[c].ssd_picturepath=a.serviceque_array[l].queue_array[c].ssd_picturepath,findArrayItem(carModelArray,"ci_serno",parseInt(a.serviceque_array[l].queue_array[c].ci_serno)),a.serviceque_array[l].queue_array[c].car_model=carModelArray[nowIndex].ci_carbrand+"  "+carModelArray[nowIndex].ci_carmodel}var d=indexObj.template("templateBranchServiceList"),p=d(a.serviceque_array[l]);$$(".block-"+a.serviceque_array[l].date).append(p),myApp.initImagesLazyLoad(".page-content")}}else if("shopservice-management"==nowPage){f={useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""};if((y=new CountUp(".queue-sum",0,parseInt(a.serviceque_array[0].total_queue),0,1,f)).start(),new CountUp(".serving-sum",0,parseInt(a.serviceque_array[0].total_serviced),0,1,f).start(),""!=a.serviceque_array[0].queue_array){a.serviceque_array[0].queue_array.sort(sortByProperty("ssqq_queserno",1));var m=[];for(var l in a.serviceque_array[0].queue_array)null==(m+"").match(a.serviceque_array[0].queue_array[l].ssqd_id)&&m.push(a.serviceque_array[0].queue_array[l].ssqd_id);var u=[];for(var c in m){var b={};for(var _ in a.serviceque_array[0].queue_array)if("1"==a.serviceque_array[0].queue_array[_].ssqq_usestatus&&a.serviceque_array[0].queue_array[_].ssqd_id==m[c]){$(".swipeout-"+m[c]+" .next-num").html(a.serviceque_array[0].queue_array[_].ssqq_queserno),b.ssqd_id=m[c],b.ssqq_id=a.serviceque_array[0].queue_array[_].ssqq_id,u.push(b);break}}indexObj._dataStorage(branchObj.storage.nextNumObj,u)}}else if("branch-info"==nowPage&&""!=a.serviceque_array[0].queue_array){a.serviceque_array[0].queue_array.sort(sortByProperty("ssqq_queserno",1));var h=0,g=0;for(var l in a.serviceque_array[0].queue_array)a.serviceque_array[0].queue_array[l].ssqd_id==t&&(h++,"2"==a.serviceque_array[0].queue_array[l].ssqq_usestatus&&(g=a.serviceque_array[0].queue_array[l].ssqq_queserno));var v=0;for(var l in a.serviceque_array[0].queue_array)if(a.serviceque_array[0].queue_array[l].ssqd_id==t&&a.serviceque_array[0].queue_array[l].md_id==s.mdId&&"1"==a.serviceque_array[0].queue_array[l].ssqq_usestatus){v=a.serviceque_array[0].queue_array[l].ssqq_queserno;break}var f={useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""};new CountUp(".now-queue-num",0,parseInt(g),0,1,f).start();var y=new CountUp(".queue-sum",0,parseInt(h),0,1,f);y.start(),new CountUp(".user-num",0,parseInt(v),0,1,f).start()}}else if("010901002"==a.message_no){if("branch-main"==nowPage){j=(O=indexObj.template("templateRecordNull"))("");$$(".queue-list").html(j)}else if("shopservice-pass"==nowPage){j=(O=indexObj.template("templateQueuePassedNull"))("");$$(".page-content").html(j)}else if("service-record"==nowPage){var O=indexObj.template("templateBranchServiceNull"),j=O("");$$(".service-record").html(j)}}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopservicecallup:function(e){var t=indexObj._dataCookies(indexObj._storage.main),a=indexObj._dataStorage(branchObj.storage.branchData);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopservicecallup,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,ssqd_id:e},success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.shopservicecallupresult){var a=JSON.parse(JSON.stringify(t.shopservicecallupresult));if("000000000"===a.message_no||"010919000"===a.message_no||"010919007"===a.message_no){"010919007"!=a.message_no?(myApp.toast(stringObj.text.call_success,"",{}).show(),browser_width<992?($(".toast-container").css("width","60%"),$(".toast-container").css("left","35%")):($(".toast-container").css("width","20%"),$(".toast-container").css("left","45%"))):myApp.alert(stringObj.text._010919007,stringObj.text.warn),mainView.router.load({url:"shop/shopservice-management",reload:!0});var s=new Date,r=s.getHours(),i=s.getMinutes();r<10&&(r="0"+r),i<10&&(i="0"+i);var n=indexObj._dataStorage(branchObj.storage.callTimeObj)||[];if((n+"").match(e))findArrayItem(n,"ssqd_id",e),n[nowIndex].call_time=r+":"+i;else{var o={};o.ssqd_id=e,o.call_time=r+":"+i,n.push(o)}indexObj._dataStorage(branchObj.storage.callTimeObj,n)}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopqueuenoshow:function(e,t){var a=indexObj._dataCookies(indexObj._storage.main),s=indexObj._dataStorage(branchObj.storage.branchData);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopqueuenoshow,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,ssqq_id:t},success:function(t){if(indexObj.jsonUrlDecode(t),myApp.hideIndicator(),t.shopqueuenoshowresult){var a=JSON.parse(JSON.stringify(t.shopqueuenoshowresult));if("000000000"===a.message_no||"010918000"===a.message_no){myApp.toast(stringObj.text.passed_success,"",{}).show(),mainView.router.load({url:"shop/shopservice-management",reload:!0});var s=new Date,r=s.getHours(),i=s.getMinutes();r<10&&(r="0"+r),i<10&&(i="0"+i);var n=indexObj._dataStorage(branchObj.storage.callTimeObj)||[];if((n+"").match(e))findArrayItem(n,"ssqd_id",e),n[nowIndex].call_time=r+":"+i;else{var o={};o.ssqd_id=e,o.call_time=r+":"+i,n.push(o)}indexObj._dataStorage(branchObj.storage.callTimeObj,n)}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopqueueovercall:function(e){var t=indexObj._dataCookies(indexObj._storage.main),a=indexObj._dataStorage(branchObj.storage.branchData);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopqueueovercall,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,ssqq_id:e},success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopqueueovercallresult){var t=JSON.parse(JSON.stringify(e.shopqueueovercallresult));"000000000"===t.message_no||"010921000"===t.message_no?(myApp.toast(stringObj.text.call_success,"",{}).show(),browser_width<992?($(".toast-container").css("width","60%"),$(".toast-container").css("left","35%")):($(".toast-container").css("width","20%"),$(".toast-container").css("left","45%")),mainView.router.load({url:"shop/shopservice-pass",reload:!0})):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopservicequerecorver:function(){var e=indexObj._dataStorage(branchObj.storage.shopServiceRecord)||{last_update_date:"",availableList:[],finishList:[],invalidList:[]},t=indexObj._dataCookies(indexObj._storage.main);indexObj._wcfget({url:branchObj.dataUrl.shopservicequerecorver,para:{modacc:stringObj.shop.moduleaccount,modvrf:encodeURIComponent(btoa(localStorage.getItem("salt_no")+"_"+CryptoJS.SHA256(stringObj.shop.moduleaccount+stringObj.shop.modulepassword+localStorage.getItem("salt")))),sat:t.sat,last_update_date:e.last_update_date},success:function(t){if(indexObj.jsonUrlDecode(t),t.shopservicequerecorverresult){var a=JSON.parse(JSON.stringify(t.shopservicequerecorverresult));if("000000001"===a.message_no){if("coupon-record"===nowPage){if("[]"===JSON.stringify(e.availableList)?(r=indexObj.template("templateCouponListNull")(""),$$("#queue .available-content").html(r)):(r=indexObj.template("templateShopServiceAvailableList")(e),$$("#queue .couponAvailableList").append(r),myApp.initImagesLazyLoad(".page-content")),"[]"===JSON.stringify(e.finishList)){n=(i=indexObj.template("templateCouponListNull"))("");$$("#queue .finish-content").html(n)}else r=indexObj.template("templateShopServiceFinishList")(e),$$("#queue .couponFinishList").append(r),myApp.initImagesLazyLoad(".page-content");if("[]"===JSON.stringify(e.invalidList)){n=(i=indexObj.template("templateCouponListNull"))("");$$("#queue .invalid-content").html(n)}else r=indexObj.template("templateShopServiceInvalidList")(e),$$("#queue .couponInvalidList").append(r),myApp.initImagesLazyLoad(".page-content");$(".title").ellipsis({row:2})}}else if("000000009"===a.message_no){for(var s in a.ssqq_list)switch(findAndRemove(e.availableList,"ssqq_id",a.ssqq_list[s].ssqq_id),findAndRemove(e.finishList,"ssqq_id",a.ssqq_list[s].ssqq_id),findAndRemove(e.invalidList,"ssqq_id",a.ssqq_list[s].ssqq_id),(n={}).ssqq_id=a.ssqq_list[s].ssqq_id,n.ssqd_id=a.ssqq_list[s].ssqd_id,n.ssqq_queserno=a.ssqq_list[s].ssqq_queserno,n.ssqq_usestatus=a.ssqq_list[s].ssqq_usestatus,n.ssqq_questarttime=a.ssqq_list[s].ssqq_questarttime,n.last_update_date=a.ssqq_list[s].last_update_date,findArrayItem(a.ssqd_list,"ssqd_id",a.ssqq_list[s].ssqd_id),n.sd_id=a.ssqd_list[nowIndex].sd_id,n.ssqd_title=a.ssqd_list[nowIndex].ssqd_title,n.ssqd_content=a.ssqd_list[nowIndex].ssqd_content,n.scm_category=a.ssqd_list[nowIndex].scm_category,n.ssqd_mainpic=stringObj.text.branch_img_path+a.ssqd_list[nowIndex].ssqd_mainpic,n.ssqd_workhour=a.ssqd_list[nowIndex].ssqd_workhour,n.ssqd_serviceprice=a.ssqd_list[nowIndex].ssqd_serviceprice,n.date=new Date(a.ssqq_list[s].last_update_date)/864e5,findArrayItem(a.sd_list,"sd_id",a.ssqd_list[nowIndex].sd_id),n.sd_shopname=a.sd_list[nowIndex].sd_shopname,n.sd_shopaddress=a.sd_list[nowIndex].sd_shopaddress,n.sd_shoptel=a.sd_list[nowIndex].sd_shoptel,n.sd_lat=a.sd_list[nowIndex].sd_lat,n.sd_lng=a.sd_list[nowIndex].sd_lng,n.sd_weeklystart=a.sd_list[nowIndex].sd_weeklystart,n.sd_weeklyend=a.sd_list[nowIndex].sd_weeklyend,n.sd_dailystart=a.sd_list[nowIndex].sd_dailystart,n.sd_dailyend=a.sd_list[nowIndex].sd_dailyend,a.ssqq_list[s].ssqq_usestatus){case"1":e.availableList.push(n);break;case"2":e.finishList.push(n);break;case"3":e.invalidList.push(n);break;case"4":e.availableList.push(n);break;case"5":case"6":e.finishList.push(n);break;case"7":e.availableList.push(n);break;case"8":e.finishList.push(n)}if(e.last_update_date=a.last_update_date,e.availableList.sort(sortByProperty("date",-1)),e.finishList.sort(sortByProperty("date",-1)),e.invalidList.sort(sortByProperty("date",-1)),indexObj._dataStorage(branchObj.storage.shopServiceRecord,e),"coupon-record"===nowPage){var r;if("[]"===JSON.stringify(e.availableList)?(r=indexObj.template("templateCouponListNull")(""),$$("#queue .available-content").html(r)):(r=indexObj.template("templateShopServiceAvailableList")(e),$$("#queue .couponAvailableList").append(r),myApp.initImagesLazyLoad(".page-content")),"[]"===JSON.stringify(e.finishList)){n=(i=indexObj.template("templateCouponListNull"))("");$$("#queue .finish-content").html(n)}else r=indexObj.template("templateShopServiceFinishList")(e),$$("#queue .couponFinishList").append(r),myApp.initImagesLazyLoad(".page-content");if("[]"===JSON.stringify(e.invalidList)){var i=indexObj.template("templateCouponListNull"),n=i("");$$("#queue .invalid-content").html(n)}else r=indexObj.template("templateShopServiceInvalidList")(e),$$("#queue .couponInvalidList").append(r),myApp.initImagesLazyLoad(".page-content");$(".title").ellipsis({row:2})}}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopservicequeabandom:function(e,t){$$(".swipeout-"+t).on("deleted",function(){var a=stringObj.text.service_abandon_reason,s="";for(var r in a)s+=0==r?'<li><label class="label-radio item-content"><input type="radio" name="reasonlist" value="'+r+'" checked><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+a[r]+"</b></div></div></div></label></li>":'<li><label class="label-radio item-content"><input type="radio" name="reasonlist" value="'+r+'"><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+a[r]+"</b></div></div></div></label></li>";myApp.modal({title:stringObj.text.reason,text:'<div class="list-block media-list"><ul id="reasonlist">'+s+"</ul></div>",buttons:[{text:stringObj.text.confirm,onClick:function(){checkReason=$('input[name="reasonlist"]:checked').val(),myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main),s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,ssqq_id:t,ssqd_id:e,ssqq_abandomreason:checkReason};indexObj._wcfget({url:branchObj.dataUrl.shopservicequeabandom,para:s,success:function(e){if(e.shopservicequeabandomresult){indexObj.jsonUrlDecode(e),myApp.hideIndicator();var a=JSON.parse(JSON.stringify(e.shopservicequeabandomresult));switch(a.message_no){case"010922000":var s=indexObj._dataStorage(branchObj.storage.shopServiceRecord);findAndRemove(s.availableList,"ssqq_id",t),indexObj._dataStorage(indexObj._storage.shopServiceRecord,s);break;default:stringObj.return_header(a.message_no)}_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}mainView.router.load({url:"coupon-record?tab=queue",reload:!0})},error:function(e){myApp.hideIndicator(),noNetwork()}})}}]}),$(".modal-title+.modal-text").css("height","89%"),$(".modal-title+.modal-text").css("overflow-y","auto"),$(".modal .list-block").css("margin","3% 0"),$(".modal-inner").css("background","#FFF"),$(".modal .item-text").css("text-align","left"),$(".media-list li").css("border-bottom","1px solid #DDD")})},shopservicescan:function(e,t,a){var s=indexObj._dataCookies(indexObj._storage.main),r=indexObj._dataStorage(branchObj.storage.branchData);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopservicescan,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,sd_id:r.sd_id,ssqd_id:e,ssqq_id:t},success:function(s){if(indexObj.jsonUrlDecode(s),myApp.hideIndicator(),s.shopservicescanresult){var i=JSON.parse(JSON.stringify(s.shopservicescanresult));switch(i.ssqq_questarttime&&(i.ssd_picturepath=i.ssd_picturepath.replace("picture?type=square","picture?type=large"),r.client_pic=i.ssd_picturepath,r.client_name=i.md_cname,r.client_num=a,r.client_date=i.ssqq_questarttime,indexObj._dataStorage(branchObj.storage.branchData,r)),i.message_no){case"000000000":mainView.router.load({url:"shop/shopservice-info?ssqd_id="+e+"&type=scan&ssqq_id="+t});break;case"010916003":myApp.modal({title:stringObj.text.warn,text:stringObj.text._010916003,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){mainView.router.load({url:"shop/shopservice-info?ssqd_id="+e+"&type=scan&ssqq_id="+t})}}]});break;case"010916005":myApp.modal({title:stringObj.text.warn,text:stringObj.text._010916005,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){mainView.router.load({url:"shop/shopservice-info?ssqd_id="+e+"&type=scan&ssqq_id="+t})}}]});break;case"010916007":myApp.modal({title:stringObj.text.warn,text:stringObj.text._010916007,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){mainView.router.load({url:"shop/shopservice-info?ssqd_id="+e+"&type=scan&ssqq_id="+t})}}]});break;default:stringObj.return_header(i.message_no),_tip&&(myApp.alert(_tip+"( "+i.message_no+" )",stringObj.text.warn),_tip=null)}}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopserviceexec:function(e,t){var a=indexObj._dataCookies(indexObj._storage.main),s=indexObj._dataStorage(branchObj.storage.branchData);myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.shopserviceexec,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,ssqd_id:e,ssqq_id:t},success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.shopserviceexecresult){var t=JSON.parse(JSON.stringify(e.shopserviceexecresult));"010917000"==t.message_no||"010917001"==t.message_no||"010917004"==t.message_no?"010917000"==t.message_no?(myApp.toast(stringObj.text.serving_success,"",{}).show(),mainView.router.load({url:"shop/shopservice-management"})):"010917001"==t.message_no?(myApp.alert(stringObj.text._010917001,stringObj.text.warn),$(".modal-button").click(function(){myApp.toast(stringObj.text.serving_success,"",{}).show(),mainView.router.load({url:"shop/shopservice-management"})})):"010917004"==t.message_no&&(myApp.alert(stringObj.text._010917004,stringObj.text.warn),$(".modal-button").click(function(){myApp.toast(stringObj.text.serving_success,"",{}).show(),mainView.router.load({url:"shop/shopservice-management"})})):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopserviceclientreply:function(e,t){var a=indexObj._dataCookies(indexObj._storage.main);indexObj._dataStorage(branchObj.storage.branchData);indexObj._wcfget({url:branchObj.dataUrl.shopserviceclientreply,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,ssqq_id:e,reply_answer:t},success:function(e){if(indexObj.jsonUrlDecode(e),e.shopserviceclientreplyresult){var t=JSON.parse(JSON.stringify(e.shopserviceclientreplyresult));"010923001"===t.message_no||"010923002"===t.message_no?myApp.toast(stringObj.text.reply_branch,"",{}).show():(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){noNetwork()}})},branchSelectInit:function(e){e.query;(indexObj._dataStorage(branchObj.storage.branchData)||{}).sd_id&&$(".left a").attr("href","shop/myBranchs"),$(".shop-block").click(function(){mainView.router.load({url:"application-shop"})}),$(".usedcar-block").click(function(){mainView.router.load({url:"application-usedcar"})})},applicationShopInit:function(e){indexObj._dataCookies(indexObj._storage.main),indexObj._dataStorage(branchObj.storage.branchData);var t=indexObj._dataStorage(branchObj.storage.applicationData)||"";t&&($$("#shop_name").val(t.sd_shopname),$$("#sd_contact_person").val(t.sd_contact_person),$$("#shop_tel").val(t.sd_shoptel),$$("#shop_address").val(t.sd_shopaddress),$$(".shop_region").val(t.sd_zipcode),$$("#shop_type").val(stringObj.text.sd_type_array[parseInt(t.sd_type)-2]),$$("#sd_uniformnumbers").val(t.sd_uniformnumbers)),$$(".shop_name").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="'+stringObj.text.branch_name+'" maxlength="50" onkeydown="input_limit(this, 50);" onkeyup="input_limit(this, 50);">',stringObj.text.branch_name),$(".input-value").val($("#shop_name").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#shop_name").val($(".input-value").val())})}),$$(".sd_contact_person").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="'+stringObj.shop.sd_contact_person+'" maxlength="20" onkeydown="input_limit(this, 20);" onkeyup="input_limit(this, 20);">',stringObj.shop.sd_contact_person),$(".input-value").val($("#sd_contact_person").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#sd_contact_person").val($(".input-value").val())})}),$$(".shop_tel").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="'+stringObj.text.tel+'" maxlength="10" onkeyup="value=value.replace(/[^-0-9]/g,\'\')">',stringObj.text.tel),$(".input-value").val($("#shop_tel").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#shop_tel").val($(".input-value").val())})}),$$(".shop_address").on("click",function(){myApp.alert('<textarea class="info resizable" placeholder="'+stringObj.text.address+'" rows="9"></textarea>',stringObj.text.address),$(".info").val($("#shop_address").val()),$("textarea.info").focus(),$(".modal-button").click(function(){$("#shop_address").val($("textarea.info").val())})}),$$(".sd_uniformnumbers").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="'+stringObj.shop.sd_uniformnumbers+'" maxlength="8" onkeydown="input_limit(this, 8);" onkeyup="input_limit(this, 8);">',stringObj.shop.sd_uniformnumbers),$(".input-value").val($("#sd_uniformnumbers").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#sd_uniformnumbers").val($(".input-value").val())})});myApp.picker({input:"#shop_type",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.text.sd_type+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){e.setValue([parseInt(t.sd_type)])},cols:[{textAlign:"center",values:[2,3],displayValues:stringObj.text.sd_type_array,onChange:function(e,t,s){a=t}}]});var a,s=stringObj.region;zipArray=s.臺北市[1];myApp.picker({input:".shop_region",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return zipArray[regionIndex]},onOpen:function(e){e.setValue([t.sd_country,t.sd_district])},cols:[{textAlign:"center",width:140,values:stringObj.counties,onChange:function(e,t){mCounty=t,e.cols[1].replaceValues&&(e.cols[1].replaceValues(s[t][0]),zipArray=s[t][1],$("#shop_address").val(t+s[t][0][0]))}},{textAlign:"center",values:s.臺北市[0],width:140,onChange:function(e,t){mDistrict=t,regionIndex=e.cols[1].activeIndex,$("#shop_address").val(mCounty+t)}}]});$(".send").click(function(){$(".sd_shopname").removeClass("lengthError"),$(".sd_contact_person").removeClass("lengthError"),$(".sd_shoptel").removeClass("lengthError"),$(".sd_shopaddress").removeClass("lengthError"),$(".sd_uniformnumbers").removeClass("lengthError"),$(".sd_shopname").removeClass("spacesError"),$(".sd_contact_person").removeClass("spacesError"),$(".sd_shoptel").removeClass("spacesError"),$(".sd_shopaddress").removeClass("spacesError"),$(".operation_type").removeClass("nullError"),$(".sd_shopname").removeClass("nullError"),$(".sd_contact_person").removeClass("nullError"),$(".sd_shoptel").removeClass("nullError"),$(".sd_zipcode").removeClass("nullError"),$(".sd_shopaddress").removeClass("nullError"),$(".sd_uniformnumbers").removeClass("nullError"),$(".sd_uniformnumbers").removeClass("formatError");var e=!1;if(""!==$.trim($("#sd_uniformnumbers").val()))switch(chkTaxId($.trim($("#sd_uniformnumbers").val()))){case"lengthError":$(".sd_uniformnumbers").addClass("lengthError"),e=!0;break;case"formatError":$(".sd_uniformnumbers").addClass("formatError"),e=!0}$("#shop_name").val().length>50&&($(".sd_shopname").addClass("lengthError"),e=!0),$("#sd_contact_person").val().length>20&&($(".sd_shopname").addClass("lengthError"),e=!0),$("#shop_tel").val().length>10&&($(".sd_shoptel").addClass("lengthError"),e=!0),$("#shop_address").val().length>100&&($(".sd_shopaddress").addClass("lengthError"),e=!0),-1!==$("#shop_name").val().indexOf(" ")&&($(".sd_shopname").addClass("spacesError"),e=!0),-1!==$("#sd_contact_person").val().indexOf(" ")&&($(".sd_contact_person").addClass("spacesError"),e=!0),-1!==$("#shop_tel").val().indexOf(" ")&&($(".sd_shoptel").addClass("spacesError"),e=!0),-1!==$("#shop_address").val().indexOf(" ")&&($(".sd_shopaddress").addClass("spacesError"),e=!0),-1!==$("#sd_uniformnumbers").val().indexOf(" ")&&($(".sd_uniformnumbers").addClass("spacesError"),e=!0),""===$.trim($("#shop_name").val())&&($(".sd_shopname").addClass("nullError"),e=!0),""===$.trim($("#sd_contact_person").val())&&($(".sd_contact_person").addClass("nullError"),e=!0),""===$.trim($("#shop_tel").val())&&($(".sd_shoptel").addClass("nullError"),e=!0),""===$.trim($("#shop_address").val())&&($(".sd_shopaddress").addClass("nullError"),e=!0),""===$.trim($(".shop_region").val())&&($(".sd_zipcode").addClass("nullError"),e=!0),""===$.trim($("#shop_type").val())&&($(".operation_type").addClass("nullError"),e=!0),e&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%")));var s=indexObj._dataCookies(indexObj._storage.main)||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,operation_type:"0",sd_type:a,sd_shopname:$("#shop_name").val(),sd_contact_person:$("#sd_contact_person").val(),sd_shoptel:$("#shop_tel").val(),rl_city_code:stringObj.counties.indexOf(mCounty)+1,sd_zipcode:zipArray[regionIndex],sd_shopaddress:$("#shop_address").val(),sd_uniformnumbers:$("#sd_uniformnumbers").val(),dcil_id:"",sd_country:mCounty,sd_district:mDistrict};t&&void 0==a&&(r.sd_type=t.sd_type),t&&void 0==zipArray[regionIndex]&&(r.sd_zipcode=t.sd_zipcode),e||("1"===s.md_seccode_created?(r.dcil_id=stringObj.text.dcil_list[0].dcil_id,indexObj._dataCookies("postshopdata",r),memberseccode("verify")):myApp.modal({title:stringObj.text.warn,text:stringObj.text.no_set_memberseccode,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.to_set,onClick:function(){memberseccode("set")}}]}))})},applicationUsedcarInit:function(e){var t=indexObj._dataStorage(branchObj.storage.applicationData)||"";t&&($$("#usedcar_name").val(t.sd_shopname),$$("#usedcar_tel").val(t.sd_shoptel),$$("#usedcar_address").val(t.sd_shopaddress),$$(".usedcar_region").val(t.sd_zipcode)),$$(".usedcar_name").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="'+stringObj.text.branch_name+'" maxlength="50">',stringObj.text.branch_name),$(".input-value").val($("#usedcar_name").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#usedcar_name").val($(".input-value").val())})}),$$(".usedcar_tel").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="'+stringObj.text.tel+'" onkeyup="value=value.replace(/[^-0-9]/g,\'\')">',stringObj.text.tel),$(".input-value").val($("#usedcar_tel").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#usedcar_tel").val($(".input-value").val())})}),$$(".usedcar_address").on("click",function(){myApp.alert('<textarea class="info resizable" placeholder="'+stringObj.text.address+'" rows="9"></textarea>',stringObj.text.address),$(".info").val($("#usedcar_address").val()),$("textarea.info").focus(),$(".modal-button").click(function(){$("#usedcar_address").val($(".info").val())})});var a=stringObj.region;zipArray=a.臺北市[1];myApp.picker({input:".usedcar_region",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return zipArray[regionIndex]},onOpen:function(e){e.setValue([t.sd_country,t.sd_district])},cols:[{textAlign:"center",width:140,values:stringObj.counties,onChange:function(e,t){mCounty=t,e.cols[1].replaceValues&&(e.cols[1].replaceValues(a[t][0]),zipArray=a[t][1])}},{textAlign:"center",values:a.臺北市[0],width:140,onChange:function(e,t){mDistrict=t,regionIndex=e.cols[1].activeIndex}}]});$(".send").click(function(){$(".sd_shopname").removeClass("lengthError"),$(".sd_shoptel").removeClass("lengthError"),$(".sd_shopaddress").removeClass("lengthError"),$(".sd_shopname").removeClass("spacesError"),$(".sd_shoptel").removeClass("spacesError"),$(".sd_shopaddress").removeClass("spacesError"),$(".sd_shopname").removeClass("nullError"),$(".sd_shoptel").removeClass("nullError"),$(".sd_zipcode").removeClass("nullError"),$(".sd_shopaddress").removeClass("nullError");var e=!1;$("#usedcar_name").val().length>50&&($(".sd_shopname").addClass("lengthError"),e=!0),$("#usedcar_tel").val().length>20&&($(".sd_shoptel").addClass("lengthError"),e=!0),$("#usedcar_address").val().length>100&&($(".sd_shopaddress").addClass("lengthError"),e=!0),-1!==$("#usedcar_name").val().indexOf(" ")&&($(".sd_shopname").addClass("spacesError"),e=!0),-1!==$("#usedcar_tel").val().indexOf(" ")&&($(".sd_shoptel").addClass("spacesError"),e=!0),-1!==$("#usedcar_address").val().indexOf(" ")&&($(".sd_shopaddress").addClass("spacesError"),e=!0),""===$("#usedcar_name").val()&&($(".sd_shopname").addClass("nullError"),e=!0),""===$("#usedcar_tel").val()&&($(".sd_shoptel").addClass("nullError"),e=!0),""===$("#usedcar_address").val()&&($(".sd_shopaddress").addClass("nullError"),e=!0),""===$(".usedcar_region").val()&&($(".sd_zipcode").addClass("nullError"),e=!0),e&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%")));var a=indexObj._dataCookies(indexObj._storage.main),s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,operation_type:"1",sd_type:"1",sd_shopname:$("#usedcar_name").val(),sd_shoptel:$("#usedcar_tel").val(),sd_zipcode:"",sd_shopaddress:$("#usedcar_address").val(),dcil_id:"",sd_country:mCounty,sd_district:mDistrict};s.sd_zipcode=t?t.sd_zipcode:zipArray[regionIndex],e||pay_list("0",$("#usedcar_name").val(),"",s)})},bonusManagementInit:function(e){$(".navbar .center").html(stringObj.shop.bonus_management);e.query;branchObj.queryshopbonusitem("")},bonusEditInit:function(e){$(".navbar .center").html(stringObj.shop.bonus_item);var t=indexObj.template("templateBonusEdit")(stringObj.shop);$$(".bonus-edit-block ul").html(t);var a=e.query;branchObj.queryshopbonusitem(a.sbgi_id),$$(".left a").click(function(){mainView.router.load({url:"shop/bonus-management",reload:!0})})},queryshopbonusitem:function(e){myApp.showIndicator(),e=e||"";var t=indexObj._dataStorage(branchObj.storage.branchData)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:mainSg.sat,sd_id:t.sd_id,sbgi_id:e};indexObj._wcfget({url:branchObj.dataUrl.queryshopbonusitem,para:a,success:function(t){if(indexObj.jsonUrlDecode(t),t.queryshopbonusitemresult){var a=JSON.parse(JSON.stringify(t.queryshopbonusitemresult));if("000000000"===a.message_no||"000000003"===a.message_no)switch(nowPage){case"bonus-management":if(a.bonusitems){$$(".bonus-list ul").html("");for(var s in a.bonusitems){"1"===a.bonusitems[s].sbgi_effective?a.bonusitems[s].sbgi_effective=stringObj.shop.status_on:a.bonusitems[s].sbgi_effective=stringObj.shop.status_off;var r=indexObj.template("templateBonusList")(a.bonusitems[s]);$$(".bonus-list ul").append(r)}$(".bonus-list ul .col-15").click(function(){mainView.router.load({url:"shop/bonus-edit?sbgi_id="+$(this).attr("sbgi_id"),reload:!0})})}else dataNull("templateBonusListNull",stringObj.text.no_data,".bonus-list ul");break;case"bonus-edit":var i,n=2;$(".bouns-status").change(function(){n=$(this).is(":checked")?1:2}),e?($$(".bouns_name").val(a.bonusitems[0].sbgi_itemname),$$(".bouns_point").val(a.bonusitems[0].sbgi_itemamount),"1"==a.bonusitems[0].sbgi_effective&&$(".bouns-status").prop("checked",!0),n=a.bonusitems[0].sbgi_effective,$(".toolbar-inner a").html(stringObj.text.edit),i=1):($(".toolbar-inner a").html(stringObj.text.add),i=0),$(".send").click(function(){$(".bouns-name").removeClass("lengthError"),$(".bouns-point").removeClass("lengthError"),$(".bouns-name").removeClass("spacesError"),$(".bouns-point").removeClass("spacesError"),$(".bouns-name").removeClass("nullError"),$(".bouns-point").removeClass("nullError");var t=!1;$(".bouns_name").val().length>20&&($(".bouns-name").addClass("lengthError"),t=!0),$(".bouns_point").val().length>7&&($(".bouns-point").addClass("lengthError"),t=!0),-1!==$(".bouns_name").val().indexOf(" ")&&($(".bouns-name").addClass("spacesError"),t=!0),-1!==$(".bouns_point").val().indexOf(" ")&&($(".bouns-point").addClass("spacesError"),t=!0),""===$(".bouns_name").val()&&($(".bouns-name").addClass("nullError"),t=!0),""===$(".bouns_point").val()&&($(".bouns-point").addClass("nullError"),t=!0),t&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%")));var a=indexObj._dataCookies(indexObj._storage.main),s=indexObj._dataStorage(branchObj.storage.branchData)||{};e=e||"";var r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,md_id:a.mdId,operation_type:i,sbgi_id:e,sbgi_fittype:0,sbgi_itemname:$(".bouns_name").val(),sbgi_itemamount:$(".bouns_point").val(),sbgi_effective:n};t||branchObj.postshopbonusmamager(r)})}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},postshopbonusmamager:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.postshopbonusmamager,para:e,success:function(t){if(indexObj.jsonUrlDecode(t),t.postshopbonusmamagerresult){var a=JSON.parse(JSON.stringify(t.postshopbonusmamagerresult));"000000000"===a.message_no?("1"==e.operation_type?myApp.toast(stringObj.text.edit_success,"",{}).show():"0"==e.operation_type&&myApp.toast(stringObj.text.add_success,"",{}).show(),mainView.router.load({url:"shop/bonus-management",reload:!0})):(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},clientListInit:function(e){$(".navbar .center").html(stringObj.shop.client_list);e.query;var t=indexObj._dataStorage(branchObj.storage.branchData)||{};branchObj.query_shopmember(t.sd_id)},query_shopmember:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:e};indexObj._wcfget({url:branchObj.dataUrl.query_shopmember,para:a,success:function(e){if(indexObj.jsonUrlDecode(e),e.queryshopmemberresult){var t=JSON.parse(JSON.stringify(e.queryshopmemberresult));if("000000000"===t.message_no)if(t.shop_member_array){for(var a in t.shop_member_array)t.shop_member_array[a].ssd_picturepath.match("square")&&(t.shop_member_array[a].ssd_picturepath=t.shop_member_array[a].ssd_picturepath.replace("picture?type=square","picture?type=large"));if("client-list"===nowPage){r=(s=indexObj.template("templateClientList"))(t);$$(".client-list-block ul").html(r),myApp.initImagesLazyLoad(".page-content"),browser_width>992&&$(".item-media img").attr("width","80"),$(window).on("resize",function(){switch(browser_width=$(window).width(),nowPage){case"client-list":browser_width>992?$(".item-media img").css("width","80px"):$(".item-media img").css("width","50px")}})}else if("select-member"===nowPage){var s=indexObj.template("templateSelectMemberList"),r=s(t);$$(".select-member-content ul").html(r),myApp.initImagesLazyLoad(".page-content"),$(".total_member span").html(t.shop_member_array.length);var i,n=!1,o=document.getElementsByName("md-checkbox");$("input[name='md-checkbox']").each(function(){$(this).change(function(){for(var e=0,t=0;t<o.length;t++)o[t].checked||(n=!1,$(".clickAll").removeClass("cancelAll"),$(".clickAll").html(stringObj.shop.select_all),e++);0===e&&(n=!0,$(".clickAll").addClass("cancelAll"),$(".clickAll").html(stringObj.text.cancel))})}),$(".clickAll").click(function(){n?($("input[name='md-checkbox']").prop("checked",!1),n=!1,$(".clickAll").removeClass("cancelAll"),$(".clickAll").html(stringObj.shop.select_all)):($("input[name='md-checkbox']").prop("checked",!0),n=!0,$(".clickAll").addClass("cancelAll"),$(".clickAll").html(stringObj.text.cancel))}),$(".edit").click(function(){i=[];for(var e=0;e<o.length;e++)o[e].checked&&i.push($(o[e]).val());indexObj._dataStorage(branchObj.storage.md_id_array,i),i.length>0?mainView.router.load({url:"message_push/message-info?from=select&type=edit&ssfi_feename=shopmemberpush",reload:!0}):myApp.toast(stringObj.text.no_select,"",{}).show()})}}else"client-list"===nowPage?dataNull("templateClientListNull",stringObj.shop.no_member,".client-list-block ul"):"select-member"===nowPage&&dataNull("templateSelectMemberNull",stringObj.shop.no_member,".select-member-content ul");else"000000003"===t.message_no?"client-list"===nowPage?dataNull("templateClientListNull",stringObj.shop.no_member,".client-list-block ul"):"select-member"===nowPage&&dataNull("templateSelectMemberNull",stringObj.shop.no_member,".select-member-content ul"):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},bonusGiftInit:function(e){$(".navbar .center").html(stringObj.shop.bonus_gift);var t=e.query;branchObj.querymemberidinfo(t.md_id);var a=indexObj.template("templateBonusGift")(stringObj.shop);$$(".bonus-gift-block ul").html(a),$$(".left a").click(function(){mainView.router.load({url:"shop/branch-main",reload:!0})}),$$(".cost-block").on("click",function(){myApp.alert('<input class="input-value" type="number" min="0" placeholder="'+stringObj.shop.input_cost+'" maxlength="8">',stringObj.shop.cost),$(".input-value").val($(".cost").val()),$(".input-value").focus(),$(".modal-button").click(function(){$(".cost").val($(".input-value").val())})}),$$(".bouns-point").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="'+stringObj.shop.input_bonus_point+'" maxlength="8">',stringObj.shop.bonus_point),$(".input-value").val($(".bouns_point").val()),$(".input-value").focus(),$(".modal-button").click(function(){$(".bouns_point").val($(".input-value").val())})}),$(".send").click(function(){$(".cost-block").removeClass("lengthError"),$(".bouns-point").removeClass("lengthError"),$(".cost-block").removeClass("spacesError"),$(".bouns-point").removeClass("spacesError"),$(".cost-block").removeClass("nullError"),$(".bouns-point").removeClass("nullError");var e=!1;$(".cost").val().length>8&&($(".cost-block").addClass("lengthError"),e=!0),$(".bouns_point").val().length>8&&($(".bouns-point").addClass("lengthError"),e=!0),-1!==$(".cost").val().indexOf(" ")&&($(".cost-block").addClass("spacesError"),e=!0),-1!==$(".bouns_point").val().indexOf(" ")&&($(".bouns-point").addClass("spacesError"),e=!0),""===$(".cost").val()&&($(".cost-block").addClass("nullError"),e=!0),""===$(".bouns_point").val()&&($(".bouns-point").addClass("nullError"),e=!0),e&&(myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","15%"),$(".toast-container").css("left","47.5%")));var a=indexObj._dataCookies(indexObj._storage.main)||{},s=indexObj._dataStorage(branchObj.storage.branchData)||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,scbr_md_id:t.md_id,scbr_comsumeamount:$(".cost").val(),scbr_bonusgive:$(".bouns_point").val()};e||branchObj.postshopcomsumebonus(r)})},querymemberidinfo:function(e){myApp.showIndicator();var t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),md_id:e};indexObj._wcfget({url:branchObj.dataUrl.querymemberidinfo,para:t,success:function(t){if(indexObj.jsonUrlDecode(t),t.querymemberidinforesult){var a=JSON.parse(JSON.stringify(t.querymemberidinforesult));if("000000000"===a.message_no){switch(nowPage){case"bonus-gift":var s=indexObj.template("templateShopUseInfo")(a);$$(".user-info").html(s);break;case"staff-management":$$(".picker-modal.modal-in").length>0&&myApp.closeModal(".picker-modal.modal-in"),""==a.md_picturepath&&(a.md_picturepath="http://"+stringObj.WEB_URL+"/app/image/general_user.png"),a.md_picturepath.match("square")&&(a.md_picturepath=a.md_picturepath.replace("picture?type=square","picture?type=large")),myApp.pickerModal('<div class="picker-modal picker-add-staff"><div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-times" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.add_employee+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div><div class="picker-modal-inner"><div class="content-block"><div class="user-info"><img src="'+a.md_picturepath+'" width=120 class="user-icon" onerror=\'this.src="http://'+stringObj.WEB_URL+'/app/image/general_user.png"\' /><div class="user-name">'+a.md_cname+"</div></div></div></div></div>"),$(".picker-add-staff .right").click(function(){branchObj.postshopclerkmanager("0",e)})}myApp.initImagesLazyLoad(".page-content")}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},postshopcomsumebonus:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.postshopcomsumebonus,para:e,success:function(e){if(indexObj.jsonUrlDecode(e),e.postshopcomsumebonusresult){var t=JSON.parse(JSON.stringify(e.postshopcomsumebonusresult));"000000000"===t.message_no?(myApp.toast(stringObj.shop.gift_success,"",{}).show(),mainView.router.load({url:"shop/branch-main",reload:!0})):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},staffManagementInit:function(e){$(".navbar .center").html(stringObj.shop.staff_management);e.query;branchObj.queryshopclerklist(),$(".add").click(function(){scan("add-staff")})},queryshopclerklist:function(){myApp.showIndicator();var e=indexObj._dataCookies(indexObj._storage.main)||{},t=indexObj._dataStorage(branchObj.storage.branchData)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:e.sat,md_id:e.mdId,sd_id:t.sd_id};indexObj._wcfget({url:branchObj.dataUrl.queryshopclerklist,para:a,success:function(e){if(indexObj.jsonUrlDecode(e),e.queryshopclerklistresult){var t=JSON.parse(JSON.stringify(e.queryshopclerklistresult));if("000000000"===t.message_no){for(var a in t.clerk_list)t.clerk_list[a].duties=stringObj.shop.duties,"0"===t.clerk_list[a].smb_bindlevel?(t.clerk_list[a].smb_bindlevel=stringObj.shop.manager,t.clerk_list[a].isEmployee=!1):(t.clerk_list[a].smb_bindlevel=stringObj.shop.employee,t.clerk_list[a].isEmployee=!0),"1"===t.clerk_list[a].smb_activestatus?t.clerk_list[a].smb_activestatus=!0:t.clerk_list[a].smb_activestatus=!1,t.clerk_list[a].ssd_picturepath.match("square")&&(t.clerk_list[a].ssd_picturepath=t.clerk_list[a].ssd_picturepath.replace("picture?type=square","picture?type=large"));var s=indexObj.template("templateStaffList")(t);$$(".staff-list-block ul").html(s),myApp.initImagesLazyLoad(".page-content"),browser_width>992&&$(".item-media img").attr("width","100"),$(window).on("resize",function(){switch(browser_width=$(window).width(),nowPage){case"staff-management":browser_width>992?$(".item-media img").css("width","100px"):$(".item-media img").css("width","50px")}}),$(".isLeaving").click(function(){var e=$(this).attr("smb_md_id");myApp.modal({title:stringObj.text.warn,text:stringObj.shop.isLeaving,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){branchObj.postshopclerkmanager("1",e)}}]})})}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},postshopclerkmanager:function(e,t){myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main)||{},s=indexObj._dataStorage(branchObj.storage.branchData)||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,md_id:a.mdId,sd_id:s.sd_id,operation_type:e,clerk_md_id:t};indexObj._wcfget({url:branchObj.dataUrl.postshopclerkmanager,para:r,success:function(e){if(indexObj.jsonUrlDecode(e),e.postshopclerkmanagerresult){var t=JSON.parse(JSON.stringify(e.postshopclerkmanagerresult));"000000000"===t.message_no?("0"===r.operation_type?myApp.toast(stringObj.text.add_success,"",{}).show():myApp.toast(stringObj.text.edit_success,"",{}).show(),mainView.router.load({url:"shop/staff-management",reload:!0})):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},bonusRecordInit:function(e){$(".navbar .center").html(stringObj.shop.bonus_record);e.query;branchObj.querymembershopbonus("")},querymembershopbonus:function(e){myApp.showIndicator(),e=e||"";var t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:e};indexObj._wcfget({url:branchObj.dataUrl.querymembershopbonus,para:a,success:function(e){if(indexObj.jsonUrlDecode(e),e.querymembershopbonusresult){var t=JSON.parse(JSON.stringify(e.querymembershopbonusresult));if("000000000"===t.message_no||"000000003"===t.message_no)if(t.shopbonus){for(var a in t.shopbonus)t.shopbonus[a].point=stringObj.shop.point,t.shopbonus[a].sd_shopphotopath=stringObj.text.branch_img_path+t.shopbonus[a].sd_shopphotopath;var s=indexObj.template("templateBonusRecordList")(t);$$(".bonus-record-list ul").html(s),myApp.initImagesLazyLoad(".page-content")}else dataNull("templateBonusRecordNull",stringObj.text.no_data,".bonus-record-list ul");else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},favoriteInit:function(e){$(".navbar .center").html(stringObj.shop.shop_bookmarks),$(".favorite-left").click(function(){window.location="pm/branch-cooperative?cate="+branch_cate+"&listtype="+nowBranchType});e.query;void 0!==(indexObj._dataCookies(indexObj._storage.main)||{}).sat&&(myApp.showIndicator(),branchObj.favoriteUpdate()),$$(".tab-branch").on("click",function(){myApp.showTab(".branch"),$$(".tab-shopcoupon").removeClass("active"),$$(this).addClass("active")}),$$(".tab-shopcoupon").on("click",function(){myApp.showTab(".shopcoupon"),$$(".tab-branch").removeClass("active"),$$(this).addClass("active")}),$(".deleteAll").click(function(){var e,t,a=indexObj._dataStorage(indexObj._storage.favorite)||{lastupdate:"",newsList:[],couponList:[],branchList:[],shopcouponList:[]};0!==a.newsList.length&&"news"===fType?myApp.modal({title:stringObj.text.warn,text:stringObj.text.newsDeleteAll,buttons:[{text:stringObj.text.cancel},{text:stringObj.text.confirm,onClick:function(){var s=indexObj._dataCookies(indexObj._storage.main),r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,useroperate:"2",ubm_objecttype:"0",ubm_objectid:"all"};myApp.showIndicator(),indexObj._wcfget({url:indexObj._dataUrl.userbookmarkupdate,para:r,success:function(s){if(indexObj.jsonUrlDecode(s),s.userbookmarkupdateresult){var r=JSON.parse(JSON.stringify(s.userbookmarkupdateresult));"000000000"===r.message_no?(isMobile.Android()?webview.nowEvent("Nsdelallmark-And","none",md_id):isMobile.iOS()&&webview.nowEvent("Nsdelallmark-iOS","none",md_id),a.newsList=[],indexObj._dataStorage(indexObj._storage.favorite,a),e=indexObj.template("templateFavoriteListNull"),t=e(""),$$(".news").html(t)):(stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)),myApp.hideIndicator()}},error:function(e){myApp.hideIndicator(),noNetwork()}})}}]}):0!==a.couponList.length&&"coupon"===fType?myApp.modal({title:stringObj.text.warn,text:stringObj.text.couponDeleteAll,buttons:[{text:stringObj.text.cancel},{text:stringObj.text.confirm,onClick:function(){var s=indexObj._dataCookies(indexObj._storage.main),r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,useroperate:"2",ubm_objecttype:"1",ubm_objectid:"all"};myApp.showIndicator(),indexObj._wcfget({url:indexObj._dataUrl.userbookmarkupdate,para:r,success:function(s){if(indexObj.jsonUrlDecode(s),s.userbookmarkupdateresult){var r=JSON.parse(JSON.stringify(s.userbookmarkupdateresult));"000000000"===r.message_no?(isMobile.Android()?webview.nowEvent("Cpdelallmark-And","none",md_id):isMobile.iOS()&&webview.nowEvent("Cpdelallmark-iOS","none",md_id),a.couponList=[],indexObj._dataStorage(indexObj._storage.favorite,a),e=indexObj.template("templateFavoriteListNull"),t=e(""),$$(".coupon").html(t)):(stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)),myApp.hideIndicator()}},error:function(e){myApp.hideIndicator(),noNetwork()}})}}]}):0!==a.branchList.length&&"branch"===fType?myApp.modal({title:stringObj.text.warn,text:stringObj.text.branchDeleteAll,buttons:[{text:stringObj.text.cancel},{text:stringObj.text.confirm,onClick:function(){var s=indexObj._dataCookies(indexObj._storage.main),r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,useroperate:"2",ubm_objecttype:"2",ubm_objectid:"all"};myApp.showIndicator(),indexObj._wcfget({url:indexObj._dataUrl.userbookmarkupdate,para:r,success:function(s){if(indexObj.jsonUrlDecode(s),s.userbookmarkupdateresult){var r=JSON.parse(JSON.stringify(s.userbookmarkupdateresult));"000000000"===r.message_no?(myApp.alert(stringObj.text.nowCoin+"："+r.gpmr_point,stringObj.text.warn),a.branchList=[],indexObj._dataStorage(indexObj._storage.favorite,a),e=indexObj.template("templateFavoriteListNull"),t=e(""),$$(".branch").html(t)):(stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)),myApp.hideIndicator()}},error:function(e){myApp.hideIndicator(),noNetwork()}})}}]}):0!==a.shopcouponList.length&&"shopcoupon"===fType&&myApp.modal({title:stringObj.text.warn,text:stringObj.text.shopcouponDeleteAll,buttons:[{text:stringObj.text.cancel},{text:stringObj.text.confirm,onClick:function(){var s=indexObj._dataCookies(indexObj._storage.main),r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,useroperate:"2",ubm_objecttype:"3",ubm_objectid:"all"};myApp.showIndicator(),indexObj._wcfget({url:indexObj._dataUrl.userbookmarkupdate,para:r,success:function(s){if(indexObj.jsonUrlDecode(s),s.userbookmarkupdateresult){var r=JSON.parse(JSON.stringify(s.userbookmarkupdateresult));"000000000"===r.message_no?(a.shopcouponList=[],indexObj._dataStorage(indexObj._storage.favorite,a),e=indexObj.template("templateFavoriteListNull"),t=e(""),$$(".shopcoupon").html(t)):(stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)),myApp.hideIndicator()}},error:function(e){myApp.hideIndicator(),noNetwork()}})}}]})});e.query;window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},1e3)},favoriteUpdate:function(){var e={lastupdate:"",newsList:[],couponList:[],branchList:[],shopcouponList:[]},t=indexObj._dataCookies(indexObj._storage.main),a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,lastupdate:""};indexObj._wcfget({url:indexObj._dataUrl.userbookmarkrecorver,para:a,success:function(t){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(t),t.userbookmarkrecorverresult){var a=JSON.parse(JSON.stringify(t.userbookmarkrecorverresult));if("000000000"===a.message_no){var s=JSON.stringify(e);for(var r in a.userbookmark)if(s.match(a.userbookmark[r].ubm_objectid)){findAndRemove(e.newsList,"ubm_objectid",a.userbookmark[r].ubm_objectid),findAndRemove(e.couponList,"ubm_objectid",a.userbookmark[r].ubm_objectid),findAndRemove(e.branchList,"ubm_objectid",a.userbookmark[r].ubm_objectid),findAndRemove(e.shopcouponList,"ubm_objectid",a.userbookmark[r].ubm_objectid);var i={};i.ubm_objectid=a.userbookmark[r].ubm_objectid,a.userbookmark[r].ubm_picpath?i.ubm_picpath=stringObj.text.branch_img_path+a.userbookmark[r].ubm_picpath:i.ubm_picpath="../app/image/imgDefault.png",i.ubm_title=a.userbookmark[r].ubm_title,i.create_date=a.userbookmark[r].create_date.substring(0,10),i.isflag=a.userbookmark[r].isflag,i.date=new Date(a.userbookmark[r].create_date)/864e5,"0"===a.userbookmark[r].ubm_objecttype&&"1"===a.userbookmark[r].isflag?e.newsList.push(i):"1"===a.userbookmark[r].ubm_objecttype&&"1"===a.userbookmark[r].isflag?e.couponList.push(i):"2"===a.userbookmark[r].ubm_objecttype&&"1"===a.userbookmark[r].isflag?e.branchList.push(i):"3"===a.userbookmark[r].ubm_objecttype&&"1"===a.userbookmark[r].isflag&&e.shopcouponList.push(i)}else{var n={};n.ubm_objectid=a.userbookmark[r].ubm_objectid,a.userbookmark[r].ubm_picpath?n.ubm_picpath=stringObj.text.branch_img_path+a.userbookmark[r].ubm_picpath:n.ubm_picpath="../app/image/imgDefault.png",n.ubm_title=a.userbookmark[r].ubm_title,n.create_date=a.userbookmark[r].create_date.substring(0,10),n.isflag=a.userbookmark[r].isflag,n.date=new Date(a.userbookmark[r].create_date)/864e5,"0"===a.userbookmark[r].ubm_objecttype&&"1"===a.userbookmark[r].isflag?e.newsList.push(n):"1"===a.userbookmark[r].ubm_objecttype&&"1"===a.userbookmark[r].isflag?e.couponList.push(n):"2"===a.userbookmark[r].ubm_objecttype&&"1"===a.userbookmark[r].isflag?e.branchList.push(n):"3"===a.userbookmark[r].ubm_objecttype&&"1"===a.userbookmark[r].isflag&&e.shopcouponList.push(n)}if(e.lastupdate=a.lastupdate,e.branchList.sort(sortByProperty("date",-1)),e.shopcouponList.sort(sortByProperty("date",-1)),indexObj._dataStorage(indexObj._storage.favorite,e),"favorite"===nowPage){mainView.showNavbar();var o;"[]"===JSON.stringify(e.branchList)?(o=indexObj.template("templateFavoriteListNull")(""),$$(".branch").html(o)):($$(".favorite-preloader").html(""),o=indexObj.template("templateFavoriteBranchList")(e),$$(".branchList").html(o),$(".branchList .to_info").unbind("click"),$(".branchList .to_info").click(function(){localStorage.setItem("pageInit","shop/favorite"),window.location="pm/branch-info?sd_id="+$(this).attr("sd_id")}),$(".title").ellipsis({row:2}),myApp.initImagesLazyLoad(".page-content")),"[]"===JSON.stringify(e.shopcouponList)?(o=indexObj.template("templateFavoriteListNull")(""),$$(".shopcoupon").html(o)):($$(".favorite-preloader").html(""),o=indexObj.template("templateFavoriteShopCouponList")(e),$$(".shopcouponList").html(o),$(".shopcouponList .to_info").unbind("click"),$(".shopcouponList .to_info").click(function(){localStorage.setItem("pageInit","shop/favorite"),window.location="pm/shopcoupon-info?scm_id="+$(this).attr("scm_id")}),$(".title").ellipsis({row:2}),myApp.initImagesLazyLoad(".page-content"))}}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null);$$(".favorite-preloader").html("")}},error:function(e){myApp.hideIndicator(),$$(".favorite-preloader").html(""),noNetwork()}})},pushRecordInit:function(e){$(".navbar .center").html(stringObj.shop.push_record);e.query;var t=indexObj.template("templatePushRecord")(stringObj.shop);$$(".push-record-content").html(t),branchObj.querymembercoininfo(),nowTab="member",branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),window.intervalParam=window.setInterval(function(){myApp.initImagesLazyLoad(".page-content")},2e3),$$("#member").on("show",function(){nowTab="member",branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$$("#member ul").html(""),branchObj.queryshoppushrecord("0")}),$$("#not_member").on("show",function(){nowTab="not_member",branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,myApp.attachInfiniteScroll($$(".infinite-scroll")),$$("#not_member ul").html(""),branchObj.queryshoppushrecord("1")}),$$(".infinite-scroll").on("infinite",function(){"not_member"===nowTab?branchObj.queryshoppushrecord("1"):branchObj.queryshoppushrecord("0")}),$(".add").click(function(){branchObj.queryshopservicefee("1","all")})},queryshoppushrecord:function(e){if(!branchObj.listLoading){branchObj.listLoading=!0,$$(".infinite-scroll-preloader").show(),myApp.showIndicator(),e=e||"";var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage(branchObj.storage.branchData)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,sapm_objecttype:e,create_date:branchObj.listId,queryamount:"20"};indexObj._wcfget({url:branchObj.dataUrl.queryshoppushrecord,para:s,success:function(e){if(indexObj.jsonUrlDecode(e),e.queryshoppushrecordresult){var t=JSON.parse(JSON.stringify(e.queryshoppushrecordresult));if("000000000"===t.message_no||"000000003"===t.message_no){if(t.pushhistory_array){$("#"+nowTab+" .list-block ul").css("border","1px solid #333");for(var a in t.pushhistory_array)t.pushhistory_array[a].sapm_pushcontent.length>20&&(t.pushhistory_array[a].sapm_pushcontent=t.pushhistory_array[a].sapm_pushcontent.substring(0,20)+"．．．"),t.pushhistory_array[a].sapm_pushpic?t.pushhistory_array[a].sapm_pushpic=stringObj.text.branch_img_path+t.pushhistory_array[a].sapm_pushpic:t.pushhistory_array[a].sapm_pushpic="../app/image/imgDefault.png";var r=indexObj.template("templatePushRecordData")(t);$$("#"+nowTab+" .list-block ul").append(r),myApp.initImagesLazyLoad(".page-content"),isMobile.Android()||isMobile.iOS()||$(".page-content .tab").niceScroll({cursorcolor:"rgba(100,100,100,.9)",cursoropacitymin:0,cursorborder:"1px solid #000",scrollspeed:20}),$(".item-info .title").ellipsis({row:1}),""===branchObj.firstId&&(branchObj.firstId=t.pushhistory_array[0].create_date);var i=indexObj._dataStorage(branchObj.storage.today_push)||[];findArrayItem(i,"sd_id",s.sd_id);var n=new Date,o=n.getMonth()+1,c=n.getDate();o<10&&(o="0"+o),c<10&&(c="0"+c),new Date(n.getFullYear()+"/"+o+"/"+c)/864e5-new Date(i[nowIndex].last_update_date)/864e5>=1&&(i[nowIndex].push_times=0,indexObj._dataStorage(branchObj.storage.today_push,i)),"2000/01/01"===i[nowIndex].last_update_date&&(i[nowIndex].last_update_date=t.pushhistory_array[0].create_date.substring(0,4)+"/"+t.pushhistory_array[0].create_date.substring(5,7)+"/"+t.pushhistory_array[0].create_date.substring(8,10),indexObj._dataStorage(branchObj.storage.today_push,i)),branchObj.listId=t.pushhistory_array[t.pushhistory_array.length-1].create_date,$$(".infinite-scroll-preloader").hide()}else myApp.detachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll-preloader").remove(),branchObj.listId||dataNull("templatePushRecordNull",stringObj.text.no_data,"#"+nowTab+" .list-block ul");branchObj.listLoading=!1}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}myApp.hideIndicator()},error:function(e){myApp.detachInfiniteScroll($$(".infinite-scroll")),$$(".infinite-scroll-preloader").remove(),branchObj.listId||dataNull("templatePushRecordNull",stringObj.text.no_data,"#"+nowTab+" .list-block ul"),myApp.hideIndicator()}})}},queryshopservicefee:function(e,t){myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main)||{},s=indexObj._dataStorage(branchObj.storage.branchData)||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,ssfi_servicetype:e};indexObj._wcfget({url:branchObj.dataUrl.queryshopservicefee,para:r,success:function(e){if(indexObj.jsonUrlDecode(e),e.queryshopservicefeeresult){var a=JSON.parse(JSON.stringify(e.queryshopservicefeeresult));if("000000000"===a.message_no){if("push-record"===nowPage)myApp.modal({title:stringObj.shop.push_type,text:'<div class="push-block"><div class="type-btn member-push"><a href="message_push/select-member">'+stringObj.shop.member_push+'</a></div><div class="note member-note">'+stringObj.shop.push_coin+'</div><div class="type-btn not-member-push"><a href="message_push/search-member">'+stringObj.shop.not_member_push+'</a></div><div class="note not-member-note">'+stringObj.shop.push_coin+"</div></div>",buttons:[{text:stringObj.text.cancel,onClick:function(){}}]}),$(".modal").addClass("push-type-modal"),findArrayItem(a.parameterkey,"ssfi_feename","shopmemberpush"),$(".member-note span").html(a.parameterkey[nowIndex].ssfi_itemprice),findArrayItem(a.parameterkey,"ssfi_feename","nonshopmemberpush"),$(".not-member-note span").html(a.parameterkey[nowIndex].ssfi_itemprice),$(".member-push").click(function(){myApp.closeModal(".push-type-modal")}),$(".not-member-push").click(function(){myApp.closeModal(".push-type-modal")});else if("message-info"===nowPage){findArrayItem(a.parameterkey,"ssfi_feename",t);var s=localStorage.getItem(branchObj.storage.imagePath)||"",r=indexObj._dataStorage(branchObj.storage.branchData)||{};switch(t){case"shopmemberpush":var i=indexObj._dataStorage(branchObj.storage.md_id_array)||[];$(".push-num input").val(i.length),$(".push-coin input").val(parseInt(a.parameterkey[nowIndex].ssfi_itemprice)*i.length);break;case"nonshopmemberpush":var n=indexObj._dataStorage(branchObj.storage.push_objectfillter)||"";$(".push-num input").val(n.push_num),$(".push-coin input").val(parseInt(a.parameterkey[nowIndex].ssfi_itemprice)*n.push_num)}$(".tabbar .send").unbind("click"),$(".tabbar .send").click(function(){var e=indexObj._dataCookies(indexObj._storage.main)||{};parseFloat(e.coin)>0?myApp.modal({title:stringObj.text.warn,text:stringObj.shop._push_check,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){var e=indexObj._dataCookies(indexObj._storage.main)||{};s.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(s=s.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length));var o=$(".push-item-block .push-item").attr("scm_id")||"";switch(t){case"shopmemberpush":var c={sd_id:r.sd_id,sapm_pushpic:s,sapm_pushcontent:$(".push-message textarea").val(),sapm_designatefunction:"0",sapm_feeitem:a.parameterkey[nowIndex].ssfi_serno,push_object:i.toString(),title:r.sd_shopname,target:stringObj.shop.push_type_array.indexOf($(".push-type").val())+2,scm_id:o},l={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:e.sat,push_content:c,psr_no:Cookies.get("salt_no"),sign_content:CryptoJS.SHA256(JSON.stringify(c)+Cookies.get("salt")).toString()};branchObj.pushshopad2member(l);break;case"nonshopmemberpush":var d=n.push_num;n={fbgender:n.fbgender,rl_citys:n.rl_citys,age_min:n.age_min,age_max:n.age_max,rl_citys_id:n.rl_citys_id};var c={sd_id:r.sd_id,sapm_pushpic:s,sapm_pushcontent:$(".push-message textarea").val(),sapm_designatefunction:"0",sapm_feeitem:a.parameterkey[nowIndex].ssfi_serno,sapm_objectamount:d,push_objectfillter:n,title:r.sd_shopname,target:stringObj.shop.push_type_array.indexOf($(".push-type").val())+2,scm_id:o},l={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:e.sat,push_content:c,psr_no:Cookies.get("salt_no"),sign_content:CryptoJS.SHA256(JSON.stringify(c)+Cookies.get("salt")).toString()};branchObj.pushshopad2nonmember(l)}localStorage.getItem("save_msg")&&branchObj.modifycannedmessage("","1",localStorage.getItem("save_msg"))}}]}):myApp.toast(stringObj.text.no_coin,"",{}).show()})}}else"000000003"===a.message_no||(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},selectMemberInit:function(e){$(".navbar .center").html(stringObj.shop.select_member);e.query;var t=indexObj.template("templateSelectMember")(stringObj.shop);$$(".select-member-content").html(t);var a=indexObj._dataStorage(branchObj.storage.branchData)||{};branchObj.query_shopmember(a.sd_id)},searchMemberInit:function(e){$(".navbar .center").html(stringObj.shop.seach_member);e.query;var t=indexObj.template("templateSearchMember")(stringObj.text);$$(".search-member-content").html(t);var a=indexObj._dataCookies(indexObj._storage.main)||{},s=indexObj._dataStorage(branchObj.storage.branchData)||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,fbgender:"",rl_citys:"",age_min:"",age_max:""},i=indexObj._dataStorage(branchObj.storage.push_objectfillter)||"";i&&($(".gender").val(stringObj.text.gender_array[parseInt(i.fbgender)]),""!==i.age_max&&""!==i.age_max&&$(".age").val(i.age_min+" ~ "+i.age_max),$(".location").val(i.rl_citys),r.fbgender=i.fbgender,r.rl_citys=i.rl_citys,r.age_min=i.age_min,r.age_max=i.age_max,r.rl_citys_id=i.rl_citys_id);myApp.picker({input:".gender",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-trash-o" aria-hidden="true"></i></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){e.setValue([parseInt(r.fbgender)]),$(".left").click(function(){$(".gender").val(""),e.value=""})},cols:[{values:[0,1],displayValues:stringObj.text.gender_array,textAlign:"center",width:"100%"}],onClose:function(e){r.fbgender=e.value.toString()}});for(var n=[],o=18;o<81;o++)n.push(o);myApp.picker({input:".age",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-trash-o" aria-hidden="true"></i></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+" ~ "+t[1]},onOpen:function(e){e.setValue([parseInt(r.age_min),parseInt(r.age_max)]),$(".left").click(function(){$(".age").val(""),e.value=[]})},cols:[{values:n,textAlign:"right",width:"45%",onChange:function(e,t){for(var a=[],s=parseInt(t);s<81;s++)a.push(s);e.cols[2].replaceValues&&e.cols[2].replaceValues(a)}},{textAlign:"center",divider:!0,content:" ~ "},{values:n,textAlign:"left",width:"45%"}],onClose:function(e){r.age_min=e.value[0]||"",r.age_max=e.value[1]||""}});var c="";for(var o in stringObj.counties)c+='<div class="checkbox-item col-25"><input type="checkbox" id="r'+(parseInt(o)+1)+'" name="location" value="'+(parseInt(o)+1)+'" city-name="'+stringObj.counties[o]+'"/><label for="r'+(parseInt(o)+1)+'"><span></span>'+stringObj.counties[o]+"</label></div>";$$(".location").on("click",function(){if($$(".picker-modal.modal-in").length>0&&myApp.closeModal(".picker-modal.modal-in"),myApp.pickerModal('<div class="picker-modal picker-carlocation"><div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-trash-o" aria-hidden="true"></i></a></div><div class="center">'+stringObj.used_car.cbi_carlocation+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div><div class="picker-modal-inner"><div class="content-block"><div class="block-list row">'+c+"</div></div></div></div>"),$$(".picker-carlocation .right").click(function(){var e=[],t=[];$("input[name='location']:checked").each(function(){e.push($(this).val()),t.push($(this).attr("city-name"))}),$(".location").val(t.toString()),r.rl_citys=t.toString(),r.rl_citys_id=e.toString()}),$(".picker-carlocation  .left").click(function(){$(".location").val(""),r.rl_citys="",r.rl_citys_id=""}),r.rl_citys_id)for(var e in r.rl_citys_id.split(","))$("#r"+r.rl_citys_id.split(",")[e]).prop("checked",!0)}),$(".search").click(function(){""===r.fbgender&&""===r.rl_citys&&""===r.age_min&&""===r.age_max?myApp.alert(stringObj.text.any_condition,stringObj.text.warn):branchObj.querypushnonmember(r)})},querypushnonmember:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.querypushnonmember,para:e,success:function(t){if(indexObj.jsonUrlDecode(t),t.querypushnonmemberresult){var a=JSON.parse(JSON.stringify(t.querypushnonmemberresult));"000000000"===a.message_no?(myApp.modal({title:stringObj.text.search_result,text:'<div class="search-result-block"><div class="push-num">'+stringObj.shop.push_num+'</div><div class="set-push-num">'+stringObj.shop.set_push_num+"</div></div>",buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){if(""!=$(".set-push-num input").val()){var t={fbgender:e.fbgender,rl_citys_id:e.rl_citys_id,rl_citys:e.rl_citys,age_min:e.age_min,age_max:e.age_max,push_num:$(".set-push-num input").val()};indexObj._dataStorage(branchObj.storage.push_objectfillter,t),mainView.router.load({url:"message_push/message-info?from=search&type=edit&ssfi_feename=nonshopmemberpush",reload:!0})}else myApp.toast(stringObj.shop.no_push_num,"",{}).show()}}]}),$(".modal").addClass("search-result-modal"),$(".push-num span").html(a.objectamount),$(".set-push-num input").on("input",function(e){$(this).val()>parseInt(a.objectamount)&&$(this).val(parseInt(a.objectamount)),$(this).val()<0&&$(this).val(1),0==$(this).val()&&$(this).val("")})):"000000003"===a.message_no?myApp.toast(stringObj.text.search_null,"",{}).show():(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},messageInfoInit:function(e){var t=e.query,a=indexObj._dataStorage(branchObj.storage.branchData);localStorage.getItem(branchObj.storage.imagePath)?stringObj.shop.push_image=stringObj.text.branch_img_path+localStorage.getItem(branchObj.storage.imagePath):stringObj.shop.push_image="../app/image/imgDefault.png";var s=indexObj.template("templateMessageInfo")(stringObj.shop);switch($$(".message-info-content").html(s),myApp.initImagesLazyLoad(".page-content"),t.type){case"edit":var r="edit";$(".save_quick_msg").css("display","block");var i=!1;$(".save_quick_msg .item-input input").change(function(){i=!!$(this).is(":checked")}),$(".push-message").on("click",function(){myApp.modal({title:stringObj.shop.pushed_info,text:'<textarea class="info resizable" placeholder="'+stringObj.text.context+"("+stringObj.text.max100+')" rows="7"></textarea><div class="quick-msg" style="color:orange"><i class="fa fa-bolt" aria-hidden="true"></i>&nbsp;<u>快選訊息</u></div>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){$(".push-message textarea").val($(".info").val())}}]}),$(".info").val($(".push-message textarea").val()),$("textarea.info").focus(),$(".quick-msg").click(function(e){branchObj.querycannedmessagelist()})});myApp.picker({input:".push-type",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.push_type+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]},onOpen:function(e){},onClose:function(e){e.cols[0].activeIndex+2===3?branchObj.getShopCouponList(a.sd_id):$(".push-item-block").css("display","none")},cols:[{width:"100%",textAlign:"center",values:stringObj.shop.push_type_array}]});$(".navbar .center").html(stringObj.shop.set_message),$(".toolbar.confirm").css("display","initial"),$(".edit-img").css("display","initial"),$(".toolbar.confirm").click(function(){$(".push-message").removeClass("lengthError"),$(".push-message").removeClass("nullError");var e=$(".push-message textarea").val(),a=!1;e.length>100&&($(".push-message").addClass("lengthError"),a=!0),""===e&&($(".push-message").addClass("nullError"),a=!0),a||(r="check",$(".navbar .center").html(stringObj.shop.push_check),$(".toolbar.confirm").css("display","none"),$(".edit-img").css("display","none"),$(".toolbar.tabbar").css("display","initial"),$(".push-num").css("display","initial"),$(".push-coin").css("display","initial"),$(".push-message").unbind("click"),$(".save_quick_msg input").attr("disabled","disabled"),$(".push-type-block input").attr("disabled","disabled"),i?localStorage.setItem("save_msg",$(".push-message textarea").val()):localStorage.getItem("save_msg")&&localStorage.removeItem("save_msg"),branchObj.queryshopservicefee("1",t.ssfi_feename))}),$(".left a").unbind("click"),$(".left a").click(function(){"check"===r?(r="edit",$(".navbar .center").html(stringObj.shop.set_message),$(".toolbar.confirm").css("display","initial"),$(".edit-img").css("display","initial"),$(".toolbar.tabbar").css("display","none"),$(".push-num").css("display","none"),$(".push-coin").css("display","none"),$(".save_quick_msg").css("display","block"),$(".save_quick_msg input").removeAttr("disabled"),$(".push-type-block input").removeAttr("disabled"),$(".push-message").unbind("click"),$(".push-message").on("click",function(){myApp.modal({title:stringObj.shop.pushed_info,text:'<textarea class="info resizable" placeholder="'+stringObj.text.context+"("+stringObj.text.max100+')" rows="7"></textarea><div class="quick-msg" style="color:orange"><i class="fa fa-bolt" aria-hidden="true"></i>&nbsp;<u>快選訊息</u></div>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){$(".push-message textarea").val($(".info").val())}}]}),$(".info").val($(".push-message textarea").val()),$("textarea.info").focus(),$(".quick-msg").click(function(e){branchObj.querycannedmessagelist()})})):mainView.router.load({url:"message_push/"+t.from+"-member",reload:!0})});break;case"info":$(".navbar .center").html(stringObj.shop.pushed_info),$(".push-num").css("display","initial"),$(".push-coin").css("display","initial"),$(".push-readed").css("display","initial"),$(".left a").attr("href","message_push/push-record"),branchObj.queryshoppushcontent(t.sapm_id)}$(".edit-img").click(function(){void 0!==Cookies.get("app_version")?addImage("push-img",""):setImgOnPC("sd_id="+a.sd_id+"&folder=shoppush","")})},queryshoppushcontent:function(e){myApp.showIndicator(),e=e||"";var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage(branchObj.storage.branchData)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,sapm_id:e};indexObj._wcfget({url:branchObj.dataUrl.queryshoppushcontent,para:s,success:function(e){if(indexObj.jsonUrlDecode(e),e.queryshoppushcontentresult){var t=JSON.parse(JSON.stringify(e.queryshoppushcontentresult));"000000000"===t.message_no?($(".push-img-block img").attr("src",stringObj.text.branch_img_path+t.sapm_pushpic),$(".push-message textarea").val(t.sapm_pushcontent),$(".push-num input").val(t.sapm_objectamount),$(".push-coin input").val(t.sapm_pushfee),$(".push-readed input").val(t.readed_count),myApp.initImagesLazyLoad(".page-content")):"000000003"===t.message_no||(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},pushshopad2member:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.pushshopad2member,para:e,success:function(t){if(indexObj.jsonUrlDecode(t),t.pushshopad2memberresult){var a=JSON.parse(JSON.stringify(t.pushshopad2memberresult));if("000000000"===a.message_no){var s=indexObj._dataStorage(branchObj.storage.today_push)||[];findArrayItem(s,"sd_id",e.push_content.sd_id);var r=new Date,i=r.getMonth()+1,n=r.getDate();i<10&&(i="0"+i),n<10&&(n="0"+n);var o=new Date(r.getFullYear()+"/"+i+"/"+n)/864e5,c=new Date(s[nowIndex].last_update_date)/864e5;if(s[nowIndex].push_times=o-c<1?parseInt(s[nowIndex].push_times)+1:1,s[nowIndex].last_update_date=r.getFullYear()+"/"+i+"/"+n,indexObj._dataStorage(branchObj.storage.today_push,s),isMobile.Android())webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,e.push_content.sapm_pushpic,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","");else if(isMobile.iOS()){var l=[];l.push(e.push_content.sapm_pushpic),webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,l,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",[])}myApp.toast(stringObj.shop.push_success,"",{}).show(),mainView.router.load({url:"message_push/push-record",reload:!0})}else"000000003"===a.message_no||(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},pushshopad2nonmember:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.pushshopad2nonmember,para:e,success:function(t){if(indexObj.jsonUrlDecode(t),t.pushshopad2nonmemberresult){var a=JSON.parse(JSON.stringify(t.pushshopad2nonmemberresult));if("000000000"===a.message_no){var s=indexObj._dataStorage(branchObj.storage.today_push)||[];findArrayItem(s,"sd_id",e.push_content.sd_id);var r=new Date,i=r.getMonth()+1,n=r.getDate();i<10&&(i="0"+i),n<10&&(n="0"+n);var o=new Date(r.getFullYear()+"/"+i+"/"+n)/864e5,c=new Date(s[nowIndex].last_update_date)/864e5;if(s[nowIndex].push_times=o-c<=1?parseInt(s[nowIndex].push_times)+1:1,s[nowIndex].last_update_date=r.getFullYear()+"/"+i+"/"+n,indexObj._dataStorage(branchObj.storage.today_push,s),isMobile.Android())webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,e.push_content.sapm_pushpic,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","");else if(isMobile.iOS()){var l=[];l.push(e.push_content.sapm_pushpic),webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,l,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",[])}myApp.toast(stringObj.shop.push_success,"",{}).show(),mainView.router.load({url:"message_push/push-record",reload:!0})}else"000000003"===a.message_no||(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}myApp.hideIndicator()},error:function(e){myApp.hideIndicator()}})},querymembercoininfo:function(){myApp.showIndicator();var e=indexObj._dataCookies(indexObj._storage.main)||{},t={md_id:e.mdId,call_update_module_id:stringObj.call_update_module_id,chkvalue:CryptoJS.SHA1(stringObj.call_update_module_id+stringObj.BANK_PASS+e.mdId+"").toString()};t=btoa(JSON.stringify(t));var a={chkvalue:CryptoJS.SHA1(stringObj.call_update_module_id+stringObj.BANK_PASS+e.mdId+"").toString(),data:t};$.ajax({dataType:"json",type:"POST",url:branchObj.dataUrl.querymembercoininfo,data:a,success:function(t){if(myApp.hideIndicator(),0===t.code)if(e.coin=t.data.bpmr_point||"0",e.giftpoint=t.data.gpmr_point||"0",e.exp=t.data.epmr_point||"0",indexObj._dataCookies(indexObj._storage.main,e,"iscarmg.com"),"push-record"===nowPage){$(".now_coin span").html(t.data.bpmr_point),branchObj.queryshoppushrecord("0");var a=indexObj._dataStorage(branchObj.storage.branchData),s=indexObj._dataStorage(branchObj.storage.today_push)||[];findArrayItem(s,"sd_id",a.sd_id),$(".today_pushed span").html(s[nowIndex].push_times)}else if("shop-buy-data"===nowPage){var r=indexObj._dataStorage("shop_item")||{};$(".gift_discount-block").css("display","initial"),$(".md_gift").html(t.data.gpmr_point+" p"),$(".ntd").html("(NTD "+Math.floor(parseFloat(t.data.gpmr_point)/50)+")"),$(".max_discount-block .max_discount").html("NTD "+Math.floor(parseFloat(r.scm_price)/2)),$(".max_discount-block .gift-point").html("("+Math.floor(parseFloat(r.scm_price)/2*50)+" p)");var i=Math.floor(parseFloat(r.scm_price)/2);i=Math.floor(parseFloat(t.data.gpmr_point)/50)>Math.floor(parseFloat(r.scm_price)/2)?Math.floor(parseFloat(r.scm_price)/2):Math.floor(parseFloat(e.giftpoint)/50);var n=0;$(".discount-block .input .discount").change(function(){parseInt($(this).val())>i&&$(this).val(i),(parseInt($(this).val())<0||""===$(this).val())&&$(this).val(""),$(".discount-block .input .gift-point").html("("+Math.floor(50*parseFloat($(this).val()))+" p)"),n=parseInt($(this).val())}),$(".discount-block .input .discount").keyup(function(){parseInt($(this).val())>i&&$(this).val(i),(parseInt($(this).val())<0||""===$(this).val())&&$(this).val(0),$(".discount-block .input .gift-point").html("("+Math.floor(50*parseFloat($(this).val()))+" p)"),0===(n=parseInt($(this).val()))?$(".scl_sum").html(parseInt(r.scm_price)*parseInt($(".scg_buyamount").val())):$(".scl_sum").html(parseInt(r.scm_price)*parseInt($(".scg_buyamount").val())-n)}),$(".discount-block .input .discount").focus(function(e){$(this).val("")}),$(".discount-block .input .discount").focusout(function(e){$(this).val(n),0===n?$(".scl_sum").html(parseInt(r.scm_price)*parseInt($(".scg_buyamount").val())):$(".scl_sum").html(parseInt(r.scm_price)*parseInt($(".scg_buyamount").val())-n)})}},error:function(e){if(myApp.hideIndicator(),"push-record"===nowPage){$(".now_coin span").html(0),branchObj.queryshoppushrecord("0");var t=indexObj._dataStorage(branchObj.storage.branchData),a=indexObj._dataStorage(branchObj.storage.today_push)||[];findArrayItem(a,"sd_id",t.sd_id),$(".today_pushed span").html(a[nowIndex].push_times)}}})},querytplproduct:function(e,t){myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:e,tpp_type:t};indexObj._wcfget({url:branchObj.dataUrl.querytplproduct,para:s,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.querytplproductresult){var a=JSON.parse(JSON.stringify(e.querytplproductresult));if("000000000"===a.message_no){if(1===t){var s=indexObj._dataStorage(branchObj.storage.blessed_relatives);for(var r in s.blessedlist){var i={};i.tplproducts=a.product;var n=indexObj.template("templateTplProducts")(i);$$(".light-"+s.blessedlist[r].tpr_serno+" .item-input").html(n)}}indexObj._dataStorage(branchObj.storage.temple_products,a.product)}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},query_advancedata:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat};indexObj._wcfget({url:branchObj.dataUrl.query_advancedata,para:a,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.query_advancedataresult){var t=JSON.parse(JSON.stringify(e.query_advancedataresult));if("000000000"===t.message_no){var a,s=indexObj._dataStorage("shop_item")||{};"1"===s.scm_reservationtag?(a="預約限定",$(".scg_buyamount").parents(".item-inner").addClass("readonly"),$(".scg_buyamount").val(1)):"1"===s.scm_producttype?(a="電子服務券",$(".scg_buyamount").parents(".item-inner").addClass("readonly"),$(".scg_buyamount").val(1)):"2"===s.scm_producttype&&(a="實體商品",$(".scg_buyamount").removeAttr("readonly"),$(".scg_buyamount").val(1),$(".scg_buyamount").css("color","#333"),$(".scg_buyamount").css("padding-left","5%"),$(".scg_buyamount").css("font-weight","blod"),$(".scg_buyamount").parents(".item-input").css("background","#eee")),"shop-buy-data"===nowPage?($(".scm_name").val(s.scm_title),$(".scm_type").val(a),$(".scm_price").val(s.scm_price),$(".scl_sum").html(parseInt(s.scm_price)*parseInt($(".scg_buyamount").val())),$(".scg_bonus").val(parseInt(s.scm_bonus_payamount)*parseInt($(".scg_buyamount").val())),$(".scg_buyername").val(t.md_lastname+t.md_firstname),$(".scg_buyermobile").val(t.md_mobile),$(".scg_buyerphone").val(t.md_tel),$(".scg_buyeremail").val(t.md_contactmail),$(".send_addr").val(stringObj.counties[parseInt(t.rl_city_code)-1]+stringObj.region[stringObj.counties[parseInt(t.rl_city_code)-1]][0][stringObj.region[stringObj.counties[parseInt(t.rl_city_code)-1]][1].indexOf(t.rl_zip)]+t.md_addr)):"shop-logistics"===nowPage&&($(".scl_receivername").val(t.md_lastname+t.md_firstname),$(".scl_receivermobile").val(t.md_mobile),$(".scl_receiverphone").val(t.md_tel),$(".scl_email").val(t.md_contactmail),$(".scl_receiveaddress").val(t.md_addr),""===t.md_city&&""===t.md_country||($(".scl_country").val(t.md_city+"  "+t.md_country),mCounty=t.md_city,mDistrict=t.md_country))}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},templeInfoInit:function(e){var t=e.query;nowSd_id=t.sd_id,branchObj.branchInfoGet(nowSd_id,t.from);var a=indexObj._dataStorage(branchObj.storage.blessed_relatives)||{blessedlist:[]};if("scan"===t.from)myApp.modal({title:stringObj.text.warn,text:"是否為<b>"+tp_name+"</b>進行線上捐獻",buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){templeDonate(t.tp_id)}}]});else if("blessed"===t.from){myApp.showTab(".temple-bright-light"),$(".toolbar-bottom .col-33 a").removeClass("active"),$(".bright-light").addClass("active");var s=indexObj.template("templateBlessed"),r=s(a);$$(".blessed-block").html(r);for(var i in a.blessedlist){var n=indexObj._dataStorage(branchObj.storage.temple_products)||[],o={};o.tplproducts=n;r=(s=indexObj.template("templateTplProducts"))(o);$$(".light-"+a.blessedlist[i].tpr_serno+" .item-input").html(r)}for(var i in a.blessedlist)$(".light-"+a.blessedlist[i].tpr_serno+' input[name="light"]').each(function(){for(var e in a.blessedlist[i].tpp)this.value===a.blessedlist[i].tpp[e].tpp_serno&&$(this).prop("checked",!0)})}var c=indexObj._dataStorage(branchObj.storage.save_data)||"";c&&($(".tps_invoice_name").val(c.tps_invoice_name),$(".tps_invoice_tel").val(c.tps_invoice_tel),$(".tps_invoice_area").val(c.tps_invoice_area),$(".tps_invoice_address").val(c.tps_invoice_address),$(".temple-bright-light .iscarpolicy input").prop("checked",c.iscarpolicy)),$(".back-btn a").attr("href","branch-cooperative?menu="+branch_menu+"&cate="+branch_cate),$$(".temple-info-content").on("show",function(){$(".toolbar-bottom .col-33 a").removeClass("active"),$(".info").addClass("active")}),$$(".tps-invoice-name-block").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="請輸入姓名">',"姓名"),$(".input-value").val($("#tps-invoice-name").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#tps-invoice-name").val($(".input-value").val())})}),$$(".tps-invoice-tel-block").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="請輸入聯絡號碼" onkeyup="value=value.replace(/[^-0-9]/g,\'\')" onkeydown="value=value.replace(/[^-0-9]/g,\'\')">',"電話"),$(".input-value").val($("#tps-invoice-tel").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#tps-invoice-tel").val($(".input-value").val())})}),$$(".tps-invoice-address-block").on("click",function(){myApp.alert('<textarea class="info resizable" placeholder="請填寫地址" rows="9"></textarea>',"地址"),$(".info").val($(".tps-invoice-address").val()),$("textarea.info").focus(),$(".modal-button").click(function(){$(".tps-invoice-address").val($("textarea.info").val())})}),$$(".tps-amount-block").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="請輸入金額" onkeydown="input_limit(this, 7);" onkeyup="input_limit(this, 7);">',"金額"),$(".input-value").val($("#tps-amount").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#tps-amount").val($(".input-value").val())})}),$$(".tps_invoice_name-block").on("click",function(){myApp.alert('<input class="input-value" type="text" placeholder="請輸入姓名">',"姓名"),$(".input-value").val($("#tps_invoice_name").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#tps_invoice_name").val($(".input-value").val())})}),$$(".tps_invoice_tel-block").on("click",function(){myApp.alert('<input class="input-value" type="number" placeholder="請輸入聯絡號碼" onkeyup="value=value.replace(/[^-0-9]/g,\'\')" onkeydown="value=value.replace(/[^-0-9]/g,\'\')">',"電話"),$(".input-value").val($("#tps_invoice_tel").val()),$(".input-value").focus(),$(".modal-button").click(function(){$("#tps_invoice_tel").val($(".input-value").val())})}),$$(".tps_invoice_address-block").on("click",function(){myApp.alert('<textarea class="info resizable" placeholder="請填寫地址" rows="9"></textarea>',"地址"),$(".info").val($("#tps_invoice_address").val()),$("textarea.info").focus(),$(".modal-button").click(function(){$("#tps_invoice_address").val($("textarea.info").val())})});var l=!1;$(".temple-bright-light .query_iscarpolicy").click(function(e){var t='<div class="popup authorization-popup"><div class="content-block"><div class="title">'+stringObj.shop.authorization_title+'</div><div class="authorization-content"><div class="main_content_text">'+stringObj.shop.authorization_context+'</div><div class="row btns"><div class="col-45 refuse close-popup">'+stringObj.text.refuse+'</div><div class="col-10"></div><div class="col-45 agree close-popup">'+stringObj.text.agree+"</div></div></div></div></div>";myApp.popup(t),$(".agree").click(function(){l=!0,$(".temple-bright-light .iscarpolicy input").prop("checked",!0)}),$(".refuse").click(function(){l=!1,$(".temple-bright-light .iscarpolicy input").prop("checked",!1)})}),$(".temple-bright-light .iscarpolicy input").change(function(){l=!!$(this).is(":checked")}),$(".bright-btn").click(function(){if((indexObj._dataCookies(indexObj._storage.main)||{}).sat){$(".tps_invoice_name-block").removeClass("lengthError"),$(".tps_invoice_address-block").removeClass("lengthError"),$(".tps_invoice_name-block").removeClass("spacesError"),$(".tps_invoice_tel-block").removeClass("spacesError"),$(".tps_invoice_address-block").removeClass("spacesError"),$(".tps_invoice_name-block").removeClass("nullError"),$(".tps_invoice_tel-block").removeClass("nullError"),$(".tps_invoice_area-block").removeClass("nullError"),$(".tpr_country-block").removeClass("nullError"),$(".tps_invoice_address-block").removeClass("nullError"),$(".temple-bright-light .iscarpolicy").removeClass("nullError");var e=!1;if($(".tps_invoice_name").val().length>10&&($(".tps_invoice_name-block").addClass("lengthError"),e=!0),$(".tps_invoice_address").val().length>200&&($(".tps_invoice_address-block").addClass("lengthError"),e=!0),-1!==$(".tps_invoice_name").val().indexOf(" ")&&($(".tps_invoice_name-block").addClass("spacesError"),e=!0),-1!==$(".tps_invoice_tel").val().indexOf(" ")&&($(".tps_invoice_tel-block").addClass("spacesError"),e=!0),-1!==$(".tps_invoice_address").val().indexOf(" ")&&($(".tps_invoice_address-block").addClass("spacesError"),e=!0),""===$(".tps_invoice_name").val()&&($(".tps_invoice_name-block").addClass("nullError"),e=!0),""===$(".tps_invoice_tel").val()&&($(".tps_invoice_tel-block").addClass("nullError"),e=!0),""===$(".tps_invoice_area").val()&&($(".tps_invoice_area-block").addClass("nullError"),e=!0),""===$(".tps_invoice_address").val()&&($(".tps_invoice_address-block").addClass("nullError"),e=!0),l||($(".temple-bright-light .iscarpolicy").addClass("nullError"),e=!0),e)myApp.toast(stringObj.text.data_not_complete,"",{}).show(),browser_width<992&&($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")),$(window).on("resize",function(){browser_width=$(window).width(),"temple-info"==nowPage&&(browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","35%"),$(".toast-container").css("left","50%")))});else{(a=indexObj._dataStorage(branchObj.storage.blessed_relatives)).tps_invoice_name=$(".tps_invoice_name").val(),a.tps_invoice_tel=$(".tps_invoice_tel").val(),a.tps_invoice_address=$(".tps_invoice_address").val(),indexObj._dataStorage(branchObj.storage.blessed_relatives,a);var t=!0;a=indexObj._dataStorage(branchObj.storage.blessed_relatives)||{blessedlist:[]};for(var s in a.blessedlist)a.blessedlist[s].tpp=[],$(".light-"+a.blessedlist[s].tpr_serno+' input[name="light"]:checked').each(function(){findArrayItem(a.blessedlist,"tpr_serno",a.blessedlist[s].tpr_serno),a.blessedlist[s].tpp.push({tpp_serno:this.value,tpp_name:$(this).attr("tpp_name"),tpp_price:$(this).attr("tpp_price")})}),0===a.blessedlist[s].tpp.length&&(t=!1);0!=a.blessedlist.length?t?(indexObj._dataStorage(branchObj.storage.blessed_relatives,a),mainView.router.load({url:"pay-info?type=templeLight"})):(myApp.toast(stringObj.text.no_light,"",{}).show(),browser_width<992?($(".toast-container").css("width","55%"),$(".toast-container").css("left","35%")):($(".toast-container").css("width","45%"),$(".toast-container").css("left","40%")),$(window).on("resize",function(){browser_width=$(window).width(),"temple-info"==nowPage&&(browser_width<992?($(".toast-container").css("width","55%"),$(".toast-container").css("left","35%")):($(".toast-container").css("width","45%"),$(".toast-container").css("left","40%")))})):(myApp.toast(stringObj.text.no_blessed,"",{}).show(),browser_width<992&&($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")),$(window).on("resize",function(){browser_width=$(window).width(),"temple-info"==nowPage&&(browser_width<992?($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%")):($(".toast-container").css("width","35%"),$(".toast-container").css("left","50%")))}))}}else myApp.modal({title:stringObj.text.warn,text:stringObj.text.notLogin,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.login,onClick:function(){webview.loginPage()}}]})})},query_relativelist:function(){myApp.showIndicator();var e=indexObj._dataCookies(indexObj._storage.main)||{},t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:e.sat};indexObj._wcfget({url:branchObj.dataUrl.query_relativelist,para:t,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.query_relativelistresult){var t=JSON.parse(JSON.stringify(e.query_relativelistresult));if("010160001"===t.message_no)dataNull("templateRelativeNull",stringObj.text.search_null,".relatives-list-content");else if("010160002"===t.message_no){var a=JSON.parse(t.relativelist);indexObj.jsonUrlDecode(a),t.relative_sum=a.length;var s=indexObj.template("templateRelative"),r=s(t);$$(".relatives-list-content").html(r);for(var i in a)"99"===a[i].tpr_title?a[i].tpr_title=stringObj.text.self:a[i].tpr_title=stringObj.text.tpr_title_array[parseInt(a[i].tpr_title)-1],a[i].tpr_show=!0,a[i].tpr_birthday&&(a[i].tpr_birthday=a[i].tpr_birthday.substring(0,10)),a[i].tpr_birthdaytime=stringObj.text.tpr_birthdaytime_array[a[i].tpr_birthdaytime];var n=indexObj._dataStorage(branchObj.storage.blessed_relatives)||{blessedlist:[]};for(var o in n.blessedlist)for(var c in a)a[c].tpr_serno===n.blessedlist[o].tpr_serno&&(a[c].tpr_show=!1);t.relativelist=a,indexObj._dataStorage(branchObj.storage.my_relatives,a);r=(s=indexObj.template("templateRelativeList"))(t);$$(".relative-list ul").html(r);var l=!1,d=document.getElementsByName("relative-checkbox"),c=0;$("input[name='relative-checkbox']").each(function(){for(var e=0;e<d.length;e++)d[e].checked||(l=!1,$(".clickAll").removeClass("cancelAll"),$(".clickAll").html(stringObj.shop.select_all),c++);0===c&&(l=!0,$(".clickAll").addClass("cancelAll"),$(".clickAll").html(stringObj.text.cancel)),$(this).change(function(){c=0;for(var e=0,t=0;t<d.length;t++)d[t].checked||(l=!1,$(".clickAll").removeClass("cancelAll"),$(".clickAll").html(stringObj.shop.select_all),e++);0===e&&(l=!0,$(".clickAll").addClass("cancelAll"),$(".clickAll").html(stringObj.text.cancel))})}),$(".clickAll").click(function(){l?($("input[name='relative-checkbox']").prop("checked",!1),l=!1,$(".clickAll").removeClass("cancelAll"),$(".clickAll").html(stringObj.shop.select_all)):($("input[name='relative-checkbox']").prop("checked",!0),l=!0,$(".clickAll").addClass("cancelAll"),$(".clickAll").html(stringObj.text.cancel))}),$(".edit-relative").click(function(e){findArrayItem(a,"tpr_serno",$(this).attr("tpr_serno")),""===a[nowIndex].tpr_name||""===a[nowIndex].tpr_birthday?myApp.alert(stringObj.text.myinfo_incomplete,stringObj.text.warn):mainView.router.load({url:"add-relatives?tpr_serno="+$(this).attr("tpr_serno")})}),$(".add-blessed-list").click(function(e){for(var t=indexObj._dataStorage(branchObj.storage.blessed_relatives)||{blessedlist:[]},s=!1,r=!1,i=0;i<d.length;i++)if(d[i].checked)if(findArrayItem(a,"tpr_serno",$(d[i]).val()),""===a[nowIndex].tpr_name||""===a[nowIndex].tpr_birthday)s=!0;else if(t.blessedlist.length>0){r=!1;for(var n in t.blessedlist)t.blessedlist[n].tpr_serno===$(d[i]).val()&&(r=!0);r||t.blessedlist.push(a[nowIndex])}else t.blessedlist.push(a[nowIndex]);else if(t.blessedlist.length>0)for(var n in t.blessedlist)t.blessedlist[n].tpr_serno===$(d[i]).val()&&findAndRemove(t.blessedlist,"tpr_serno",$(d[i]).val());s?myApp.alert(stringObj.text.myinfo_incomplete,stringObj.text.warn):(indexObj._dataStorage(branchObj.storage.blessed_relatives,t),mainView.router.load({url:"temple-info?sd_id="+nowSd_id+"&from=blessed"}))}),$(".delete-relatives").click(function(e){for(var t=!1,s=[],r=0;r<d.length;r++)if(d[r].checked){var i={};i.tpr_serno=$(d[r]).val(),s.push(i),findArrayItem(a,"tpr_serno",$(d[r]).val()),a[nowIndex].tpr_title===stringObj.text.self&&(t=!0)}t?(myApp.toast(stringObj.text.not_del_self,"",{}).show(),browser_width<992&&($(".toast-container").css("width","40%"),$(".toast-container").css("left","45%"))):s.length>0?myApp.modal({title:stringObj.text.warn,text:stringObj.text.check_delete,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){var e=indexObj._dataCookies(indexObj._storage.main)||{},t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:e.sat};t.tpr_serno=JSON.stringify(s),t.modify=3,branchObj.modify_relative(t)}}]}):myApp.alert(stringObj.text.unselected_relatives,stringObj.text.warn)})}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null);$(".add-relatives").click(function(e){mainView.router.load({url:"add-relatives"})})}},error:function(e){myApp.hideIndicator()}})},relativesListInit:function(e){e.query;$(".navbar .center").html(stringObj.text.relatives_list),branchObj.query_relativelist(),$(".relatives-list-left").click(function(e){mainView.router.load({url:"temple-info?sd_id="+nowSd_id+"&from=blessed"})})},modify_relative:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.modify_relative,para:e,success:function(t){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(t),t.modify_relativeresult){var a=JSON.parse(JSON.stringify(t.modify_relativeresult));if("000000000"===a.message_no){if(1===e.modify)myApp.toast(stringObj.text.add_success,"",{}).show(),mainView.router.load({url:"relatives-list"});else if(2===e.modify)myApp.toast(stringObj.text.editFinish,"",{}).show(),mainView.router.load({url:"relatives-list"});else if(3===e.modify){var s=indexObj._dataStorage(branchObj.storage.blessed_relatives)||{blessedlist:[]},r=JSON.parse(e.tpr_serno);for(var i in r)findAndRemove(s.blessedlist,"tpr_serno",r[i].tpr_serno),indexObj._dataStorage(branchObj.storage.blessed_relatives,s);myApp.toast(stringObj.text.delete_success,"",{}).show(),mainView.router.load({url:"relatives-list",reload:!0})}}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},addRelativesInit:function(e){var t=e.query,a=indexObj._dataCookies(indexObj._storage.main)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat};if(t.tpr_serno){$(".navbar .add-relatives-center").html(stringObj.text.edit_relatives),$(".add .toolbar-inner a").html(stringObj.text.edit),s.modify=2;var r=indexObj._dataStorage(branchObj.storage.my_relatives)||{};findArrayItem(r,"tpr_serno",t.tpr_serno),$(".tpr_name").val(r[nowIndex].tpr_name),$(".tpr_title").val(r[nowIndex].tpr_title),$(".tpr_birthday").val(r[nowIndex].tpr_birthday.substring(0,10)),$(".tpr_birthdaytime").val(r[nowIndex].tpr_birthdaytime),$(".tpr_country").val(r[nowIndex].tpr_country+" "+r[nowIndex].tpr_area),$(".tpr_address").val(r[nowIndex].tpr_address),s.tpr_serno=r[nowIndex].tpr_serno,r[nowIndex].tpr_title===stringObj.text.self?s.tpr_title=99:s.tpr_title=stringObj.text.tpr_title_array.indexOf(r[nowIndex].tpr_title)+1,s.tpr_birthdaytime=stringObj.text.tpr_birthdaytime_array.indexOf(r[nowIndex].tpr_birthdaytime),s.tpr_country=r[nowIndex].tpr_country,s.tpr_area=r[nowIndex].tpr_area}else $(".navbar .add-relatives-center").html(stringObj.text.add_relatives),s.modify=1;$(".add-relatives-left").click(function(e){window.history.back()});for(var i=myApp.picker({input:".tpr_title",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.text.tpr_title+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]},onOpen:function(e){2===s.modify&&e.setValue([r[nowIndex].tpr_title])},onClose:function(e){s.tpr_title=e.cols[0].activeIndex+1},cols:[{width:"100%",textAlign:"center",values:stringObj.text.tpr_title_array}]}),n=stringObj.region,o=myApp.picker({input:".tpr_country",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+"  "+t[1]},onOpen:function(e){2===s.modify&&e.setValue([r[nowIndex].tpr_country,r[nowIndex].tpr_area])},onClose:function(e){},cols:[{textAlign:"center",width:140,values:stringObj.counties,onChange:function(e,t){s.tpr_country=t,e.cols[1].replaceValues&&e.cols[1].replaceValues(n[t][0])}},{textAlign:"center",values:n.臺北市[0],width:140,onChange:function(e,t){s.tpr_area=t}}]}),c=(myApp.picker({input:".tpr_birthdaytime",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.text.tpr_birthdaytime+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]},onOpen:function(e){2===s.modify&&e.setValue([r[nowIndex].tpr_birthdaytime])},onClose:function(e){s.tpr_birthdaytime=e.cols[0].activeIndex},cols:[{width:"100%",textAlign:"center",values:stringObj.text.tpr_birthdaytime_array}]}),new Date),l=[],d=1;d<=31;d++)l.push(d<10?"0"+d:d);for(var p=[],d=1;d<=30;d++)p.push(d<10?"0"+d:d);for(var m=[],d=1;d<=29;d++)m.push(d<10?"0"+d:d);for(var u=[],d=1;d<=28;d++)u.push(d<10?"0"+d:d);var b=myApp.picker({input:".tpr_birthday",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker noUse"><i class="fa fa-trash-o" aria-hidden="true"></i></a></div><div class="center">生日</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+"-"+t[1]+"-"+t[2]},onOpen:function(e){if(2===s.modify)e.setValue([r[nowIndex].tpr_birthday.substring(0,4),r[nowIndex].tpr_birthday.substring(5,7),r[nowIndex].tpr_birthday.substring(8,10)]);else{var t=c.getMonth()+1,a=c.getDate();t<10&&(t="0"+t),a<10&&(a="0"+a),e.setValue([c.getFullYear(),t,a])}},cols:[{textAlign:"center",values:function(){for(var e=[],t=1911;t<=c.getFullYear();t++)e.push(t<10?"0"+t:t);return e}(),onChange:function(e,t){"02"===e.cols[2].value&&(parseInt(e.cols[0].value)%4==0?e.cols[4].replaceValues&&e.cols[4].replaceValues(m):e.cols[4].replaceValues&&e.cols[4].replaceValues(u))}},{textAlign:"center",divider:!0,content:" - "},{values:function(){for(var e=[],t=1;t<=12;t++)e.push(t<10?"0"+t:t);return e}(),onChange:function(e,t){"02"===e.cols[2].value?parseInt(e.cols[0].value)%4==0?e.cols[4].replaceValues&&e.cols[4].replaceValues(m):e.cols[4].replaceValues&&e.cols[4].replaceValues(u):parseInt(e.cols[2].value)<8?parseInt(e.cols[2].value)%2==1?e.cols[4].replaceValues&&e.cols[4].replaceValues(l):e.cols[4].replaceValues&&e.cols[4].replaceValues(p):parseInt(e.cols[2].value)%2==1?e.cols[4].replaceValues&&e.cols[4].replaceValues(p):e.cols[4].replaceValues&&e.cols[4].replaceValues(l)}},{textAlign:"center",divider:!0,content:" - "},{values:function(){for(var e=[],t=1;t<=31;t++)e.push(t<10?"0"+t:t);return e}()}]});$(".tpr_name-block").click(function(){myApp.alert('<input class="input-value" type="text" placeholder="'+stringObj.text.input_name+'">',stringObj.text.user_name),$(".input-value").val($(".tpr_name").val()),$(".input-value").focus(),$(".modal-button").click(function(){$(".tpr_name").val($(".input-value").val())})}),$(".tpr_address-block").click(function(){myApp.alert('<textarea class="info resizable" placeholder="'+stringObj.text.input_address_placeholder+'" rows="9"></textarea>',stringObj.text.address),$(".info").val($("#tpr_address").val()),$("textarea.info").focus(),$(".modal-button").click(function(){$("#tpr_address").val($(".info").val())})}),99===s.tpr_title&&(i.destroy(),o.destroy(),b.destroy(),$(".tpr_name-block").unbind("click"),$(".tpr_address-block").unbind("click"),$(".list-block input").css("color","#888"),$(".list-block textarea").css("color","#888"),$(".list-block .tpr_birthdaytime").css("color","#FCFAF2")),$(".add").click(function(e){$(".tpr_name-block").removeClass("lengthError"),$(".tpr_address-block").removeClass("lengthError"),$(".tpr_name-block").removeClass("spacesError"),$(".tpr_title-block").removeClass("spacesError"),$(".tpr_birthday-block").removeClass("spacesError"),$(".tpr_address-block").removeClass("spacesError"),$(".tpr_name-block").removeClass("nullError"),$(".tpr_title-block").removeClass("nullError"),$(".tpr_birthday-block").removeClass("nullError"),$(".tpr_birthdaytime-block").removeClass("nullError"),$(".tpr_country-block").removeClass("nullError"),$(".tpr_address-block").removeClass("nullError");var t=!1;$(".tpr_name").val().length>10&&($(".tpr_name-block").addClass("lengthError"),t=!0),$(".tpr_address").val().length>200&&($(".tpr_address-block").addClass("lengthError"),t=!0),-1!==$(".tpr_name").val().indexOf(" ")&&($(".tpr_name-block").addClass("spacesError"),t=!0),-1!==$(".tpr_title").val().indexOf(" ")&&($(".tpr_title-block").addClass("spacesError"),t=!0),-1!==$(".tpr_birthday").val().indexOf(" ")&&($(".tpr_birthday-block").addClass("spacesError"),t=!0),-1!==$(".tpr_address").val().indexOf(" ")&&($(".tpr_address-block").addClass("spacesError"),t=!0),""===$(".tpr_name").val()&&($(".tpr_name-block").addClass("nullError"),t=!0),""===$(".tpr_title").val()&&($(".tpr_title-block").addClass("nullError"),t=!0),""===$(".tpr_birthday").val()&&($(".tpr_birthday-block").addClass("nullError"),t=!0),""===$(".tpr_birthdaytime").val()&&($(".tpr_birthdaytime-block").addClass("nullError"),t=!0),""===$(".tpr_country").val()&&($(".tpr_country-block").addClass("nullError"),t=!0),""===$(".tpr_address").val()&&($(".tpr_address-block").addClass("nullError"),t=!0),t||(s.tpr_name=$(".tpr_name").val(),s.tpr_birthday=$(".tpr_birthday").val(),s.tpr_address=$(".tpr_address").val(),branchObj.modify_relative(s))})},createlogisticsdata:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage("logistics_data")||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,scg_id:localStorage.getItem("scg_id"),scm_id:a.scm_id,scl_receivername:a.scl_receivername,scl_receivermobile:a.scl_receivermobile,scl_receiverphone:a.scl_receiverphone,scl_email:a.scl_email,scl_postcode:a.scl_postcode,scl_city:a.scl_city,scl_district:a.scl_district,scl_receiveaddress:a.scl_receiveaddress,scl_delivery_time:stringObj.shop.scl_delivery_time_array.indexOf(a.scl_delivery_time)};indexObj._wcfget({url:branchObj.dataUrl.createlogisticsdata,para:s,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.createlogisticsdataresult){var t=JSON.parse(JSON.stringify(e.createlogisticsdataresult));"000000000"===t.message_no?branchObj.createpaymentflow(localStorage.getItem("scg_id")):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},createpaymentflow:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:nowSd_id,scg_id:e};void 0!==Cookies.get("app_version")?a.is_mobile=1:a.is_mobile=0,indexObj._wcfget({url:branchObj.dataUrl.createpaymentflow,para:a,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.createpaymentflowresult){var t=JSON.parse(JSON.stringify(e.createpaymentflowresult));if("000000000"===t.message_no)switch(Cookies.set("createpaymentflow","1"),t.paymentflow){case"1":void 0!==Cookies.get("app_version")?webview.toWallet(JSON.stringify(t.paymentdata)):suntechbuysafe(t.paymentdata);break;case"2":ecpay(t.paymentdata)}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},payInfoInit:function(e){var t=e.query;$(".pay-info-left").click(function(){window.history.back(),"templeDonate"===t.type&&(blessed_relatives.blessedlist=[],indexObj._dataStorage(branchObj.storage.blessed_relatives,blessed_relatives))});var a=indexObj._dataStorage("logistics_data")||{},s=indexObj._dataStorage("shop_item")||{},r=indexObj._dataStorage("shop_buy_data")||{};a.scg_buyername=r.scg_buyername,a.scg_buyermobile=r.scg_buyermobile,a.scg_buyerphone=r.scg_buyerphone,a.scg_buyeremail=r.scg_buyeremail,a.scg_buyermessage=r.scg_buyermessage,a.scm_id=s.scm_id,a.scm_pic=stringObj.text.branch_img_path+s.scm_mainpic,a.scm_item=s.scm_title,a.scl_amount=r.scg_buyamount,a.scm_item_sum=parseInt(s.scm_price)*parseInt(r.scg_buyamount)-parseInt(r.scg_subtract_price),a.scl_delivery_time=stringObj.shop.scl_delivery_time_array[parseInt(a.scl_delivery_time)-1],a.refunds_note=stringObj.text.refunds_note,nowSd_id=s.sd_id,"1"===s.scm_coupon_providetype&&(a.scm_item_sum=0,a.scg_bonus=parseInt(s.scm_bonus_payamount)*parseInt(r.scg_buyamount));var i=indexObj.template("templatePayInfo")(a);$$(".pay-info-block").html(i),myApp.initImagesLazyLoad(".page-content"),$(".pay").click(function(){"1"===(indexObj._dataCookies(indexObj._storage.main)||{}).md_seccode_created?(void 0===Cookies.get("createpaymentflow")&&("coupon"!==t.from&&"reservation"!==t.from&&(t.from="other"),a.from=t.from,indexObj._dataStorage("logistics_data",a)),memberseccode("verify")):myApp.modal({title:stringObj.text.warn,text:stringObj.text.no_set_memberseccode,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.to_set,onClick:function(){memberseccode("set")}}]})})},updatescgpayment:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,scg_id:e};indexObj._wcfget({url:branchObj.dataUrl.updatescgpayment,para:a,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.updatescgpaymentresult){var t=JSON.parse(JSON.stringify(e.updatescgpaymentresult));"000000000"===t.message_no||(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},paysuccesstopush:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage("shop_buy_data")||{},s=indexObj._dataStorage("shop_item")||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,scg_id:e,identifier:"",addr:"",phone:"",email:"",md_cname:""};"1"!==s.scm_coupon_providetype&&(r.identifier=a.identifier,r.addr=a.send_addr,r.phone=a.scg_buyermobile,r.email=a.scg_buyeremail,r.md_cname=a.scg_buyername,""!==a.identifier&&(r.md_cname=a.tax_title)),indexObj._wcfget({url:branchObj.dataUrl.paysuccesstopush,para:r,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.paysuccesstopushresult){var t=JSON.parse(JSON.stringify(e.paysuccesstopushresult));"000000000"===t.message_no||"011601005"===t.message_no?"2"===(indexObj._dataStorage("shop_item")||{}).scm_producttype&&("000000000"===t.message_no?myApp.alert(stringObj.text.nowCoin+"："+t.gpmr_point,stringObj.text.warn):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},paySuccessInit:function(e){e.query;myApp.hideIndicator();var t=indexObj._dataStorage("shop_buy_data")||{},a=indexObj._dataStorage("shop_item")||{};localStorage.getItem("scg_id")?branchObj.paysuccesstopush(localStorage.getItem("scg_id")):window.location="pm/branch-cooperative?cate="+branch_cate+"&listtype="+nowBranchType;var s=new Date,r=s.getMonth()+1;r<10&&(r="0"+r);var i=s.getDate();i<10&&(i="0"+i);var n=s.getHours();n<10&&(n="0"+n);var o=s.getMinutes();o<10&&(o="0"+o);var c=s.getSeconds();c<10&&(c="0"+c);var l={pay_time:s.getFullYear()+"/"+r+"/"+i+" "+n+":"+o+":"+c,sd_shopname:a.sd_shopname,scm_title:a.scm_title,scg_id:localStorage.getItem("scg_id"),sd_shoptel:a.sd_shoptel,scg_price:parseInt(t.scl_sum)-parseInt(t.scg_subtract_price),scg_bonus:t.scg_bonus};"1"===a.scm_coupon_providetype&&(l.scg_price=0);var d=indexObj.template("templatePaySuccess")(l);$$(".pay-success-block").html(d),myApp.initImagesLazyLoad(".page-content"),indexObj._dataStorage(indexObj._storage.reservationbook,null),localStorage.removeItem("scg_id"),localStorage.removeItem("scm_id"),indexObj._dataStorage("shop_item",null),indexObj._dataStorage("shop_buy_data",null),indexObj._dataStorage("logistics_data",null),$(".confirm").click(function(){window.location="pm/branch-cooperative?cate="+branch_cate+"&listtype="+nowBranchType})},createblessreport:function(e,t,a){myApp.showIndicator();var s=indexObj._dataCookies(indexObj._storage.main)||{},r=indexObj._dataStorage(branchObj.storage.branchData),i={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,query_start:e,query_end:t,sd_id:r.sd_id,tpp_type:a};indexObj._wcfget({url:branchObj.dataUrl.createblessreport,para:i,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.createblessreportresult){var t=JSON.parse(JSON.stringify(e.createblessreportresult));if("000000000"===t.message_no){switch(t.report_head.tpp_type){case"1":t.report_head.tpp_type=stringObj.text.temple_light;break;case"2":t.report_head.tpp_type=stringObj.text.temple_donate}t.report_head.query_start=t.report_head.query_start.substring(0,10),t.report_head.query_end=t.report_head.query_end.substring(0,10),t.report_head.totalamount=t.report_head.totalamount.replace(/\B(?=(\d{3})+(?!\d))/g,",");for(var a in t.tps_record)t.tps_record[a].tps_amounts=parseInt(t.tps_record[a].tps_amount),t.tps_record[a].tps_amount=t.tps_record[a].tps_amount.replace(/\B(?=(\d{3})+(?!\d))/g,",");var s=indexObj.template("templateReconciliation"),r=s(t);$$(".reconciliation-tab .data-table-block").html(r),indexObj._dataStorage("createblessreport",t),$(".reconciliation-tab .sortable-cell").click(function(){$(".reconciliation-tab .sortable-cell").removeClass("sortable-active"),$(this).addClass("sortable-active"),$(this).hasClass("sortable-asc")?($(this).removeClass("sortable-asc"),$(this).addClass("sortable-desc"),$(this).hasClass("tps_id")?t.tps_record.sort(sortByProperty("tps_id",-1)):$(this).hasClass("tps_amount")?t.tps_record.sort(sortByProperty("tps_amounts",-1)):$(this).hasClass("create_date")&&t.tps_record.sort(sortByProperty("create_date",-1))):($(this).removeClass("sortable-desc"),$(this).addClass("sortable-asc"),$(this).hasClass("tps_id")?t.tps_record.sort(sortByProperty("tps_id",1)):$(this).hasClass("tps_amount")?t.tps_record.sort(sortByProperty("tps_amounts",1)):$(this).hasClass("create_date")&&t.tps_record.sort(sortByProperty("create_date",1))),s=indexObj.template("templateReconciliationItems"),r=s(t),$$(".reconciliation-tab .data-table-block .card-content tbody").html(r),indexObj._dataStorage("createblessreport",t)})}else"011404001"===t.message_no?myApp.alert(stringObj.text.search_null,stringObj.text.warn):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},createblesslightreport:function(e,t){myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main)||{},s=indexObj._dataStorage(branchObj.storage.branchData),r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,query_start:e,query_end:t,sd_id:s.sd_id};indexObj._wcfget({url:branchObj.dataUrl.createblesslightreport,para:r,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.createblesslightreportresult){var t=JSON.parse(JSON.stringify(e.createblesslightreportresult));if("000000000"===t.message_no){t.report_head.query_start=t.report_head.query_start.substring(0,10),t.report_head.query_end=t.report_head.query_end.substring(0,10);var a=indexObj.template("templateSalesDetails"),s=a(t);$$(".sales-details-tab .data-table-block").html(s),indexObj._dataStorage("createblesslightreport",t),$(".sales-details-tab .sortable-cell").click(function(){$(".sales-details-tab .sortable-cell").removeClass("sortable-active"),$(this).addClass("sortable-active"),$(this).hasClass("sortable-asc")?($(this).removeClass("sortable-asc"),$(this).addClass("sortable-desc"),$(this).hasClass("tps_id")?t.tps_record.sort(sortByProperty("tps_id",-1)):$(this).hasClass("tpp_name")?t.tps_record.sort(sortByProperty("tpp_name",-1)):$(this).hasClass("create_date")&&t.tps_record.sort(sortByProperty("create_date",-1))):($(this).removeClass("sortable-desc"),$(this).addClass("sortable-asc"),$(this).hasClass("tps_id")?t.tps_record.sort(sortByProperty("tps_id",1)):$(this).hasClass("tpp_name")?t.tps_record.sort(sortByProperty("tpp_name",1)):$(this).hasClass("create_date")&&t.tps_record.sort(sortByProperty("create_date",1))),a=indexObj.template("templateSalesDetailsItems"),s=a(t),$$(".sales-details-tab .data-table-block .card-content tbody").html(s),indexObj._dataStorage("createblesslightreport",t)})}else"011404001"===t.message_no?myApp.alert(stringObj.text.search_null,stringObj.text.warn):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},templeTableInit:function(e){e.query;isMobile.Android()||isMobile.iOS()||$(".tabs .page-content").niceScroll({cursorcolor:"rgba(100,100,100,.9)",cursoropacitymin:0,cursorborder:"1px solid #000"});var t=myApp.calendar({input:".reconciliation-tab .query_start",dateFormat:"yyyy/mm/dd",monthNames:stringObj.text.monthNames}),a=new Date;$(".reconciliation-tab .query_start").change(function(){t.close(),$(".reconciliation-tab .query_end").attr("placeholder",stringObj.text.input_end_date),a=new Date($(this).val());var e=myApp.calendar({input:".reconciliation-tab .query_end",dateFormat:"yyyy/mm/dd",monthNames:stringObj.text.monthNames,disabled:{from:new Date("1911/01/01"),to:new Date($(this).val()).setDate(a.getDate()-1)}});$(".reconciliation-tab .query_end").change(function(){e.close()})}),nowTab="reconciliation",$$(".reconciliation-tab").on("show",function(){nowTab="reconciliation",$(".buttons-row a").removeClass("active"),$(".reconciliation").addClass("active")}),$$(".sales-details-tab").on("show",function(){nowTab="sales-details",$(".buttons-row a").removeClass("active"),$(".sales-details").addClass("active");var e=myApp.calendar({input:".sales-details-tab .query_start",dateFormat:"yyyy/mm/dd",monthNames:stringObj.text.monthNames});a=new Date,$(".sales-details-tab .query_start").change(function(){e.close(),$(".sales-details-tab .query_end").attr("placeholder",stringObj.text.input_end_date),a=new Date($(this).val());var t=myApp.calendar({input:".sales-details-tab .query_end",dateFormat:"yyyy/mm/dd",monthNames:stringObj.text.monthNames,disabled:{from:new Date("1911/01/01"),to:new Date($(this).val()).setDate(a.getDate()-1)}});$(".sales-details-tab .query_end").change(function(){t.close()})})});var s,r;$(".reconciliation-tab .search").click(function(){"0"===$('select[name="tpp_type"]').val()||""===$(".reconciliation-tab .query_start").val()||""===$(".reconciliation-tab .query_end").val()?myApp.alert(stringObj.text.data_not_complete,stringObj.text.warn):(s=new Date($(".reconciliation-tab .query_start").val())/864e5,(r=new Date($(".reconciliation-tab .query_end").val())/864e5)-s>31?myApp.alert(stringObj.text.not_more_than_31days,stringObj.text.warn):branchObj.createblessreport($(".reconciliation-tab .query_start").val(),$(".reconciliation-tab .query_end").val(),$('select[name="tpp_type"]').val()))}),$(".sales-details-tab .search").click(function(){""===$(".sales-details-tab .query_start").val()||""===$(".sales-details-tab .query_end").val()?myApp.alert(stringObj.text.data_not_complete,stringObj.text.warn):(s=new Date($(".sales-details-tab .query_start").val())/864e5,(r=new Date($(".sales-details-tab .query_end").val())/864e5)-s>31?myApp.alert(stringObj.text.not_more_than_31days,stringObj.text.warn):branchObj.createblesslightreport($(".sales-details-tab .query_start").val(),$(".sales-details-tab .query_end").val()))}),$(".print").click(function(e){localStorage.setItem("nowTab",nowTab),"reconciliation"===nowTab?indexObj._dataStorage("createblessreport")?window.open("http://"+stringObj.WEB_URL+"/Shop/printTable","_blank"):myApp.alert(stringObj.text.search_null,stringObj.text.warn):"sales-details"===nowTab&&(indexObj._dataStorage("createblesslightreport")?window.open("http://"+stringObj.WEB_URL+"/Shop/printTable","_blank"):myApp.alert(stringObj.text.search_null,stringObj.text.warn))})},addMarker_fullmap:function(e,t,a,s,r){var i;switch(s){case"2":i={url:"app/image/marker1.png"};break;case"3":i={url:"app/image/marker2.png"};break;case"4":i={url:"app/image/marker3.png"}}var n=new google.maps.Marker({position:e,title:t,map:a,icon:i});markers.push(n);var o=new google.maps.InfoWindow;o.setContent('<b style="color:#000;">'+t+"</b>"),google.maps.event.addListener(n,"click",function(){a.setCenter(n.getPosition()),nowCenter=n.getPosition(),prev&&prev_infowindow.close(),prev=!0,prev_infowindow=o;var e=indexObj._dataStorage("shop_list");findArrayItem(e,"sd_id",r),e[nowIndex].sd_shopphotopath?e[nowIndex].sd_shopphotopath=stringObj.text.branch_img_path+e[nowIndex].sd_shopphotopath:e[nowIndex].sd_shopphotopath="app/image/imgDefault.png";"map"===nowPage||nowPage,o.open(a,n),myApp.pickerModal('<div class="picker-modal"><div class="toolbar"><div class="toolbar-inner"><div class="left"></div><div class="center">'+t+'</div><div class="right"><a href="#" class="close-picker"><i class="fa fa-times"></i></a></div></div></div><div class="picker-modal-inner"><div class="content-block marker-info"><div class="row info-content"><div class="col-50"><img src="'+e[nowIndex].sd_shopphotopath+'" width=160  onerror=\'this.src="app/image/imgDefault.png"\'/></div><div class="col-50"><div class="store-tel">電話：</div><div class="store-tel" style="padding-bottom:3%;">'+e[nowIndex].sd_shoptel+'</div><div class="store-time">時間：</div><div class="store-time">星期'+e[nowIndex].sd_weeklystart+"～星期"+e[nowIndex].sd_weeklyend+"，"+e[nowIndex].sd_dailystart.substring(0,5)+"～"+e[nowIndex].sd_dailyend.substring(0,5)+'</div></div></div><div class="bottom-block row no-gutter"><div class="col-75"><a sd_id="'+r+'" class="close-picker to_info">店家資訊</a></div></div></div></div></div>'),$(".to_info").unbind("click"),$(".to_info").click(function(){localStorage.setItem("pageInit",nowPage),window.location="pm/branch-info?sd_id="+$(this).attr("sd_id")})})},mapInit:function(e){void 0!==Cookies.get("app_version")?webview.getLocation():$.getJSON("http://ip-api.com/json/?callback=?",function(e){nowLocation(e.lon,e.lat)}),$(".map-left").click(function(e){window.location="pm/branch-cooperative?cate="+localStorage.getItem("cate")+"&listtype="+nowBranchType});var t=indexObj.template("templateMapType")(branchObj._menuList[0]);$$(".type-block").html(t),$(".type-block .markerType").eq(0).addClass("active");e.query;if(void 0===Cookies.get("marker_type")?Cookies.set("marker_type","2"):($(".type-block .markerType").removeClass("active"),$(".type-block .markerType").eq(parseInt(Cookies.get("marker_type"))-2).addClass("active")),null===localStorage.getItem("map_prompt")){myApp.popover('<div class="popover location_popover"><div class="popover-inner"><div class="content-block"><span>查詢目前所在位置</span></div></div></div>',$(".set_location")),localStorage.setItem("map_prompt",1)}$(".search-btn").click(function(e){if($(this).css("display","none"),Cookies.set("sd_lat",full_map.getCenter().lat()),Cookies.set("sd_lng",full_map.getCenter().lng()),markers.length>0)for(var t=0;t<markers.length;t++)markers[t].setMap(null);if(markers=[],branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,branchObj.branchListGet(""),void 0!==nowlat&&0!==nowlat){my_marker&&my_marker.setMap(null);var a={url:"app/image/user-marker.png"};my_marker=new google.maps.Marker({position:new google.maps.LatLng(nowlat,nowlng),map:full_map,title:"Me",icon:a})}}),$(".set_location").click(function(e){nowlat="",nowlng="",void 0!==Cookies.get("app_version")?webview.getLocation():$.getJSON("http://ip-api.com/json/?callback=?",function(e){nowLocation(e.lon,e.lat)})}),$(".markerType").click(function(){if($(".type-block .markerType").removeClass("active"),$(this).addClass("active"),$(".search-btn").css("display","none"),markers.length>0){for(var e=0;e<markers.length;e++)markers[e].setMap(null);markers=[]}Cookies.set("marker_type",$(this).attr("type")),Cookies.set("sd_lat",full_map.getCenter().lat()),Cookies.set("sd_lng",full_map.getCenter().lng()),branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,branchObj.branchListGet("")})},querycannedmessagelist:function(e,t){myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main)||{},s=indexObj._dataStorage(branchObj.storage.branchData)||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id};indexObj._wcfget({url:branchObj.dataUrl.querycannedmessagelist,para:r,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.querycannedmessagelistresult){var t=JSON.parse(JSON.stringify(e.querycannedmessagelistresult));if("000000000"===t.message_no)if(t.canned_message_list.length>0){for(var a in t.canned_message_list)t.canned_message_list[a].cmsg_content.match("\n")?t.canned_message_list[a].cmsg_content_show=t.canned_message_list[a].cmsg_content.replace(/\n/gi,"&nbsp;<br>"):t.canned_message_list[a].cmsg_content_show=t.canned_message_list[a].cmsg_content;if("message-info"===nowPage){var s="";for(var a in t.canned_message_list)s+='<li><label class="label-radio item-content"><input type="radio" name="quick-msg" value="'+t.canned_message_list[a].cmsg_serno+'"><div class="item-inner"><div class="item-text">'+t.canned_message_list[a].cmsg_content_show+'</div><textarea style="display:none;">'+t.canned_message_list[a].cmsg_content+"</textarea></div></label></li>";var r='<div class="popup popup-quick-msg"><div class="close-btn"><a href="#" class="close-popup"><i class="fa fa-times" aria-hidden="true"></i></a></div><div class="content-block"><div class="title">'+stringObj.shop.quick_msg+'</div><div class="quick-msg-content"><div class="list-block"><ul>'+s+'</ul></div></div></div><div class="toolbar toolbar-bottom tabbar animated fadeInUp"><div class="toolbar-inner"><a href="#" class="confirm">'+stringObj.text.confirm+"</a></div></div></div>";myApp.popup(r),$(".popup-quick-msg").css("z-index","91000"),$(".quick-msg-content ul li input").eq(0).attr("checked",'"checked"');var i=t.canned_message_list[0].cmsg_content;$(".popup-quick-msg li").click(function(){i=$(this).find("textarea").val()}),$(".popup-quick-msg .toolbar-bottom .confirm").click(function(e){myApp.closeModal(".popup-quick-msg"),$("textarea.info").val(i)})}else if("quick-msg-management"===nowPage){t.canned_message_list.length<20&&$(".toolbar-bottom.add-msg").css("display","block");var n=indexObj.template("templateQuickMsgList")(t);$$(".quick-msg-management-content .grid").append(n),(mgrid=$(".grid").masonry({itemSelector:".grid-item",columnWidth:".grid-sizer",percentPosition:!0})).masonry("layout"),$(".edit-msg").unbind("click"),$(".del-msg").unbind("click"),$(".edit-msg").click(function(e){var t=$(this).parents(".card").find(".card-content-inner");myApp.modal({title:stringObj.shop.quick_msg_context,text:'<textarea class="info resizable" placeholder="'+stringObj.text.context+"("+stringObj.text.max100+')" rows="7">'+t.find("textarea").val()+"</textarea>",buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.edit,onClick:function(){""===$.trim($(".info").val())?myApp.toast(stringObj.text.no_input_data,"",{}).show():$(".info").val().length>100?myApp.toast(stringObj.text.limit100,"",{}).show():branchObj.modifycannedmessage(t.attr("cmsg_serno"),"2",$(".info").val(),t)}}]})}),$(".del-msg").click(function(e){var t=$(this).parents(".card").find(".card-content-inner");myApp.modal({title:stringObj.text.warn,text:stringObj.text.check_delete,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text._delete,onClick:function(){branchObj.modifycannedmessage(t.attr("cmsg_serno"),"0","",t)}}]})})}}else"message-info"===nowPage?(myApp.closeModal(),myApp.modal({title:stringObj.text.warn,text:stringObj.text.no_quick_msg,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.to_set,onClick:function(){mainView.router.load({url:"quick-msg-management",reload:!0})}}]})):"quick-msg-management"===nowPage&&($(".toolbar-bottom.add-msg").css("display","block"),dataNull("templateQuickMsgListNull",stringObj.text.no_data,".quick-msg-management-content"));else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},modifycannedmessage:function(e,t,a,s){myApp.showIndicator();var r=indexObj._dataCookies(indexObj._storage.main)||{},i=indexObj._dataStorage(branchObj.storage.branchData)||{},n={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,sd_id:i.sd_id,modify_type:t,cmsg_serno:e,cmsg_content:a};indexObj._wcfget({url:branchObj.dataUrl.modifycannedmessage,para:n,success:function(e){if(indexObj.jsonUrlDecode(e),e.modifycannedmessageresult){var r=JSON.parse(JSON.stringify(e.modifycannedmessageresult));if("000000000"===r.message_no)switch(t){case"0":myApp.hideIndicator(),s.parents(".grid-item").removeClass("zoomIn"),s.parents(".grid-item").addClass("fast"),s.parents(".grid-item").addClass("zoomOut"),s.parents(".grid-item").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){s.parents(".grid-item").css("display","none"),mgrid.masonry("layout")}),myApp.toast(stringObj.text.delete_success,"",{}).show();break;case"1":"quick-msg-management"===nowPage?(myApp.hideIndicator(),myApp.toast(stringObj.text.add_success,"",{}).show(),mainView.router.load({url:"quick-msg-management",reload:!0})):"message-info"===nowPage&&localStorage.removeItem("save_msg");break;case"2":myApp.hideIndicator(),myApp.toast(stringObj.text.edit_success,"",{}).show();var i;i=a.match("\n")?a.replace(/\n/gi,"&nbsp;<br>"):a,s.html(i+'<textarea style="display:none;">'+a+"</textarea>"),mgrid.masonry("layout")}else"message-info"!==nowPage&&myApp.hideIndicator(),stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},quickMsgManagementInit:function(e){branchObj.querycannedmessagelist(),$(".navbar .center").html(stringObj.shop.quick_msg_management),$(".add-msg").click(function(e){myApp.modal({title:stringObj.shop.quick_msg_context,text:'<textarea class="info resizable" placeholder="'+stringObj.text.context+"("+stringObj.text.max100+')" rows="7"></textarea>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.add,onClick:function(){""===$.trim($(".info").val())?myApp.toast(stringObj.text.no_input_data,"",{}).show():$(".info").val().length>100?myApp.toast(stringObj.text.limit100,"",{}).show():branchObj.modifycannedmessage("","1",$(".info").val())}}]})})},shopDataConfigInit:function(e){$(".navbar .shop-data-config-center").html(stringObj.shop.shop_data_config)},updateshopdatapayment:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.updateshopdatapayment,para:e,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.updateshopdatapaymentresult){var t=JSON.parse(JSON.stringify(e.updateshopdatapaymentresult));"000000000"===t.message_no?myApp.toast(stringObj.text.set_success,"",{}).show():(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},paySettingInit:function(e){$(".navbar .pay-setting-center").html(stringObj.shop.pay_setting),$(".pay-setting-left").click(function(){window.history.back()});var t=indexObj._dataStorage(branchObj.storage.branchData)||{};branchObj.branchInfoGet(t.sd_id,"")},queryorderlist:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.queryorderlist,para:e,success:function(t){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(t),t.queryorderlistresult){var a=JSON.parse(JSON.stringify(t.queryorderlistresult));if("000000000"===a.message_no)if(a.order_list.length>0){$(".pagination").css("display","block"),$(".pagination-content").css("visibility","visible"),$(".pagination-content .sum-pages").html(Math.ceil(parseInt(a.totalcount)/10));for(var s=[],r=1;r<Math.ceil(parseInt(a.totalcount)/10)+1;r++)s.push(r);if(Math.ceil(parseInt(a.totalcount)/10)>1&&$(".pagination-content .next-page").css("visibility","visible"),1===e.data_pagination&&($(".pagination-content .previous-page").css("visibility","hidden"),$(".pagination-content .now-page").val(1)),e.data_pagination===Math.ceil(parseInt(a.totalcount)/10)&&$(".pagination-content .next-page").css("visibility","hidden"),0===order_totalcount)if(order_totalcount=parseInt(a.totalcount),order_swiper&&(order_swiper.removeAllSlides(),order_swiper.destroy(!1,!0)),order_swiper=new Swiper(".swiper-container",{onSlideChangeStart:function(t){e.data_pagination=t.activeIndex+1,$(".pagination-content .now-page").val(e.data_pagination),1===e.data_pagination?$(".pagination-content .previous-page").css("visibility","hidden"):$(".pagination-content .previous-page").css("visibility","visible"),e.data_pagination===Math.ceil(parseInt(a.totalcount)/10)?$(".pagination-content .next-page").css("visibility","hidden"):$(".pagination-content .next-page").css("visibility","visible"),branchObj.queryorderlist(e)}}),$(".pagination-content .previous-page").unbind("click"),$(".pagination-content .previous-page").click(function(e){order_swiper.slidePrev(!0,300)}),$(".pagination-content .next-page").unbind("click"),$(".pagination-content .next-page").click(function(e){order_swiper.slideNext(!0,300)}),"coupon-order-forms"===nowPage)for(r=0;r<Math.ceil(parseInt(a.totalcount)/10);r++)order_swiper.appendSlide('<div class="swiper-slide swiper-slide-'+(parseInt(r)+1)+'"><div class="data-table card"><table><thead><tr><th class="label-cell">訂單編號</th><th class="label-cell">收件人</th><th class="label-cell">訂單狀態</th></tr></thead><tbody></tbody></table></div></div>');else if("order-forms"===nowPage)for(r=0;r<Math.ceil(parseInt(a.totalcount)/10);r++)order_swiper.appendSlide('<div class="swiper-slide swiper-slide-'+(parseInt(r)+1)+'"><div class="data-table card"><table><thead><tr><th class="label-cell">訂單編號</th><th class="label-cell">收件人</th><th class="label-cell">訂單狀態</th><th class="label-cell"></th></tr></thead><tbody></tbody></table></div></div>');for(var r in a.order_list)switch(browser_width<992?a.order_list[r].show_scg_id="..."+a.order_list[r].scg_id.substr(a.order_list[r].scg_id.length-5,a.order_list[r].scg_id.length):a.order_list[r].show_scg_id=a.order_list[r].scg_id,a.order_list[r]._scg_usestatus=stringObj.shop.scg_usestatus_array[parseInt(a.order_list[r].scg_usestatus)],a.order_list[r].scg_usestatus){case"5":a.order_list[r].report_btn_text=stringObj.shop.print_order,a.order_list[r].color="midnightblue";break;case"6":a.order_list[r].report_btn_text=stringObj.shop.pick_order,a.order_list[r].color="saddlebrown";break;case"7":a.order_list[r].report_btn_text=stringObj.shop.sent_order,a.order_list[r].color="darkgreen";break;case"8":default:a.order_list[r].report_btn_text=""}if("coupon-order-forms"===nowPage)i=indexObj.template("templateCouponOrderFormsItems");else if("order-forms"===nowPage)var i=indexObj.template("templateOrderFormsItems");var n=i(a);$$(".swiper-container .swiper-slide-"+(parseInt(order_swiper.activeIndex)+1)+" .data-table table tbody").html(n),now_page_picker&&now_page_picker.destroy(),now_page_picker=myApp.picker({input:".now-page",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.chose_page+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(t){e.data_pagination&&t.setValue([e.data_pagination])},onClose:function(t){e.data_pagination=t.cols[0].value,order_swiper.slideTo(t.cols[0].value-1,300,!0)},cols:[{textAlign:"center",values:s,onChange:function(e,t){}}]}),$(".swiper-container .data-table table tbody tr .label-cell").click(function(e){mainView.router.load({url:"order-form-info?scg_id="+$(this).parents("tr").attr("scg_id")+"&from="+nowPage})}),$(".swiper-container .data-table table tbody tr .report").click(function(e){var t=$(this).attr("scl_id");switch($(this).attr("scg_usestatus")){case"5":void 0!==Cookies.get("app_version")?myApp.alert(stringObj.shop.pc_print,stringObj.text.warn):branchObj.printdeliverorder([t]);break;case"6":branchObj.querysclid(t);break;case"7":myApp.modal({title:stringObj.shop.report_sentlogistics,text:'<input class="scl_tracenum" type="text" placeholder="'+stringObj.shop.scl_tracenum+'" style="padding: 2%;font-size: 1.2em;width: 96%;">',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){branchObj.reportsentlogistics(t,$(".scl_tracenum").val())}}]});break;case"8":branchObj.reportcargoarrive(t)}})}else $(".pagination").css("display","none"),(order_swiper=new Swiper(".swiper-container",{})).removeAllSlides(),order_swiper.appendSlide('<div class="swiper-slide"><div class="content-null"><h1><i class="fa fa-file-text-o"></i></h1><br><h3>'+stringObj.text.search_null+"</h3></div></div>"),order_swiper.destroy(!1,!0);else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},orderFormManagementInit:function(e){e.query;$(".navbar .order-form-management-center").html(stringObj.shop.order_form_management),$(".all-print").click(function(e){void 0!==Cookies.get("app_version")?myApp.alert(stringObj.shop.pc_print,stringObj.text.warn):branchObj.printdeliverorder([])}),$(".item-title.report").click(function(e){void 0!==Cookies.get("app_version")?scan("report"):myApp.modal({title:stringObj.shop.pick_report,text:'<input class="scl_id" type="text" placeholder="'+stringObj.shop._scl_id+'" style="padding: 2%;font-size: 1.2em;width: 96%;">',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){branchObj.querysclid($(".scl_id").val())}}]})})},querysclid:function(e,t){myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,scl_id:e};indexObj._wcfget({url:branchObj.dataUrl.querysclid,para:s,success:function(t){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(t),t.querysclidresult){var a=JSON.parse(JSON.stringify(t.querysclidresult));"000000000"===a.message_no?"6"===a.scg_usestatus?mainView.router.load({url:"pick-report?scl_id="+e+"&scm_id="+a.scm_id}):myApp.toast(stringObj.shop.picked_order,"",{}).show():(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},printdeliverorder:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage(branchObj.storage.branchData)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,scl_id_array:JSON.stringify(e)};indexObj._wcfget({url:branchObj.dataUrl.printdeliverorder,para:s,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.printdeliverorderresult){var t=JSON.parse(JSON.stringify(e.printdeliverorderresult));"000000000"===t.message_no?(indexObj._dataStorage("printdeliverorder",t.deliverorder_array),window.open("http://"+stringObj.WEB_URL+"/print-order-form","_blank")):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},reportcargopack:function(e,t){myApp.showIndicator(),t.match(branchObj.dataUrl.FTP_TEMPPRARY_PATH)&&(t=t.substring(branchObj.dataUrl.FTP_TEMPPRARY_PATH.length));var a=indexObj._dataCookies(indexObj._storage.main)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,scl_id:e,scl_cargopack_pic:t};indexObj._wcfget({url:branchObj.dataUrl.reportcargopack,para:s,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.reportcargopackresult){var a=JSON.parse(JSON.stringify(e.reportcargopackresult));if("000000000"===a.message_no){if(localStorage.removeItem("report_img"),myApp.toast(stringObj.shop.report_success,"",{}).show(),order_totalcount=0,mainView.router.load({url:"order-forms"}),isMobile.Android())webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,t,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary","");else if(isMobile.iOS()){var s=[];s.push(t),webview.renameFileToMove(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,s,branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary",[])}}else stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},reportsentlogistics:function(e,t){myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,scl_id:e,scl_tracenum:t};indexObj._wcfget({url:branchObj.dataUrl.reportsentlogistics,para:s,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.reportsentlogisticsresult){var t=JSON.parse(JSON.stringify(e.reportsentlogisticsresult));"000000000"===t.message_no?(myApp.toast(stringObj.shop.report_success,"",{}).show(),order_totalcount=0,mainView.router.load({url:"order-forms"})):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},reportcargoarrive:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,scl_id:e};indexObj._wcfget({url:branchObj.dataUrl.reportcargoarrive,para:a,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.reportcargoarriveresult){var t=JSON.parse(JSON.stringify(e.reportcargoarriveresult));"000000000"===t.message_no||(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator()}})},couponOrderFormsInit:function(e){e.query;$(".navbar .coupon-order-forms-center").html(stringObj.shop.coupon_order_forms),$(".coupon-order-forms-left").click(function(e){order_totalcount=0});var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage(branchObj.storage.branchData)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,scm_producttype:"1",scm_id:"",create_date_start:"",create_date_end:"",scg_usestatus:"",data_pagination:1,start_scg_id:"",queryamount:10};$(".scg_usestatus").val(stringObj.shop.scg_usestatus_array[0]);myApp.picker({input:".scg_usestatus",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.scg_usestatus+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){},onClose:function(e){},cols:[{textAlign:"center",values:[0,1,2,3,4,5,10,11],displayValues:stringObj.shop.coupon_scg_usestatus_array,onChange:function(e,t){"0"===e.cols[0].value?s.scg_usestatus="":s.scg_usestatus=e.cols[0].value}}]});branchObj.queryorderlist(s),$(".search-btn").click(function(e){order_totalcount=0,s.data_pagination=1,branchObj.queryorderlist(s)})},orderFormsInit:function(e){e.query;$(".navbar .order-forms-center").html(stringObj.shop.order_forms),$(".order-forms-left").click(function(e){order_totalcount=0});var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage(branchObj.storage.branchData)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,scm_producttype:"2",scm_id:"",create_date_start:"",create_date_end:"",scg_usestatus:"",data_pagination:1,start_scg_id:"",queryamount:10};$(".scg_usestatus").val(stringObj.shop.scg_usestatus_array[0]);myApp.picker({input:".scg_usestatus",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.scg_usestatus+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){},cols:[{textAlign:"center",values:[0,1,2,3,4,5,6,7,8,9,10,11],displayValues:stringObj.shop.scg_usestatus_array,onChange:function(e,t){"0"===e.cols[0].value?s.scg_usestatus="":s.scg_usestatus=e.cols[0].value}}]});branchObj.queryorderlist(s),$(".search-btn").click(function(e){order_totalcount=0,s.data_pagination=1,branchObj.queryorderlist(s)})},shopsalesoverview:function(e){e.query;for(var t=indexObj._dataCookies(indexObj._storage.main)||{},a=indexObj._dataStorage(branchObj.storage.branchData)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:a.sd_id,query_start:"",query_end:"",scm_producttype:1,queryamount:10},r=new Date,i=r.getMonth()+1,n=r.getYear()+1900,o=[],c=[],l=[],d=[],p=0;p<3;p++)i<1?(n-=1,o.push(12),l.push(n),c.push(getDaysOfMonth(i,n))):(o.push(i<10?"0"+i:i),l.push(n),c.push(getDaysOfMonth(i,n))),i-=1;d.push(l[0]+"-"+o[0]+"-"+c[0]),d.push(l[0]+"-"+o[0]+"-15"),d.push(l[1]+"-"+o[1]+"-"+c[1]),d.push(l[1]+"-"+o[1]+"-15"),d.push(l[2]+"-"+o[2]+"-"+c[2]),d.push(l[2]+"-"+o[2]+"-15");myApp.picker({input:".select-date",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">帳務結算日</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onClose:function(e){var t=e.cols[0].value;$("input[name=date]").val(t)},cols:[{width:"100%",textAlign:"center",values:d,onChange:function(e,t){}}]});$(".search-btn").click(function(e){var t=$("input[name=date]").val(),a=t.split("-");15==a[2]?(s.query_start=a[0]+"-"+a[1]+"-01",s.query_end=t):(s.query_start=a[0]+"-"+a[1]+"-16",s.query_end=t),branchObj.queryshopsalesoverview(s)})},queryshopsalesoverview:function(e){myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.queryshopsalesoverview,para:e,success:function(t){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(t),t.queryshopsalesoverviewresult){var a=JSON.parse(JSON.stringify(t.queryshopsalesoverviewresult));if("000000000"===a.message_no){var s=indexObj.template("templateSalesOverview")(a);$$(".shop-sales-overview-tab .shop-sales-overview-block").html(s);for(var r=0;r<$(".money").length;r++)$(".money").eq(r).text(thousandComma($(".money").eq(r).text()));indexObj._dataStorage("shop_report_data",e),$(".href").on("click",function(){var e=indexObj._dataStorage(branchObj.storage.shop_report_data)||{};2==$(this).data("usestatus")?(e.usestatus=!0,indexObj._dataStorage("shop_report_data",e)):(e.usestatus=!1,indexObj._dataStorage("shop_report_data",e))})}}},error:function(e){myApp.hideIndicator()}})},queryordercontent:function(e){myApp.showIndicator();var t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,scg_id:e};indexObj._wcfget({url:branchObj.dataUrl.queryordercontent,para:a,success:function(e){if(myApp.hideIndicator(),indexObj.jsonUrlDecode(e),e.queryordercontentresult){var t=JSON.parse(JSON.stringify(e.queryordercontentresult));if("000000000"===t.message_no){t.scm_mainpic=stringObj.text.branch_img_path+t.scm_mainpic,t.scl_cargopack_pic&&(t.scl_cargopack_pic=stringObj.text.branch_img_path+t.scl_cargopack_pic),t.scg_price=parseFloat(t.scm_price)*parseInt(t.scg_buyamount),"1"===t.scm_producttype&&(t.isCoupon=!0);var a=indexObj.template("templateOrderFormInfo")(t);if($$(".order-form-info-content .order-form-info-block").html(a),myApp.initImagesLazyLoad(".page-content"),"2"===t.scm_producttype){switch(t.scg_usestatus){case"5":$(".toolbar.toolbar-bottom").css("display","block"),$(".toolbar.toolbar-bottom a").html(stringObj.shop.print_order);break;case"6":$(".toolbar.toolbar-bottom").css("display","block"),$(".toolbar.toolbar-bottom a").html(stringObj.shop.pick_order);break;case"7":$(".toolbar.toolbar-bottom").css("display","block"),$(".toolbar.toolbar-bottom a").html(stringObj.shop.sent_order);break;case"8":case"9":$(".toolbar.toolbar-bottom").css("display","block"),$(".toolbar.toolbar-bottom a").html(stringObj.shop.print_order)}$(".toolbar-bottom").unbind("click"),$(".toolbar-bottom").click(function(e){switch(t.scg_usestatus){case"5":void 0!==Cookies.get("app_version")?myApp.alert(stringObj.shop.pc_print,stringObj.text.warn):branchObj.printdeliverorder([t.scl_id]);break;case"6":branchObj.querysclid(t.scl_id);break;case"7":myApp.modal({title:stringObj.shop.report_sentlogistics,text:'<input class="scl_tracenum" type="text" placeholder="'+stringObj.shop.scl_tracenum+'" style="padding: 2%;font-size: 1.2em;width: 96%;">',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){branchObj.reportsentlogistics(t.scl_id,$(".scl_tracenum").val())}}]});break;default:void 0!==Cookies.get("app_version")?myApp.alert(stringObj.shop.pc_print,stringObj.text.warn):branchObj.printdeliverorder([t.scl_id])}})}}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator()}})},orderFormInfoInit:function(e){var t=e.query;"order-forms"===t.from?$(".navbar .order-form-info-center").html(stringObj.shop.order_form_info):"coupon-order-forms"===t.from&&$(".navbar .order-form-info-center").html(stringObj.shop.coupon_order_form_info),$(".order-form-info-left").click(function(){window.history.back()}),branchObj.queryordercontent(t.scg_id)},pickReportInit:function(e){var t=e.query;$(".navbar .pick-report-center").html(stringObj.shop.pick_report),$(".pick-report-left").click(function(){localStorage.removeItem("report_img"),window.history.back()}),localStorage.getItem("report_img")&&($(".image-block img").attr("data-src",stringObj.text.branch_img_path+localStorage.getItem("report_img")),myApp.initImagesLazyLoad(".page-content")),$(".image-block").click(function(e){var a=indexObj._dataStorage(branchObj.storage.branchData)||{};isMobile.Android()||isMobile.iOS()?(now_scm_id=t.scm_id,now_scl_id=t.scl_id,addImage("report","")):setImgOnPC("sd_id="+a.sd_id+"&folder=shopcoupon&type=report&position=add&scl_id="+t.scl_id+"&scm_id="+t.scm_id,"")}),$(".report-img").click(function(e){localStorage.getItem("report_img")?branchObj.reportcargopack(t.scl_id,localStorage.getItem("report_img")):myApp.toast(stringObj.shop.no_image,"",{}).show()})},query_member_car_list:function(){var e=indexObj._dataCookies(indexObj._storage.main)||{},t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:e.sat};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.query_member_car_list,para:t,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.query_member_car_listresult){var t=JSON.parse(JSON.stringify(e.query_member_car_listresult));if("000000000"===t.message_no){var a="";for(var s in t.owncar_list)t.owncar_list[s].mocp_picpath?t.owncar_list[s].mocp_picpath=stringObj.text.mycar_img_path+t.owncar_list[s].mocp_picpath:t.owncar_list[s].mocp_picpath="app/image/imgDefault.png",a+='<li><label class="label-radio item-content"><input type="radio" name="cars" value="'+t.owncar_list[s].moc_id+'"><div class="item-media"><img src="'+t.owncar_list[s].mocp_picpath+'" width="120" onerror=\'this.src="app/image/imgDefault.png"\'></div><div class="item-inner"><div class="item-text">'+t.owncar_list[s].cbl_fullname+" "+t.owncar_list[s].cbm_fullname+" "+t.owncar_list[s].cms_fullname+"</div></div></label></li>";var r='<div class="popup popup-cars"><div class="content-block"><div class="title">'+stringObj.shop.check_cars+'</div><div class="cars-content"><div class="list-block"><ul>'+a+'</ul></div></div></div><div class="toolbar toolbar-bottom tabbar animated fadeInUp"><div class="toolbar-inner"><a href="#" class="confirm">'+stringObj.text.confirm+"</a></div></div></div>";myApp.popup(r),$(".popup-shop-items").css("z-index","91000"),$(".item-text").ellipsis({row:2}),$(".cars-content ul li input").eq(0).attr("checked",'"checked"'),$(".popup-cars .toolbar-bottom .confirm").click(function(e){myApp.closeModal(".popup-cars"),$(".scg_cartype").val($("input[name=cars]:checked").parents(".item-content").find(".item-inner .item-text").text()),$(".scg_cartype").attr("moc_id",$("input[name=cars]:checked").val())})}else"000000003"===t.message_no?myApp.modal({title:stringObj.text.warn,text:"無車輛資訊，可至 <b>會員選單 - 我的資訊 - 車友車庫</b> 新增車輛資訊",buttons:[{text:stringObj.text.confirm,onClick:function(){}}]}):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},query_member_car_detail:function(e){var t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),moc_id:e};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.query_member_car_detail,para:t,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.query_member_car_detailresult){var t=JSON.parse(JSON.stringify(e.query_member_car_detailresult));if("000000000"===t.message_no){var a=indexObj._dataStorage("scm_item")||{},s=indexObj._dataStorage("reservationinfo");findArrayItem(s.reservelist,"scm_id",a.scm_id);var r='<div class="popup popup-reserve"><div class="page-content"><div class="title">'+a.scm_title+'</div><div class="image-blcok"><img src="'+stringObj.text.branch_img_path+a.scm_mainpic+'" class="main-img" onerror=\'this.src="app/image/imgDefault.png"\'/></div><div class="reserve-info-content"><div class="subtitle">'+stringObj.text.description_context+'</div><div class="context">'+a.scm_fulldescript+'</div><div class="subtitle">'+stringObj.text.user_info+'</div><div class="context" style="display: inline-flex;"><div class="item-title">'+stringObj.text.reservationTime+'：</div><div class="scr_rvtime">'+s.reservationdate+" "+s.reservelist[nowIndex].scr_rvtime+'</div></div><br><div class="context" style="display: inline-flex;"><div class="item-title">'+stringObj.text.remark+'：</div><div class="scg_buyermessage">'+s.reservelist[nowIndex].scg_buyermessage+'</div></div><br><div class="context" style="display: inline-flex;"><div class="item-title">'+stringObj.my_car.car_style+'：</div><div class="car_type">'+t.cbl_fullname+" "+t.cbm_fullname+" "+t.cms_fullname+'</div></div><br><div class="context" style="display: inline-flex;"><div class="item-title">'+stringObj.my_car.car_yearstyle+'：</div><div class="ci_car_year_style">'+t.ci_car_year_style+'</div></div><br><div class="context" style="display: inline-flex;"><div class="item-title">'+stringObj.my_car.moc_carbodycolor+'：</div><div class="moc_carbodycolor">'+t.moc_carbodycolor+'</div></div></div></div><div class="toolbar toolbar-bottom tabbar animated fadeInUp"><div class="toolbar-inner"><a href="#" class="confirm">'+stringObj.text.confirm+"</a></div></div></div>";myApp.popup(r),$(".popup-reserve").css("z-index","91000"),$(".toolbar .confirm").click(function(){myApp.closeModal(".popup-reserve")})}else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},shopBuyDataInit:function(e){var t=e.query;$(".navbar .shop-buy-data-center").html(stringObj.shop.shop_buy_data),$(".shop-buy-data-left").click(function(){window.history.back()}),branchObj.query_advancedata(t.from);var a=indexObj._dataStorage("shop_item")||{};$(".scg_buyamount").change(function(){parseInt($(this).val())>parseInt(a.inventory)&&$(this).val(a.inventory),parseInt($(this).val())<1&&$(this).val(1),$(".scl_sum").html(parseInt(a.scm_price)*parseInt($(this).val()))}),$(".scg_buyamount").keyup(function(){parseInt($(this).val())>parseInt(a.inventory)&&$(this).val(a.inventory),parseInt($(this).val())<1&&$(this).val(1),$(".scl_sum").html(parseInt(a.scm_price)*parseInt($(this).val()))}),"1"===a.scm_coupon_providetype?$(".scg_bonus-block").css("display","initial"):($(".scm_price-block").css("display","initial"),$(".scl_sum-block").css("display","initial"),$(".invoice_code-block").css("display","initial"),"true"===a.PayGiftpointAsCash&&branchObj.querymembercoininfo());var s={};s.invoice_type=1;myApp.picker({input:".invoice_type",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.invoice_type+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]},onOpen:function(e){},onClose:function(e){s.invoice_type=e.cols[0].activeIndex+1},cols:[{width:"100%",textAlign:"center",values:stringObj.shop.invoice_type_array,onChange:function(e,t){1===e.cols[0].activeIndex?($(".tax_title-block").css("display","block"),$(".tax_id-block").css("display","block")):($(".tax_title-block").css("display","none"),$(".tax_id-block").css("display","none"))}}]});$(".scg_cartype").click(function(e){branchObj.query_member_car_list()}),$(".next").unbind("click"),$(".next").click(function(e){$(".scg_buyername-block").removeClass("lengthError"),$(".scg_buyermobile-block").removeClass("lengthError"),$(".scg_buyerphone-block").removeClass("lengthError"),$(".scg_buyeremail-block").removeClass("lengthError"),$(".tax_id-block").removeClass("lengthError"),$(".scg_buyeremail-block").removeClass("formatError"),$(".tax_id-block").removeClass("formatError"),$(".scg_buyamount-block").removeClass("spacesError"),$(".scg_buyername-block").removeClass("spacesError"),$(".scg_buyermobile-block").removeClass("spacesError"),$(".scg_buyerphone-block").removeClass("spacesError"),$(".discount-block").removeClass("spacesError"),$(".scg_buyamount-block").removeClass("nullError"),$(".scg_buyername-block").removeClass("nullError"),$(".scg_buyermobile-block").removeClass("nullError"),$(".scg_buyeremail-block").removeClass("nullError"),$(".discount-block").removeClass("nullError"),$(".tax_title-block").removeClass("nullError"),$(".tax_id-block").removeClass("nullError"),$(".send_addr-block").removeClass("nullError");var r=!1;if(-1==$(".scg_buyeremail").val().search(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i)&&""!==$.trim($(".scg_buyeremail").val())&&($(".scg_buyeremail-block").addClass("formatError"),r=!0),"1"!==a.scm_coupon_providetype&&2===s.invoice_type)switch(chkTaxId($.trim($(".tax_id").val()))){case"lengthError":$(".tax_id-block").addClass("lengthError"),r=!0;break;case"formatError":$(".tax_id-block").addClass("formatError"),r=!0}if($(".scg_buyername").val().length>30&&($(".scg_buyername-block").addClass("lengthError"),r=!0),$(".scg_buyermobile").val().length>10&&($(".scg_buyermobile-block").addClass("lengthError"),r=!0),$(".scg_buyerphone").val().length>20&&($(".scg_buyerphone-block").addClass("lengthError"),r=!0),$(".scg_buyeremail").val().length>100&&($(".scg_buyeremail-block").addClass("lengthError"),r=!0),-1!==$(".scg_buyername").val().indexOf(" ")&&($(".scg_buyername-block").addClass("spacesError"),r=!0),-1!==$(".scg_buyermobile").val().indexOf(" ")&&($(".scg_buyermobile-block").addClass("spacesError"),r=!0),-1!==$(".scg_buyerphone").val().indexOf(" ")&&($(".scg_buyerphone-block").addClass("spacesError"),r=!0),-1!==$(".scg_buyamount").val().indexOf(" ")&&($(".scg_buyamount-block").addClass("spacesError"),r=!0),-1!==$(".discount").val().indexOf(" ")&&($(".discount-block").addClass("spacesError"),r=!0),""===$.trim($(".scg_buyername").val())&&($(".scg_buyername-block").addClass("nullError"),r=!0),""===$.trim($(".scg_buyermobile").val())&&($(".scg_buyermobile-block").addClass("nullError"),r=!0),""===$.trim($(".scg_buyeremail").val())&&($(".scg_buyeremail-block").addClass("nullError"),r=!0),""===$.trim($(".scg_buyamount").val())&&($(".scg_buyamount-block").addClass("nullError"),r=!0),"1"!==a.scm_coupon_providetype&&(2===s.invoice_type&&(""===$.trim($(".tax_title").val())&&($(".tax_title-block").addClass("nullError"),r=!0),""===$.trim($(".tax_id").val())&&($(".tax_id-block").addClass("nullError"),r=!0)),""===$.trim($(".send_addr").val())&&($(".send_addr-block").addClass("nullError"),r=!0)),!r)switch(a=indexObj._dataStorage("shop_item")||{},s.scm_id=t.scm_id,s.scl_amount=$(".scl_amount").val(),s.scg_buyamount=$(".scg_buyamount").val(),s.scl_sum=parseInt(a.scm_price)*parseInt($(".scg_buyamount").val()),s.scg_bonus=$(".scg_bonus").val(),s.scg_buyername=$(".scg_buyername").val(),s.scg_buyermobile=$(".scg_buyermobile").val(),s.scg_buyerphone=$(".scg_buyerphone").val(),s.scg_buyeremail=$(".scg_buyeremail").val(),s.scg_buyermessage=$(".scg_buyermessage").val(),s.tax_title=$(".tax_title").val(),s.identifier=$(".tax_id").val(),s.send_addr=$(".send_addr").val(),s.scg_paymentstatus=0,s.scg_gp_subtract_amount=50*parseInt($(".discount").val()),s.scg_subtract_price=$(".discount").val(),s.moc_id=$(".scg_cartype").attr("moc_id"),""===$.trim($(".tax_title").val())&&(s.tax_title=""),indexObj._dataStorage("shop_buy_data",s),t.from){case"coupon":mainView.router.load({url:"pay-info?scm_id="+t.scm_id+"&from=coupon"});break;case"reservation":mainView.router.load({url:"shop/shopcoupon-reservation?scm_id="+t.scm_id+"&booktype=0"});break;case"commodity":mainView.router.load({url:"shop-logistics?scm_id="+t.scm_id})}})},shopLogisticsInit:function(e){var t=e.query;$(".navbar .shop-logistics-center").html(stringObj.shop.shop_logistics),$(".shop-logistics-left").click(function(){window.history.back()}),branchObj.query_advancedata(t.from);var a=indexObj._dataCookies(indexObj._storage.main)||{},s={modacc:stringObj.blogMenu.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat};s.scl_delivery_time=1,myApp.picker({input:".scl_delivery_time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.scl_delivery_time+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]},onOpen:function(e){},onClose:function(e){s.scl_delivery_time=e.cols[0].activeIndex+1},cols:[{width:"100%",textAlign:"center",values:stringObj.shop.scl_delivery_time_array}]}).setValue([stringObj.shop.scl_delivery_time_array[0]]);var r=stringObj.region;zipArray=r.臺北市[1];myApp.picker({input:".scl_country",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+"  "+t[1]},onOpen:function(e){""===mCounty&&""===mDistrict||e.setValue([mCounty,mDistrict])},onClose:function(e){s.scl_postcode=zipArray[regionIndex]},cols:[{textAlign:"center",width:140,values:stringObj.counties,onChange:function(e,t){s.scl_city=t,e.cols[1].replaceValues&&(e.cols[1].replaceValues(r[t][0]),zipArray=r[t][1])}},{textAlign:"center",values:r.臺北市[0],width:140,onChange:function(e,t){s.scl_district=t,regionIndex=e.cols[1].activeIndex}}]});$(".next-btn").unbind("click"),$(".next-btn").click(function(e){$(".scl_receivername-block").removeClass("lengthError"),$(".scl_receivermobile-block").removeClass("lengthError"),$(".scl_receiverphone-block").removeClass("lengthError"),$(".scl_email-block").removeClass("lengthError"),$(".scl_receiveaddress-block").removeClass("lengthError"),$(".scl_email-block").removeClass("formatError"),$(".scl_receivername-block").removeClass("spacesError"),$(".scl_receivermobile-block").removeClass("spacesError"),$(".scl_receiverphone-block").removeClass("spacesError"),$(".scl_receiveaddress-block").removeClass("spacesError"),$(".scl_receivername-block").removeClass("nullError"),$(".scl_receivermobile-block").removeClass("nullError"),$(".scl_receiveaddress-block").removeClass("nullError"),$(".scl_country-block").removeClass("nullError"),$(".scl_delivery_time-block").removeClass("nullError");var a=!1;-1==$(".scl_email").val().search(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i)&&""!==$.trim($(".scl_email").val())&&($(".scl_email-block").addClass("formatError"),a=!0),$(".scl_receivername").val().length>10&&($(".scl_receivername-block").addClass("lengthError"),a=!0),$(".scl_receivermobile").val().length>10&&($(".scl_receivermobile-block").addClass("lengthError"),a=!0),$(".scl_receiverphone").val().length>20&&($(".scl_receiverphone-block").addClass("lengthError"),a=!0),$(".scl_email").val().length>100&&($(".scl_email-block").addClass("lengthError"),a=!0),$(".scl_receiveaddress").val().length>100&&($(".scl_receiveaddress-block").addClass("lengthError"),a=!0),-1!==$(".scl_receivername").val().indexOf(" ")&&($(".scl_receivername-block").addClass("spacesError"),a=!0),-1!==$(".scl_receivermobile").val().indexOf(" ")&&($(".scl_receivermobile-block").addClass("spacesError"),a=!0),-1!==$(".scl_receiverphone").val().indexOf(" ")&&($(".scl_receiverphone-block").addClass("spacesError"),a=!0),-1!==$(".scl_receiveaddress").val().indexOf(" ")&&($(".scl_receiveaddress-block").addClass("spacesError"),a=!0),""===$.trim($(".scl_receivername").val())&&($(".scl_receivername-block").addClass("nullError"),a=!0),""===$.trim($(".scl_receivermobile").val())&&($(".scl_receivermobile-block").addClass("nullError"),a=!0),""===$.trim($(".scl_email").val())&&($(".scl_email-block").addClass("nullError"),a=!0),""===$.trim($(".scl_country").val())&&($(".scl_country-block").addClass("nullError"),a=!0),""===$.trim($(".scl_receiveaddress").val())&&($(".scl_receiveaddress-block").addClass("nullError"),a=!0),""===$.trim($(".scl_delivery_time").val())&&($(".scl_delivery_time-block").addClass("nullError"),a=!0),a||(void 0!==mCounty&&(s.scl_city=mCounty,s.scl_district=mDistrict,zipArray=r[mCounty][1],s.scl_postcode=zipArray[r[mCounty][0].indexOf(mDistrict)]),s.scl_amount=$(".scl_amount").val(),s.scl_sum=$(".scl_sum").val(),s.scl_receivername=$(".scl_receivername").val(),s.scl_receivermobile=$(".scl_receivermobile").val(),s.scl_receiverphone=$(".scl_receiverphone").val(),s.scl_email=$(".scl_email").val(),s.scl_receiveaddress=$(".scl_receiveaddress").val(),s.scg_paymentstatus=0,indexObj._dataStorage("logistics_data",s),mainView.router.load({url:"pay-info?scm_id="+t.scm_id+"&scg_id="+localStorage.getItem("scg_id")}))})},create_reservationpaused:function(e,t){var a=indexObj._dataStorage(branchObj.storage.branchData)||{},s=indexObj._dataCookies(indexObj._storage.main)||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,sd_id:a.sd_id,rp_start_datetime:e,rp_end_datetime:t};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.create_reservationpaused,para:r,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.create_reservationpausedresult){var t=JSON.parse(JSON.stringify(e.create_reservationpausedresult));"000000000"===t.message_no?(myApp.toast(stringObj.text.add_success,"",{}).show(),myApp.closeModal(".popup-service-paused"),branchObj.query_reservationpausedlist()):(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},delete_reservationpaused:function(e){var t=indexObj._dataStorage(branchObj.storage.branchData)||{},a=indexObj._dataCookies(indexObj._storage.main)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:t.sd_id,rp_serno:e};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.delete_reservationpaused,para:s,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.delete_reservationpausedresult){var t=JSON.parse(JSON.stringify(e.delete_reservationpausedresult));"000000000"===t.message_no?branchObj.query_reservationpausedlist():(stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},query_reservationpausedlist:function(){var e=indexObj._dataStorage(branchObj.storage.branchData)||{},t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:e.sd_id};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.query_reservationpausedlist,para:a,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.query_reservationpausedlistresult){var t=JSON.parse(JSON.stringify(e.query_reservationpausedlistresult));if("000000000"===t.message_no)if(t.reservationpaused_list.length>0){for(var a in t.reservationpaused_list)t.reservationpaused_list[a].rp_start_date=t.reservationpaused_list[a].rp_start_datetime.substring(0,10)+" ("+stringObj.text.dayNames[new Date(t.reservationpaused_list[a].rp_start_datetime.substring(0,10)).getDay()]+")",t.reservationpaused_list[a].rp_start_time=t.reservationpaused_list[a].rp_start_datetime.substring(11,16),t.reservationpaused_list[a].rp_end_date=t.reservationpaused_list[a].rp_end_datetime.substring(0,10)+" ("+stringObj.text.dayNames[new Date(t.reservationpaused_list[a].rp_end_datetime.substring(0,10)).getDay()]+")",t.reservationpaused_list[a].rp_end_time=t.reservationpaused_list[a].rp_end_datetime.substring(11,16);var s=indexObj.template("templateServicePausedList")(t);$$(".reservationpaused_list ul").html(s),$(".del").unbind("click"),$(".del").click(function(e){var t=$(this).attr("rp_serno");myApp.modal({title:stringObj.text.warn,text:stringObj.text.check_delete,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text._delete,onClick:function(){branchObj.delete_reservationpaused(t)}}]})})}else dataNull("templateServicePausedNull",stringObj.text.no_data,".reservationpaused_list ul");else stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},appointmentManagementInit:function(e){e.query;$(".navbar .appointment-management-center").html(stringObj.shop.appointment_management),branchObj.query_reservationpausedlist(),$(".add_service_paused").unbind("click"),$(".add_service_paused").click(function(e){myApp.popup(".popup-service-paused"),$(".toolbar .confirm").click(function(){myApp.closeModal(".popup-reserve")});var t,a,s,r;$$(".popup-service-paused").on("popup:opened",function(e,i){var n=new Date,o=new Date,c=n.getMonth()+1;c<10&&(c="0"+c);var l=n.getDate();l<10&&(l="0"+l);var d=n.getHours(),p=n.getMinutes();p<30?p="30":(p="00",23===d?d=0:d+=1),d<10&&(d="0"+d),$(".rp_start_date").val(n.getFullYear()+"-"+c+"-"+l+" ("+stringObj.text.dayNames[n.getDay()]+")"),$(".rp_end_date").val(n.getFullYear()+"-"+c+"-"+l+" ("+stringObj.text.dayNames[n.getDay()]+")"),$(".rp_start_time").val(d+":"+p),$(".rp_end_time").val(d+":"+p),t=myApp.calendar({input:".rp_start_date",dateFormat:"yyyy-mm-dd (D)",firstDay:0,monthNames:stringObj.text.monthNames,dayNamesShort:stringObj.text.dayNames,closeOnSelect:!0,onOpen:function(){$$(".picker-calendar-week-day-weekend").each(function(e,t){"六"==$$(t).text()&&$$(t).addClass("sat")}),$$(".picker-calendar-week-day-weekend").each(function(e,t){"日"==$$(t).text()&&$$(t).addClass("sun")})},onClose:function(){void 0!==s.cols[0]&&($(".rp_start_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l?s.cols[0].values=function(){for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}():s.cols[0].values=function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()),$(".rp_end_date").css("color","#666"),$(".rp_end_time").css("color","#000"),$(".rp_end_date").val($(".rp_start_date").val()),n=new Date($(".rp_start_date").val()),a=myApp.calendar({input:".rp_end_date",dateFormat:"yyyy-mm-dd (D)",firstDay:0,monthNames:stringObj.text.monthNames,dayNamesShort:stringObj.text.dayNames,closeOnSelect:!0,onOpen:function(){$$(".picker-calendar-week-day-weekend").each(function(e,t){"六"==$$(t).text()&&$$(t).addClass("sat")}),$$(".picker-calendar-week-day-weekend").each(function(e,t){"日"==$$(t).text()&&$$(t).addClass("sun")})},onClose:function(){void 0!==r.cols[0]&&($(".rp_end_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l?r.cols[0].values=function(){for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}():r.cols[0].values=function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}())},disabled:{from:new Date("1911/01/01"),to:new Date($(".rp_start_date").val()).setDate(n.getDate()-1)}}),r||(r=myApp.picker({input:".rp_end_time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">結束時間</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+":"+t[1]},onOpen:function(e){$(".rp_end_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l?(e.cols[0].values=function(){for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}(),parseInt(e.cols[0].value)===parseInt(d)&&"30"===p?e.cols[2].replaceValues&&($(".rp_end_time").val(d+":"+p),e.cols[2].replaceValues(["30"])):e.cols[2].replaceValues&&e.cols[2].replaceValues(["00","30"])):e.cols[0].values=function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},onClose:function(e){},cols:[{width:"45%",values:function(){for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}(),onChange:function(e,t,a){$(".rp_end_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l&&parseInt(e.cols[0].value)===parseInt(d)&&"30"===p?e.cols[2].replaceValues&&e.cols[2].replaceValues(["30"]):e.cols[2].replaceValues&&e.cols[2].replaceValues(["00","30"])}},{width:"10%",textAlign:"center",divider:!0,content:" : "},{width:"45%",textAlign:"left",values:["00","30"]}]}))},disabled:{from:new Date("1911/01/01"),to:(new Date).setDate(n.getDate()-1)}}),s=myApp.picker({input:".rp_start_time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">開始時間</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+":"+t[1]},onOpen:function(e){$(".rp_start_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l?(e.cols[0].values=function(){for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}(),parseInt(e.cols[0].value)===parseInt(d)&&"30"===p?e.cols[2].replaceValues&&($(".rp_start_time").val(d+":"+p),e.cols[2].replaceValues(["30"])):e.cols[2].replaceValues&&e.cols[2].replaceValues(["00","30"])):e.cols[0].values=function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},onClose:function(e){a&&r||($(".rp_end_date").css("color","#666"),$(".rp_end_time").css("color","#000"),n=new Date($(".rp_start_date").val()),a||(a=myApp.calendar({input:".rp_end_date",dateFormat:"yyyy-mm-dd (D)",firstDay:0,monthNames:stringObj.text.monthNames,dayNamesShort:stringObj.text.dayNames,closeOnSelect:!0,onOpen:function(){$$(".picker-calendar-week-day-weekend").each(function(e,t){"六"==$$(t).text()&&$$(t).addClass("sat")}),$$(".picker-calendar-week-day-weekend").each(function(e,t){"日"==$$(t).text()&&$$(t).addClass("sun")})},onClose:function(){void 0!==r.cols[0]&&($(".rp_end_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l?r.cols[0].values=function(){for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}():r.cols[0].values=function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}())},disabled:{from:new Date("1911/01/01"),to:new Date($(".rp_start_date").val()).setDate(n.getDate()-1)}})),r||(r=myApp.picker({input:".rp_end_time",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">結束時間</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+":"+t[1]},onOpen:function(e){$(".rp_end_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l?(e.cols[0].values=function(){for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}(),parseInt(e.cols[0].value)===parseInt(d)&&"30"===p?e.cols[2].replaceValues&&($(".rp_end_time").val(d+":"+p),e.cols[2].replaceValues(["30"])):e.cols[2].replaceValues&&e.cols[2].replaceValues(["00","30"])):e.cols[0].values=function(){for(var e=[],t=0;t<=23;t++)e.push(t<10?"0"+t:t);return e}()},onClose:function(e){},cols:[{width:"45%",values:function(){for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}(),onChange:function(e,t,a){$(".rp_end_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l&&parseInt(e.cols[0].value)===parseInt(d)&&"30"===p?e.cols[2].replaceValues&&e.cols[2].replaceValues(["30"]):e.cols[2].replaceValues&&e.cols[2].replaceValues(["00","30"])}},{width:"10%",textAlign:"center",divider:!0,content:" : "},{width:"45%",textAlign:"left",values:["00","30"]}]})))},cols:[{width:"45%",values:function(){new Date;for(var e=[],t=d;t<=23;t++)e.push(t<10?"0"+t:t);return e}(),onChange:function(e,t,a){$(".rp_start_date").val().substring(0,10)===o.getFullYear()+"-"+c+"-"+l&&parseInt(e.cols[0].value)===parseInt(d)&&"30"===p?e.cols[2].replaceValues&&e.cols[2].replaceValues(["30"]):e.cols[2].replaceValues&&e.cols[2].replaceValues(["00","30"])}},{width:"10%",textAlign:"center",divider:!0,content:" : "},{width:"45%",textAlign:"left",values:["00","30"]}]})}),$$(".popup-service-paused").on("popup:close",function(e,t){$(".rp_end_date").css("color","#ddd"),$(".rp_end_time").css("color","#ccc"),a&&a.destroy(),r&&r.destroy()}),$(".popup-service-paused .add_service_paused").unbind("click"),$(".popup-service-paused .add_service_paused").click(function(e){branchObj.create_reservationpaused($(".rp_start_date").val().substring(0,10)+" "+$(".rp_start_time").val(),$(".rp_end_date").val().substring(0,10)+" "+$(".rp_end_time").val())})})},query_shopsettlementrec_m_list:function(e){var t=indexObj._dataCookies(indexObj._storage.main)||{},a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,sd_id:e};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.query_shopsettlementrec_m_list,para:a,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.query_shopsettlementrec_m_listresult){var t=JSON.parse(JSON.stringify(e.query_shopsettlementrec_m_listresult));if("000000000"===t.message_no)if(t.shopsettlementrec_m_list.length>0){for(var a in t.shopsettlementrec_m_list)"0"===t.shopsettlementrec_m_list[a].ssrm_settlementpayment?t.shopsettlementrec_m_list[a].settlement_status=stringObj.shop.ssrm_settlementreview[parseInt(t.shopsettlementrec_m_list[a].ssrm_settlementreview)]:t.shopsettlementrec_m_list[a].settlement_status=stringObj.shop.ssrm_settlementpayment[parseInt(t.shopsettlementrec_m_list[a].ssrm_settlementpayment)];r=(s=indexObj.template("templateSettleAccounts"))(t);$$(".settle-accounts-list ul").html(r)}else{r=(s=indexObj.template("templateSettleAccountsNull"))("");$$(".settle-accounts-list ul").html(r)}else{var s=indexObj.template("templateSettleAccountsNull"),r=s("");$$(".settle-accounts-list ul").html(r),stringObj.return_header(t.message_no),_tip&&(myApp.alert(_tip+"( "+t.message_no+" )",stringObj.text.warn),_tip=null)}}},error:function(e){var t=indexObj.template("templateSettleAccountsNull")("");$$(".settle-accounts-list ul").html(t),myApp.hideIndicator(),noNetwork()}})},settleAccountsInit:function(e){var t=indexObj._dataStorage(branchObj.storage.branchData);branchObj.query_shopsettlementrec_m_list(t.sd_id)},update_settlementview:function(e,t,a){var s=indexObj._dataCookies(indexObj._storage.main)||{},r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:s.sat,sd_id:e,ssrm_id:t,settlementreview:a};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.update_settlementview,para:r,success:function(e){if(indexObj.jsonUrlDecode(e),myApp.hideIndicator(),e.update_settlementviewresult){var a=JSON.parse(JSON.stringify(e.update_settlementviewresult));"000000000"===a.message_no?(myApp.toast(stringObj.text.already_send,"",{}).show(),mainView.router.load({url:"settle-accounts-content?ssrm_id="+t,reload:!0})):(stringObj.return_header(a.message_no),_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null))}},error:function(e){myApp.hideIndicator(),noNetwork()}})},query_shopsettlementrec_m:function(e,t){var a=indexObj._dataCookies(indexObj._storage.main)||{},s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:e,ssrm_id:t};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.query_shopsettlementrec_m,para:s,success:function(a){if(indexObj.jsonUrlDecode(a),myApp.hideIndicator(),a.query_shopsettlementrec_mresult){var s=JSON.parse(JSON.stringify(a.query_shopsettlementrec_mresult));if("000000000"===s.message_no){if(s.shopsettlementrec_m){$(".toolbar .error").unbind("click"),$(".toolbar .error").click(function(a){myApp.modal({title:stringObj.shop.accounts_error,text:stringObj.shop.accounts_error_context,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){branchObj.update_settlementview(e,t,2)}}]})}),$(".toolbar .request").unbind("click"),$(".toolbar .request").click(function(a){myApp.modal({title:stringObj.shop.accounts_request,text:stringObj.shop.accounts_request_context,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){branchObj.update_settlementview(e,t,1)}}]}),$(".modal-text .price").html(s.shopsettlementrec_m.ssrm_settlementpayamount)}),"0"===s.shopsettlementrec_m.ssrm_settlementreview&&$(".toolbar").css("display","block"),"0"===s.shopsettlementrec_m.ssrm_settlementpayment?s.shopsettlementrec_m.settlement_status=stringObj.shop.ssrm_settlementreview[parseInt(s.shopsettlementrec_m.ssrm_settlementreview)]:s.shopsettlementrec_m.settlement_status=stringObj.shop.ssrm_settlementpayment[parseInt(s.shopsettlementrec_m.ssrm_settlementpayment)],s.shopsettlementrec_m.ssrm_totalplatformfee=(parseFloat(s.shopsettlementrec_m.ssrm_totaliscarplatformfee)+parseFloat(s.shopsettlementrec_m.ssrm_totalpaymentflowfee)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),s.shopsettlementrec_m.ssrm_totaltransatctioncount=s.shopsettlementrec_m.ssrm_totaltransatctioncount.replace(/\B(?=(\d{3})+(?!\d))/g,","),s.shopsettlementrec_m.salecount=s.shopsettlementrec_m.salecount.replace(/\B(?=(\d{3})+(?!\d))/g,","),s.shopsettlementrec_m.ssrm_salebypp=s.shopsettlementrec_m.ssrm_salebypp.replace(/\B(?=(\d{3})+(?!\d))/g,","),s.shopsettlementrec_m.ssrm_totalppconsume=s.shopsettlementrec_m.ssrm_totalppconsume.replace(/\B(?=(\d{3})+(?!\d))/g,","),s.shopsettlementrec_m.saleamount=s.shopsettlementrec_m.saleamount.replace(/\B(?=(\d{3})+(?!\d))/g,","),s.shopsettlementrec_m.ssrm_settlementpayamount=s.shopsettlementrec_m.ssrm_settlementpayamount.replace(/\B(?=(\d{3})+(?!\d))/g,","),indexObj._dataStorage("shopsettlementrec_m",{ssrm_billingcycle_start:s.shopsettlementrec_m.ssrm_billingcycle_start,ssrm_billingcycle_end:s.shopsettlementrec_m.ssrm_billingcycle_end,ssrm_totaltransatctioncount:s.shopsettlementrec_m.ssrm_totaltransatctioncount,ssrm_settlementpayamount:s.shopsettlementrec_m.ssrm_settlementpayamount});var r=indexObj.template("templateSettleAccountsContent")(s.shopsettlementrec_m);$$(".settle-accounts-content-block").html(r)}}else stringObj.return_header(s.message_no),_tip&&(myApp.alert(_tip+"( "+s.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},settleAccountsContentInit:function(e){var t=e.query,a=indexObj._dataStorage(branchObj.storage.branchData);branchObj.query_shopsettlementrec_m(a.sd_id,t.ssrm_id)},query_shopsettlementrec_d_list:function(e,t,a,s){var r=indexObj._dataCookies(indexObj._storage.main)||{},i={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,sd_id:e,ssrm_id:t,billingtype:a,data_pagination:s,queryamount:10};myApp.showIndicator(),indexObj._wcfget({url:branchObj.dataUrl.query_shopsettlementrec_d_list,para:i,success:function(s){if(indexObj.jsonUrlDecode(s),myApp.hideIndicator(),s.query_shopsettlementrec_d_listresult){var r=JSON.parse(JSON.stringify(s.query_shopsettlementrec_d_listresult));if("000000000"===r.message_no)if(r.query_shopsettlementrec_d_list.length>0){if(0===settle_accounts_totalcount){var n=indexObj._dataStorage("shopsettlementrec_m")||{},o=(l=indexObj.template("templateSettleAccountsTableBlock"))(n);if($$(".settle-accounts-table-content").html(o),$(".billingtype"+a).addClass("active"),$(".buttons-row a").unbind("click"),$(".buttons-row a").click(function(s){$(".buttons-row a").removeClass("active"),$(this).addClass("active"),settle_accounts_totalcount=0,a=$(this).attr("billingtype"),branchObj.query_shopsettlementrec_d_list(e,t,a,1)}),settle_accounts_totalcount=parseInt(r.totalcount),settle_accounts_swiper&&(settle_accounts_swiper.removeAllSlides(),settle_accounts_swiper.destroy(!1,!0)),settle_accounts_swiper=new Swiper(".swiper-container",{effect:"fade",onSlideChangeStart:function(s){i.data_pagination=s.activeIndex+1,$(".pagination-content .now-page").val(i.data_pagination),1===i.data_pagination?$(".pagination-content .previous-page").css("visibility","hidden"):$(".pagination-content .previous-page").css("visibility","visible"),i.data_pagination===Math.ceil(parseInt(r.totalcount)/10)?$(".pagination-content .next-page").css("visibility","hidden"):$(".pagination-content .next-page").css("visibility","visible"),branchObj.query_shopsettlementrec_d_list(e,t,a,i.data_pagination)}}),$(".pagination-content .previous-page").unbind("click"),$(".pagination-content .previous-page").click(function(e){settle_accounts_swiper.slidePrev(!0,300)}),$(".pagination-content .next-page").unbind("click"),$(".pagination-content .next-page").click(function(e){settle_accounts_swiper.slideNext(!0,300)}),"settle-accounts-table"===nowPage)if(1===parseInt(a))for(c=0;c<Math.ceil(parseInt(r.totalcount)/10);c++)settle_accounts_swiper.appendSlide('<div class="swiper-slide swiper-slide-'+(parseInt(c)+1)+'"><div class="data-table card"><table><thead><tr><th class="label-cell">訂單編號</th><th class="label-cell">交易時間</th><th class="numeric-cell">實收金額</th></tr></thead><tbody></tbody></table></div></div>');else if(3===parseInt(a))for(c=0;c<Math.ceil(parseInt(r.totalcount)/10);c++)settle_accounts_swiper.appendSlide('<div class="swiper-slide swiper-slide-'+(parseInt(c)+1)+'"><div class="data-table card"><table><thead><tr><th class="label-cell">訂單編號</th><th class="label-cell">交易時間</th><th class="numeric-cell">特點消費</th></tr></thead><tbody></tbody></table></div></div>')}for(var c in r.query_shopsettlementrec_d_list)r.query_shopsettlementrec_d_list[c].scg_id=r.query_shopsettlementrec_d_list[c].scg_id.substring(0,2)+"***"+r.query_shopsettlementrec_d_list[c].scg_id.substring(r.query_shopsettlementrec_d_list[c].scg_id.length-4,r.query_shopsettlementrec_d_list[c].scg_id.length);if(1===parseInt(a))l=indexObj.template("templateSettleAccountsTable1");else if(3===parseInt(a))var l=indexObj.template("templateSettleAccountsTable3");o=l(r);if($$(".swiper-container .swiper-slide-"+(parseInt(settle_accounts_swiper.activeIndex)+1)+" .data-table table tbody").html(o),r.query_shopsettlementrec_d_list.length<10)for(c=0;c<10-r.query_shopsettlementrec_d_list.length%10;c++)$(".swiper-container .swiper-slide-"+(parseInt(settle_accounts_swiper.activeIndex)+1)+" .data-table table tbody").append('<tr><th class="label-cell"></th><th class="label-cell"></th><th class="numeric-cell"></th></tr>');$(".pagination").css("display","block"),$(".pagination-content").css("visibility","visible"),$(".pagination-content .sum-pages").html(Math.ceil(parseInt(r.totalcount)/10));for(var d=[],c=1;c<Math.ceil(parseInt(r.totalcount)/10)+1;c++)d.push(c);Math.ceil(parseInt(r.totalcount)/10)>1&&$(".pagination-content .next-page").css("visibility","visible"),1===i.data_pagination&&($(".pagination-content .previous-page").css("visibility","hidden"),$(".pagination-content .now-page").val(1)),i.data_pagination===Math.ceil(parseInt(r.totalcount)/10)&&$(".pagination-content .next-page").css("visibility","hidden"),settle_accounts_picker&&settle_accounts_picker.destroy(),settle_accounts_picker=myApp.picker({input:".now-page",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"><i class="fa fa-check noUse" aria-hidden="true"></i></a></div><div class="center">'+stringObj.shop.chose_page+'</div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return a[0]},onOpen:function(e){i.data_pagination&&e.setValue([i.data_pagination])},onClose:function(e){i.data_pagination=e.cols[0].value,settle_accounts_swiper.slideTo(e.cols[0].value-1,300,!0)},cols:[{width:"100%",textAlign:"center",values:d,onChange:function(e,t){}}]})}else $(".pagination").css("display","none"),(settle_accounts_swiper=new Swiper(".swiper-container",{})).removeAllSlides(),settle_accounts_swiper.appendSlide('<div class="swiper-slide"><div class="content-null"><h1><i class="fa fa-file-text-o"></i></h1><br><h3>'+stringObj.text.search_null+"</h3></div></div>"),settle_accounts_swiper.destroy(!1,!0);else stringObj.return_header(r.message_no),_tip&&(myApp.alert(_tip+"( "+r.message_no+" )",stringObj.text.warn),_tip=null)}},error:function(e){myApp.hideIndicator(),noNetwork()}})},settleAccountsTableInit:function(e){var t=e.query;billingtype=1,$(".settle-accounts-table-left").click(function(e){mainView.router.load({url:"settle-accounts-content?ssrm_id="+t.ssrm_id,reload:!0})});var a=indexObj._dataStorage(branchObj.storage.branchData);branchObj.query_shopsettlementrec_d_list(a.sd_id,t.ssrm_id,billingtype,1)}};paySuccess=function(e){myApp.showIndicator(),"00"===(e=JSON.parse(e)).errcode?mainView.router.load({url:"pay-success"}):(myApp.hideIndicator(),myApp.alert(e.errmsg,stringObj.text.warn))},input_limit=function(e,t){var a=t;e.value.length>a&&(e.value=e.value.substr(0,a))},templeDonate=function(e){mainView.router.load({url:"pay-info?type=templeDonate&tp_id="+e})},pay_password_popup=function(e,t){var a='<div class="popup pay-password-popup"><div class="close-btn"><a href="#" class="close-popup"><i class="fa fa-times" aria-hidden="true"></i></a></div><div class="content-block"><div class="title">支付密碼</div><input class="verification_code" type="password" placeholder="請輸入支付密碼" onkeydown="input_limit(this, 6);" onkeyup="input_limit(this, 6);"><a href="#" class="button button-big confirm">'+stringObj.text.confirm+"</a></div></div>";myApp.popup(a),$(".confirm").click(function(){myApp.closeModal(".pay-password-popup"),mainView.router.load({url:"pay-success?type="+e+"&tp_id="+t,reload:!0})})},uploadAfter=function(e,t,a){var s=indexObj._dataStorage(branchObj.storage.branchData)||{},r=e+"/"+t+"/"+a+".jpg";if("maincover"==t)s.sd_shopphotopath=branchObj.dataUrl.FTP_TEMPPRARY_PATH+r,indexObj._dataStorage(branchObj.storage.branchData,s),s.sd_shopphotopath&&($$(".branch-img-block").html('<img data-src="'+stringObj.text.branch_img_path+s.sd_shopphotopath+'" class="lazy branch-img" onerror=\'this.src = "../app/image/imgDefault.png"\'/><div class="edit-img"><i class="fa fa-pencil" aria-hidden="true"></i></div>'),$(".edit-img").click(function(){addImage("branch-img","")})),myApp.initImagesLazyLoad(".page-content");else if("shopservice"==t)s.ssqd_mainpic=branchObj.dataUrl.FTP_TEMPPRARY_PATH+r,indexObj._dataStorage(branchObj.storage.branchData,s),s.ssqd_mainpic&&($$(".shopservice-img-block").html('<img data-src="'+stringObj.text.branch_img_path+s.ssqd_mainpic+'" class="lazy shopservice-img" onerror=\'this.src = "../app/image/imgDefault.png"\'/><div class="edit-img"><i class="fa fa-pencil" aria-hidden="true"></i></div>'),$(".edit-img").click(function(){isMobile.Android()||isMobile.iOS()?addImage("branch-service",""):setImgOnPC("sd_id="+s.sd_id+"&folder=shopservice","")})),myApp.initImagesLazyLoad(".page-content");else if("shoppush"==t)localStorage.setItem(branchObj.storage.imagePath,branchObj.dataUrl.FTP_TEMPPRARY_PATH+r),r&&($(".push-img-block img").attr("src",stringObj.text.branch_img_path+branchObj.dataUrl.FTP_TEMPPRARY_PATH+r),$(".edit-img").unbind("click"),$(".edit-img").click(function(){void 0!==Cookies.get("app_version")?addImage("push-img",branchObj.dataUrl.FTP_TEMPPRARY_PATH+r):setImgOnPC("sd_id="+s.sd_id+"&folder=shoppush",branchObj.dataUrl.FTP_TEMPPRARY_PATH+r)})),myApp.initImagesLazyLoad(".page-content");else if("sd"===e||"md"===e){var i=indexObj._dataStorage(usedCarObj.storage.usedCarData);if("usedcar-main-img"==nowAddImgType)i.used_car_imgs.main=usedCarObj.dataUrl.FTP_TEMPPRARY_PATH+r,indexObj._dataStorage(usedCarObj.storage.usedCarData,i);else if("usedcar-picscategory1-img"==nowAddImgType||"usedcar-picscategory2-img"==nowAddImgType||"usedcar-picscategory3-img"==nowAddImgType){switch(nowAddImgType){case"usedcar-picscategory1-img":i.used_car_imgs.picscategory1=usedCarObj.dataUrl.FTP_TEMPPRARY_PATH+r;break;case"usedcar-picscategory2-img":i.used_car_imgs.picscategory2=usedCarObj.dataUrl.FTP_TEMPPRARY_PATH+r;break;case"usedcar-picscategory3-img":i.used_car_imgs.picscategory3=usedCarObj.dataUrl.FTP_TEMPPRARY_PATH+r}indexObj._dataStorage(usedCarObj.storage.usedCarData,i)}else""!=nowEditFilePath?i.used_car_imgs.imgs.splice(i.used_car_imgs.imgs.indexOf(nowEditFilePath),1,usedCarObj.dataUrl.FTP_TEMPPRARY_PATH+r):i.used_car_imgs.imgs.push(usedCarObj.dataUrl.FTP_TEMPPRARY_PATH+r),indexObj._dataStorage(usedCarObj.storage.usedCarData,i);if(""!=(i=indexObj._dataStorage(usedCarObj.storage.usedCarData)).used_car_imgs.main&&(usedCarSwiper.removeAllSlides(),usedCarSwiper.appendSlide('<div class="swiper-slide"><img src="'+stringObj.text.usedcar_img_path+i.used_car_imgs.main+'" onerror=\'this.src="../app/image/imgDefault.png"\' />   </div>')),i.used_car_imgs.imgs.length>0)for(var n in i.used_car_imgs.imgs)usedCarSwiper.appendSlide('<div class="swiper-slide"><img src="'+stringObj.text.usedcar_img_path+i.used_car_imgs.imgs[n]+'" onerror=\'this.src="../app/image/imgDefault.png"\' />   </div>');""!=i.used_car_imgs.main&&i.used_car_imgs.imgs.length<20&&usedCarSwiper.appendSlide('<div class="swiper-slide"><img src="../app/image/imgDefault.png" onerror=\'this.src="../app/image/imgDefault.png"\' /></div>'),""!=i.used_car_imgs.picscategory1&&$(".picscategory1").attr("src",stringObj.text.usedcar_img_path+i.used_car_imgs.picscategory1),""!=i.used_car_imgs.picscategory2&&$(".picscategory2").attr("src",stringObj.text.usedcar_img_path+i.used_car_imgs.picscategory2),""!=i.used_car_imgs.picscategory3&&$(".picscategory3").attr("src",stringObj.text.usedcar_img_path+i.used_car_imgs.picscategory3),usedCarSwiper.slideTo(i.used_car_imgs.imgs.length,0,!0),""!=i.used_car_imgs.main?$(".img-index").html(i.used_car_imgs.imgs.length+1+"/"+(i.used_car_imgs.imgs.length+2)):$(".img-index").html(i.used_car_imgs.imgs.length+1+"/1"),myApp.initImagesLazyLoad(".page-content")}else if("md_id"===e){var o=indexObj._dataStorage(myCarObj.storage.myCarData);if("mycar-main-img"==nowAddImgType?(o.my_car_imgs.main=myCarObj.dataUrl.FTP_TEMPPRARY_PATH+r,indexObj._dataStorage(myCarObj.storage.myCarData,o)):(""!=nowEditFilePath?o.my_car_imgs.imgs.splice(o.my_car_imgs.imgs.indexOf(nowEditFilePath),1,myCarObj.dataUrl.FTP_TEMPPRARY_PATH+r):o.my_car_imgs.imgs.push(myCarObj.dataUrl.FTP_TEMPPRARY_PATH+r),indexObj._dataStorage(myCarObj.storage.myCarData,o)),""!=(o=indexObj._dataStorage(myCarObj.storage.myCarData)).my_car_imgs.main&&(myCarSwiper.removeAllSlides(),myCarSwiper.appendSlide('<div class="swiper-slide"><img src="'+stringObj.text.mycar_img_path+o.my_car_imgs.main+'" onerror=\'this.src="../app/image/imgDefault.png"\' /></div>')),o.my_car_imgs.imgs.length>0)for(var n in o.my_car_imgs.imgs)myCarSwiper.appendSlide('<div class="swiper-slide"><img src="'+stringObj.text.mycar_img_path+o.my_car_imgs.imgs[n]+'" onerror=\'this.src="../app/image/imgDefault.png"\' /></div>');""!=o.my_car_imgs.main&&o.my_car_imgs.imgs.length<20&&myCarSwiper.appendSlide('<div class="swiper-slide"><img src="../app/image/imgDefault.png" onerror=\'this.src="../app/image/imgDefault.png"\' /></div>'),myCarSwiper.slideTo(o.my_car_imgs.imgs.length,0,!0),""!=o.my_car_imgs.main?$(".img-index").html(o.my_car_imgs.imgs.length+1+"/"+(o.my_car_imgs.imgs.length+2)):$(".img-index").html(o.my_car_imgs.imgs.length+1+"/1"),myApp.initImagesLazyLoad(".page-content")}else if("head_badge"==t){var c=indexObj._dataCookies(indexObj._storage.main);c.clubdata.ccd_clubbadge=carClubObj.dataUrl.FTP_TEMPPRARY_PATH+r,indexObj._dataCookies(indexObj._storage.main,c,"iscarmg.com"),c.clubdata.ccd_clubbadge&&($$(".club-logo-block").html('<img data-src="'+stringObj.text.car_club_img_path+c.clubdata.ccd_clubbadge+'" width=100 class="lazy" onerror=\'this.src="../app/image/imgDefault.png"\' /><div class="edit-icon"><i class="fa fa-pencil" aria-hidden="true"></i></div>'),$(".club-logo-block").click(function(){addImage("club-logo","")})),myApp.initImagesLazyLoad(".page-content")}else if("shopcontent"===t){var l=indexObj._dataStorage(branchObj.storage.shop_data)||{};""!=nowEditFilePath?(findArrayItem(l.sd_advancedata,"content_img",nowEditFilePath),l.sd_advancedata[nowIndex].content_img=branchObj.dataUrl.FTP_TEMPPRARY_PATH+r):l.sd_advancedata.push({content_text:"",content_img:branchObj.dataUrl.FTP_TEMPPRARY_PATH+r}),indexObj._dataStorage(branchObj.storage.shop_data,l),saveShopData(),mainView.router.load({url:localStorage.getItem("back_url").substring(localStorage.getItem("back_url").indexOf("#!/")+3),reload:!0}),localStorage.removeItem("back_url")}else{if("main-img"===nowAddImgType)s.shopcoupon_imgs.main=branchObj.dataUrl.FTP_TEMPPRARY_PATH+r,indexObj._dataStorage(branchObj.storage.branchData,s);else if("sub-img"===nowAddImgType)""!==nowEditFilePath?s.shopcoupon_imgs.imgs.splice(s.shopcoupon_imgs.imgs.indexOf(nowEditFilePath),1,branchObj.dataUrl.FTP_TEMPPRARY_PATH+r):s.shopcoupon_imgs.imgs.push(branchObj.dataUrl.FTP_TEMPPRARY_PATH+r),indexObj._dataStorage(branchObj.storage.branchData,s);else if("report"===nowAddImgType)$(".image-block img").attr("src",stringObj.text.branch_img_temporary_path+r),localStorage.setItem("report_img",branchObj.dataUrl.FTP_TEMPPRARY_PATH+r);else{var d=indexObj._dataStorage(branchObj.storage.commodity_data)||{scm_advancedescribe:[]};""!==nowEditFilePath?(findArrayItem(d.scm_advancedescribe,"content_img",nowEditFilePath),d.scm_advancedescribe[nowIndex].content_img=branchObj.dataUrl.FTP_TEMPPRARY_PATH+r):d.scm_advancedescribe.push({content_text:"",content_img:branchObj.dataUrl.FTP_TEMPPRARY_PATH+r}),indexObj._dataStorage(branchObj.storage.commodity_data,d)}if(""!==s.shopcoupon_imgs.main&&$$(".image-block .container").html('<div class="main-image-block"><img class="main lazy" data-src="'+stringObj.text.branch_img_path+s.shopcoupon_imgs.main+"\" onclick=\"addImage('main-img','"+s.shopcoupon_imgs.main+'\')"/><div class="main-lable">'+stringObj.text.front_cover+"</div></div>"),s.shopcoupon_imgs.imgs.length>0)for(var n in s.shopcoupon_imgs.imgs)$$(".image-block .container").append('<div class="sub-image-block"><img class="lazy" data-src="'+stringObj.text.branch_img_path+s.shopcoupon_imgs.imgs[n]+"\" onclick=\"addImage('sub-img','"+s.shopcoupon_imgs.imgs[n]+"')\"/></div>");s.shopcoupon_imgs.imgs.length<5&&$$(".image-block .container").append("<div class=\"image-item\" onclick=\"addImage('sub-img','')\">+</div>"),myApp.initImagesLazyLoad(".page-content"),saveData(),localStorage.setItem(branchObj.storage.imagePath,"ShopCoupon"),mainView.router.load({url:localStorage.getItem("back_url").substring(localStorage.getItem("back_url").indexOf("#!/")+3),reload:!0}),localStorage.removeItem("back_url")}},setQueueStatus=function(e,t){var a={useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""};new CountUp(".now-queue-num",0,parseInt(t),0,1,a).start();var s=indexObj._dataStorage(branchObj.storage.shopServiceRecord)||{last_update_date:"",availableList:[],finishList:[],invalidList:[]};if(JSON.stringify(s.availableList).match(e)){var r=new Date,i=r.getMonth()+1,n=r.getDate();if(i<10&&(i="0"+i),n<10&&(n="0"+n),new Date(r.getFullYear()+"/"+i+"/"+n)/864e5-new Date(s.last_update_date)/864e5>=1)o=new CountUp(".user-num",0,0,0,1,a);else var o=new CountUp(".user-num",0,parseInt(s.availableList[0].ssqq_queserno),0,1,a);o.start()}else(o=new CountUp(".user-num",0,0,0,1,a)).start()},changeStatus=function(e,t){var a=indexObj._dataCookies(indexObj._storage.main),s=indexObj._dataStorage(branchObj.storage.branchData);if("shopcoupon-management"==nowPage){var r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,scm_id:e,managetype:1,scm_title:"",scm_fulldescript:"",scm_category:"",scm_mainpic:"",scm_activepics:"",scm_price:"",scm_startdate:"",scm_enddate:"",scm_reservationtag:"",scm_dailystart:"",scm_dailyend:"",scm_workhour:"",scm_preparehour:"",scm_includeweekend:"",scm_reservationavailable:"",scm_member_limit:"",scm_balanceno:""};t?(r.scm_poststatus="0",r.md_securitycode="",branchObj.shopcouponmanager(r)):(r.scm_poststatus="1","1"===a.md_seccode_created?(indexObj._dataCookies("shopcouponmanager_data",r),memberseccode("verify")):myApp.modal({title:stringObj.text.warn,text:stringObj.text.no_set_memberseccode,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.to_set,onClick:function(){memberseccode("set")}}]}))}else"shopservice-setting"==nowPage&&((r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:s.sd_id,action_type:1,ssqd_id:e,ssqd_title:"",ssqd_content:"",ssqd_mainpic:"",ssqd_workhour:"",ssqd_serviceprice:"",ssqd_effectivity:"",ssqd_maxqueueamount:""}).ssqd_effectivity=t?"0":"1",branchObj.shopservicemanage(r))},addImage=function(e,t){nowAddImgType=e,nowEditFilePath=t;var a,s,r=indexObj._dataCookies(indexObj._storage.main),i=indexObj._dataStorage(branchObj.storage.branchData)||{},n=branchObj.dataUrl.FTP_PATH_BRANCH+"/temporary";"branch-img"===e?(a="maincover",s=i.sd_id):"branch-service"===e?(a="shopservice",s=i.sd_id):"push-img"===e?(a="shoppush",s=i.sd_id):"usedcar-main-img"===e||"usedcar-sub-img"===e||"usedcar-add-img"===e||"usedcar-picscategory1-img"===e||"usedcar-picscategory2-img"===e||"usedcar-picscategory3-img"===e?(n=usedCarObj.dataUrl.FTP_PATH_USEDCAR+"/temporary","1"==r.md_clienttype||"99"==r.md_clienttype?(a="sd",s=i.sd_id):"0"==r.md_clienttype&&(a="md",s=r.mdId)):"club-logo"==e?(a="head_badge",s=r.clubdata.ccd_id,n=carClubObj.dataUrl.FTP_PATH_CARCLUB+"/temporary"):"mycar-main-img"===e||"mycar-sub-img"===e||"mycar-add-img"===e?(a="md_id",s=r.mdId,n=myCarObj.dataUrl.FTP_PATH_MYCAR+"/temporary"):"shopcontent"===e?(a="shopcontent",s=i.sd_id):"report"===e?(a="shopcoupon/"+now_scm_id+"/pick_pack/"+now_scl_id,s=i.sd_id):(a="shopcoupon",s=i.sd_id),myApp.modal({title:"請選擇上傳方式",text:'<div class="list-block media-list" style="margin-top: 4%;margin-bottom: 0;"><ul style="background:none;"><li class="branchCamera" style="border-bottom: 1px dashed #ccc;"><div class="item-content"><div class="item-media"><i class="fa fa-camera-retro" style="color: darkslateblue;font-size: 16pt;"></i></div><div class="item-inner"><div class="item-title-row"><div class="item-title">拍照上傳</div></div></div></div></li><li class="localImage" style="border-bottom: 1px dashed #ccc;"><div class="item-content"><div class="item-media"><i class="fa fa-picture-o" aria-hidden="true"  style="color: darkgreen;font-size: 16pt;"></i></div><div class="item-inner"><div class="item-title-row"><div class="item-title">本地圖片上傳</div></div></div></div></li><li class="removeImage"><div class="item-content"><div class="item-media"><i class="fa fa-trash-o" aria-hidden="true"  style="color: darkred;font-size: 16pt;"></i></div><div class="item-inner"><div class="item-title-row"><div class="item-title">&nbsp;刪除</div></div></div></div></li></ul></div>',buttons:[{text:stringObj.text.cancel,onClick:function(){}}]}),$(".branchCamera").click(function(){var t=new Date,r=t.getMonth()+1,i=t.getDate(),o=t.getHours(),c=t.getMinutes(),l=t.getSeconds();r<10&&(r="0"+r),i<10&&(i="0"+i),o<10&&(o="0"+o),c<10&&(c="0"+c),l<10&&(l="0"+l),"shopcontent"===e&&(localStorage.setItem("back_url",window.location.href),localStorage.setItem("scrollTop",$(".branch-info-edit-content").scrollTop()+70)),"shopcoupon"===e&&(localStorage.setItem("back_url",window.location.href),localStorage.setItem("scrollTop",$("."+nowPage+"-content").scrollTop()+70));var d=""+t.getFullYear()+r+i+o+c+l;"usedcar-main-img"==e||"usedcar-sub-img"==e||"usedcar-add-img"==e||"usedcar-picscategory1-img"==e||"usedcar-picscategory2-img"==e||"usedcar-picscategory3-img"==e||"mycar-main-img"==e||"mycar-sub-img"==e||"mycar-add-img"==e?webview.branchCamera(branchObj.dataUrl.FTP_HOST,n,a,s,d):webview.branchCamera(branchObj.dataUrl.FTP_HOST,n,s,a,d),myApp.closeModal()}),$(".localImage").click(function(){var t=new Date,r=t.getMonth()+1,i=t.getDate(),o=t.getHours(),c=t.getMinutes(),l=t.getSeconds();r<10&&(r="0"+r),i<10&&(i="0"+i),o<10&&(o="0"+o),c<10&&(c="0"+c),l<10&&(l="0"+l),"shopcontent"===e&&(localStorage.setItem("back_url",window.location.href),localStorage.setItem("scrollTop",$(".branch-info-edit-content").scrollTop()+70)),"shopcoupon"===e&&(localStorage.setItem("back_url",window.location.href),localStorage.setItem("scrollTop",$("."+nowPage+"-content").scrollTop()+70));var d=""+t.getFullYear()+r+i+o+c+l;"usedcar-main-img"==e||"usedcar-sub-img"==e||"usedcar-add-img"==e||"usedcar-picscategory1-img"==e||"usedcar-picscategory2-img"==e||"usedcar-picscategory3-img"==e||"mycar-main-img"==e||"mycar-sub-img"==e||"mycar-add-img"==e?webview.localImage(branchObj.dataUrl.FTP_HOST,n,a,s,d):webview.localImage(branchObj.dataUrl.FTP_HOST,n,s,a,d),myApp.closeModal()}),"main-img"!=e&&""!=t&&"branch-img"!=e&&"branch-service"!=e&&"usedcar-main-img"!=e&&"usedcar-add-img"!=e&&"mycar-main-img"!=e&&"mycar-add-img"!=e||($(".removeImage").css("display","none"),$(".localImage").css("border-bottom","0")),$(".removeImage").click(function(){myApp.closeModal(),deleteImg(t)})},deleteImg=function(e){myApp.modal({title:stringObj.text.warn,text:"確定要刪除?",buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){myApp.showPreloader("刪除中...");var t=indexObj._dataStorage(branchObj.storage.branchData);if("shopcoupon-edit"===nowPage){-1!==t.shopcoupon_imgs.imgs.indexOf(e)&&(t.delete_imgs.push(e),t.shopcoupon_imgs.imgs.splice(t.shopcoupon_imgs.imgs.indexOf(e),1),indexObj._dataStorage(branchObj.storage.branchData,t));i=indexObj._dataStorage(branchObj.storage.commodity_data)||{};findAndRemove(i.scm_advancedescribe,"content_img",e),indexObj._dataStorage(branchObj.storage.commodity_data,i),localStorage.setItem("scrollTop",$(".shopcoupon-edit-content").scrollTop()),localStorage.setItem("back_url",window.location.href),deleteFinish("true")}else if("used-car-add"===nowPage){var a=indexObj._dataStorage(usedCarObj.storage.usedCarData);switch(nowAddImgType){case"usedcar-sub-img":a.used_car_imgs.imgs.splice(a.used_car_imgs.imgs.indexOf(e),1);break;case"usedcar-picscategory1-img":a.used_car_imgs.picscategory1="";break;case"usedcar-picscategory2-img":a.used_car_imgs.picscategory2="";break;case"usedcar-picscategory3-img":a.used_car_imgs.picscategory3=""}indexObj._dataStorage(usedCarObj.storage.usedCarData,a),deleteFinish("true")}else if("my-car-info-edit"===nowPage){var s=indexObj._dataStorage(myCarObj.storage.myCarData);s.my_car_imgs.imgs.splice(s.my_car_imgs.imgs.indexOf(e),1),indexObj._dataStorage(myCarObj.storage.myCarData,s),deleteFinish("true")}else if("branch-info-edit"===nowPage){var r=indexObj._dataStorage(branchObj.storage.shop_data)||{};findAndRemove(r.sd_advancedata,"content_img",e),indexObj._dataStorage(branchObj.storage.shop_data,r),localStorage.setItem("scrollTop",$(".branch-info-edit-content").scrollTop()),localStorage.setItem("back_url",window.location.href),deleteFinish("true")}else if("add-shopcoupon"===nowPage){var i=indexObj._dataStorage(branchObj.storage.commodity_data)||{};findAndRemove(i.scm_advancedescribe,"content_img",e),indexObj._dataStorage(branchObj.storage.commodity_data,i),localStorage.setItem("scrollTop",$(".add-shopcoupon-content").scrollTop()),localStorage.setItem("back_url",window.location.href),deleteFinish("true")}else{if(isMobile.Android())webview.deleteFileFromFTP(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,e);else if(isMobile.iOS()){var n=[];n.push(e),webview.deleteFileFromFTP(branchObj.dataUrl.FTP_HOST,branchObj.dataUrl.FTP_PATH_BRANCH,n)}t.shopcoupon_imgs.imgs.splice(t.shopcoupon_imgs.imgs.indexOf(e),1),indexObj._dataStorage(branchObj.storage.branchData,t)}}}]})},deleteFinish=function(e){if(myApp.hidePreloader(),"true"==e){if("used-car-add"==nowPage){myApp.toast(stringObj.text.delete_success,"",{}).show();var t=indexObj._dataStorage(usedCarObj.storage.usedCarData);if(""!=t.used_car_imgs.main&&(usedCarSwiper.removeAllSlides(),usedCarSwiper.appendSlide('<div class="swiper-slide"><img src="'+stringObj.text.usedcar_img_path+t.used_car_imgs.main+'" onerror=\'this.src="../app/image/imgDefault.png"\' />   </div>')),t.used_car_imgs.imgs.length>0)for(var a in t.used_car_imgs.imgs)usedCarSwiper.appendSlide('<div class="swiper-slide"><img src="'+stringObj.text.usedcar_img_path+t.used_car_imgs.imgs[a]+'" onerror=\'this.src="../app/image/imgDefault.png"\' />   </div>');""!=t.used_car_imgs.main&&t.used_car_imgs.imgs.length<20&&usedCarSwiper.appendSlide('<div class="swiper-slide"><img src="../app/image/imgDefault.png" onerror=\'this.src="../app/image/imgDefault.png"\' /></div>'),usedCarSwiper.slideTo(t.used_car_imgs.imgs.length,0,!0),""!=t.used_car_imgs.main?$(".img-index").html(t.used_car_imgs.imgs.length+1+"/"+(t.used_car_imgs.imgs.length+2)):$(".img-index").html(t.used_car_imgs.imgs.length+1+"/1"),""!=t.used_car_imgs.picscategory1?$(".picscategory1").attr("src",stringObj.text.usedcar_img_path+t.used_car_imgs.picscategory1):$(".picscategory1").attr("src","../app/image/add-img.png"),""!=t.used_car_imgs.picscategory2?$(".picscategory2").attr("src",stringObj.text.usedcar_img_path+t.used_car_imgs.picscategory2):$(".picscategory2").attr("src","../app/image/add-img.png"),""!=t.used_car_imgs.picscategory3?$(".picscategory3").attr("src",stringObj.text.usedcar_img_path+t.used_car_imgs.picscategory3):$(".picscategory3").attr("src","../app/image/add-img.png")}else if("my-car-info-edit"==nowPage){myApp.toast(stringObj.text.delete_success,"",{}).show();var s=indexObj._dataStorage(myCarObj.storage.myCarData);if(""!=s.my_car_imgs.main&&(myCarSwiper.removeAllSlides(),myCarSwiper.appendSlide('<div class="swiper-slide"><img src="'+stringObj.text.mycar_img_path+s.my_car_imgs.main+'" onerror=\'this.src="../app/image/imgDefault.png"\' />   </div>')),s.my_car_imgs.imgs.length>0)for(var a in s.my_car_imgs.imgs)myCarSwiper.appendSlide('<div class="swiper-slide"><img src="'+stringObj.text.mycar_img_path+s.my_car_imgs.imgs[a]+'" onerror=\'this.src="../app/image/imgDefault.png"\' />   </div>');""!=s.my_car_imgs.main&&s.my_car_imgs.imgs.length<20&&myCarSwiper.appendSlide('<div class="swiper-slide"><img src="../app/image/imgDefault.png" onerror=\'this.src="../app/image/imgDefault.png"\' /></div>'),myCarSwiper.slideTo(s.my_car_imgs.imgs.length,0,!0),""!=s.my_car_imgs.main?$(".img-index").html(s.my_car_imgs.imgs.length+1+"/"+(s.my_car_imgs.imgs.length+2)):$(".img-index").html(s.my_car_imgs.imgs.length+1+"/1")}else if("branch-info-edit"===nowPage)saveShopData(),mainView.router.load({url:localStorage.getItem("back_url").substring(localStorage.getItem("back_url").indexOf("#!/")+3),reload:!0}),localStorage.removeItem("back_url");else if("add-shopcoupon"===nowPage||"shopcoupon-edit"===nowPage)saveData(),mainView.router.load({url:localStorage.getItem("back_url").substring(localStorage.getItem("back_url").indexOf("#!/")+3),reload:!0}),localStorage.removeItem("back_url");else if("message-info"===nowPage)localStorage.removeItem(branchObj.storage.imagePath),$(".push-img-block img").attr("src","../app/image/imgDefault.png"),$(".edit-img").unbind("click"),$(".edit-img").click(function(){void 0!==Cookies.get("app_version")?addImage("push-img",""):setImgOnPC("sd_id="+r.sd_id+"&folder=shoppush","")});else{$$(".image-block .container").html("");var r=indexObj._dataStorage(branchObj.storage.branchData);if(""!=r.shopcoupon_imgs.main&&($$(".image-block .container").html('<div class="main-image-block"><img class="main lazy" data-src="'+stringObj.text.branch_img_path+r.shopcoupon_imgs.main+'"/><div class="main-lable">封面</div></div>'),$(".main-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("main-img",r.shopcoupon_imgs.main):setImgOnPC("sd_id="+r.sd_id+"&folder=shopcoupon&type=main","")})),r.shopcoupon_imgs.imgs.length>0){for(var a in r.shopcoupon_imgs.imgs)$$(".image-block .container").append('<div class="sub-image-block" position='+a+'><img class="lazy" data-src="'+stringObj.text.branch_img_path+r.shopcoupon_imgs.imgs[a]+'" /></div>');$(".sub-image-block").click(function(){isMobile.Android()||isMobile.iOS()?addImage("sub-img",r.shopcoupon_imgs.imgs[parseInt($(this).attr("position"))]):setImgOnPC("sd_id="+r.sd_id+"&folder=shopcoupon&type=sub&position="+$(this).attr("position"),r.shopcoupon_imgs.imgs[parseInt($(this).attr("position"))])})}r.shopcoupon_imgs.imgs.length<5&&($$(".image-block .container").append('<div class="image-item">+</div>'),$(".image-item").click(function(){isMobile.Android()||isMobile.iOS()?addImage("sub-img",""):setImgOnPC("sd_id="+r.sd_id+"&folder=shopcoupon&type=sub&position=add","")}))}myApp.initImagesLazyLoad(".page-content")}else myApp.alert(stringObj.text.delete_fail,stringObj.text.warn)},shopCouponAbandon=function(e,t){$$(".swipeout-"+t).on("deleted",function(){var a=stringObj.text.abandon_reason,s="";for(var r in a)s+=0==r?'<li><label class="label-radio item-content"><input type="radio" name="reasonlist" value="'+r+'" checked><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+a[r]+"</b></div></div></div></label></li>":'<li><label class="label-radio item-content"><input type="radio" name="reasonlist" value="'+r+'"><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+a[r]+"</b></div></div></div></label></li>";myApp.modal({title:"理由",text:'<div class="list-block media-list"><ul id="reasonlist">'+s+"</ul></div>",buttons:[{text:stringObj.text.confirm,onClick:function(){checkReason=$('input[name="reasonlist"]:checked').val(),myApp.showIndicator();var a=indexObj._dataCookies(indexObj._storage.main),s={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,scm_id:e,scg_id:t,scg_abandomreason:checkReason};indexObj._wcfget({url:branchObj.dataUrl.shopcouponabandon,para:s,success:function(e){if(e.shopcouponabandonresult){indexObj.jsonUrlDecode(e);var a=JSON.parse(JSON.stringify(e.shopcouponabandonresult));switch(a.message_no){case"010909000":var s=indexObj._dataStorage(branchObj.storage.alarmInfo)||{alarmInfoArray:[]},r=JSON.parse(localStorage.getItem("alarmCheck"))||{alarmCheckArray:[]};s.alarmInfoArray.length>0&&(nowIndex=-1,findArrayItem(s.alarmInfoArray,"id",t),nowIndex>=0&&(webview.closeAlarm(s.alarmInfoArray[nowIndex].alarmIndex,t),findAndRemove(s.alarmInfoArray,"id",t),indexObj._dataStorage(branchObj.storage.alarmInfo,s),r.alarmCheckArray.splice(r.alarmCheckArray.indexOf(t),1),indexObj._dataStorage("alarmCheck",r)));var i=indexObj._dataStorage(branchObj.storage.shopCouponRecord);findAndRemove(i.availableList,"scg_id",t),indexObj._dataStorage(indexObj._storage.shopCouponRecord,i);break;default:stringObj.return_header(a.message_no)}_tip&&(myApp.alert(_tip+"( "+a.message_no+" )",stringObj.text.warn),_tip=null)}mainView.router.load({url:"coupon-record?tab=shop-coupon",reload:!0}),myApp.hideIndicator()},error:function(e){myApp.hideIndicator(),noNetwork()}})}}]}),$(".modal").css("height","60%"),$(".modal-title+.modal-text").css("height","89%"),$(".modal-title+.modal-text").css("overflow-y","auto"),$(".modal .list-block").css("margin","3% 0"),$(".modal-inner").css("background","#FFF"),$(".modal .item-text").css("text-align","left"),$(".media-list li").css("border-bottom","1px solid #DDD")})},branchReply=function(e,t,a,s){var r=indexObj._dataCookies(indexObj._storage.main),i=indexObj._dataStorage(branchObj.storage.branchData);"2"==s?($$(".swipeout-"+t).on("deleted",function(){var a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,sd_id:i.sd_id,sqna_id:e,sqnr_id:t,activetype:s,sqnr_responsemessage:""};branchObj.shopquestionnaire_response(a)}),window.location.href.match("webend_admin")&&myApp.modal({title:stringObj.text.warn,text:stringObj.text.check_delete,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text._delete,onClick:function(){var a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,sd_id:i.sd_id,sqna_id:e,sqnr_id:t,activetype:s,sqnr_responsemessage:""};branchObj.shopquestionnaire_response(a)}}]})):(myApp.modal({title:stringObj.text.sqna_message,text:'<textarea class="sqna_msg resizable" rows="9" placeholder="'+stringObj.text.input_limit70+'" onkeyup="this.value = this.value.slice(0, 70)"></textarea>',buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){var a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,sd_id:i.sd_id,sqna_id:e,sqnr_id:t,activetype:s,sqnr_responsemessage:$(".sqna_msg").val()};branchObj.shopquestionnaire_response(a)}}]}),$(".sqna_msg").val(a),$("textarea.sqna_msg").focus())},queue=function(e){var t='<div class="popup queue-popup"><div class="navbar"><div class="navbar-inner"><div class="left sliding queue-left"><a href="#" class="link icon-only close-popup"><span class="icon-chevron-left"></span></a></div><div class="center sliding">'+stringObj.text.service_queue+'</div><div class="right queue-right"></div></div></div><div class="queue-block"><div class="row no-gutter"><div class="col-20">款式：</div><div class="col-80"><input type="text" class="carModels" placeholder="請選擇廠牌型號" readonly/></div></div><div style="margin: 4% 0;">備註：</div><textarea class="queremark" placeholder="內容訊息"></textarea><a href="#" class="button queue-btn">排隊</a></div></div>';myApp.popup(t),carModelArray=carModels.Alfa_Romeo[1];myApp.picker({input:".carModels",rotateEffect:!1,toolbarTemplate:'<div class="toolbar"><div class="toolbar-inner"><div class="left"><a href="#" class="link close-picker"></a></div><div class="right"><a href="#" class="link close-picker"><i class="fa fa-check" aria-hidden="true"></i></a></div></div></div>',formatValue:function(e,t,a){return t[0]+"  "+t[1]},cols:[{textAlign:"left",width:180,values:["Alfa_Romeo","Aston_Martin","Audi","Bentley","BMW","Bugatti","Buick","Cadillac","Chery","Chrysler","Citroen","CMC","Daihatsu","DS","Ferrari","Fiat","Ford","Honda","Hyundai","Infiniti","IVECO","Jaguar","Kia","Lamborghini","Land Rover","Lexus","Lotus","Luxgen","Maserati","Mazda","McLaren","Mercedes_Benz","Mini","Mitsubishi","Morgan","Nissan","Opel","Peugeot","Porsche","Proton","Renault","Rolls_Royce","Skoda","Smart","Ssangyong","Subaru","Suzuki","Tesla","Tobe","Toyota","Volkswagen","Volvo"],onChange:function(e,t){e.cols[1].replaceValues&&(e.cols[1].replaceValues(carModels[t][0]),carModelArray=carModels[t][1])}},{values:carModels.Alfa_Romeo[0],width:180,onChange:function(e,t){modelIndex=e.cols[1].activeIndex}}]});$(".queue-btn").click(function(){myApp.closeModal(".queue-popup");var t=indexObj._dataCookies(indexObj._storage.main),a={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,ssqd_id:e,ci_serno:carModelArray[modelIndex],ssqq_queremark:$(".queremark").val()};branchObj.shopservicequeask(a)})},serviceCall=function(e,t){switch(e){case"call":branchObj.shopservicecallup(t);break;case"pass":var a=indexObj._dataStorage(branchObj.storage.nextNumObj)||[];a.length>0?(findArrayItem(a,"ssqd_id",t),branchObj.shopqueuenoshow(t,a[nowIndex].ssqq_id)):myApp.alert(stringObj.shop.no_queue,stringObj.text.warn);break;case"overCall":branchObj.shopqueueovercall(t)}},shopServiceAbandon=function(e,t){branchObj.shopservicequeabandom(e,t)},toBranch=function(e,t,a){var s=indexObj._dataStorage(branchObj.storage.branchData)||{};switch(s.sd_id=t,s.sd_shopname=a,s.smb_shoptype=e,indexObj._dataStorage(branchObj.storage.branchData,s),e){case"0":case"1":mainView.router.load({url:"shop/branch-main?sd_id="+t,reload:!0});break;case"99":t&&(s.sd_id=t,s.sd_type="shop",indexObj._dataStorage(branchObj.storage.branchData,s)),mainView.router.load({url:"shop/branch-info-edit?sd_id="+t,reload:!0})}},pay_list=function(e,t,a,s){var r,i;switch(e){case"0":i=stringObj.used_car.dcil_list_json0,r=s;break;case"2":var n=indexObj._dataCookies(indexObj._storage.main),o=indexObj._dataStorage(branchObj.storage.branchData);i=stringObj.used_car.dcil_list_json1,r={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:n.sat,md_clienttype:e,sd_id:o.sd_id,cbi_id:a,dcil_id:""}}var c="";for(var l in i)c+="0"===l?'<li><label class="label-radio item-content"><input type="radio" name="dcil_list" value="'+i[l].dcil_id+'" checked><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+i[l].dcil_itemname+'</b></div><div class="item-after">'+i[l].dcil_depositamount+'pt</div></div><div class="item-text">'+i[l].dcil_itemdescript+"</div></div></label></li>":'<li><label class="label-radio item-content"><input type="radio" name="dcil_list" value="'+i[l].dcil_id+'"><div class="item-inner"><div class="item-title-row"><div class="item-title"><b>'+i[l].dcil_itemname+'</b></div><div class="item-after">'+i[l].dcil_depositamount+'pt</div></div><div class="item-text">'+i[l].dcil_itemdescript+"</div></div></label></li>";myApp.modal({title:stringObj.text.pay_list,text:'<div class="row no-gutter"><div class="col-20 note">名稱：</div><div class="col-80">'+t+'</div></div><div class="row no-gutter"><div class="col-35 note">'+stringObj.text.now_coin+'：</div><div class="col-65">0</div></div>',afterText:'<div class="dcil_list_block"><div class="list-block media-list"><ul id="reasonlist">'+c+"</ul></div></div>",buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){switch(r.dcil_id=$('input[name="dcil_list"]:checked').val(),e){case"0":branchObj.postshopdata(r);break;case"2":usedCarObj.payusedcarpost(r)}}}]}),$(".modal").css("width","300px"),browser_width>330?$(".modal").css("left","47%"):$(".modal").css("left","45%"),$(".modal-title+.modal-text").css("margin","3% 0"),$(".modal-title+.modal-text").css("text-align","left"),$(".modal-title+.modal-text .row").css("margin","2% 0"),$(".modal-title+.modal-text .row").css("padding","0 15px"),$(".modal-title+.modal-text .note").css("color","darkslategray"),$(".modal-title+.modal-text .col-35").css("width","35%"),$(".modal-title+.modal-text .col-65").css("width","65%"),$(".dcil_list_block").css("height","80%"),$(".dcil_list_block").css("overflow-y","auto"),$(".modal .list-block").css("margin","1% 0"),$(".modal-inner").css("background","#FFF"),$(".modal .item-text").css("text-align","left"),$(".media-list li").css("border-bottom","1px solid #DDD"),$(".item-after").css("color","firebrick")},readFile=function(){var e=this.files[0],t=new FileReader;t.readAsDataURL(e),t.onload=function(e){$(".popup .set-img-block").css("display","none"),result.innerHTML='<img id="pre-img" class="pre-img" src="'+this.result+'" alt="" height="'+img_height+'" width="'+img_width+'" />';var t=$(".pre-img").croppie({enableExif:!0,viewport:{width:img_width,height:img_height},boundary:{width:img_width,height:img_height}});$(".delete-btn").css("display","none"),$(".upload-btn").css("display","none"),$(".crop-btn").css("display","block"),$(".crop-btn").click(function(){t.croppie("result",{type:"base64",format:"jpeg",quality:.8}).then(function(e){result.innerHTML='<img id="pre-img" class="pre-img" src="'+e+'" alt="" height="'+img_height+'" width="'+img_width+'" />',$(".set-img-block").val(e),$(".crop-btn").css("display","none"),$(".upload-btn").css("display","block")})})}};var img_width,img_height;setImgOnPC=function(e,t){if(t)a='<div class="popup"><div class="close-btn"><a href="#" class="close-popup"><i class="fa fa-times" aria-hidden="true"></i></a></div><div class="title">'+stringObj.text.select_img+'</div><div class="content-block"><form method="post" id="myForm" action="upload?'+e+'" enctype="multipart/form-data"><input type="file" name="file" id="file" class="set-img" accept="image/*"><input name="img" type="text" class="set-img-block" onclick="this.form.file.click();"><br><div id="result"><img id="pre-img" class="pre-img" src="'+stringObj.text.branch_img_path+t+'" /></div><br><input class="upload-btn" type="submit" name="submit" value="上傳" /></form><button class="crop-btn">剪裁</button><button class="delete-btn">刪除</button></div></div>';else var a='<div class="popup"><div class="close-btn"><a href="#" class="close-popup"><i class="fa fa-times" aria-hidden="true"></i></a></div><div class="title">'+stringObj.text.select_img+'</div><div class="content-block"><form method="post" id="myForm" action="upload?'+e+'" enctype="multipart/form-data"><input type="file" name="file" id="file" class="set-img" accept="image/*"><input name="img" type="text" class="set-img-block" onclick="this.form.file.click();"><br><div id="result"></div><br><input class="upload-btn" type="submit" name="submit" value="上傳" /></form><button class="crop-btn">剪裁</button></div></div>';myApp.popup(a),$(".upload-btn").click(function(){localStorage.setItem("back_url",window.location.href),"add-shopcoupon"===nowPage?($(".add-shopcoupon-content").scrollTop()>70&&localStorage.setItem("scrollTop",$(".add-shopcoupon-content").scrollTop()+70),saveData()):"shopcoupon-edit"===nowPage?($(".shopcoupon-edit-content").scrollTop()>70&&localStorage.setItem("scrollTop",$(".shopcoupon-edit-content").scrollTop()+70),saveData()):(localStorage.setItem("scrollTop",$(".branch-info-edit-content").scrollTop()+70),saveShopData())}),$(".popup").addClass("set-img-popup"),$(".set-img-block").css("height",$(".set-img-block").width()/8*5),img_width=$(".set-img-block").width(),img_height=$(".set-img-block").width()/8*5;var s=document.getElementById("result"),r=document.getElementById("file");t&&($(".popup .set-img-block").css("display","none"),$(".delete-btn").css("display","block"),s.innerHTML='<img id="pre-img" class="pre-img" src="'+stringObj.text.branch_img_path+t+'" alt="" height="'+img_height+'" width="'+img_width+'" />',$(".delete-btn").click(function(){myApp.closeModal(),deleteImg(t)})),"undefined"==typeof FileReader?(s.innerHTML="Sorry, 瀏覽器不支持 FileReader",r.setAttribute("disabled","disabled")):r.addEventListener("change",readFile,!1)},shopLogout=function(){myApp.modal({title:stringObj.text.warn,text:stringObj.text.logoutCheck,buttons:[{text:stringObj.text.cancel,onClick:function(){}},{text:stringObj.text.confirm,onClick:function(){indexObj._dataStorage(indexObj._storage.branchData,null),indexObj._dataStorage(indexObj._storage.myFavorite,null),indexObj._dataStorage(indexObj._storage.mailList,null),indexObj._dataStorage(indexObj._storage.couponRecord,null),indexObj._dataStorage(indexObj._storage.shopCouponRecord,null),indexObj._dataStorage(indexObj._storage.shopServiceRecord,null),loginType="";var e=indexObj._dataCookies(indexObj._storage.main)||{};if(e&&e.murId){if("0"===e.loginType)var t=e.sso_token;indexObj._dataCookies(indexObj._storage.main,{murId:e.murId},"iscarmg.com"),e=indexObj._dataCookies(indexObj._storage.main)||{murId:e.murId};var a="http://"+stringObj.WEB_URL+"/Shop/webend_admin/login";t?window.open("https://www.facebook.com/logout.php?next="+encodeURIComponent(a)+"&access_token="+t,"_self",!1):window.open(a,"_self",!1)}}}]})},saveShopData=function(){if("branch-info-edit"===nowPage){var e=indexObj._dataStorage(branchObj.storage.shop_data)||{},t=indexObj._dataStorage(branchObj.storage.branchData)||{};e.sd_shopname=$(".page:not(.cached) #branch-name").val(),e.sd_shoptel=$(".page:not(.cached) #branch-tel").val(),e.sd_zipcode=$(".page:not(.cached) .branchRegion").val(),e.sd_shopaddress=$(".page:not(.cached) #branch-address").val(),e.sd_weeklystart=$(".branchDate").val().substring(2,3),e.sd_weeklyend=$(".branchDate").val().substring(8,9),e.sd_dailystart=$(".branchTime").val().substring(0,5),e.sd_dailyend=$(".branchTime").val().substring(8,13),e.sd_shopphotopath=t.sd_shopphotopath||"",e.sd_introtext=$(".page:not(.cached) #branch-info").val(),e.sd_contact_person=$(".page:not(.cached) #user-name").val(),e.sd_contact_tel=$(".page:not(.cached) #user-tel").val(),e.sd_contact_mobile=$(".page:not(.cached) #user-phone").val(),e.sd_contact_address=$(".page:not(.cached) #user-address").val(),e.sd_contact_email=$(".page:not(.cached) #user-email").val(),e.sd_advancedata=e.sd_advancedata||[],indexObj._dataStorage(branchObj.storage.shop_data,e)}},saveData=function(){if("temple-info"===nowPage){var e=indexObj._dataStorage(branchObj.storage.save_data)||{},t=indexObj._dataStorage(branchObj.storage.branchData)||{};e.tps_invoice_name=$(".tps_invoice_name").val(),e.tps_invoice_tel=$(".tps_invoice_tel").val(),e.tps_invoice_area=$(".tps_invoice_area").val(),e.tps_invoice_address=$(".tps_invoice_address").val(),e.iscarpolicy=!1,$(".temple-bright-light .iscarpolicy input:checked").each(function(){e.iscarpolicy=!0}),indexObj._dataStorage(branchObj.storage.save_data,e);var a=indexObj._dataStorage(branchObj.storage.blessed_relatives)||{};for(var s in a.blessedlist)a.blessedlist[s].tpp=[],$(".light-"+a.blessedlist[s].tpr_serno+' input[name="light"]:checked').each(function(){findArrayItem(a.blessedlist,"tpr_serno",a.blessedlist[s].tpr_serno),a.blessedlist[s].tpp.push({tpp_serno:this.value,tpp_name:$(this).attr("tpp_name"),tpp_price:$(this).attr("tpp_price")})});indexObj._dataStorage(branchObj.storage.blessed_relatives,a)}else if("add-shopcoupon"===nowPage||"shopcoupon-edit"===nowPage){var r=indexObj._dataStorage(branchObj.storage.commodity_data)||{},t=indexObj._dataStorage(branchObj.storage.branchData)||{};r.scm_title=$("#shopcoupon-name").val(),r.scm_fulldescript=$("#scm_fulldescript").val(),r.scm_producttype=r.scm_producttype,r.scm_category=0,r.scm_mainpic=t.shopcoupon_imgs.main,r.scm_activepics=JSON.stringify(t.shopcoupon_imgs.imgs),r.scm_price=$("#price").val(),r.scm_startdate=$("#calendar-range").val().substring(0,10),r.scm_enddate=$("#calendar-range").val().substring(13),r.scm_reservationtag=r.scm_reservationtag,r.scm_dailystart=$("#shopcoupon-time").val().substring(0,5),r.scm_dailyend=$("#shopcoupon-time").val().substring(8),r.scm_workhour=(60*parseInt($("#require-time").val().substring(0,2))+parseInt($("#require-time").val().substring(6,8)))/30,r.scm_preparehour=(60*parseInt($("#prepare-time").val().substring(0,2))+parseInt($("#prepare-time").val().substring(6,8)))/30,r.scm_includeweekend=$("input[name='weekend-radio']:checked").val(),r.scm_reservationavailable=$("#reserve-num").val(),r.scm_poststatus="",r.scm_member_limit=$("#limit").val(),r.scm_balanceno=$("#scm_balanceno").val(),r.scm_coupon_providetype=r.scm_coupon_providetype,r.scm_bonus_payamount=$("#scm_bonus_payamount").val(),r.scm_bonus_giveafteruse=r.scm_bonus_giveafteruse,r.scm_bonus_giveamount=$("#scm_bonus_giveamount").val(),r.scm_advancedescribe=r.scm_advancedescribe||[],indexObj._dataStorage(branchObj.storage.commodity_data,r)}},suntechbuysafe=function(e){e.esafe_path=esafe_path;var t=indexObj.template("templateEsafeInfoForm")(e);$$(".pay-info-block").append(t),$(".scg_form").submit()},ecpay=function(e){var t=indexObj.template("templateEcpayInfoForm")(e);$$(".pay-info-block").append(t),$(".scg_form").submit()},ipLocation=function(){$.getJSON("http://ip-api.com/json/?callback=?",function(e){nowLocation(e.lon,e.lat)})},nowLocation=function(e,t){if(void 0!==e&&0!==e&&""!==e?(nowlat=t,nowlng=e):(nowlat=stringObj.text.default_lat,nowlng=stringObj.text.default_lng),"map"===nowPage||"map"===nowMode){var a={zoom:14,center:new google.maps.LatLng(nowlat,nowlng),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},s=$(".full_map");if((full_map=new google.maps.Map(s[0],a)).setCenter(new google.maps.LatLng(nowlat,nowlng)),Cookies.set("sd_lat",full_map.getCenter().lat()),Cookies.set("sd_lng",full_map.getCenter().lng()),markers.length>0)for(var r=0;r<markers.length;r++)markers[r].setMap(null);markers=[],"map"===nowPage?($(".search-btn").css("display","none"),branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,branchObj.branchListGet(""),full_map.addListener("dragend",function(){$(".search-btn").css("display","block")})):"map"===nowMode&&(branchObj.firstId="",branchObj.listId="",branchObj.listLoading=!1,branchObj.distance="",branchObj.branchListGet("")),my_marker&&my_marker.setMap(null);var i={url:"app/image/user-marker.png"};my_marker=new google.maps.Marker({position:new google.maps.LatLng(nowlat,nowlng),map:full_map,title:"Me",icon:i})}"shop-search-result"!==nowPage&&"branch-cooperative"!==nowPage||(void 0===e||0===e||""===e?(noGpsModal(),$(this).prop("checked",!1),$(this).next().css("background","darkgray"),$(this).next().css("color","#000"),$(".block-list input").removeAttr("disabled"),$('.block-list input[type="checkbox"] + label').css("background","darkgray"),$('.block-list input[type="checkbox"] + label').css("color","#000")):"branch-cooperative"===nowPage&&$.getJSON("http://ip-api.com/json/?callback=?",function(e){var t={};t.spm_serno=2,t.sd_lat=e.lat||"",t.sd_lng=e.lon||"",t.sd_shopname="",t.sd_country="",indexObj._dataStorage(indexObj._storage.search_result,t),mainView.router.load({url:"around-search-result"})}))},thousandComma=function(e){for(var t=e.toString(),a=/(-?\d+)(\d{3})/;a.test(t);)t=t.replace(a,"$1,$2");return t},getDaysOfMonth=function(e,t){return 2===e?t%4==0?29:28:e<8?e%2==1?31:30:e%2==1?30:31},chkTaxId=function(e){var t=new Array;t[0]=1,t[1]=2,t[2]=1,t[3]=2,t[4]=1,t[5]=2,t[6]=4,t[7]=1;var a=0;if(8!==e.length)return"lengthError";var s=e.split("");for(i=0;i<=7;i++){if(e.charCodeAt()<48||e.charCodeAt()>57)return"formatError";a+=cc(s[i]*t[i])}return a%10==0?"00":7==s[6]&&(a+1)%10==0?"00":"formatError"},cc=function(e){if(e>9){var t=e+"";n1=1*t.substring(0,1),n2=1*t.substring(1,2),e=n1+n2}return e},$(document).ready(function(){$$(document).on("touchstart touchmove touchcancel touchend",".branch-pager",branchObj._pageTouch),isMobile.Android()||isMobile.iOS()||(window.onbeforeunload=function(){indexObj._dataStorage(branchObj.storage.imagePath,null)})}),$$(document).on("pageInit",function(e){var t=e.detail.page;switch(nowPage=t.name,browser_width>992&&$(".page-content").niceScroll({cursorcolor:"rgba(100,100,100,.9)",cursoropacitymin:0,cursorborder:"1px solid #000",scrollspeed:20}),"branch-info-edit"!==t.name&&indexObj._dataStorage(branchObj.storage.shop_data,null),"add-shopcoupon"!==t.name&&"shopcoupon-edit"!==t.name&&indexObj._dataStorage(branchObj.storage.commodity_data,null),"temple-table"!==t.name&&(localStorage.removeItem("nowTab"),indexObj._dataStorage("createblessreport",null),indexObj._dataStorage("createblesslightreport",null)),"add-relatives"===t.name||"relatives-list"===t.name||"temple-info"===t.name||"pay-info"===t.name||indexObj._dataStorage(branchObj.storage.save_data,null),"map"!==nowPage&&indexObj._dataStorage("shop_list",null),"shopcoupon-info"!==nowPage&&localStorage.removeItem("pageInit"),"branch-main"!==nowPage&&indexObj._dataStorage("reservationinfo",null),"branch-reservation-record"!==nowPage&&indexObj._dataStorage("reservationpaused_list",null),t.name){case"shop-salesoverview":branchObj.shopsalesoverview(t);break;case"shop-menu":indexObj.shopMenuInit(t);break;case"coupon-record":indexObj.couponRecordInit(t),userAvatarInit();break;case"branch-main":branchObj.branchMainInit(t),userAvatarInit();break;case"branch-info-edit":branchObj.branchInfoEditInit(t),$(".navbar .left").click(function(){indexObj._dataStorage(branchObj.storage.imagePath,null)});break;case"branch-cooperative":indexObj._dataStorage("shop_item",null),indexObj._dataStorage(branchObj.storage.search_result)||branchObj.branchCooperativeInit(t),userAvatarInit();break;case"branch-search":branchObj.branchSearchInit(t);break;case"branch-info":localStorage.setItem("pageInit","false"),branchObj.branchInfoInit(t);break;case"branch-binding":branchObj.branchBindingInit(t);break;case"myBranchs":branchObj.myBranchsInit(t),userAvatarInit();break;case"branch-region-search":branchObj.branchRegionSearchInit(t);break;case"shopcoupon-management":branchObj.shopcouponManagementInit(t),userAvatarInit();break;case"questionnaire-management":branchObj.questionnaireManagementInit(t),userAvatarInit();break;case"add-shopcoupon":branchObj.addShopCouponInit(t),$(".navbar .left").click(function(){indexObj._dataStorage(branchObj.storage.imagePath,null)}),isMobile.Android()||isMobile.iOS()||$(".page-content .image-block").niceScroll({cursorcolor:"rgba(100,100,100,.9)",cursoropacitymin:0,cursorborder:"1px solid #000"});break;case"shopcoupon-info":localStorage.setItem("pageInit","false"),branchObj.shopCouponInfoInit(t);break;case"shopcoupon-edit":branchObj.shopCouponEditInit(t),$(".navbar .left").click(function(){indexObj._dataStorage(branchObj.storage.imagePath,null)});break;case"shopcoupon-reservation":branchObj.shopCouponReservationInit(t);break;case"branch-scan-record":branchObj.branchScanRecordInit(t);break;case"branch-reservation-record":branchObj.branchReservationRecordInit(t);break;case"service-record":branchObj.serviceRecordInit(t);break;case"shop-questionnaire":branchObj.shopQuestionnaireInit(t);break;case"shopservice-management":branchObj.shopServiceManagementInit(t),userAvatarInit();break;case"shopservice-setting":branchObj.shopServiceSettingInit(t);break;case"shopservice-edit":branchObj.shopServiceEditInit(t),$(".navbar .left").click(function(){indexObj._dataStorage(branchObj.storage.imagePath,null)});break;case"shopservice-pass":branchObj.shopServicePassInit(t);break;case"shop-record":branchObj.shopRecordInit(t),userAvatarInit();break;case"shopservice-info":branchObj.shopServiceinfoInit(t);break;case"branch-select":branchObj.branchSelectInit(t);break;case"application-shop":branchObj.applicationShopInit(t),userAvatarInit();break;case"application-usedcar":branchObj.applicationUsedcarInit(t);break;case"bonus-management":userAvatarInit(),branchObj.bonusManagementInit(t);break;case"bonus-edit":branchObj.bonusEditInit(t);break;case"bonus-gift":branchObj.bonusGiftInit(t);break;case"bonus-record":userAvatarInit(),branchObj.bonusRecordInit(t);break;case"client-list":userAvatarInit(),branchObj.clientListInit(t);break;case"staff-management":userAvatarInit(),branchObj.staffManagementInit(t);break;case"favorite":userAvatarInit(),branchObj.favoriteInit(t);break;case"message-main":userAvatarInit();break;case"push-record":indexObj._dataStorage(branchObj.storage.imagePath,null),indexObj._dataStorage(branchObj.storage.push_objectfillter,null),indexObj._dataStorage(branchObj.storage.md_id_array,null),branchObj.pushRecordInit(t);break;case"select-member":branchObj.selectMemberInit(t);break;case"search-member":branchObj.searchMemberInit(t);break;case"message-info":branchObj.messageInfoInit(t);break;case"temple-info":branchObj.templeInfoInit(t);break;case"pay-info":branchObj.payInfoInit(t);break;case"pay-success":branchObj.paySuccessInit(t);break;case"relatives-list":branchObj.relativesListInit(t);break;case"add-relatives":branchObj.addRelativesInit(t);break;case"temple-table":branchObj.templeTableInit(t);break;case"map":indexObj._dataStorage(branchObj.storage.search_result,null),branchObj.mapInit(t),userAvatarInit();break;case"shop-records":branchObj.shopRecordsInit(t),userAvatarInit();break;case"pay-setting":branchObj.paySettingInit(t);break;case"order-form-management":order_totalcount=0,branchObj.orderFormManagementInit(t);break;case"coupon-order-forms":localStorage.removeItem("report_img"),branchObj.couponOrderFormsInit(t);break;case"order-forms":localStorage.removeItem("report_img"),branchObj.orderFormsInit(t);break;case"order-form-info":localStorage.removeItem("report_img"),branchObj.orderFormInfoInit(t);break;case"pick-report":branchObj.pickReportInit(t);break;case"shop-logistics":branchObj.shopLogisticsInit(t);break;case"shop-buy-data":localStorage.removeItem("scg_id"),branchObj.shopBuyDataInit(t);break;case"quick-msg-management":branchObj.quickMsgManagementInit(t);break;case"shop-search-result":branchObj.shopSearchResultInit(t);break;case"around-search-result":branchObj.aroundSearchResultInit(t);break;case"appointment-management":branchObj.appointmentManagementInit(t);break;case"no-reply-reservation":branchObj.noReplyReservationInit(t);break;case"shopcoupon-main":userAvatarInit();break;case"settle-accounts":branchObj.settleAccountsInit(t);break;case"settle-accounts-content":branchObj.settleAccountsContentInit(t);break;case"settle-accounts-table":settle_accounts_totalcount=0,branchObj.settleAccountsTableInit(t)}}),$$(document).on("pageAfterBack",function(e){var t=e.detail.page.view.activePage;switch(nowPage=t.name,t.name){case"shop-logistics":branchObj.shopLogisticsInit(t)}});