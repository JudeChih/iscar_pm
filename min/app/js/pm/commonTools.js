var app_version="",scan_from,commonTools={api:{verify_sat:"http://"+stringObj.MEMBER_URL+"/api/vrf/verify_sat",query_salt:"http://"+stringObj.MEMBER_URL+"/api/vrf/query_salt",modify_member_data:"http://"+stringObj.WEB_URL+"/modify_member_data",querymembershopinfo:"http://"+stringObj.WEB_URL+"/shopmanage/querymembershopinfo",userbookmarkrecorver:"http://"+stringObj.WEB_URL+"/account/userbookmarkrecorver",userbookmarkupdate:"http://"+stringObj.WEB_URL+"/account/userbookmarkupdate",shopcouponexec:"http://"+stringObj.API_IP+"/shopcoupon/shopcouponexec"},storage:{businessIsLogin:"businessIsLogin",main:_main,search_result:"search_result",branchData:"branchData",myshopdata:"myshopdata",listtype:"listtype",cate:"cate",shop_item:"shop_item",favorite:"myFavorite"},setParameter:function(o){if("tw"===_region)t={mur:o,modacc:stringObj.shop.moduleaccount,modvrf:CryptoJS.SHA256(stringObj.shop.moduleaccount+stringObj.shop.modulepassword).toString(),redirect_uri:"http://"+stringObj.WEB_URL+"/pm-transform"};else var t={mur:o,modacc:_region+"_"+stringObj.shop.moduleaccount,modvrf:CryptoJS.SHA256(_region+"_"+stringObj.shop.moduleaccount+stringObj.shop.modulepassword).toString(),redirect_uri:"http://"+stringObj.WEB_URL+"/pm-transform"};Cookies.set("parameter",encodeURIComponent(btoa(JSON.stringify(t))))},init:function(){var o=commonTools._dataCookies(commonTools.storage.main)||{};if(void 0===Cookies.get("app_version")&&void 0===o.murId?getMurId(function(o){commonTools.setParameter(o)}):commonTools.setParameter(o.murId),o.sat)commonTools.verify_sat(),md_id=o.mdId;else if(commonTools._dataCookies("branchData",null),md_id="Guest",loginType="",o&&o.murId){var t=o.murId,e=localStorage.getItem("salt_no"),s=localStorage.getItem("salt"),a=localStorage.getItem("listtype"),i=localStorage.getItem("cate"),n=localStorage.getItem("test");if(localStorage.getItem(commonTools.storage.search_result))var r=localStorage.getItem(commonTools.storage.search_result);if(localStorage.getItem("pageInit"))var c=localStorage.getItem("pageInit");localStorage.clear(),commonTools._dataCookies(commonTools.storage.main,{murId:t},"iscarmg.com"),commonTools._dataStorage("salt_no",e),commonTools._dataStorage("salt",s),commonTools._dataStorage("search_result",r),commonTools._dataStorage("listtype",a),commonTools._dataStorage("cate",i),commonTools._dataStorage("pageInit",c),commonTools._dataStorage("test",n)}o.mdId&&commonTools.favoriteUpdate()},jsonUrlDecode:function(o){for(var t in o)"object"==typeof o[t]?this.jsonUrlDecode(o[t]):o[t]=decodeURIComponent(o[t])},jsonUrlEncode:function(o){for(var t in o)"object"==typeof o[t]?this.jsonUrlEncode(o[t]):o[t]=encodeURIComponent(o[t])},_userLogout:function(){var o=commonTools._dataCookies(commonTools.storage.main)||{};Cookies.remove("coupon_scm_id"),Cookies.remove("coupon_md_id"),Cookies.remove("branchData"),window.location="http://"+stringObj.MEMBER_URL+"/logout?parameter="+Cookies.get("parameter")+"&sat="+o.sat},_dataCookies:function(o,t,e){return void 0===t?void 0!==Cookies.get(o)&&JSON.parse(Cookies.get(o)):null===t?(Cookies.remove(o),!0):"object"==typeof t?(void 0===e?Cookies.set(o,JSON.stringify(t)):Cookies.set(o,JSON.stringify(t),{domain:e}),!0):"string"==typeof t&&(void 0===e?Cookies.set(o,t):Cookies.set(o,t,{domain:e}),!0)},_dataStorage:function(o,t){return void 0===t?JSON.parse(localStorage.getItem(o)):null===t?(localStorage.removeItem(o),!0):"object"==typeof t?(localStorage.setItem(o,JSON.stringify(t)),!0):"string"==typeof t&&(localStorage.setItem(o,t),!0)},_wcfget:function(o){var t=o.url,e=JSON.stringify(JSON.stringify(o.para));$.ajax({contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",url:t,data:e,success:function(t){o.success&&o.success(t)},error:function(t){o.error&&o.error(t)},complete:function(t){o.finish&&o.finish(t)},beforeSend:function(t){o.progress&&o.progress(t)}})},modify_member_data:function(o){var t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:o.sat,md_id:o.mdId,md_cname:o.md_cname,md_picturepath:o.md_picturepath,md_logintype:o.loginType,md_clienttype:o.md_clienttype,md_clubjoinstatus:o.md_clubjoinstatus,md_city:o.md_city,rl_city_code:o.rl_city_code,rl_zip:o.rl_zip,md_country:o.md_country,md_birthday:o.md_birthday,md_fbgender:o.md_fbgender};showIndicator(),commonTools._wcfget({url:commonTools.api.modify_member_data,para:t,success:function(o){commonTools.jsonUrlDecode(o),o.modify_member_dataresult&&("000000000"===JSON.parse(JSON.stringify(o.modify_member_dataresult)).message_no||_tip&&(_tip=null)),hideIndicator()},error:function(o){hideIndicator()}})},querymembershopinfo:function(){var o=commonTools._dataCookies(commonTools.storage.main)||{},t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:o.sat};showIndicator(),commonTools._wcfget({url:commonTools.api.querymembershopinfo,para:t,success:function(o){if(commonTools.jsonUrlDecode(o),o.querymembershopinforesult){var t=JSON.parse(JSON.stringify(o.querymembershopinforesult));"000000000"===t.message_no?(commonTools._dataStorage(commonTools.storage.myshopdata,t.shopdata_array),commonTools.init()):(commonTools.init(),_tip&&(_tip=null))}hideIndicator()},error:function(o){hideIndicator()}})},query_salt:function(o,t){var e={modacc:o};showIndicator(),commonTools._wcfget({url:commonTools.api.query_salt,para:e,success:function(e){if(commonTools.jsonUrlDecode(e),e.query_saltresult){var s=JSON.parse(JSON.stringify(e.query_saltresult));if("000000000"===s.message_no){var a=atob(decodeURIComponent(s.salt)),i=a.substring(0,a.indexOf("_")),n=a.substring(a.indexOf("_")+1);Cookies.set("salt_no",i),Cookies.set("salt",n),Cookies.set("modvrf",encodeURIComponent(btoa(i+"_"+CryptoJS.SHA256(o+t+n)))),commonTools._dataStorage("salt_no",i),commonTools._dataStorage("salt",n),loginInit(function(o){o.mdId?(commonTools.modify_member_data(o),"1"===o.md_clienttype?commonTools.querymembershopinfo():commonTools.init()):(hideIndicator(),commonTools.init())})}else _tip&&(_tip=null)}hideIndicator()},error:function(o){hideIndicator()}})},verify_sat:function(){var o=commonTools._dataCookies(commonTools.storage.main)||{},t={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:o.sat};showIndicator(),commonTools._wcfget({url:commonTools.api.verify_sat,para:t,success:function(o){if(commonTools.jsonUrlDecode(o),o.verify_satresult)if("010110001"===JSON.parse(JSON.stringify(o.verify_satresult)).message_no){var t=commonTools._dataCookies(commonTools.storage.main)||{};location.search}else{if(commonTools._dataStorage(commonTools.storage.branchData,null),commonTools._dataStorage(commonTools.storage.favorite,null),commonTools._dataStorage(commonTools.storage.mailList,null),commonTools._dataStorage(commonTools.storage.couponRecord,null),commonTools._dataStorage(commonTools.storage.shopCouponRecord,null),commonTools._dataStorage(commonTools.storage.shopServiceRecord,null),Cookies.set("shoplist",0),loginType="",(t=commonTools._dataCookies(commonTools.storage.main)||{})&&t.murId){if("0"===t.loginType)t.sso_token;commonTools._dataCookies(commonTools.storage.main,{murId:t.murId},"iscarmg.com")}if(_tip&&(_tip=null),"branch-cooperative"==$(".view.view-main").prop("id"))for(var e=0;e<$(".favorite").length;e++)$(".favorite img").eq(e).prop("src","../app/image/unsubscribe.png");userAvatarInit()}hideIndicator()},error:function(o){hideIndicator()}})},favoriteUpdate:function(){var o={lastupdate:"",newsList:[],couponList:[],branchList:[],shopcouponList:[]},t=commonTools._dataCookies(commonTools.storage.main)||{},e={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:t.sat,lastupdate:""};showIndicator(),commonTools._wcfget({url:commonTools.api.userbookmarkrecorver,para:e,success:function(t){if(commonTools.jsonUrlDecode(t),t.userbookmarkrecorverresult){var e=JSON.parse(JSON.stringify(t.userbookmarkrecorverresult));if("000000000"===e.message_no){var s=JSON.stringify(o);for(var a in e.userbookmark)if(s.match(e.userbookmark[a].ubm_objectid)){findAndRemove(o.newsList,"ubm_objectid",e.userbookmark[a].ubm_objectid),findAndRemove(o.couponList,"ubm_objectid",e.userbookmark[a].ubm_objectid),findAndRemove(o.branchList,"ubm_objectid",e.userbookmark[a].ubm_objectid),findAndRemove(o.shopcouponList,"ubm_objectid",e.userbookmark[a].ubm_objectid);var i={};i.ubm_objectid=e.userbookmark[a].ubm_objectid,e.userbookmark[a].ubm_picpath?i.ubm_picpath=stringObj.text.branch_img_path+e.userbookmark[a].ubm_picpath:i.ubm_picpath="../app/image/imgDefault.png",i.ubm_title=e.userbookmark[a].ubm_title,i.create_date=e.userbookmark[a].create_date.substring(0,10),i.isflag=e.userbookmark[a].isflag,i.date=new Date(e.userbookmark[a].create_date)/864e5,"0"===e.userbookmark[a].ubm_objecttype&&"1"===e.userbookmark[a].isflag?o.newsList.push(i):"1"===e.userbookmark[a].ubm_objecttype&&"1"===e.userbookmark[a].isflag?o.couponList.push(i):"2"===e.userbookmark[a].ubm_objecttype&&"1"===e.userbookmark[a].isflag?o.branchList.push(i):"3"===e.userbookmark[a].ubm_objecttype&&"1"===e.userbookmark[a].isflag&&o.shopcouponList.push(i)}else{var n={};n.ubm_objectid=e.userbookmark[a].ubm_objectid,e.userbookmark[a].ubm_picpath?n.ubm_picpath=stringObj.text.branch_img_path+e.userbookmark[a].ubm_picpath:n.ubm_picpath="../app/image/imgDefault.png",n.ubm_title=e.userbookmark[a].ubm_title,n.create_date=e.userbookmark[a].create_date.substring(0,10),n.isflag=e.userbookmark[a].isflag,n.date=new Date(e.userbookmark[a].create_date)/864e5,"0"===e.userbookmark[a].ubm_objecttype&&"1"===e.userbookmark[a].isflag?o.newsList.push(n):"1"===e.userbookmark[a].ubm_objecttype&&"1"===e.userbookmark[a].isflag?o.couponList.push(n):"2"===e.userbookmark[a].ubm_objecttype&&"1"===e.userbookmark[a].isflag?o.branchList.push(n):"3"===e.userbookmark[a].ubm_objecttype&&"1"===e.userbookmark[a].isflag&&o.shopcouponList.push(n)}if(o.lastupdate=e.lastupdate,o.branchList.sort(sortByProperty("date",-1)),o.shopcouponList.sort(sortByProperty("date",-1)),commonTools._dataStorage(commonTools.storage.favorite,o),"branch-cooperative"==$(".view.view-main").prop("id")){if(o)for(var a in o.branchList)$(".favorite-"+o.branchList[a].ubm_objectid).html('<img src="../app/image/subscribe.png" />')}else if("shopcoupon-info"==$(".view.view-main").prop("id")&&o)for(var a in o.shopcouponList)$(".favorite-"+o.shopcouponList[a].ubm_objectid).html('<i class="fa fa-star"></i>')}else _tip&&(_tip=null)}hideIndicator()},error:function(o){hideIndicator()}})},shopcouponexec:function(o,t,e,s){var a=commonTools._dataCookies(commonTools.storage.main)||{},i=commonTools._dataStorage(commonTools.storage.branchData);showIndicator(),commonTools._wcfget({url:commonTools.api.shopcouponexec,para:{modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:a.sat,sd_id:i.sd_id,scm_id:o,scg_id:t,coupon_operation:"1"},success:function(o){if(commonTools.jsonUrlDecode(o),o.shopcouponexecresult){var t=JSON.parse(JSON.stringify(o.shopcouponexecresult));"010911000"===t.message_no?""===t.scm_balanceno?(commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.serving_success,buttons:[{text:stringObj.text.confirm,onClick:function(){removeSomething(),location.href="/Shop#!/shop/branch-main"}}]}),hideIndicator()):(code39(t.scm_balanceno),hideIndicator()):(stringObj.return_header(t.message_no),_tip&&(commonTools.setPopBox({title:stringObj.text.warn,text:_tip,buttons:[{text:stringObj.text.confirm,onClick:function(){removeSomething()}}]}),_tip=null,hideIndicator()))}},error:function(o){hideIndicator()}})},backToPrePage:function(){-1!=window.location.href.match("Welcome")?window.location="/pm":Cookies.get("back")||window.location.hostname!=document.referrer.split("/")[2]||void 0==document.referrer.split("/")[2]?(Cookies.remove("back"),window.location="/pm"):history.back()},setPopBox:function(o){var t=o.buttons.length,e="",s="";o.button_class&&(s=o.button_class),$("body").append('<div class="modal modal-in pop_box" style="display: block;margin-top: -63px;"></div>'),$(".pop_box").append('<div class="modal-inner"></div>'),$(".pop_box .modal-inner").append(function(){return'<div class="modal-title">'+o.title+"</div>"+('<div class="modal-text">'+o.text+"</div>")}),$(".pop_box").append('<div class="modal-buttons modal-buttons-'+t+" "+s+'"></div>'),$(".pop_box .modal-buttons").append(function(){for(var s=0;s<t;s++)e=e+'<span class="modal-button">'+o.buttons[s].text+"</span>";return e});for(var a=0;a<t;a++)$(".pop_box .modal-button").eq(a).on("click",o.buttons[a].onClick);$("body").append('<div class="modal-overlay modal-overlay-visible"></div>'),$(".views").addClass("blur")},decodefunction:function(o){JSON.stringify(o,function(){return"function"==typeof o?"/Function("+o.toString()+")/":json})},encodefunction:function(json){JSON.parse(json,function(){return"string"==typeof json&&json.startsWith("/Function(")&&json.endsWith(")/")?(json=json.substring(10,json.length-2),eval("("+json+")")):json})},scan:function(o){scan_from=o,(commonTools._dataCookies(commonTools.storage.main)||{}).sat?webview.scan():commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.notLogin,buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}},{text:stringObj.text.confirm,onClick:function(){removeSomething(),webview.loginPage()}}]})}};scanMsg=function(o){if(o.match("member_card_id"))switch(scan_from){case"branch":e=JSON.parse(o);mainView.router.load({url:"shop/bonus-gift?md_id="+e.member_card_id,reload:!0});break;case"business":var t=(e=JSON.parse(o)).member_card_id;window.location.href="/Shop#!/branch-binding?md_id="+t;break;case"add-staff":var e=JSON.parse(o);branchObj.querymemberidinfo(e.member_card_id)}else"report"===scan_from||o.match("scg_id")||o.match("ssqd_id")||o.match("cdm_id")||commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.scan_msg_error,buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}}]})},logout=function(){commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.logoutCheck,buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}},{text:stringObj.text.confirm,onClick:function(){removeSomething(),commonTools._userLogout()}}]})},ipLocation=function(){$.getJSON("http://ip-api.com/json/?callback=?",function(o){nowLocation(o.lon,o.lat)})},nowLocation=function(o,t){var e=commonTools._dataStorage("page_from")||"";if(void 0===o||0===o||""===o)commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.shop.no_GPS,buttons:[{text:stringObj.text.default_setting,onClick:function(){if(removeSomething(),"map"==e)Cookies.set("sd_lat",stringObj.text.default_lat),Cookies.set("sd_lng",stringObj.text.default_lng),window.location.href="/Shop#!/map";else if("around_search"==e){var o={};o.spm_serno=2,o.sd_lat=stringObj.text.default_lat,o.sd_lng=stringObj.text.default_lng,o.sd_shopname="",o.sd_country="",commonTools._dataStorage(commonTools.storage.search_result,o),window.location.href="/Shop#!/around-search-result?from=around_search"}}},{text:stringObj.text.go_setting,onClick:function(){removeSomething(),webview.openSettingGPS()}},{text:stringObj.text.cancel,onClick:function(){removeSomething()}}],button_class:"modal-buttons-vertical"});else if("around_search"==e){var s={};s.spm_serno=2,s.sd_lat=t||"",s.sd_lng=o||"",s.sd_shopname="",s.sd_country="",commonTools._dataStorage(commonTools.storage.search_result,s),window.location.href="/Shop#!/around-search-result?from=around_search"}},addFavorite=function(o,t,e,s,a,i,n){showIndicator(),commonTools.jsonUrlDecode(e);var r=commonTools._dataCookies(commonTools.storage.main)||{};if($(".favorite-"+o).removeClass("expandOpen"),void 0!==r.sat){var c,m=commonTools._dataStorage(commonTools.storage.favorite)||{lastupdate:"",newsList:[],couponList:[],branchList:[],shopcouponList:[]};switch(n){case"0":c=JSON.stringify(m.newsList);break;case"1":c=JSON.stringify(m.couponList);break;case"2":c=JSON.stringify(m.branchList);break;case"3":c=JSON.stringify(m.shopcouponList)}if(c.match(o)){$(".favorite-"+o).removeClass("expandOpen");var l=commonTools._dataCookies(commonTools.storage.main)||{},d={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:l.sat,useroperate:"1",ubm_objecttype:n,ubm_objectid:o};commonTools._wcfget({url:commonTools.api.userbookmarkupdate,para:d,success:function(t){if(t.userbookmarkupdateresult){var e=JSON.parse(JSON.stringify(t.userbookmarkupdateresult));"000000000"===e.message_no?("0"===n?findAndRemove(m.newsList,"ubm_objectid",o):"1"===n?findAndRemove(m.couponList,"ubm_objectid",o):"2"===n?findAndRemove(m.branchList,"ubm_objectid",o):"3"===n&&findAndRemove(m.shopcouponList,"ubm_objectid",o),"branch-cooperative"==$(".view.view-main").prop("id")||"branch-info"==$(".view.view-main").prop("id")?($(".favorite-"+o).addClass("expandOpen"),$(".favorite-"+o).html('<img src="../app/image/unsubscribe.png" onerror=\'this.src="../app/image/imgDefault.png"\' />')):($(".favorite-"+o).addClass("expandOpen"),$(".favorite-"+o).html('<i class="fa fa-star-o"></i>')),commonTools._dataStorage(commonTools.storage.favorite,m),"0"===n||"1"===n||"2"===n&&commonTools.setPopBox({title:stringObj.text.cancel_subscription,text:stringObj.text.nowCoin+"："+e.gpmr_point,buttons:[{text:stringObj.text.confirm,onClick:function(){removeSomething()}}]}),hideIndicator()):(_tip&&(_tip=null),hideIndicator())}},error:function(o){hideIndicator()}})}else switch(n){case"2":commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.shop.iscarpolicy,buttons:[{text:stringObj.text.refuse,onClick:function(){removeSomething()}},{text:stringObj.text.agree,onClick:function(){removeSomething(),addBookmarks(o,t,e,s,a,i,n)}}]}),$(".modal .query_iscarpolicy").unbind("click"),$(".modal .query_iscarpolicy").click(function(){var o='<div class="popup popup-iscarpolicy" style="display: block;"><div class="close-btn"><a href="#" class="close-popup"><i class="fa fa-times" aria-hidden="true"></i></a></div><div class="content-block"><div class="title">『就是行』汽車特店會員服務條款</div><div class="iscarpolicy-content"><div class="main_content_text">'+stringObj.shop_service_contract+"</div></div></div></div>";$("body").append(o),$(".popup.popup-iscarpolicy").addClass("modal-in"),$(".views").addClass("blur"),$("body").append('<div class="popup-overlay modal-overlay-visible"></div>'),$(".popup-iscarpolicy").css("z-index","91000"),$(".popup-iscarpolicy .close-btn").on("click",function(){$(".popup.popup-iscarpolicy").addClass("modal-out",function(){$(".popup.popup-iscarpolicy").removeClass("modal-in",function(){$(".popup.popup-iscarpolicy").remove()})}),$(".popup-overlay.modal-overlay-visible").remove(),$(".views").removeClass("blur")})}),hideIndicator();break;default:addBookmarks(o,t,e,s,a,i,n)}}else commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.notLogin,buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}},{text:stringObj.text.login,onClick:function(){removeSomething(),webview.loginPage(),Cookies.set("returnUrl",location.href)}}]}),hideIndicator()},showIndicator=function(){$("body").append('<div class="pm_indicator"><span style="width:42px; height:42px" class="preloader preloader-white"></span></div><div class="modal-overlay modal-overlay-visible pm_overlay"></div>')},hideIndicator=function(){$(".pm_indicator").remove(),$(".pm_overlay").remove()},code39=function(o){" "!=o&&($("body").append('<div class="modal modal-in" style="display: block;margin-top: -150px;"><div class="modal-inner"><div class="modal-title">'+stringObj.text.warn+'</div><div class="modal-text"><div class="member-block"><div class="code39-title">'+stringObj.text.code39_title+'</div><br><div class="barcode39" style="width:200px; height:80px; margin: 0% auto;">'+o+"</div><p>"+o+'</p></div></div></div><div class="modal-buttons modal-buttons-1 "><span class="modal-button confirm">'+stringObj.text.confirm+'</span></div></div><div class="modal-overlay modal-overlay-visible"></div>'),$(".views").addClass("blur"),$(".confirm").on("click",function(){$(".modal.modal-in").remove(),$(".modal-overlay.modal-overlay-visible").remove(),$(".views").removeClass("blur"),location.href="/Shop#!/shop/branch-main"}),$(".barcode39").barcode({code:"code39"}))},setScrollBar=function(){"branch_cooperative"==$(".view.view-main").prop("id")&&$(".content").niceScroll({cursorcolor:"rgba(100,100,100,.9)",cursoropacitymin:0,cursorborder:"1px solid #000",scrollspeed:10,mousescrollstep:60}),$(".page-content").niceScroll({cursorcolor:"rgba(100,100,100,.9)",cursoropacitymin:0,cursorborder:"1px solid #000",scrollspeed:10,mousescrollstep:60})},addBookmarks=function(o,t,e,s,a,i,n){showIndicator();var r=commonTools._dataCookies(commonTools.storage.main)||{},c={modacc:stringObj.shop.moduleaccount,modvrf:Cookies.get("modvrf"),sat:r.sat,useroperate:"0",ubm_objecttype:n,ubm_objectid:o};commonTools._wcfget({url:commonTools.api.userbookmarkupdate,para:c,success:function(r){if(r.userbookmarkupdateresult){var c=JSON.parse(JSON.stringify(r.userbookmarkupdateresult));if("000000000"===c.message_no||"011601002"===c.message_no){"branch-cooperative"==$(".view.view-main").prop("id")||"branch-info"==$(".view.view-main").prop("id")?($(".favorite-"+o).addClass("expandOpen"),$(".favorite-"+o).html('<img src="../app/image/subscribe.png" onerror=\'this.src="../app/image/imgDefault.png"\' />')):($(".favorite-"+o).addClass("expandOpen"),$(".favorite-"+o).html('<i class="fa fa-star"></i>'));var m=commonTools._dataStorage(commonTools.storage.favorite)||{lastupdate:"",newsList:[],couponList:[],branchList:[],shopcouponList:[]},l={};l.ubm_objectid=o,l.ubm_picpath=t,l.ubm_title=e,l.catName=s,l.author=a,l.create_date="3"===n?i:i.substring(0,10),l.isflag="1",l.date=new Date(i)/864e5,"0"===n?m.newsList.push(l):"1"===n?m.couponList.push(l):"2"===n?m.branchList.push(l):"3"===n&&m.shopcouponList.push(l),commonTools._dataStorage(commonTools.storage.favorite,m),"branch-cooperative"==$(".view.view-main").prop("id")||"branch-info"==$(".view.view-main").prop("id")?"000000000"===c.message_no?(commonTools.setPopBox({title:stringObj.text.subscription_success,text:stringObj.text.nowCoin+"："+c.gpmr_point,buttons:[{text:stringObj.text.confirm,onClick:function(){removeSomething()}}]}),hideIndicator()):(stringObj.return_header(c.message_no),_tip&&(commonTools.setPopBox({title:stringObj.text.subscription_success,text:_tip,buttons:[{text:stringObj.text.confirm,onClick:function(){removeSomething()}}]}),_tip=null),hideIndicator()):hideIndicator()}else stringObj.return_header(c.message_no),_tip&&(commonTools.setPopBox({title:stringObj.text.warn,text:_tip,buttons:[{text:stringObj.text.confirm,onClick:function(){removeSomething()}}]}),_tip=null),hideIndicator()}},error:function(o){hideIndicator()}})},findAndRemove=function(o,t,e){o.forEach(function(s,a){s[t]===e&&o.splice(a,1)})},sortByProperty=function(o,t){return function(e,s){return e[o]>s[o]&&1===t?1:e[o]<s[o]&&-1===t?1:e[o]==s[o]?0:-1}},removeSomething=function(){$(".pop_box").remove(),$(".modal-overlay.modal-overlay-visible").remove(),$(".views").removeClass("blur")},$(document).ready(function(){commonTools.query_salt(stringObj.shop.moduleaccount,stringObj.shop.modulepassword)});