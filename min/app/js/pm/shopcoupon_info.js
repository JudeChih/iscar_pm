$(function(){function o(){var o=$(".swiper_num").length,t=$("#sw_width").width();t-=44,$(".swiper_num").each(function(){0==$(this).index()?$(this).css("width","44"):$(this).css("width",t/(o-1))})}function t(){0==$(".lazy").length?($(".lazy_indicator").remove(),$(".lazy_overlay").remove()):$(".lazy").Lazy({bind:"event",delay:0,onFinishedAll:function(){$(".lazy_indicator").remove(),$(".lazy_overlay").remove()},afterLoad:function(o){},onError:function(o){o.prop("src","../app/image/imgDefault.png")}})}function e(){var o=new Swiper(".shopcoupon-imgs",{pagination:".swiper-pagination",paginationClickable:!0,centeredSlides:!0,autoplay:3e3,autoplayDisableOnInteraction:!1,slidesPerView:"auto",loop:!1,loopedSlides:3});o.appendSlide('<div class="swiper-slide shop-item" id="shop-main"><img src="'+stringObj.text.branch_img_path+scm_mainpic+'" onerror=\'this.src="../app/image/imgDefault.png"\'/></div>');for(var t in scm_activepics)o.appendSlide('<div class="swiper-slide shop-item" id="shop-img'+t+'"><img src="'+stringObj.text.branch_img_path+scm_activepics[t]+'" onerror=\'this.src="../app/image/imgDefault.png"\'/></div>');o.slideTo(0,0,!0),o.update()}function s(){var o=new google.maps.LatLng(parseFloat(lat),parseFloat(lng)),t={zoom:15,center:o,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1},e=new google.maps.Map(document.getElementById("shopcoupon-map"),t);n(o,shopname,e)}function n(o,t,e){var i=new google.maps.Marker({position:o,title:t,map:e}),s=new google.maps.InfoWindow;s.setContent('<b style="color:#000;">'+t+"</b>"),s.open(e,i),google.maps.event.addListener(i,"click",function(){s.open(e,i)})}var a=$("input[name=shoppoint]").val();null!=a&&void 0!=a&&commonTools._dataStorage("shoppoint",a);var c,p,r=location.search,l=[];if(-1!=r.indexOf("?"))for(c=r.split("?")[1].split("&"),i=0;i<c.length;i++)p=c[i].split("="),l.push([p[0],p[1]]);var d=commonTools._dataCookies(commonTools.storage.main)||{},m={sd_id:sd_id,scm_id:scm_id,sd_shopname:shopname,scm_reservationtag:scm_reservationtag,scm_producttype:scm_producttype,scm_price:scm_price,scm_title:scm_title,scm_mainpic:scm_mainpic,sd_shoptel:sd_shoptel,scm_enddate:scm_enddate,scm_coupon_providetype:scm_coupon_providetype,scm_bonus_payamount:scm_bonus_payamount,PayGiftpointAsCash:PayGiftpointAsCash};Cookies.get("coupon_md_id")&&Cookies.get("coupon_scm_id")&&scm_id==Cookies.get("coupon_scm_id")&&(m.coupon_scm_id=Cookies.get("coupon_scm_id"),m.coupon_md_id=Cookies.get("coupon_md_id")),commonTools._dataStorage(commonTools.storage.shop_item,m);var _=commonTools._dataStorage(commonTools.storage.favorite)||{lastupdate:"",newsList:[],couponList:[],branchList:[],shopcouponList:[]};JSON.stringify(_.shopcouponList).match(scm_id)&&$(".favorite-"+scm_id).html('<i class="fa fa-star"></i>');var h=$("#shopcoupon_data_title").offset().top;$(".page-content").scroll(function(){h=$("#shopcoupon_data_title").offset().top,$(this).scrollTop()>=h?$(".subnavbar").removeClass("noUse"):($(".subnavbar").addClass("noUse"),$(".shopcoupon-info-left").css("top",0)),($("#data_title_box").offset().top<-1||$("#data_title_box").offset().top>1)&&$("#data_title_box").css("display","none"),($("#shopdata_text_box").offset().top<-1||$("#shopdata_text_box").offset().top>1)&&$("#shopdata_text_box").css("display","none"),($("#other_text_box").offset().top<-1||$("#other_text_box").offset().top>1)&&$("#other_text_box").css("display","none"),($("#detail_title_box").offset().top<-1||$("#detail_title_box").offset().top>1)&&$("#detail_title_box").css("display","none")}),$(".data_title_box").on("click",function(){$("#data_title_box").css("display","block"),location.replace($(this).prop("href"))}),$(".shopdata_text_box").on("click",function(){$("#shopdata_text_box").css("display","block"),0!=$("#shopdata_text_box").offset().top&&$("#shopdata_text_box").css("height",44),location.replace($(this).prop("href"))}),$(".other_text_box").on("click",function(){$("#other_text_box").css("display","block"),0!=$("#other_text_box").offset().top&&$("#other_text_box").css("height",44),location.replace($(this).prop("href"))}),$(".detail_title_box").on("click",function(){$("#detail_title_box").css("display","block"),0!=$("#detail_title_box").offset().top&&$("#detail_title_box").css("height",44),location.replace($(this).prop("href"))}),"scan"===sci_type?($(".serving").css("display","inherit"),$(".favorite").css("display","none"),$(".shopcoupon-subTitle").css("display","none"),$(".branch-info").css("display","none"),$("#shopcoupon-map").css("display","none"),$(".shopcoupon-info-block").css("height","auto"),$("#shopcoupon_other_text").css("display","none"),$(".shopcoupon-other-content").css("display","none"),$("#giftpoint_text").css("display","none"),$(".gift-point").css("display","none")):"shop_available"===sci_type||"shop_finish"==sci_type||"shop_invalid"==sci_type||"reserved"==sci_type||"favorite"==sci_type?"shop_available"===sci_type?$(".showQR").css("display","inherit"):"reserved"==sci_type?$(".reserved").css("display","inherit"):"favorite"===sci_type&&($(".get").css("display","inherit"),$(".cannotget").css("display","inherit")):"management"===sci_type||($(".get").css("display","inherit"),$(".cannotget").css("display","inherit")),$(".shopcoupon-info-left a").on("click",function(){var o="";for(var t in l)"sd_id"==l[t][0]&&(o=l[t][1]);""!=o?window.location="/pm/branch-info?sd_id="+o:commonTools.backToPrePage()}),$(".btn_share").click(function(){commonTools.setPopBox({title:stringObj.text.share,text:'<input class="clone_input" type="text" value="'+url+'"/>',buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}},{text:stringObj.text.copy,onClick:function(){void 0!=Cookies.get("app_version")?(webview.copyText($(".clone_input").val()),removeSomething()):($(".clone_input").select(),document.execCommand("Copy"),removeSomething(),commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.already_copy,buttons:[{text:stringObj.text.confirm,onClick:function(){removeSomething()}}]}))}}]})}),$(".get").click(function(){if(Cookies.remove("createpaymentflow"),d.sat)if(1==scm_coupon_providetype){var o=!0,t=commonTools._dataStorage(commonTools.storage.favorite)||{lastupdate:"",newsList:[],couponList:[],branchList:[],shopcouponList:[]};if(t)for(var e in t.branchList)t.branchList[e].ubm_objectid==sd_id&&(o=!1);o?commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.addNotYet,buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}},{text:stringObj.text.subscription,onClick:function(){removeSomething(),addFavorite(sd_id,stringObj.text.branch_img_path+sd_shopphotopath,shopname,sd_shopaddress,sd_shoptel,"","2")}}]}):parseInt(inventory)>0?(localStorage.setItem("scm_id",scm_id),"1"===scm_reservationtag?window.location="/Shop#!/shop-buy-data?scm_id="+scm_id+"&from=reservation":"1"===scm_producttype?window.location="/Shop#!/shop-buy-data?scm_id="+scm_id+"&from=coupon":"2"===scm_producttype&&(window.location="/Shop#!/shop-buy-data?scm_id="+scm_id+"&from=commodity")):commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.no_inventory,buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}}]})}else parseInt(inventory)>0?(localStorage.setItem("scm_id",scm_id),"1"===scm_reservationtag?window.location="/Shop#!/shop-buy-data?scm_id="+scm_id+"&from=reservation":"1"===scm_producttype?window.location="/Shop#!/shop-buy-data?scm_id="+scm_id+"&from=coupon":"2"===scm_producttype&&(window.location="/Shop#!/shop-buy-data?scm_id="+scm_id+"&from=commodity")):commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.no_inventory,buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}}]});else commonTools.setPopBox({title:stringObj.text.warn,text:stringObj.text.notLogin,buttons:[{text:stringObj.text.cancel,onClick:function(){removeSomething()}},{text:stringObj.text.login,onClick:function(){removeSomething(),webview.loginPage(),Cookies.set("returnUrl",location.href)}}]})}),$(".serving").click(function(){commonTools.shopcouponexec(scm_id,scg_id,scm_title,scm_enddate)}),$(window).load(function(){s(),t(),o(),$(window).width()>=992&&setScrollBar(),e()}),$(window).resize(function(){o()})});